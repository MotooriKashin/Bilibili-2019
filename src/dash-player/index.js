/*!
 * Bilibili Dash Player v1.15.28(355)-6a8c2376
 *
 * Copyright 2018 - 2024 bilibili, Inc.
 * Released in 2024-02-29T07:18:24.725Z
 * 
 * 从B站移植新版本时，须要手动冻结dashjs的MediaPlayer、FactoryMaker、Version三属性以免被页面污染
 * 参考：Object.defineProperties(s,{MediaPlayer:{value:n.a},FactoryMaker:{value:i.a},Version:{value:Object(o.a)()}})
 */
export default (() => {function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==c(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=16)}([function(e,t,r){"use strict";var n=function(){var e=void 0,t=[],r={},n={};function i(e,r){for(var n in t){var i=t[n];if(i.context===e&&i.name===r)return i.instance}return null}function o(e,t){return t[e]}function a(e,t,r){e in r&&(r[e]=t)}function s(t,r,n){var i=void 0,o=t.__dashjs_factory_name,a=r[o];if(a){var s=a.instance;if(!a.override)return s.apply({context:r,factory:e},n);for(var u in i=t.apply({context:r},n),s=s.apply({context:r,factory:e,parent:i},n))i.hasOwnProperty(u)&&(i[u]=s[u])}else i=t.apply({context:r},n);return i.getClassName=function(){return o},i}return e={extend:function(e,t,r,n){!n[e]&&t&&(n[e]={instance:t,override:r})},reset:function(){t.length=0},getSingletonInstance:i,setSingletonInstance:function(e,r,n){for(var i in t){var o=t[i];if(o.context===e&&o.name===r)return void(t[i].instance=n)}t.push({name:r,context:e,instance:n})},getSingletonFactory:function(e){var n=o(e.__dashjs_factory_name,r);return n||(n=function(r){var n=void 0;return void 0===r&&(r={}),{getInstance:function(){return n||(n=i(r,e.__dashjs_factory_name)),n||(n=s(e,r,arguments),t.push({name:e.__dashjs_factory_name,context:r,instance:n})),n}}},r[e.__dashjs_factory_name]=n),n},getSingletonFactoryByName:function(e){return o(e,r)},updateSingletonFactory:function(e,t){a(e,t,r)},getClassFactory:function(e){var t=o(e.__dashjs_factory_name,n);return t||(t=function(t){return void 0===t&&(t={}),{create:function(){return s(e,t,arguments)}}},n[e.__dashjs_factory_name]=t),t},getClassFactoryByName:function(e){return o(e,n)},updateClassFactory:function(e,t){a(e,t,n)}}}();t.a=n},function(e,t,r){var n={parseBuffer:function(e){return new i(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(o.prototype._boxProcessors[e]=t)},createFile:function(){return new i},createBox:function(e,t,r){var n=o.create(e);return t&&t.append(n,r),n},createFullBox:function(e,t,r){var i=n.createBox(e,t,r);return i.version=0,i.flags=0,i},Utils:{}};n.Utils.dataViewToString=function(e,t){var r=t||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(r).decode(e);var n=[],i=0;if("utf-8"===r)for(;i<e.byteLength;){var o=e.getUint8(i++);o<128||(o<224?(o=(31&o)<<6,o|=63&e.getUint8(i++)):o<240?(o=(15&o)<<12,o|=(63&e.getUint8(i++))<<6,o|=63&e.getUint8(i++)):(o=(7&o)<<18,o|=(63&e.getUint8(i++))<<12,o|=(63&e.getUint8(i++))<<6,o|=63&e.getUint8(i++))),n.push(String.fromCharCode(o))}else for(;i<e.byteLength;)n.push(String.fromCharCode(e.getUint8(i++)));return n.join("")},n.Utils.utf8ToByteArray=function(e){var t,r;if("undefined"!=typeof TextEncoder)t=(new TextEncoder).encode(e);else for(t=[],r=0;r<e.length;++r){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?(t.push(192|n>>6),t.push(128|63&n)):n<65536?(t.push(224|n>>12),t.push(128|63&n>>6),t.push(128|63&n)):(t.push(240|n>>18),t.push(128|63&n>>12),t.push(128|63&n>>6),t.push(128|63&n))}return t},n.Utils.appendBox=function(e,t,r){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==r)if(null!=r){var n,i=-1;if("number"==typeof r)i=r;else{if("string"==typeof r)n=r;else{if("object"!=c(r)||!r.type)return void e.boxes.push(t);n=r.type}for(var o=0;o<e.boxes.length;o++)if(n===e.boxes[o].type){i=o+1;break}}e.boxes.splice(i,0,t)}else e.boxes.push(t)},t.parseBuffer=n.parseBuffer,t.addBoxProcessor=n.addBoxProcessor,t.createFile=n.createFile,t.createBox=n.createBox,t.createFullBox=n.createFullBox,t.Utils=n.Utils,n.Cursor=function(e){this.offset=void 0===e?0:e};var i=function(e){this._cursor=new n.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};i.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},i.prototype.fetchAll=function(e,t){var r=[];return i._sweep.call(this,e,r,t),r},
i.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=o.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},i._sweep=function(e,t,r){for(var n in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&r)return;i._sweep.call(this.boxes[n],e,t,r)}},i.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var r=new Uint8Array(t);for(this._rawo=new DataView(r.buffer),this.bytes=r,this._cursor.offset=0,e=0;e<this.boxes.length;e++)this.boxes[e].write();return r.buffer},i.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)};var o=function(){this._cursor=new n.Cursor};o.parse=function(e){var t=new o;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},o.create=function(e){var t=new o;return t.type=e,t.boxes=[],t},o.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],o.prototype._boxProcessors={},o.prototype._procField=function(e,t,r){this._parsing?this[e]=this._readField(t,r):this._writeField(t,r,this[e])},o.prototype._procFieldArray=function(e,t,r,n){var i;if(this._parsing)for(this[e]=[],i=0;i<t;i++)this[e][i]=this._readField(r,n);else for(i=0;i<this[e].length;i++)this._writeField(r,n,this[e][i])},o.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},o.prototype._procEntries=function(e,t,r){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push({}),r.call(this,this[e][n]);else for(n=0;n<t;n++)r.call(this,this[e][n])},o.prototype._procSubEntries=function(e,t,r,n){var i;if(this._parsing)for(e[t]=[],i=0;i<r;i++)e[t].push({}),n.call(this,e[t][i]);else for(i=0;i<r;i++)n.call(this,e[t][i])},o.prototype._procEntryField=function(e,t,r,n){this._parsing?e[t]=this._readField(r,n):this._writeField(r,n,e[t])},o.prototype._procSubBoxes=function(e,t){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e].push(o.parse(this));else for(r=0;r<t;r++)this._rawo?this[e][r].write():this.size+=this[e][r].getLength()},o.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},o.prototype._readInt=function(e){var t=null,r=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(r);break;case 16:t=this._raw.getInt16(r);break;case 32:t=this._raw.getInt32(r);break;case 64:var n=this._raw.getInt32(r),i=this._raw.getInt32(r+4);t=n*Math.pow(2,32)+i}return this._cursor.offset+=e>>3,t},o.prototype._readUint=function(e){var t,r,n=null,i=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:n=this._raw.getUint8(i);break;case 16:n=this._raw.getUint16(i);break;case 24:n=((t=this._raw.getUint16(i))<<8)+(r=this._raw.getUint8(i+2));break;case 32:n=this._raw.getUint32(i);break;case 64:t=this._raw.getUint32(i),r=this._raw.getUint32(i+4),n=t*Math.pow(2,32)+r}return this._cursor.offset+=e>>3,n},o.prototype._readString=function(e){for(var t="",r=0;r<e;r++){var n=this._readUint(8);t+=String.fromCharCode(n)}return t},o.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},o.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},o.prototype._readData=function(e){var t=e>0?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(t>0){var r=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,r}return null},o.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return e>0&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t?n.Utils.dataViewToString(t):t},o.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},o.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},o.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(o.parse(this))},o.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)},o.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),this.size},o.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},o.prototype._writeInt=function(e,t){if(this._rawo){var r=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(r,t);break;case 16:this._rawo.setInt16(r,t);break;case 32:this._rawo.setInt32(r,t);break;case 64:var n=Math.floor(t/Math.pow(2,32)),i=t-n*Math.pow(2,32);this._rawo.setUint32(r,n),this._rawo.setUint32(r+4,i)}this._cursor.offset+=e>>3}else this.size+=e>>3},o.prototype._writeUint=function(e,t){if(this._rawo){var r,n,i=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(i,t);break;case 16:this._rawo.setUint16(i,t);break;case 24:r=(16776960&t)>>8,n=255&t,this._rawo.setUint16(i,r),this._rawo.setUint8(i+2,n);break;case 32:this._rawo.setUint32(i,t);break;case 64:n=t-(r=Math.floor(t/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(i,r),this._rawo.setUint32(i+4,n)}this._cursor.offset+=e>>3}else this.size+=e>>3},o.prototype._writeString=function(e,t){for(var r=0;r<e;r++)this._writeUint(8,t.charCodeAt(r))},o.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},o.prototype._writeTemplate=function(e,t){var r=Math.floor(t),n=(t-r)*Math.pow(2,e/2);this._writeUint(e/2,r),this._writeUint(e/2,n)},
o.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,r=0;r<e.length;r++)this._rawo.setInt8(t+r,e[r]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},o.prototype._writeUTF8String=function(e){var t=n.Utils.utf8ToByteArray(e);if(this._rawo)for(var r=new DataView(this._rawo.buffer,this._cursor.offset,t.length),i=0;i<t.length;i++)r.setUint8(i,t[i]);else this.size+=t.length},o.prototype._writeField=function(e,t,r){switch(e){case"uint":this._writeUint(t,r);break;case"int":this._writeInt(t,r);break;case"template":this._writeTemplate(t,r);break;case"string":-1==t?this._writeTerminatedString(r):this._writeString(t,r);break;case"data":this._writeData(r);break;case"utf8":this._writeUTF8String(r)}},o.prototype._boxProcessors.avc1=o.prototype._boxProcessors.avc2=o.prototype._boxProcessors.avc3=o.prototype._boxProcessors.avc4=o.prototype._boxProcessors.hvc1=o.prototype._boxProcessors.hev1=o.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},o.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},o.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)}))},o.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},o.prototype._boxProcessors.free=o.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},o.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},o.prototype._boxProcessors.ftyp=o.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},o.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},o.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},o.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},o.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},o.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},o.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},o.prototype._boxProcessors.mp4a=o.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},o.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},o.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},o.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},o.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},o.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},o.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,(function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)}))},o.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},o.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,(function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,(function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)}))}))},o.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},o.prototype._boxProcessors.subs=function(){this._procFullBox(),
this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,(function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)}))}))},o.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},o.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},o.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},o.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,(function(e){this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))}))},o.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},o.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},o.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)}))},o.prototype._boxProcessors["url "]=o.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},o.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},o.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},o.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},o.prototype._boxProcessors.vtte=function(){}},function(e,t,r){"use strict";var n,i,o,a,s,u,c,l;Object.defineProperty(t,"__esModule",{value:!0}),t.DISABLE_LOADER_TYPE=t.SPECIAL_AUDIO_TYPE=t.USER_CODEC_PREFER_TYPE=t.FILTER_VIDEO_URL_REASON=t.VIDEO_CODEC_ID=t.VIDEO_QN=t.ERROR_CODE=t.DOLBY_AUDIO_QN=t.DEFAULT_FAWKES_CONFIG=t.FLAC_QN=t.STRING=t.ERROR=t.EVENTS=void 0,t.EVENTS={SCRIPT_LOADED:"scripLoaded",VIDEO_INFO:"videoInfo",WARNING:"warning",AST_IN_FUTURE:"astInFuture",BUFFER_EMPTY:"bufferStalled",BUFFER_LOADED:"bufferLoaded",BUFFER_LEVEL_STATE_CHANGED:"bufferStateChanged",ERROR:"error",FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted",FRAGMENT_LOADING_HEADER_RECEIVED:"fragmentLoadingHeaderReceived",FRAGMENT_LOADING_PROGRESS:"fragmentLoadingProgress",FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",FRAGMENT_LOADING_ABANDONED:"fragmentLoadingAbandoned",FRAGMENT_LOADED_ERROR:"fragmentLoadedError",FRAGMENT_P2P_LOAD_INFO:"fragmentP2pLoadInfo",CDN_LOAD_INFO:"cdnLoadInfo",PCDN_LOADED_ERROR:"pcdnLoadedError",LOG:"log",MANIFEST_LOADED:"manifestLoaded",METRICS_CHANGED:"metricsChanged",METRIC_CHANGED:"metricChanged",METRIC_ADDED:"metricAdded",METRIC_UPDATED:"metricUpdated",PERIOD_SWITCH_COMPLETED:"periodSwitchCompleted",PERIOD_SWITCH_STARTED:"periodSwitchStarted",QUALITY_CHANGE_REQUESTED:"qualityChangeRequested",QUALITY_CHANGE_RENDERED:"qualityChangeRendered",TRACK_CHANGE_RENDERED:"trackChangeRendered",SOURCE_INITIALIZED:"sourceInitialized",STREAM_INITIALIZED:"streamInitialized",STREAM_TEARDOWN_COMPLETE:"streamTeardownComplete",TEXT_TRACKS_ADDED:"allTextTracksAdded",TEXT_TRACK_ADDED:"textTrackAdded",TTML_PARSED:"ttmlParsed",TTML_TO_PARSE:"ttmlToParse",CAN_PLAY:"canPlay",PLAYBACK_ENDED:"playbackEnded",PLAYBACK_ERROR:"playbackError",PLAYBACK_NOT_ALLOWED:"playbackNotAllowed",PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",PLAYBACK_PAUSED:"playbackPaused",PLAYBACK_PLAYING:"playbackPlaying",PLAYBACK_PROGRESS:"playbackProgress",PLAYBACK_RATE_CHANGED:"playbackRateChanged",PLAYBACK_SEEKED:"playbackSeeked",PLAYBACK_SEEKING:"playbackSeeking",PLAYBACK_SEEK_ASKED:"playbackSeekAsked",PLAYBACK_STARTED:"playbackStarted",PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",PLAYBACK_WAITING:"playbackWaiting",MANIFEST_VALIDITY_CHANGED:"manifestValidityChanged",KEY_ADDED:"public_keyAdded",KEY_ERROR:"public_keyError",KEY_MESSAGE:"public_keyMessage",KEY_SESSION_CLOSED:"public_keySessionClosed",KEY_SESSION_CREATED:"public_keySessionCreated",KEY_SESSION_REMOVED:"public_keySessionRemoved",KEY_STATUSES_CHANGED:"public_keyStatusesChanged",KEY_SYSTEM_ACCESS_COMPLETE:"public_keySystemAccessComplete",KEY_SYSTEM_SELECTED:"public_keySystemSelected",LICENSE_REQUEST_COMPLETE:"public_licenseRequestComplete",PROTECTION_CREATED:"public_protectioncreated",PROTECTION_DESTROYED:"public_protectiondestroyed",DELAY_TO_APPEND_TO_BUFFER:"delayToAppendBuffer",QUALITY_CHANGE_DOWNLOADED:"qualityChangeDownloaded",QUOTA_EXCEEDED:"quotaExceeded",GET_NEXT_FRAGMENT:"getNextFragment",APPENDING_NEXT_SOURCE:"appendingNextSource",APPENDED_NEXT_SOURCE:"appendedNextSource",APPENDED_NEXT_SOURCE_DURATION_CHANGED:"appendedNextSourceDurationChanged",START_OFFSET_TIME_WARNING:"startOffsetTimeWarning",BUFFERING_OPTIMIZATION:"buffering_optimization",QUALITY_CHANGE_ABNORMAL:"qualityChangeAbnormal",SWITCH_AUDIO_TRACK_REQUEST:"switchAudioTrackRequest",SWITCH_AUDIO_TRACK_RENDERED:"switchAudioTrackRendered",REQUEST_RETRYED:"requestRetryed",PREDICT_SEEK:"predictSeek",JUMP_MEDIA_GAP:"jumpMediaGap"},t.ERROR={INTERNAL_ERROR:-1,DURATION_IS_NOT_ALL_EQUAL:-2,DURATION_DEVIATION_IS_TOO_LARGE:-3,START_OFFSET_TIME_WARNING:-4,DOWNLOAD_ERROR:4,DOWNLOAD_MPD_ERROR:4001,DOWNLOAD_XINK_ERROR:4002,DOWNLOAD_INIT_SEGMENT_ERROR:4003,DOWNLOAD_MEDIA_SEGMENT_ERROR:4004,DOWNLOAD_INDEX_SEGMENT_ERROR:4005,DOWNLOAD_SWITCHING_SEGMENT_ERROR:4006,DOWNLOAD_OTHER_ERROR:4007,DOWNLOAD_FRAGMENT_ERROR:4101,
DOWNLOAD_FRAGMENT_ERROR_RETRY_SUCCESS:4102,DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE:4103,DOWNLOAD_FRAGMENT_ERROR_TIMEOUT:4105,CONNECT_FRAGMENT_ERROR_TIMEOUT:4106,CONNECT_FRAGMENT_ERROR_OFFLINE:4107,MANIFEST_ERROR:5,MANIFEST_TYPE_ERROR:5001,MANIFEST_RESOLVE_ERROR:5002,MEDIA_ERROR:6,MEDIA_ABORTED_ERROR:6001,MEDIA_NETWORK_ERROR:6002,MEDIA_DECODE_ERROR:6003,MEDIA_SUPPORTED_ERROR:6004,MEDIA_ENCRYPTED_ERROR:6005,MEDIA_UNKNOWN_ERROR:6e3},t.STRING={VIDEO:"video",AUDIO:"audio",LOG:"log",WARNING:"warning",ERROR:"error",ABR_DYNAMIC:"abrDynamic",ABR_BOLA:"abrBola",ABR_THROUGHPUT:"abrThroughput",SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME:"bilidp-switch-source-transition-canvas",DASH_CONFIG:"dash_config",PDN_ENABLE:"pdn_enable",BILIBILI_DECODE_ERROR_OBJ:"bilibili_decode_error_obj"},t.FLAC_QN=30251,t.DEFAULT_FAWKES_CONFIG={dash_config:{pdn_disable_qn_list:"[120, 125, 126, 127]",pdn_disable_codecid_list:"[13]",pdn_enable:"1",pdn_mid_black_list:"[]",nc_disable:"0",p2p_disable:"0",rp_disable:"0",wasm_off_list:"[]"},common_policy:{},data_policy:{},gray_policy:{},monitor:{},nc_box_policy:{},nc_new_push_policy:{},nc_policy:{},nc_sdk_policy:{},nc_tracker_policy:{},player_policy:{},reward_pcdn_loader_policy:{},reward_seeder_policy:{},self_test_policy:{},top_list_service_policy:{}},function(e){e[e.AUDIO=30255]="AUDIO",e[e.AMTOS=30250]="AMTOS"}(n||(n={})),t.DOLBY_AUDIO_QN=n,function(e){e[e.SET_QUALITY_ERR=2e4]="SET_QUALITY_ERR",e[e.SET_QUALITY_VALUE_ERR=20001]="SET_QUALITY_VALUE_ERR",e[e.SET_QUALITY_TYPE_ERR=20002]="SET_QUALITY_TYPE_ERR",e[e.SET_QUALITY_APENDING_ERR=20003]="SET_QUALITY_APENDING_ERR",e[e.SET_QUALITY_SAME_VALUE=20004]="SET_QUALITY_SAME_VALUE",e[e.SET_QUALITY_TIME_OUT=20005]="SET_QUALITY_TIME_OUT",e[e.SET_QUALITY_RENDER_CHANGED=20006]="SET_QUALITY_RENDER_CHANGED",e[e.SET_QUALITY_MULTI_TRACK=20007]="SET_QUALITY_MULTI_TRACK",e[e.SET_QUALITY_ABR=20008]="SET_QUALITY_ABR",e[e.SWITCH_AUDIO_TRACK_ERR=3e4]="SWITCH_AUDIO_TRACK_ERR",e[e.SWITCH_AUDIO_TRACK_NOT_SUPPORT=30001]="SWITCH_AUDIO_TRACK_NOT_SUPPORT",e[e.SWITCH_AUDIO_TRACK_ID_NOT_CHANGED=30002]="SWITCH_AUDIO_TRACK_ID_NOT_CHANGED",e[e.SWITCH_AUDIO_TRACK_ID_NOT_EXIST=30003]="SWITCH_AUDIO_TRACK_ID_NOT_EXIST",e[e.SWITCH_SOURCE_ERR=4e4]="SWITCH_SOURCE_ERR",e[e.SWITCH_SOURCE_ABORT=40001]="SWITCH_SOURCE_ABORT",e[e.SWITCH_SOURCE_FAILED=40002]="SWITCH_SOURCE_FAILED",e[e.SWITCH_SOURCE_TIMEOUT=40003]="SWITCH_SOURCE_TIMEOUT"}(i||(i={})),t.ERROR_CODE=i,function(e){e[e.QN_8K=127]="QN_8K",e[e.QN_DOLBY_VISION=126]="QN_DOLBY_VISION",e[e.QN_HDR10=125]="QN_HDR10",e[e.QN_4K=120]="QN_4K",e[e.QN_1080P_60=116]="QN_1080P_60",e[e.QN_1080P_PLUS=112]="QN_1080P_PLUS",e[e.QN_1080P=80]="QN_1080P",e[e.QN_720P_60=74]="QN_720P_60",e[e.QN_720P=64]="QN_720P",e[e.QN_480P=32]="QN_480P",e[e.QN_360P=16]="QN_360P"}(o||(o={})),t.VIDEO_QN=o,function(e){e[e.AVC=7]="AVC",e[e.HEVC=12]="HEVC",e[e.AV1=13]="AV1"}(a||(a={})),t.VIDEO_CODEC_ID=a,function(e){e.USE_HEVC_INSTEADOF_AVC="USE_HEVC_INSTEADOF_AVC",e.FILTER_SPECIAL_VIDEO="FILTER_SPECIAL_VIDEO"}(s||(s={})),t.FILTER_VIDEO_URL_REASON=s,function(e){e[e.RECOMMEND=0]="RECOMMEND",e[e.HEVC=1]="HEVC",e[e.DISABLE=2]="DISABLE",e[e.AV1=3]="AV1"}(u||(u={})),t.USER_CODEC_PREFER_TYPE=u,function(e){e.DOLBY="dolby",e.FLAC="flac"}(c||(c={})),t.SPECIAL_AUDIO_TYPE=c,function(e){e[e.NONE=0]="NONE",e[e.DISABLE_NC=1]="DISABLE_NC",e[e.DISABLE_RP=2]="DISABLE_RP"}(l||(l={})),t.DISABLE_LOADER_TYPE=l},function(e,t,r){"use strict";var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.prototype.extend=function(e,t){if(e){var r=!!t&&t.override,n=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!r||n&&-1===e[i].indexOf("public_")||(this[i]=e[i])}},e}();t.a=n},function(e,t,r){"use strict";var n=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var i,o,a=function(){function e(){}return e.getLocalStorage=function(e){var t="";try{t=window.localStorage.getItem(e)}catch(e){}return t},e.setLocalStorage=function(e,t){try{window.localStorage.setItem(e,t)}catch(e){}},e.removeStorage=function(e){try{window.localStorage.removeItem(e)}catch(e){}},e.getSessionStorage=function(e){var t="";try{t=window.sessionStorage.getItem(e)}catch(e){}return t},e.setSessionStorage=function(e,t){try{window.sessionStorage.setItem(e,t)}catch(e){}},e.toFixed=function(e,t){return void 0===t&&(t=2),parseFloat(null==e?void 0:e.toFixed(t))},e.atob=function(e){try{return window.atob(e)}catch(e){return null}},e.switchFawkesConfig=function(e){var t={};for(var r in e)if(RegExp(String.raw(i||(i=n(["^(.+).(.+)$"],["^(.+)\\.(.+)$"])))).test(r)){var a=r.match(RegExp(String.raw(o||(o=n(["^(.+).(.+)$"],["^(.+)\\.(.+)$"]))))),s=a[1],u=a[2];t[s]||(t[s]={}),t[s][u]=this.atob(e[r])}return t},e.getCookie=function(t){try{if(e.cookie)return e.cookie[t]||"";if(!document.cookie||""===document.cookie)return"";e.cookie={};for(var r=document.cookie.split(";"),n=0;n<r.length;n++){var i=r[n].split("="),o=i[0].trim(),a=i[1].trim();e.cookie[o]=a}return e.cookie[t]||""}catch(e){return""}},e.saveDecodeErrorMediaQualityNumber=function(e,t,r){try{var n=null;if(!(sessionStorage&&sessionStorage.setItem&&sessionStorage.getItem&&sessionStorage.removeItem))throw new Error("");var i=sessionStorage.getItem(r);null!==i&&""!==i?(n=JSON.parse(i))[e]&&Array.isArray(n[e])?!n[e].includes(t)&&n[e].push(t):(n[e]=[],n[e].push(t)):(n={audio:[],video:[]})[e].push(t),n&&sessionStorage.setItem(r,JSON.stringify(n))}catch(e){console.error(e)}},e.getDecodeErrorMediaQualityNumberListForType=function(e,t){try{if(sessionStorage&&sessionStorage.getItem){var r=sessionStorage.getItem(t);if(void 0!==r&&""!==r){var n=JSON.parse(r);return n[e]&&Array.isArray(n[e])?n[e]:[]}return[]}}catch(e){return[]}},e.isInSpareTime=function(){var e=(new Date).getHours();return![12,13,20,21].includes(e)},e.cookie=null,e}();t.default=a},function(e,t,r){"use strict";function n(){return"2.7.0"}r.d(t,"a",(function(){return n}))},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BROWSER_TYPE=t.getGPUInfo=t.getCurrentBrowserInfo=t.getFireFoxInfo=t.getEdgeInfo=t.getSafariInfo=void 0;var i,o=n(r(4));!function(e){e.Chrome="Chrome",e.ChromiumEdge="Edge",e.LegacyEdge="LegacyEdge",e.Firefox="FireFox",e.Safari="Safari",e.QQ="QQ",e.Sogou="Sogou",e.Other="Other"}(i||(i={})),t.BROWSER_TYPE=i,t.getSafariInfo=function(e){var t,r;e||(e=null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase());var n=e.indexOf("safari")>-1&&e.indexOf("chrom")<0,i=e.match(/version\/\d+/);return{isSafari:n,version:n&&(null==i?void 0:i.length)?+i[0].substr(8):-1}},t.getEdgeInfo=function(e){var t,r;e||(e=null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase());var n=e.indexOf("edge/")>-1,i=e.match(/edge\/\d+/);return{isEdge:n,version:n&&(null==i?void 0:i.length)?+i[0].substr(5):-1}},t.getFireFoxInfo=function(e){var t,r;e||(e=null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase());var n=e.indexOf("Firefox/")>-1,i=e.match(/Firefox\/\d+/);return{isFireFox:n,version:n&&(null==i?void 0:i.length)?+i[0].substr(8):-1}},t.getCurrentBrowserInfo=function(){var e,t,r=null===(t=null===(e=window.navigator)||void 0===e?void 0:e.userAgent)||void 0===t?void 0:t.toLowerCase(),n={type:i.Other,version:0};try{var o={Chrome:r.indexOf("chrome")>-1&&r.indexOf("safari")>-1,Firefox:r.indexOf("firefox")>-1,Safari:r.indexOf("safari")>-1&&-1===r.indexOf("chrome"),LegacyEdge:r.indexOf("edge")>-1,Edge:r.indexOf("edg/")>-1,QQ:r.indexOf("qqbrowser")>-1,Sogou:r.indexOf("se 2.x")>-1};for(var a in o)if(o[a]){var s="",u=null;"QQ"===a?(s=r.match(/chrome\/([\d.]+)/)[1],u=i.QQ):"Chrome"===a?(u=i.Chrome,s=r.match(/chrome\/([\d.]+)/)[1]):"Firefox"===a?(s=r.match(/firefox\/([\d.]+)/)[1],u=i.Firefox):"Safari"===a?(s=r.match(/version\/([\d.]+)/)[1],u=i.Safari):"Edge"===a?(s=r.match(/edg\/([\d.]+)/)[1],
u=i.ChromiumEdge):"LegacyEdge"===a?(s=r.match(/edge\/([\d.]+)/)[1],u=i.LegacyEdge):"Sogou"===a&&(u=i.Sogou,s=r.match(/chrome\/([\d.]+)/)[1]),n.type=u,n.version=parseInt(s,10)}}catch(e){n.type=i.Other,n.version=0}return n},t.getGPUInfo=function(){return o.default.getLocalStorage("bilibili_player_gpu_renderer")||""}},function(e,t,r){"use strict";var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init=function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.FRAGMENTED_TEXT="fragmentedText",this.EMBEDDED_TEXT="embeddedText",this.MUXED="muxed",this.IMAGE="image",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.UTF8="utf-8",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma"},e}()),i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init=function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors"},e}()),o=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init=function(){this.DOWNLOAD_ERROR=4,this.DOWNLOAD_MPD_ERROR=4001,this.DOWNLOAD_XINK_ERROR=4002,this.DOWNLOAD_INIT_SEGMENT_ERROR=4003,this.DOWNLOAD_MEDIA_SEGMENT_ERROR=4004,this.DOWNLOAD_INDEX_SEGMENT_ERROR=4005,this.DOWNLOAD_SWITCHING_SEGMENT_ERROR=4006,this.DOWNLOAD_OTHER_ERROR=4007,this.DOWNLOAD_FRAGMENT_ERROR=4101,this.DOWNLOAD_FRAGMENT_ERROR_RETRY_SUCCESS=4102,this.DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE=4103,this.DOWNLOAD_FRAGMENT_ERROR_RANGE=4104,this.DOWNLOAD_FRAGMENT_ERROR_TIMEOUT=4105,this.CONNECT_FRAGMENT_ERROR_TIMEOUT=4106,this.CONNECT_FRAGMENT_ERROR_OFFLINE=4107,this.CONNECT_NC_FRAGMENT_ERROR_TIMEOUT=4108,this.DOWNLOAD_PCDN_SCRIPT_ERROR=4201,this.DOWNLOAD_PCDN_SCRIPT_TIMEOUT=4202,this.DOWNLOAD_PCDN_DISABLED=4203,this.MANIFEST_ERROR=5,this.MANIFEST_TYPE_ERROR=5001,this.MANIFEST_RESOLVE_ERROR=5002,this.MEDIA_ERROR=6,this.MEDIA_ABORTED_ERROR=6001,this.MEDIA_NETWORK_ERROR=6002,this.MEDIA_DECODE_ERROR=6003,this.MEDIA_SUPPORTED_ERROR=6004,this.MEDIA_ENCRYPTED_ERROR=6005,this.MEDIA_UNKNOWN_ERROR=6e3,this.MEDIA_DECODE_ERROR_VIDEO="video",this.MEDIA_DECODE_ERROR_AUDIO="audio",this.MEDIA_DECODE_ERROR_UNKNOWN="unknown"},e}()),a=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value=""},s=r(0);function u(){var e={};function t(t,r,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!t)throw new Error("event type cannot be null or undefined");if(!r||"function"!=typeof r)throw new Error("listener must be a function: "+r);if(!(n(t,r,i)>=0)){e[t]=e[t]||[];var a={callback:r,scope:i,priority:o},s=e[t].some((function(r,n){if(r&&o>r.priority)return e[t].splice(n,0,a),!0}));s||e[t].push(a)}}function r(t,r,i){if(t&&r&&e[t]){var o=n(t,r,i);o<0||(e[t][o]=null)}}function n(t,r,n){var i=-1;return e[t]?(e[t].some((function(e,t){if(e&&e.callback===r&&(!n||n===e.scope))return i=t,!0})),i):i}return{on:t,off:r,once:function(e,n,i){t(e,(function t(o){n.call(i,o),r(e,t,i)}),i)},trigger:function(t,r){if(t&&e[t]){if((r=r||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");r.type=t,e[t]=e[t].filter((function(e){return e})),e[t].forEach((function(e){return e&&e.callback.call(e.scope,r)}))}},reset:function(){e={}}}}u.__dashjs_factory_name="EventBus";var l=s.a.getSingletonFactory(u);l.EVENT_PRIORITY_LOW=0,l.EVENT_PRIORITY_HIGH=5e3,s.a.updateSingletonFactory(u.__dashjs_factory_name,l);var d=l,f=r(3),p=new(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this));return r.BUFFERING_COMPLETED="bufferingCompleted",r.BUFFER_CLEARED="bufferCleared",r.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",r.BYTES_APPENDED="bytesAppended",r.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",r.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",r.CURRENT_TRACK_CHANGED="currentTrackChanged",r.DATA_UPDATE_COMPLETED="dataUpdateCompleted",r.DATA_UPDATE_STARTED="dataUpdateStarted",r.INITIALIZATION_LOADED="initializationLoaded",r.INIT_FRAGMENT_LOADED="initFragmentLoaded",r.INIT_REQUESTED="initRequested",r.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",r.LIVE_EDGE_SEARCH_COMPLETED="liveEdgeSearchCompleted",r.LOADING_COMPLETED="loadingCompleted",r.LOADING_PROGRESS="loadingProgress",r.LOADING_DATA_PROGRESS="loadingDataProgress",r.LOADING_ABANDONED="loadingAborted",r.MANIFEST_UPDATED="manifestUpdated",r.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",r.QUOTA_EXCEEDED="quotaExceeded",r.REPRESENTATION_UPDATED="representationUpdated",r.SEGMENTS_LOADED="segmentsLoaded",r.SERVICE_LOCATION_BLACKLIST_ADD="serviceLocationBlacklistAdd",r.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",r.SOURCEBUFFER_REMOVE_COMPLETED="sourceBufferRemoveCompleted",r.STREAMS_COMPOSED="streamsComposed",r.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",r.STREAM_COMPLETED="streamCompleted",r.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",r.TIMED_TEXT_REQUESTED="timedTextRequested",r.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",r.URL_RESOLUTION_FAILED="urlResolutionFailed",r.VIDEO_CHUNK_RECEIVED="videoChunkReceived",r.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",r.XLINK_ELEMENT_LOADED="xlinkElementLoaded",r.XLINK_READY="xlinkReady",r.REQUEST_RETRYED="requestRetryed",r.BUFFER_CREATED="bufferCreated",r.VERIFY_SEGMENT_WARNING="verifySegmentWarning",r.INIT_HID="initHID",r.BIND_MEDIA_SOURCE_LOADER="bindMediaSourceLoader",r.SWITCH_AUDIO_TRACK_REQUEST="switchAudioTrackRequest",r.MULTI_AUDIO_TRACK_APPEND="multiAudioTrackAppend",r.SWITCH_AUDIO_TRACK_RENDERED="switchAudioTrackRendered",r.PREDICT_SEEK="predictSeek",r.JUMP_MEDIA_GAP="jumpMediaGap",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(f.a))),h=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=e.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaType=null,
this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null,this.timeout=1e4};h.ACTION_DOWNLOAD="download",h.ACTION_COMPLETE="complete";var y=h;function m(){var e,t=this.context,r=d(t).getInstance(),n=void 0,i=void 0,o=void 0,a=void 0,s=void 0;return e={log:function(){var e="",t=null;i&&(t=(new Date).getTime(),e+="["+(t-s)+"]"),o&&this&&this.getClassName&&(e+="["+this.getClassName()+"]",this.getType&&(e+="["+this.getType()+"]")),e.length>0&&(e+=" "),Array.apply(null,arguments).forEach((function(t){e+=t+" "})),n&&console.log(e),r.trigger(p.LOG,{message:e})},setLogTimestampVisible:function(e){i=e},setCalleeNameVisible:function(e){o=e},setLogToBrowserConsole:function(e){n=e},getLogToBrowserConsole:function(){return n},setABRLogVisible:function(e){a=e},getABRLogVisible:function(){return a||n}},n=!1,a=!1,i=!0,o=!1,s=(new Date).getTime(),e}m.__dashjs_factory_name="Debug";var g=s.a.getSingletonFactory(m),v="loading",_="executed",E="failed";function b(e){e=e||{};var t=this.context,r=g(t).getInstance().log,n=d(t).getInstance(),i=e.metricsModel,o=e.fragmentLoader,a={},s=void 0,u=void 0,c=void 0,l=void 0;function f(e){var t;return!!e&&(t=!1,c.some((function(r){if(n=e,i=r,!isNaN(n.index)&&n.startTime===i.startTime&&n.adaptationIndex===i.adaptationIndex&&n.type===i.type||function(e,t){return isNaN(e.index)&&isNaN(t.index)&&e.quality===t.quality}(e,r)||function(e,t){return e.action===y.ACTION_COMPLETE&&e.action===t.action}(e,r))return t=!0;var n,i})),t)}function h(e){return isNaN(e.duration)?.25:e.duration/8}function m(e){c=c.filter((function(t){var r=h(t);return isNaN(t.startTime)||void 0!==e&&t.startTime>=e-r}))}function b(e,t){t<=e+.5||(c=c.filter((function(r){var n=h(r);return isNaN(r.startTime)||r.startTime>=t-n||isNaN(r.duration)||r.startTime+r.duration<=e+n})))}function S(e,t,r){for(var n=e.length-1;n>=0;n--){var i=e[n],o=i.startTime,a=o+i.duration;if(r=isNaN(r)?h(i):r,!isNaN(o)&&!isNaN(a)&&t+r>=o&&t-r<a||isNaN(o)&&isNaN(t))return i}return null}function T(e){var t=void 0;switch(e){case v:t=l;break;case _:t=c;break;default:t=[]}return t}function w(e,t){i.addSchedulingInfo(e.mediaType,new Date,e.type,e.startTime,e.availabilityStartTime,e.duration,e.quality,e.range,t),i.addRequestsQueue(e.mediaType,l,c)}function A(e){if(e.sender===o&&!e.error){if(l.splice(l.indexOf(e.request),1),e.response&&!e.error){var t=c&&c[c.length-1],i=u.getPlaybackController().getTime()||0,a=e.request,s=t&&(isNaN(t.index)||isNaN(t.startTime)&&isNaN(t.duration)),d=a&&(isNaN(a.index)||isNaN(a.startTime)&&isNaN(a.duration)),f=t&&(0===i||a.startTime-1<=i&&a.startTime+a.duration+1>=i),h=t&&a.index-t.index==1||c&&c.length&&c.filter((function(e){return a.index-e.index==1})).length||0===a.index;if(r("push",a.mediaType,JSON.stringify({index:a.index,isLastNaNRequest:s,isCurrentNaNRequest:d,isCurrentTimeInFirstRequest:f,isMediaRequest:h,currentTime:i,range:a.range})),!d&&f&&c.length>1&&!h&&c.splice(1,c.length-1),t&&!d&&!f&&!h)return void u.getScheduleController().start();c.push(e.request)}w(e.request,e.error?E:_),n.trigger(p.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this}),e.request&&e.request.p2pLoadInfo&&"{}"!=JSON.stringify(e.request.p2pLoadInfo)&&n.trigger(p.FRAGMENT_P2P_LOAD_INFO,{p2pLoadInfo:e.request.p2pLoadInfo}),e.request&&e.request.loadInfo&&"{}"!=JSON.stringify(e.request.loadInfo)&&n.trigger(p.CDN_LOAD_INFO,{loadInfo:e.request.loadInfo,NCInfo:e.request.NCInfo,mediaInfo:{mediaType:e.request.mediaType,quality:e.request.quality,id:e.request.representationId}})}}function R(e){e.sender===o&&n.trigger(p.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this})}function P(e){if(e.sender===o&&(n.trigger(p.FRAGMENT_LOADING_ABANDONED,{streamProcessor:this.getStreamProcessor(),request:e.request,mediaType:e.mediaType}),e.request&&e.request.NCInfo&&"{}"!=JSON.stringify(e.request.NCInfo))){var t=e.request;if(a.mediaType===t.mediaType&&a.quality===t.quality&&a.range===t.range&&a.delayLoadingTime===t.delayLoadingTime)return;a={mediaType:t.mediaType,quality:t.quality,range:t.range,delayLoadingTime:t.delayLoadingTime},n.trigger(p.CDN_LOAD_INFO,{NCInfo:e.request.NCInfo,mediaInfo:{mediaType:e.request.mediaType,quality:e.request.quality,id:e.request.representationId}})}}function D(){c=[],l=[]}return s={setStreamProcessor:function(e){u=e},getStreamProcessor:function(){return u},getRequests:function(e){var t=e?e.state instanceof Array?e.state:[e.state]:[],r=[];return t.forEach((function(t){var n=T(t);r=r.concat(function(e,t){return t.hasOwnProperty("time")?[S(e,t.time,t.threshold)]:e.filter((function(e){for(var r in t)if("state"!==r&&t.hasOwnProperty(r)&&e[r]!=t[r])return!1;return!0}))}(n,e))})),r},isFragmentLoaded:f,isFragmentLoadedOrPending:function(e){var t=!1,r=0,n=void 0;if(!(t=f(e)))for(r=0;r<l.length;r++)n=l[r],e.url===n.url&&e.startTime===n.startTime&&(t=!0);return t},removeExecutedRequestsBeforeTime:m,removeExecutedRequestsAfterTime:function(e){c=c.filter((function(t){return isNaN(t.startTime)||void 0!==e&&t.startTime<=e}))},syncExecutedRequestsWithBufferedRange:function(e,t){if(e&&0!==e.length){for(var r=0,n=0,i=e.length;n<i;n++)b(r,e.start(n)),r=e.end(n);t>0&&b(r,t)}else m()},clearExecutedRequestBySeeking:function(){c=[]},abortRequests:function(){o.abort(),l=[]},executeRequest:function(e){switch(e.action){case y.ACTION_COMPLETE:c.push(e),w(e,_),r("[FragmentModel] executeRequest trigger STREAM_COMPLETED"),n.trigger(p.STREAM_COMPLETED,{request:e,fragmentModel:this});break;case y.ACTION_DOWNLOAD:w(e,v),l.push(e),function(e){n.trigger(p.FRAGMENT_LOADING_STARTED,{sender:s,request:e});var t=u&&u.getBufferLevel();e.bufferLevel=t,e.startLoadFragmentTime=(new Date).getTime(),o.load(e)}(e);break;default:r("Unknown request action.")}},reset:function(){n.off(p.LOADING_COMPLETED,A,this),n.off(p.LOADING_DATA_PROGRESS,R,this),n.off(p.LOADING_ABANDONED,P,this),o&&o.reset(),D()},addExecutedRequest:function(){},resetInitialSettings:D,getLastQnFragmentCompletedCnts:function(e){var t=0;if(c&&c.length>0)for(var r=c.length-1;r>=0&&e===c[r].quality;r--)t++;return t},resetPreloadData:function(){o&&o.resetPreloadData()},syncExecutedRequestsWithMultipleLevels:function(e,t){if(e&&0!==e.length){for(var r=0,n=0,i=e.length;n<i;n++){var o=e[n];b(r,o.start),r=o.end}t>0&&b(r,t)}else m()},getRequestsForState:T,getLoadingRequests:function(){return l}},D(),n.on(p.LOADING_COMPLETED,A,s),n.on(p.LOADING_DATA_PROGRESS,R,s),n.on(p.LOADING_ABANDONED,P,s),s}b.__dashjs_factory_name="FragmentModel";var S=s.a.getClassFactory(b);S.FRAGMENT_MODEL_LOADING=v,S.FRAGMENT_MODEL_EXECUTED=_,S.FRAGMENT_MODEL_CANCELED="canceled",S.FRAGMENT_MODEL_FAILED=E,s.a.updateClassFactory(b.__dashjs_factory_name,S);var T=S,w=function e(t,r,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.message=r||null,this.data=n||null,this.errorCode=i||null,this.httpCode=o||null};function A(e,t,r){var n=this.context,i=g(n).getInstance().log,o=d(n).getInstance(),a=void 0,s=void 0,u=[],c=r;function l(){return a?a.buffered:[]}function f(){var e=this;if(u.length>0){s=!0;var t=u[0];u.splice(0,1);var r=[],n=function(){var n=l();!function(e,t,r,n){t&&t.length>0&&t.length<r.length&&function(e,t){for(var r=0;r<e.length;r++){var n=Math.round(e.start(r)),i=Math.round(e.end(r));if(i===t.start||n===t.end||t.start>=n&&t.end<=i)return!0}return!1}(t,n)&&o.trigger(p.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:e,from:r.end(r.length-2),to:r.start(r.length-1),unintended:!0})}(e,r,n,t),u.length>0?f.call(this):(s=!1,c&&c({chunk:t}))};try{0===t.bytes.length?n.call(this):(r=l(),a.appendBuffer?a.appendBuffer(t.bytes):a.append(t.bytes,t),h(a,n.bind(this)))}catch(e){i('SourceBuffer append failed "'+e+'"'),u.length>0?f():s=!1,c&&c({chunk:t,
error:new w(e.code,e.message,null)})}}}function h(e,t){var r=void 0,n=function(){e.updating||(clearInterval(r),t())};if(e.updating)if("function"==typeof e.addEventListener)try{e.addEventListener("updateend",(function r(){e.updating||(e.removeEventListener("updateend",r,!1),t())}),!1)}catch(e){r=setInterval(n,50)}else r=setInterval(n,50);else t()}var y={getAllBufferRanges:l,getBuffer:function(){return a},append:function(e){u.push(e),s||h(a,f.bind(this))},remove:function(t,r,n){var i=this;h(a,(function(){try{t>=0&&r>t&&(n||"ended"!==e.readyState)&&a.remove(t,r),h(a,(function(){o.trigger(p.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:i,from:t,to:r,unintended:!1})}))}catch(e){o.trigger(p.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:i,from:t,to:r,unintended:!1,error:new w(e.code,e.message,null)})}}))},abort:function(){try{("open"===e.readyState||a.setTextTrack&&"ended"===e.readyState)&&a.abort()}catch(e){i('SourceBuffer append abort failed: "'+e+'"')}u=[]},reset:function(){if(a){try{e.removeSourceBuffer(a)}catch(e){i("Failed to remove source buffer from media source.")}s=!1,a=null}u=[],c=null},setAppendWindowEnd:function t(r){r<=0||h(a,(function(){if("open"===e.readyState)a.appendWindowEnd=r;else var n=setTimeout((function(){clearTimeout(n),t(r)}),50)}))},updateTimestampOffset:function(e){a.timestampOffset===e||isNaN(e)||h(a,(function(){a.timestampOffset=e}))}};return function(){s=!1;var r=t.codec;try{if(r.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))throw new Error("not really supported");a=e.addSourceBuffer(r)}catch(e){throw e}}(),y}A.__dashjs_factory_name="SourceBufferSink";var R=s.a.getClassFactory(A);function P(e){var t=this.context,r=g(t).getInstance().log,n=[],i=void 0,o=e;function a(e,t){n=n.filter((function(r){return!((isNaN(t)||r.start<t)&&(isNaN(e)||r.end>e))}))}return{getAllBufferRanges:function(){for(var e=[],t=0;t<n.length;t++){var r=n[t];0===e.length||r.start>e[e.length-1].end?e.push({start:r.start,end:r.end}):e[e.length-1].end=r.end}var i={start:function(t){return e[t].start},end:function(t){return e[t].end}};return Object.defineProperty(i,"length",{get:function(){return e.length}}),i},append:function(e){"InitializationSegment"!==e.segmentType?(n.push(e),n.sort((function(e,t){return e.start-t.start})),i=null):i=e,r("PreBufferSink appended chunk s: "+e.start+"; e: "+e.end),o&&o({chunk:e})},remove:a,abort:function(){},discharge:function(e,t){var r=function(e,t){return n.filter((function(r){return(isNaN(t)||r.start<t)&&(isNaN(e)||r.end>e)}))}(e,t);return i&&(r.push(i),i=null),a(e,t),r},reset:function(){n=[],i=null,o=null}}}P.__dashjs_factory_name="PreBufferSink";var D=s.a.getClassFactory(P),I={DEFAULT:.5,STRONG:1,WEAK:0};function O(e,t,r){return{quality:void 0===e?-1:e,reason:void 0===t?null:t,priority:function(e){var t=I.DEFAULT;return e!==I.DEFAULT&&e!==I.STRONG&&e!==I.WEAK||(t=e),t}(r)}}O.__dashjs_factory_name="SwitchRequest";var C=s.a.getClassFactory(O);C.NO_CHANGE=-1,C.PRIORITY=I,s.a.updateClassFactory(O.__dashjs_factory_name,C);var N=C;function k(e){e=e||{};var t=this.context,r=g(t).getInstance().log,n=e.metricsModel;return{getMaxIndex:function(e){var i=N(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getStreamProcessor")))return i;!function(){if(!n||!n.hasOwnProperty("getReadOnlyMetricsFor"))throw new Error("Missing config parameter(s)")}();var o=e.getMediaInfo(),a=e.getMediaType(),s=n.getReadOnlyMetricsFor(a),u=e.getStreamProcessor(),c=e.getAbrController(),l=e.getStreamInfo(),d=l&&l.manifestInfo?l.manifestInfo.isDynamic:null,f=c.getThroughputHistory(),p=f.getSafeAverageThroughput(a,d),h=f.getAverageLatency(a),y=s.BufferState.length>0?s.BufferState[s.BufferState.length-1]:null,m=e.useBufferOccupancyABR();return!s||isNaN(p)||!y||m||c.getAbandonmentStateFor(a)!==oe.ABANDON_LOAD&&(y||d)&&(i.quality=c.getQualityForBitrate(o,p,h),u.getScheduleController().setTimeToLoadDelay(0),r("ThroughputRule requesting switch to index: ",i.quality,"type: ",a,"Average throughput",Math.round(p),"kbps"),i.reason={throughput:p,latency:h}),i},reset:function(){}}}k.__dashjs_factory_name="ThroughputRule";var L=s.a.getClassFactory(k);function x(e){e=e||{};var t=this.context,r=g(t).getInstance().log,n=e.mediaPlayerModel,i=e.metricsModel,o=e.dashMetrics,a=void 0,s=void 0,u=void 0;function c(){a={},s={},u=[]}var l={shouldAbandon:function(e){var c=N(t).create(N.NO_CHANGE,{name:x.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return c;var l,d,f=e.getMediaInfo(),p=e.getMediaType(),h=e.getCurrentRequest();if(!isNaN(h.index)){l=p,d=h.index,a[l]=a[l]||{},a[l][d]=a[l][d]||{};var y=n.getStableBufferTime(),m=o.getCurrentBufferLevel(i.getReadOnlyMetricsFor(p));if(m>y)return c;var g=a[p][h.index];if(null===g||null===h.firstByteDate||s.hasOwnProperty(g.id))return c;if(void 0===g.firstByteTime&&(u[p]=[],g.firstByteTime=h.firstByteDate.getTime(),g.segmentDuration=h.duration,g.bytesTotal=h.bytesTotal,g.id=h.index),g.bytesLoaded=h.bytesLoaded,g.elapsedTime=(new Date).getTime()-g.firstByteTime,g.bytesLoaded>0&&g.elapsedTime>0&&function(e,t){u[e]=u[e]||[],u[e].push(t)}(p,Math.round(8*g.bytesLoaded/g.elapsedTime)),u[p].length>=5&&g.elapsedTime>500&&g.bytesLoaded<g.bytesTotal){var v=u[p].reduce((function(e,t){return e+t}),0);g.measuredBandwidthInKbps=Math.round(v/u[p].length),g.estimatedTimeOfDownload=+(8*g.bytesTotal/g.measuredBandwidthInKbps/1e3).toFixed(2);var _=g.estimatedTimeOfDownload;if(_<1.8*g.segmentDuration&&_<.8*m||0===e.getRepresentationInfo().quality)return c;if(!s.hasOwnProperty(g.id)){var E=e.getAbrController(),b=g.bytesTotal-g.bytesLoaded,S=E.getBitrateList(f),T=E.getQualityFor(p,f.streamInfo),w=function(e,t,r){var o=E.getQualityForBitrate(f,g.measuredBandwidthInKbps*n.getBandwidthSafetyFactor()),a=E.getMinAllowedIndexFor(p),s=i.getReadOnlyMetricsFor(p),u=s.BufferState.length>0?s.BufferState[s.BufferState.length-1]:null;return t>=.8*r&&o>e?e>0?e-1:e:r<1||u&&u.state===Le.BUFFER_EMPTY?0:void 0!==a?Math.max(a,o):o}(T,_,m);b>g.bytesTotal*S[w].bitrate/S[T].bitrate&&w!==T&&(c.quality=w,c.reason.throughput=g.measuredBandwidthInKbps,c.reason.fragmentID=g.id,s[g.id]=g,r("AbandonRequestsRule ( ",p,"frag id",g.id,") is asking to abandon and switch to quality to ",w,"from quality "+T," measured bandwidth was",g.measuredBandwidthInKbps),delete a[p][g.id])}}else g.bytesLoaded===g.bytesTotal&&delete a[p][g.id]}return c},reset:c};return c(),l}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}x.__dashjs_factory_name="AbandonRequestsRule",s.a.getClassFactory(x);var F=function e(){M(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this._stream=null,this._tfinish=null,this._mediaduration=null,this._responseHeaders=null,this._serviceLocation=null},U=function e(){M(this,e),this.s=null,this.d=null,this.b=[]};function B(e){e=e||{};var t=this.context,r=g(t).getInstance().log,n=e.dashMetrics,o=e.metricsModel,a=e.mediaPlayerModel,s=d(t).getInstance(),u=void 0,c=void 0;function l(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function f(){for(var e in c)if(c.hasOwnProperty(e)){var t=c[e];0!==t.state&&l(t)}}function h(){}function y(e,t){if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=.99,!isNaN(e.lastSegmentFinishTimeMs)){var r=n.getCurrentBufferLevel(o.getReadOnlyMetricsFor(t))+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),i=function(e,t){return e.Vp*(e.utilities[t]+e.gp)}(e,e.lastQuality),a=Math.max(0,i-r);e.placeholderBuffer=Math.min(a,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),
e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}}function m(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=c[e.chunk.mediaInfo.type];if(t&&0!==t.state){var r=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||r>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=r,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=r,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,y(t,e.chunk.mediaInfo.type)}}}function v(e){if(e&&e.metric===i.HTTP_REQUEST&&e.value&&e.value.type===F.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=c[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),y(t,e.mediaType))}}function _(e){if(e){var t=c[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function E(e){}function b(e,t,r,n){var i=e.getRealBufferLevel();return+(5*r[t].bandwidth/(1e3*n)).toFixed(2)>i-3}function S(){c={}}return u={getMaxIndex:function(e){var i=e.getMediaInfo(),s=e.getMediaType(),u=o.getReadOnlyMetricsFor(s),d=e.getStreamProcessor(),f=e.getStreamInfo(),p=e.getAbrController(),h=p.getThroughputHistory(),y=(f&&f.id,f&&f.manifestInfo&&f.manifestInfo.isDynamic),m=e.useBufferOccupancyABR(),g=N(t).create();if(g.reason=g.reason||{},!m)return g;d.getScheduleController().setTimeToLoadDelay(0);var v=function(e){var t=e.getMediaType(),r=c[t];return r||(r=function(e){var t={},r=e.getMediaInfo().bitrateList.map((function(e){return e.bandwidth})),n=function(e){return e.map((function(e){return Math.log(e)}))}(r);n=n.map((function(e){return e-n[0]+1}));var i=a.getStableBufferTime(),o=function(e,t,r){var n=r.reduce((function(e,t,n){return t>r[e]?n:e}),0);if(0===n)return null;var i=Math.max(e,10+2*t.length),o=(r[n]-1)/(i/10-1);return{gp:o,Vp:10/o}}(i,r,n);return o?(t.state=1,t.bitrates=r,t.utilities=n,t.stableBufferTime=i,t.Vp=o.Vp,t.gp=3,t.lastQuality=0,l(t)):t.state=0,t}(e),c[t]=r),r}(e);if(0===v.state)return g;var _=n.getCurrentBufferLevel(u),E=h.getAverageThroughput(s,y),S=h.getSafeAverageThroughput(s,y),T=h.getAverageLatency(s),w=void 0;if(g.reason.state=v.state,g.reason.throughput=E,g.reason.latency=T,isNaN(E))return g;switch(v.state){case 1:w=p.getQualityForBitrate(i,.4*S,T);var A=e.getCurrentValue();w>A&&(w=A),g.quality=w,g.reason.throughput=S,v.lastQuality=w,v.lastPredictQn=w,isNaN(v.lastSegmentDurationS),!isNaN(v.lastSegmentDurationS)&&_>=1*v.lastSegmentDurationS&&(v.state=2),r("【bolaV2 "+s+"】use throughput qn is "+i.bitrateList[w].id);break;case 2:var R=p.getPlaybackRate(),P=p.getRealBufferLevel();w=function(e,t,n,i){var o=0,s=n.getMediaInfo(),u=n.getMediaType(),c=n.getAbrController(),l=c.getThroughputHistory(),d=l.getAverageLatency(u);if(e>i){var f=l.getMinThroughput(u),p=t;o=f*a.getFactorByBufferLevel(p),r("【bolaV2 cac "+u+"】 min throughput: "+f)}else o=l.getSafeAverageThroughput(u),r("【bolaV2 cac "+u+"】 avg throughput: "+l.getAverageThroughput(u));var h=c.getQualityForBitrate(s,o,d),y=s.bitrateList;if(r("【bolaV2 adjust "+u+"】startQn: "+y[e].id+", curQn: "+y[i].id+", cache: "+t+", adapter: "+o+", latency: "+d+", thQn: "+y[h].id),e>i)e=h<i||c.getHasChangedByABRStrategy(u)&&c.getLastQnFragmentCompletedCnts(u,i)<3||c.getRealBufferLevel()<12?h<i&&b(c,i,y,o)?h:i:h>e?e:h;else{var m=l.getDict(u);h>=i||!m||m.length<2?b(c,i,y,o)&&(e=i):(h>e||h<e&&b(c,e,y,o))&&(e=h)}return e}(w=function(e,t,n,i,o){var a=t.bitrates.length,s=Math.min(1,n/e)/o,u=NaN,c=NaN,l=t.utilities,d=t.gp,f=l[l.length-1];r("【bolaV2 getQn "+i+"】, efcBuf: "+e+", curBufLv: "+s+", high: "+f);for(var p=a-1;p>=0;p--){var h=s;p<t.lastQuality&&(h=Math.min(1,h+.1));var y=t.utilities[p],m=((y+d)/(f+d)-h)/y;(isNaN(c)||m>=c)&&(c=m,u=p)}return u}(p.getEffectiveBufferTime(),v,P,s,R),P/R,e,v.lastPredictQn),g.quality=w,g.reason.throughput=E,g.reason.latency=T,g.reason.bufferLevel=P,v.lastQuality=w,v.lastPredictQn=w,r("【bolaV2 "+s+"】final qn is "+i.bitrateList[w].id);break;case 3:w=p.getQualityForBitrate(i,.5*S,T),!isNaN(v.lastSegmentDurationS)&&_>=1*v.lastSegmentDurationS&&(v.state=2),g.quality=w,g.reason.throughput=E,g.reason.latency=T,g.reason.bufferLevel=_,r("【bolaV2 "+s+"】seek use throughput qn is "+i.bitrateList[w].id);break;default:r("BOLA ABR rule invoked in bad state."),g.quality=p.getQualityForBitrate(i,S,T),g.reason.state=v.state,g.reason.throughput=S,g.reason.latency=T,v.state=1,l(v)}return g},reset:function(){S(),s.off(p.PLAYBACK_xING,f,u),s.off(p.PERIOD_SWITCH_STARTED,h,u),s.off(p.MEDIA_FRAGMENT_LOADED,m,u),s.off(p.METRIC_ADDED,v,u),s.off(p.QUALITY_CHANGE_REQUESTED,_,u),s.off(p.FRAGMENT_LOADING_ABANDONED,E,u)}},S(),s.on(p.PLAYBACK_SEEKING,f,u),s.on(p.PERIOD_SWITCH_STARTED,h,u),s.on(p.MEDIA_FRAGMENT_LOADED,m,u),s.on(p.METRIC_ADDED,v,u),s.on(p.QUALITY_CHANGE_REQUESTED,_,u),s.on(p.FRAGMENT_LOADING_ABANDONED,E,u),u}F.GET="GET",F.HEAD="HEAD",F.MPD_TYPE="MPD",F.XLINK_EXPANSION_TYPE="XLinkExpansion",F.INIT_SEGMENT_TYPE="InitializationSegment",F.INDEX_SEGMENT_TYPE="IndexSegment",F.MEDIA_SEGMENT_TYPE="MediaSegment",F.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",F.OTHER_TYPE="other",B.__dashjs_factory_name="BolaRuleV2";var j=s.a.getClassFactory(B),V="qualitySwitchRules",G="abandonFragmentRules";function H(e){e=e||{};var t=this.context,r=e.mediaPlayerModel,n=e.metricsModel,i=e.dashMetrics,o=void 0,a=void 0;function s(e){return e.filter((function(e){return e.quality>N.NO_CHANGE}))}function u(e){var r,n={},i=void 0,o=void 0,a=void 0,s=void 0;if(0!==e.length){for(n[N.PRIORITY.STRONG]=N.NO_CHANGE,n[N.PRIORITY.WEAK]=N.NO_CHANGE,n[N.PRIORITY.DEFAULT]=N.NO_CHANGE,i=0,r=e.length;i<r;i+=1)(o=e[i]).quality!==N.NO_CHANGE&&(n[o.priority]=n[o.priority]>N.NO_CHANGE?Math.min(n[o.priority],o.quality):o.quality);return n[N.PRIORITY.WEAK]!==N.NO_CHANGE&&(a=n[N.PRIORITY.WEAK]),n[N.PRIORITY.DEFAULT]!==N.NO_CHANGE&&(a=n[N.PRIORITY.DEFAULT]),n[N.PRIORITY.STRONG]!==N.NO_CHANGE&&(a=n[N.PRIORITY.STRONG]),a!==N.NO_CHANGE&&(s=a),N(t).create(s)}}return{initialize:function(){o=[],a=[],r.getUseDefaultABRRules()&&(o.push(j(t).create({metricsModel:n,dashMetrics:i,mediaPlayerModel:r})),o.push(L(t).create({metricsModel:n,dashMetrics:i}))),r.getABRCustomRules().forEach((function(e){e.type===V&&o.push(e.rule(t).create()),e.type===G&&a.push(e.rule(t).create())}))},reset:function(){[o,a].forEach((function(e){e&&e.length&&e.forEach((function(e){return e.reset&&e.reset()}))})),o=[],a=[]},getMaxQuality:function(e){return u(s(o.map((function(t){return t.getMaxIndex(e)}))))||N(t).create()},shouldAbandonFragment:function(e){return u(s(a.map((function(t){return t.shouldAbandon(e)}))))||N(t).create()}}}H.__dashjs_factory_name="ABRRulesCollection";var q=s.a.getClassFactory(H);q.QUALITY_SWITCH_RULES=V,q.ABANDON_FRAGMENT_RULES=G,s.a.updateSingletonFactory(H.__dashjs_factory_name,q);var W=q,Y=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN,this.id=""};function K(e){var t=(e=e||{}).abrController,r=e.streamProcessor,n=e.streamProcessor.getCurrentRepresentationInfo(),i=e.switchHistory,o=e.droppedFramesHistory,a=e.currentRequest,s=e.useBufferOccupancyABR,u=e.currentValue;return{getMediaType:function(){return n.mediaInfo.type},getMediaInfo:function(){return n.mediaInfo},getDroppedFramesHistory:function(){return o},getCurrentRequest:function(){return a},getSwitchHistory:function(){return i},getStreamInfo:function(){return n.mediaInfo.streamInfo},getStreamProcessor:function(){return r},getAbrController:function(){return t},getRepresentationInfo:function(){return n},useBufferOccupancyABR:function(){return s},getCurrentValue:function(){return u}}}K.__dashjs_factory_name="RulesContext";var Q=s.a.getClassFactory(K);function z(){var e=[],t=[];return{push:function(r){r.newValue===N.NO_CHANGE&&(r.newValue=r.oldValue),e[r.oldValue]||(e[r.oldValue]={noDrops:0,drops:0,dropSize:0});var n=r.newValue-r.oldValue,i=n<0?1:0,o=i?-n:0,a=i?0:1;if(e[r.oldValue].drops+=i,e[r.oldValue].dropSize+=o,e[r.oldValue].noDrops+=a,t.push({idx:r.oldValue,noDrop:a,drop:i,dropSize:o}),t.length>8){var s=t.shift();e[s.idx].drops-=s.drop,
e[s.idx].dropSize-=s.dropSize,e[s.idx].noDrops-=s.noDrop}},getSwitchRequests:function(){return e},reset:function(){e=[],t=[]}}}z.__dashjs_factory_name="SwitchRequestHistory";var Z=s.a.getClassFactory(z);function J(){var e=[],t=0,r=0;return{push:function(n,i){var o=i&&i.droppedVideoFrames?i.droppedVideoFrames:0,a=i&&i.totalVideoFrames?i.totalVideoFrames:0,s=o-t;t=o;var u=a-r;r=a,isNaN(n)||(e[n]?(e[n].droppedVideoFrames+=s,e[n].totalVideoFrames+=u):e[n]={droppedVideoFrames:s,totalVideoFrames:u})},getFrameHistory:function(){return e},getFrameInfo:function(){return{droppedFrames:t,totalFrames:r}},reset:function(n){e=[],t=n.droppedVideoFrames,r=n.totalVideoFrames}}}J.__dashjs_factory_name="DroppedFramesHistory";var X=s.a.getClassFactory(J);function $(e){var t=(e=e||{}).mediaPlayerModel,r=void 0,i=void 0,o=void 0,a=void 0,s=void 0;function u(e,t,r,n){var i=Math.pow(.5,r/n.fast);e.fastEstimate=(1-i)*t+i*e.fastEstimate;var o=Math.pow(.5,r/n.slow);e.slowEstimate=(1-o)*t+o*e.slowEstimate,e.totalWeight+=r}function c(e,u,c){return t.getMovingAverageMethod()!==n.MOVING_AVERAGE_SLIDING_WINDOW?function(e,t){var r=e?s.throughputHalfLife:s.latencyHalfLife,n=e?o[t]:a[t];if(!n||n.totalWeight<=0)return NaN;var i=n.fastEstimate/(1-Math.pow(.5,n.totalWeight/r.fast)),u=n.slowEstimate/(1-Math.pow(.5,n.totalWeight/r.slow));return e?Math.min(i,u):Math.max(i,u)}(e,u):function(e,t,n){var o=function(e,t,n){var o=void 0,a=void 0;if(e?(o=r[t],a=n?3:4):(o=i[t],a=4),o){if(a>=o.length)a=o.length;else if(e)for(var s=1;s<a;++s){var u=o[s]/o[s-1];if((u>=1.3||u<=1/1.3)&&(a+=1)===o.length)break}}else a=0;return a}(e,t,n),a=(e?r:i)[t];return 0!==o&&a&&0!==a.length?(a=a.slice(-o)).reduce((function(e,t){return e+t}))/a.length:NaN}(e,u,c)}function l(e,t){return c(!0,e,t)}function d(e){r[e]=r[e]||[],i[e]=i[e]||[],o[e]=o[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0},a[e]=a[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function f(){r={},i={},o={},a={}}var p={push:function(e,c,l){if(c.trace&&c.trace.length){var f=c.tresponse.getTime()-c.trequest.getTime()||1,p=c._tfinish.getTime()-c.tresponse.getTime()||1,h=c.trace.reduce((function(e,t){return e+t.b[0]}),0),y=f+p,m=Math.round(8*h/y);if(!(h<1e4)){if(d(e),function(e,r,i){return e===n.VIDEO?i+r<t.getCacheLoadThresholdForType(n.VIDEO):e===n.AUDIO?i+r<t.getCacheLoadThresholdForType(n.AUDIO):void 0}(e,f,p)){if(r[e].length>0&&!r[e].hasCachedEntries)return;r[e].hasCachedEntries=!0}else r[e]&&r[e].hasCachedEntries&&function(e){delete r[e],delete i[e],delete o[e],delete a[e],d(e)}(e);m>9900&&(m=9900),r[e].push(m),r[e].length>5&&r[e].shift(),i[e].push(f),i[e].length>5&&i[e].shift(),u(o[e],m,.001*p,s.throughputHalfLife),u(a[e],f,1,s.latencyHalfLife)}}},getAverageThroughput:l,getSafeAverageThroughput:function(e,r){var n=l(e,r);return isNaN(n)||(n*=t.getBandwidthSafetyFactor()),n},getAverageLatency:function(e){return c(!1,e)},getMinThroughput:function(e){return Math.min.apply(Math,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(r[e]))},getDict:function(e){return{throughput:r[e],latency:i[e]}},onProgress:function(e,t){if(!t.requestStartDate&&!t.p2pLoadInfo||"video"!==e)return!1;var n=(new Date).getTime(),a=null;if(t.headersReceivedDate?a=t.headersReceivedDate.getTime():t.p2pLoadInfo.requestStartTime&&(a=t.p2pLoadInfo.requestStartTime.getTime()),a){var c=n-a||1,l=null;t.headersReceivedDate&&t.requestStartDate&&(l=t.headersReceivedDate.getTime()-t.requestStartDate.getTime());var f=c,p=t.bytesLoaded;if(p<76100)return!1;t.lastByte=p;var h=Math.round(8*p/f);return t.p2pLoadInfo&&t.p2pLoadInfo.requestStartTime,d(e),"number"!=typeof l||isNaN(l)||(i[e].push(l),i[e].length>5&&i[e].shift()),h>9900&&(h=9900),r[e].push(h),r[e].length>5&&r[e].shift(),u(o[e],h,.001*c,s.throughputHalfLife),!0}},reset:f};return s={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},f(),p}$.__dashjs_factory_name="ThroughputHistory";var ee=s.a.getClassFactory($),te="abandonload",re="allowload";function ne(){var e=this.context,t=g(e).getInstance(),r=d(e).getInstance(),o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,y=void 0,m=void 0,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,I=void 0,O=void 0,C=void 0,k=void 0,L=void 0,x=void 0,M=void 0,U=void 0,B=void 0,j=void 0,V=void 0,G=void 0,H=void 0,q={video:0,audio:0},K={video:{},audio:{}};function z(e){var t=e.request.mediaType;"MediaSegment"===e.request.type&&"video"===t&&M.onProgress(t,e.request,e.response)}function J(e){e||(c={video:!0,audio:!0}),l={},f={},h={},y={},v={},m={},L={},U={},E=!1,V=!0,b=!1,void 0===S&&(S=!1),k=void 0,x=void 0,M=void 0,clearTimeout(_),_=null,G={video:!1,audio:!1}}function $(e){e.mediaType===n.VIDEO&&(k=e.oldQuality,x.push(k,I.getPlaybackQuality()))}function ne(e){e.metric!==i.HTTP_REQUEST||!e.value||e.value.type!==F.MEDIA_SEGMENT_TYPE||e.mediaType!==n.AUDIO&&e.mediaType!==n.VIDEO||M.push(e.mediaType,e.value,V),e.metric!==i.BUFFER_LEVEL||e.mediaType!==n.AUDIO&&e.mediaType!==n.VIDEO||function(e,t){var r=O.getABRStrategy();if(r!==n.ABR_STRATEGY_BOLA)if(r!==n.ABR_STRATEGY_THROUGHPUT){var i=O.getStableBufferTime(),o=i,s=.5*i,u=U[e],c=t>(u?s:o);U[e]=c,c!==u&&a(c?"AbrController ("+e+") switching from throughput to buffer occupancy ABR rule (buffer: "+t.toFixed(3)+").":"AbrController ("+e+") switching from buffer occupancy to throughput ABR rule (buffer: "+t.toFixed(3)+").")}else U[e]=!1;else U[e]=!0}(e.mediaType,.001*e.value.level)}function ie(e,t){return l[t]=l[t]||{},l[t].hasOwnProperty(e)||(l[t][e]=0),function(e,t){if(t!==n.VIDEO||!E||!m[t])return e;S||ve();var r=R.getValue(),i=P.getAdaptationForType(r,0,t).Representation,o=e;if(w>0&&A>0){for(;o>0&&i[o]&&w<i[o].width&&w-i[o-1].width<i[o].width-w;)o-=1;i.length-2>=o&&i[o].width===i[o+1].width&&(o=Math.min(e,o+1))}return o}(function(e,t,r){var n=ce(t);return isNaN(n)||n>=1||n<0?e:Math.min(e,Math.round(r*n))}(function(e,t){var r=e;if(!m[t])return r;var n=ue(t);void 0!==n&&(r=Math.max(e,n));var i=se(t);return void 0!==i&&(r=Math.min(r,i)),r}(l[t][e],e),e,l[t][e]),e)}function oe(e){return h.hasOwnProperty("max")&&h.max.hasOwnProperty(e)?h.max[e]:NaN}function ae(e){return h.hasOwnProperty("min")&&h.min.hasOwnProperty(e)?h.min[e]:NaN}function se(e){var t=oe(e);return t?he(m[e].getMediaInfo(),t):void 0}function ue(e){var t=ae(e);if(t){var r=ye(m[e].getMediaInfo()),n=he(m[e].getMediaInfo(),t);return r[n]&&n<r.length-1&&r[n].bitrate<1e3*t&&n++,n}}function ce(e){return y.hasOwnProperty("max")&&y.max.hasOwnProperty(e)?y.max[e]:1}function le(e){return c[e]}function de(e,t,r,n){var i=t.id,o=ge(e);if(null===r||isNaN(r)||r%1!=0)throw new Error("argument is not an integer");var a=ie(e,i);r!==o&&r>=0&&r<=a&&fe(e,o,r,a,n)}function fe(e,n,i,o,s){if(e&&m[e]){var u=m[e].getStreamInfo(),c=u?u.id:null;if(t.getABRLogVisible()){var l=j.getCurrentBufferLevel(B.getReadOnlyMetricsFor(e));a("AbrController ("+e+") switch from "+n+" to "+i+"/"+o+" (buffer: "+l+") "+(s?JSON.stringify(s):"."))}!function(e,t,r){f[t]=f[t]||{},f[t][e]=r}(e,c,i),r.trigger(p.QUALITY_CHANGE_REQUESTED,{mediaType:e,streamInfo:u,oldQuality:n,newQuality:i,reason:s})}}function pe(e,t){v[e].state=t,v[e].time=t===te?performance.now():NaN}function he(e,t,r){if(V&&r&&m[e.type].getCurrentRepresentationInfo()&&m[e.type].getCurrentRepresentationInfo().fragmentDuration){r/=1e3;var n=m[e.type].getCurrentRepresentationInfo().fragmentDuration;if(r>n)return 0;t*=1-r/n}var i=ye(e);if(!i||0===i.length)return 0;for(var o=i.length-1;o>=0;o--)if(1e3*t>=i[o].bitrate)return o;return 0}function ye(e){if(!e||!e.bitrateList)return null;for(var t=e.bitrateList,r=e.type,n=[],i=void 0,o=0,a=t.length;o<a;o++)(i=new Y).mediaType=r,i.qualityIndex=o,i.id=t[o].id,i.bitrate=t[o].bandwidth,i.width=t[o].width,i.height=t[o].height,i.scanType=t[o].scanType,n.push(i);return n}function me(e){return U[e]}function ge(e){if(e&&m[e]){var t=m[e].getStreamInfo(),r=t?t.id:null;if(r)return f[r]=f[r]||{},f[r].hasOwnProperty(e)||(f[r][e]=Ee(e,!1)||0),f[r][e]}return 0}function ve(){if(I){var e=b&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;w=I.getClientWidth()*e,A=I.getClientHeight()*e}
}function _e(t){var r=t.request.mediaType;if(le(r)){var n=m[r];if(!n)return;var i=Q(e).create({abrController:o,streamProcessor:n,currentRequest:t.request,useBufferOccupancyABR:me(r)}),a=s.shouldAbandonFragment(i);if(a.quality>N.NO_CHANGE){var c=n.getFragmentModel();c.getRequests({state:T.FRAGMENT_MODEL_LOADING,index:t.request.index})[0]&&(c.abortRequests(),pe(r,te),L[r].reset(),L[r].push({oldValue:ge(r,u.getActiveStreamInfo()),newValue:a.quality,confidence:1,reason:a.reason}),de(r,u.getActiveStreamInfo(),a.quality,a.reason),clearTimeout(_),_=setTimeout((function(){pe(r,re),_=null}),O.getAbandonLoadTimeout()))}}}function Ee(e){if(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]){var t=O.getPreloadData();if(t&&t[e+"id"])return m[e].getRepresentationController().getQualityForRepresentationId(t[e+"id"])}return q[e]||0}return o={isPlayingAtTopQuality:function(e){var t=e.id,r=ge(n.AUDIO),i=ge(n.VIDEO);return r===ie(n.AUDIO,t)&&i===ie(n.VIDEO,t)},updateTopQualityIndex:function(e){var t=e.type,r=e.streamInfo.id,n=e.representationCount-1;return function(e,t,r){l[t]=l[t]||{},l[t][e]=r}(t,r,n),n},getThroughputHistory:function(){return M},getBitrateList:ye,getQualityForBitrate:he,getMaxAllowedBitrateFor:oe,getTopBitrateInfoFor:function(e){if(e&&m&&m[e]){var t=m[e].getStreamInfo();if(t.id){var r=ie(e,t.id),n=ye(m[e].getMediaInfo());return n[r]?n[r]:null}}return null},getMinAllowedBitrateFor:ae,setMaxAllowedBitrateFor:function(e,t){h.max=h.max||{},h.max[e]=t},setMinAllowedBitrateFor:function(e,t){h.min=h.min||{},h.min[e]=t},getMaxAllowedIndexFor:se,getMinAllowedIndexFor:ue,getMaxAllowedRepresentationRatioFor:ce,setMaxAllowedRepresentationRatioFor:function(e,t){y.max=y.max||{},y.max[e]=t},getInitialBitrateFor:function(e){var t=C.getSavedBitrateSettings(e);if(!h.hasOwnProperty(e))if(y.hasOwnProperty(e)){var r=R.getValue(),i=P.getAdaptationForType(r,0,e).Representation;if(Array.isArray(i)){var o=Math.max(Math.round(i.length*y[e])-1,0);h[e]=i[o].bandwidth}else h[e]=0}else isNaN(t)?h[e]=e===n.VIDEO?1e3:100:h[e]=t;return h[e]},setInitialBitrateFor:function(e,t){h[e]=t},getInitialRepresentationRatioFor:function(e){return y.hasOwnProperty(e)?y[e]:null},setInitialRepresentationRatioFor:function(e,t){y[e]=t},setAutoSwitchBitrateFor:function(e,t){c[e]=t},getAutoSwitchBitrateFor:le,getUseDeadTimeLatency:function(){return V},setUseDeadTimeLatency:function(e){V=e},setLimitBitrateByPortal:function(e){E=e},getLimitBitrateByPortal:function(){return E},getUsePixelRatioInLimitBitrateByPortal:function(){return b},setUsePixelRatioInLimitBitrateByPortal:function(e){b=e},getQualityFor:ge,getAbandonmentStateFor:function(e){return v[e]?v[e].state:null},setPlaybackQuality:de,checkPlaybackQuality:function(r){if(r&&m&&m[r]){var n=m[r].getStreamInfo(),i=n?n.id:null,u=ge(r),c=Q(e).create({abrController:o,streamProcessor:m[r],currentValue:u,switchHistory:L[r],droppedFramesHistory:x,useBufferOccupancyABR:me(r)});if(x){var l=I.getPlaybackQuality();l&&x.push(k,l)}if(le(r)){var d=ue(r),f=ie(r,i),p=s.getMaxQuality(c),h=p.quality;if(void 0!==d&&h<d&&(h=d),h>f&&(h=f),L[r].push({oldValue:u,newValue:h}),h>N.NO_CHANGE&&h!=u){if(v[r].state===re||h>u)return G[r]=!0,fe(r,u,h,f,p.reason),!0}else if(t.getABRLogVisible()){var y=j.getCurrentBufferLevel(B.getReadOnlyMetricsFor(r));a("AbrController ("+r+") stay on "+u+"/"+f+" (buffer: "+y+")")}}}return!1},getTopQualityIndexFor:ie,setElementSize:ve,setWindowResizeEventCalled:function(e){S=e},createAbrRulesCollection:function(){(s=W(e).create({metricsModel:B,dashMetrics:j,mediaPlayerModel:O,videoModel:I,adapter:D})).initialize()},registerStreamType:function(t,i){L[t]=Z(e).create(),m[t]=i,v[t]=v[t]||{},v[t].state=re,U[t]=!1,r.on(p.LOADING_PROGRESS,_e,this),r.on(p.FRAGMENT_LOADING_PROGRESS,z,this),t==n.VIDEO&&(r.on(p.QUALITY_CHANGE_RENDERED,$,this),x=X(e).create()),r.on(p.METRIC_ADDED,ne,this),M=ee(e).create({mediaPlayerModel:O})},unRegisterStreamType:function(e){delete m[e]},setDefaultQualityFor:function(e,t){q[e]=Number(t)||0,a("Set default quality for "+e+" - "+q[e])},getDefaultQualityFor:Ee,getDroppedFramesInfo:function(){return x&&x.getFrameInfo&&x.getFrameInfo()||{}},setCurrentSegmentInfoFor:function(e,t){K[e]=t},getCurrentSegmentInfoFor:function(e){return K[e]},getInitializeDate:function(){return H},getHasChangedByABRStrategy:function(e){return G[e]},setConfig:function(e){e&&(e.streamController&&(u=e.streamController),e.domStorage&&(C=e.domStorage),e.mediaPlayerModel&&(O=e.mediaPlayerModel),e.metricsModel&&(B=e.metricsModel),e.dashMetrics&&(j=e.dashMetrics),e.dashManifestModel&&(P=e.dashManifestModel),e.adapter&&(D=e.adapter),e.manifestModel&&(R=e.manifestModel),e.videoModel&&(I=e.videoModel),e.initializeDate&&(H=e.initializeDate))},getLastQnFragmentCompletedCnts:function(e,t){var r=m[e];return r?r.getFragmentModel().getLastQnFragmentCompletedCnts(t):0},getEffectiveBufferTime:function(){var e,t=O.getStableBufferTime(),r=I.getTime(),n=I.getDuration()-r,i=(new Date).getTime(),o=O.getLastStartSeekTime(),s=O.getStartPlaybackTime(),u=(i-Math.max(o,s))/1e3;return e=u<10?Math.min(10,t):Math.min(Math.min(n,u),t),a("【bolaV2 getEfc】max: "+t+", curTime: "+r+",playTime: "+u+", lseek: "+o),e},getPlaybackRate:function(){return I.getPlaybackRate()||1},reset:function(){J(!0),r.off(p.LOADING_PROGRESS,_e,this),r.off(p.FRAGMENT_LOADING_PROGRESS,z,this),r.off(p.QUALITY_CHANGE_RENDERED,$,this),r.off(p.METRIC_ADDED,ne,this),s&&s.reset()},shouldAbandon:function(e,t){var r=e.retry,n=e.retryTimes,i=e.bytesTotal,o=e.bytesLoaded;return r>0||n>0||+((i-o)/(1e3*M.getSafeAverageThroughput(t,!1))).toFixed(2)>j.getCurrentBufferLevel(B.getReadOnlyMetricsFor(t))-5},getRealBufferLevel:function(){var e=I.getVideoBufferRanges();if(!e||e.length<=0)return 0;var t=I.getTime();return e[e.length-1].end-t||0}},a=t.log.bind(o),J(),o}ne.__dashjs_factory_name="AbrController";var ie=s.a.getSingletonFactory(ne);ie.ABANDON_LOAD=te,ie.QUALITY_DEFAULT=0,s.a.updateSingletonFactory(ne.__dashjs_factory_name,ie);var oe=ie,ae="neverReplace",se="alwaysReplace",ue="highestBitrate",ce="widestRange",le=ue;function de(){var e,t=this.context,r=g(t).getInstance().log,i=d(t).getInstance(),o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=[se,ae],f=[ue,ce],h={video:0,audio:0};function y(e,t){if(!e||!t)return[];var r=t.id;return o[r]&&o[r][e]?o[r][e].list:[]}function m(e,t){return!e||!t||t&&!o[t.id]?null:o[t.id][e].current}function v(e){if(e){var t=e.type,r=e.streamInfo,n=r.id,a=m(t,r);if(o[n]&&o[n][t]&&(!a||!T(e,a))){o[n][t].current=e,a&&i.trigger(p.CURRENT_TRACK_CHANGED,{oldMediaInfo:a,newMediaInfo:e,switchMode:u[t]});var s=function(e){var t={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration};return t.lang||t.viewpoint||t.role&&t.role.length>0||t.accessibility&&t.accessibility.length>0||t.audioChannelConfiguration&&t.audioChannelConfiguration.length>0?t:null}(e);s&&o[n][t].storeLastSettings&&(s.roles&&(s.role=s.roles[0],delete s.roles),s.accessibility&&(s.accessibility=s.accessibility[0]),s.audioChannelConfiguration&&(s.audioChannelConfiguration=s.audioChannelConfiguration[0]),c.setSavedMediaSettings(t,s))}}}function _(e,t){e&&t&&(a[e]=t)}function E(e){return e?a[e]:null}function b(){return s||le}function S(e){return e===n.AUDIO||e===n.VIDEO||e===n.TEXT||e===n.FRAGMENTED_TEXT||e===n.IMAGE}function T(e,t){var r=e.id===t.id,n=e.viewpoint===t.viewpoint,i=e.lang===t.lang,o=e.roles.toString()===t.roles.toString(),a=e.accessibility.toString()===t.accessibility.toString(),s=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString();return r&&n&&i&&o&&a&&s}function w(){o={},a={audio:null,video:null},u={audio:se,video:ae}}function A(e,t){var r=!e.lang||e.lang===t.lang,n=!e.viewpoint||e.viewpoint===t.viewpoint,i=!e.role||!!t.roles.filter((function(t){return t===e.role}))[0],o=!e.accessibility||!!t.accessibility.filter((function(t){return t===e.accessibility}))[0],a=!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter((function(t){return t===e.audioChannelConfiguration}))[0];return r&&n&&i&&o&&a}function R(e){var t=b(),n=[],i=function(e){var t=0,r=[],n=void 0;return e.forEach((function(e){
(n=Math.max.apply(Math,e.bitrateList.map((function(e){return e.bandwidth}))))>t?(t=n,r=[e]):n===t&&r.push(e)})),r},o=function(e){var t=0,r=[],n=void 0;return e.forEach((function(e){(n=e.representationCount)>t?(t=n,r=[e]):n===t&&r.push(e)})),r};switch(t){case ue:(n=i(e)).length>1&&(n=o(n));break;case ce:(n=o(e)).length>1&&(n=i(e));break;default:r("track selection mode is not supported: "+t)}return n[0]}return e={checkInitialMediaSettingsForType:function(e,t){var r=E(e),i=y(e,t),o=[];e!==n.FRAGMENTED_TEXT?(r||_(e,r=c.getSavedMediaSettings(e)),i&&0!==i.length&&(r&&i.forEach((function(e){A(r,e)&&o.push(e)})),0===o.length?v(R(i)):o.length>1?v(R(o)):v(o[0]))):v(i[0])},addTrack:function(e){if(e){var t=e.type;if(S(t)){var r=e.streamInfo.id;o[r]||(o[r]={audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},fragmentedText:{list:[],storeLastSettings:!0,current:null},image:{list:[],storeLastSettings:!0,current:null}});for(var n=o[r][t].list,i=0,a=n.length;i<a;++i)if(T(n[i],e))return;n.push(e);var s=E(t);s&&A(s,e)&&!m(t,e.streamInfo)&&v(e)}}},getTracksFor:y,getCurrentTrackFor:m,isCurrentTrack:function(e){var t=e.type,r=e.streamInfo.id;return o[r]&&o[r][t]&&T(o[r][t].current,e)},setTrack:v,setInitialSettings:_,getInitialSettings:E,setSwitchMode:function(e,t){-1!==l.indexOf(t)?u[e]=t:r("track switch mode is not supported: "+t)},getSwitchMode:function(e){return u[e]},setSelectionModeForInitialTrack:function(e){-1!==f.indexOf(e)?s=e:r("track selection mode is not supported: "+e)},getSelectionModeForInitialTrack:b,isMultiTrackSupportedByType:S,isTracksEqual:T,setStartOffsetTimeForType:function(e,t){e&&t>0&&(h[e]=t)},getStartOffsetTimeForType:function(e){return h[e]||0},setConfig:function(e){e&&(e.errHandler&&e.errHandler,e.domStorage&&(c=e.domStorage))},reset:w},w(),e}de.__dashjs_factory_name="MediaController";var fe=s.a.getSingletonFactory(de);fe.TRACK_SWITCH_MODE_NEVER_REPLACE=ae,fe.TRACK_SWITCH_MODE_ALWAYS_REPLACE=se,fe.TRACK_SELECTION_MODE_HIGHEST_BITRATE=ue,fe.TRACK_SELECTION_MODE_WIDEST_RANGE=ce,fe.DEFAULT_INIT_TRACK_SELECTION_MODE=le,s.a.updateSingletonFactory(de.__dashjs_factory_name,fe);var pe=fe,he=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=t._offset,this.type=t.type,this.size=t.size,this.boxes=[],t.boxes)for(var r=0;r<t.boxes.length;r++)this.boxes.push(new e(t.boxes[r]));switch(this.isComplete=!0,t.type){case"sidx":if(this.timescale=t.timescale,this.earliest_presentation_time=t.earliest_presentation_time,this.first_offset=t.first_offset,this.references=t.references,t.references){this.references=[];for(var n=0;n<t.references.length;n++){var i={reference_type:t.references[n].reference_type,referenced_size:t.references[n].referenced_size,subsegment_duration:t.references[n].subsegment_duration};this.references.push(i)}}break;case"emsg":this.id=t.id,this.value=t.value,this.timescale=t.timescale,this.scheme_id_uri=t.scheme_id_uri,this.presentation_time_delta=t.presentation_time_delta,this.event_duration=t.event_duration,this.message_data=t.message_data;break;case"mdhd":case"mvhd":this.timescale=t.timescale;break;case"mfhd":this.sequence_number=t.sequence_number;break;case"subs":this.entry_count=t.entry_count,this.entries=t.entries;break;case"tfhd":this.base_data_offset=t.base_data_offset,this.sample_description_index=t.sample_description_index,this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"tfdt":this.version=t.version,this.baseMediaDecodeTime=t.baseMediaDecodeTime,this.flags=t.flags;break;case"trun":if(this.sample_count=t.sample_count,this.first_sample_flags=t.first_sample_flags,this.data_offset=t.data_offset,this.flags=t.flags,this.samples=t.samples,t.samples){this.samples=[];for(var o=0,a=t.samples.length;o<a;o++){var s={sample_size:t.samples[o].sample_size,sample_duration:t.samples[o].sample_duration,sample_composition_time_offset:t.samples[o].sample_composition_time_offset};this.samples.push(s)}}break;case"elst":this.boxes=t.entries}}return e.prototype.getChildBox=function(e){for(var t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t]},e.prototype.getChildBoxes=function(e){for(var t=[],r=0;r<this.boxes.length;r++)this.boxes[r].type===e&&t.push(this.boxes[r]);return t},e}();function ye(){var e=void 0;function t(t){var n=[];if(!t||!e||"function"!=typeof e.fetchAll)return n;for(var i=e.fetchAll(t),o=void 0,a=0,s=i.length;a<s;a++)(o=r(i[a]))&&n.push(o);return n}function r(e){if(!e)return null;var t=new he(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}return{getBox:function(t){return t&&e&&e.boxes&&0!==e.boxes.length&&"function"==typeof e.fetch?r(e.fetch(t)):null},getBoxes:t,setData:function(t){e=t},getLastBox:function(){if(!e||!e.boxes||!e.boxes.length)return null;var r=t(e.boxes[e.boxes.length-1].type);return r.length>0?r[r.length-1]:null}}}ye.__dashjs_factory_name="IsoFile";var me=s.a.getClassFactory(ye),ge=r(1),ve=r.n(ge),_e=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastCompletedOffset=t,this.found=r,this.size=n};function Ee(){var e=this.context;function t(e,t){return e[t+3]>>>0|e[t+2]<<8>>>0|e[t+1]<<16>>>0|e[t]<<24>>>0}function r(e,t){return String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t])}return{parse:function(t){if(!t)return null;void 0===t.fileStart&&(t.fileStart=0);var r=ve.a.parseBuffer(t),n=me(e).create();return n.setData(r),n},findLastTopIsoBoxCompleted:function(e,n,i){if(void 0===i&&(i=0),!n||i+8>=n.byteLength)return new _e(0,!1);for(var o=n instanceof ArrayBuffer?new Uint8Array(n):n,a=void 0,s=0;i<o.byteLength;){var u=t(o,i),c=r(o,i+4);if(0===u)break;i+u<=o.byteLength&&(e.indexOf(c)>=0?a=new _e(i,!0,u):s=i+u),i+=u}return a||new _e(s,!1)}}}Ee.__dashjs_factory_name="BoxParser";var be=s.a.getSingletonFactory(Ee);function Se(){var e={};return{save:function(t){var r=t.streamId,n=t.representationId;e[r]=e[r]||{},e[r][n]=t},extract:function(t,r){return e&&e[t]&&e[t][r]?e[t][r]:null},reset:function(){e={}}}}Se.__dashjs_factory_name="InitCache";var Te=s.a.getSingletonFactory(Se),we=[1,3,7];function Ae(e){e=e||{};var t,r=this.context,i=e.bufferController,o=e.mediaPlayerModel,a=d(r).getInstance(),s=1,u=void 0,c=void 0;function l(e){e.chunk.mediaInfo.type===n.AUDIO&&y(e.chunk.bytes)}function f(e){u&&e.sender.getType()===n.AUDIO&&(u=!1,a.trigger(p.SWITCH_AUDIO_TRACK_RENDERED,{id:o.getAudioTrackId(),index:e.index,startTime:e.startTime}))}function h(){return o.getAudioTrackId()!==s}function y(e){for(var t=ve.a.parseBuffer(e).fetchAll("tkhd"),r=[],n=0;n<t.length;n++){var i=t[n],a={id:i.track_ID,enabled:!1,flags:i.flags};we.includes(i.flags)&&(s=i.track_ID,a.enabled=!0),r.push(a)}c("【AudioTrackController】parse tkhd success, default tracks is "+s),o.setAudioTrackIds(r)}return t={AudioTrackControllerType:function(){return"AudioTrackController"},shouldSwitchTrack:h,canUseNativeFomular:function(){var e=i.getBuffer(),t=e.getBuffer();return e&&t&&t.audioTracks&&!1},switchByAudioTracks:function(){var e=i.getBuffer().getBuffer().audioTracks,t=Object.values(e).find((function(e){return e.enabled=!0})),r=o.getAudioTrackId(),n=e.getTrackById(r),a=!0;t&&(t.enabled=!1),e.addEventListener("change",(function(){a&&n&&(n.enabled=!0),a=!1}))},switchByModifyTrackId:function(e){if(e&&h()){var t=e.bytes,r=ve.a.parseBuffer(t).fetchAll("tfhd");if(r&&r.length>1){var n=o.getAudioTrackId(),i=r.find((function(e){return e.track_ID===s})),a=r.find((function(e){return e.track_ID===n}));i&&a&&(i._raw.setUint32(12,n),a._raw.setUint32(12,s),e.trackSwitchInfo={id:n})}}},setDefaultTrackId:y,revertDefaultTrack:function(e){if(e&&e.trackSwitchInfo){var t=e.bytes,r=e.trackSwitchInfo.id,n=ve.a.parseBuffer(t).fetchAll("tfhd");if(n&&n.length>1){var i=n.find((function(e){return e.track_ID===s})),o=n.find((function(e){return e.track_ID===r}));i&&o&&(i._raw.setUint32(12,r),
o._raw.setUint32(12,s),e.trackSwitchInfo=null)}}},setSwitchingState:function(e){u=e},initialize:function(){a.on(p.BYTES_APPENDED_END_FRAGMENT,f,this),a.on(p.INIT_FRAGMENT_LOADED,l,this)},reset:function(){u=!1,a.off(p.BYTES_APPENDED_END_FRAGMENT,f,this),a.off(p.INIT_FRAGMENT_LOADED,l,this)}},c=g(r).getInstance().log.bind(t),u=!1,t}Ae.__dashjs_factory_name="AudioTrackController";var Re=s.a.getClassFactory(Ae),Pe="bufferLoaded",De="bufferStalled",Ie=.5,Oe=.01,Ce="BufferController";function Ne(e){e=e||{};var t=this.context,r=d(t).getInstance(),i=e.metricsModel,o=e.mediaPlayerModel,a=e.errHandler,s=e.streamController,u=e.mediaController,c=e.adapter,l=e.abrController,f=e.playbackController,h=e.type,m=e.streamProcessor,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,w=void 0,A=void 0,P=void 0,I=void 0,O=void 0,C=void 0,N=void 0,k=void 0,L=void 0,x=void 0,M=void 0,U=void 0,B=void 0,j=void 0,V=void 0,G=void 0,H=void 0,q=void 0,W=void 0,Y=void 0,K=void 0,Q=void 0,z=void 0,Z=void 0,J=void 0;function X(e){var t=e.time;if(O&&O.getBuffer()&&J.length){var r=O.getBuffer().buffered;if(r&&r.length>=1&&r.end(r.length-1)-t<=.5){var n=J.shift();n&&(z.switchByModifyTrackId(n),ie(n))}}}function $(){if(z.setSwitchingState(!0),k){var e=f.getTime();k.end-e>2&&(!z.shouldSwitchTrack()&&k.trackSwitchInfo?z.revertDefaultTrack(k):(k.trackSwitchInfo&&z.revertDefaultTrack(k),z.switchByModifyTrackId(k)),ie(k,!0))}}function ee(){var e=f.getTime(),t=de();0===t.length&&ge().length>0&&(t=[{start:ge().start(0)}]),t.length<=0||(t[t.length-1].end=e-1,t.forEach((function(e){e.force=!0})),Ae(t))}function te(e){if(!U||!e||!m)return null;if(A)try{"function"==typeof(O=R(t).create(A,e,se.bind(this))).getBuffer().initialize&&O.getBuffer().initialize(h,m),r.trigger(p.BUFFER_CREATED,{mediaType:e.type})}catch(e){_("Caught error on create SourceBuffer: "+e),a.mediaSourceError("Error creating "+h+" source buffer.")}else O=D(t).create(se.bind(this));var n=m.getRepresentationInfoForQuality(E).MSETimeOffset||Y;m.getRepresentationInfoForQuality(E)&&Le(n)}function re(e){e.fragmentModel===m.getFragmentModel()&&(_("Init fragment finished loading saving to",h+"'s init cache"),_("Append Init fragment",h," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality),O?O.setAppendWindowEnd(o.getCachedDurationOffset("duration")):Q=function(){var e=o.getCachedDurationOffset("duration");O.setAppendWindowEnd(e)},ie(e.chunk))}function ne(e){if(e.fragmentModel===m.getFragmentModel()){var i=e.chunk,a=i.bytes,s=i.quality,u=m.getRepresentationInfoForQuality(s),l=c.getEventsFor(u.mediaInfo,m),d=c.getEventsFor(u,m),y=o.getEnableMultipleAudioTracks();if(l&&l.length>0||d&&d.length>0){var g=function(e,r,n,i){for(var o=Math.max(!r||isNaN(r.startTime)?0:r.startTime,0),a=[],s=[],u=n.concat(i),l=0,d=u.length;l<d;l++)a[u[l].schemeIdUri]=u[l];for(var f=be(t).getInstance().parse(e).getBoxes("emsg"),p=0,h=f.length;p<h;p++){var y=c.getEvent(f[p],a,o);y&&s.push(y)}return s}(a,m.getFragmentModel().getRequests({state:T.FRAGMENT_MODEL_EXECUTED,quality:s,index:i.index})[0],l,d);m.getEventController().addInbandEvents(g)}if(H){q=i;var E=O&&ge();E&&E.length>0&&f.getTimeToStreamEnd()>Ie&&(_("Clearing buffer because track changed - "+(E.end(E.length-1)+.5)),Ae([{start:0,end:E.end(E.length-1)+.5,force:!0}]))}else h===n.AUDIO&&i.mediaInfo.type===n.AUDIO&&y?function(e){var t;if(t=f.getTime(),0===e.index||e.start<=t&&t<=e.end)_("【Multi Audio】append multi audio chunk: "+e.index+"-"+e.start+"-"+e.end),z.switchByModifyTrackId(e),ie(e);else{var n={sender:v,index:e.index},i=J.findIndex((function(t){return t.index===e.index}));if(-1!==i)return _("【Multi Audio】multi audio identical chunk emerged, replacing it: "+e.index),void(J[i]=e);J.push(e),e.fromMulti=!0,r.trigger(p.MULTI_AUDIO_TRACK_APPEND,n)}}(i):ie(i)}}function ie(e,t){!x||t?(x=!0,k=e,e.startOffsetTime=u.getStartOffsetTimeForType(e.mediaInfo.type),O?O.append(e):W.push(e),e.mediaInfo.type===n.VIDEO&&r.trigger(p.VIDEO_CHUNK_RECEIVED,{chunk:e})):G.push(e)}function ae(e){if(e.mediaType===h&&(Q&&(Q(),Q=null),W.length))for(var t=Date.now(),n=e.mediaType,i=l.getInitializeDate(),a=0;a<W.length;a++){var s=W[a];s&&s.mediaInfo.type===n&&O&&O.append&&(W[a]=null,Y&&(Le(Y),Y=0),O.append(s),r.trigger(p.DELAY_TO_APPEND_TO_BUFFER,{mediaType:n,appendTime:t-i,createdTime:Date.now()-i,isPreload:!!o.getPreloadData()}))}}function se(e){if(e.error){if(22===e.error.code&&(w=.8*Ge(),_("Quota exceeded for type: "+h+", Critical Buffer: "+w),w>0)){var t=Math.max(.2*w,1),n=w-t;o.setBufferToKeep(parseFloat(t).toFixed(5)),o.setBufferAheadToKeep(parseFloat(n).toFixed(5))}22!==e.error.code&&He()||(_("Clearing playback buffer to overcome quota exceed situation for type: "+h),r.trigger(p.QUOTA_EXCEEDED,{sender:v,criticalBufferLevel:w,mediaType:h}),le(),x=!1)}else{(k=e.chunk)&&!isNaN(k.index)&&(P=Math.max(k.index,P),Ee());var i=ge();if(k.segmentType===F.MEDIA_SEGMENT_TYPE)fe();else if(H){var a=f.getTime();_("[BufferController][",h,"] appendToBuffer seek target should be "+a),m.getScheduleController().setSeekTarget(a),c.setIndexHandlerTime(m,a)}var s={sender:v,quality:k.quality,startTime:k.start,index:k.index,fromMulti:k.fromMulti,bufferedRanges:i};k&&!k.endFragment?r.trigger(p.BYTES_APPENDED,s):k&&r.trigger(p.BYTES_APPENDED_END_FRAGMENT,s),0===G.length?x=!1:ie(G.shift(),!0)}}function ue(e){E!==e.newQuality&&h===e.mediaType&&m.getStreamInfo().id===e.streamInfo.id&&(Le(m.getRepresentationInfoForQuality(e.newQuality).MSETimeOffset),E=e.newQuality)}function ce(){if(b&&(j=!0,b=!1,I=Number.POSITIVE_INFINITY),G=[],x=!1,h!==n.FRAGMENTED_TEXT){var e=ge(),t=o.getEnableMultipleAudioTracks(),r=!0;if(e&&e.length>0)for(var i=f.getTime(),a=0,s=e.length;a<s;a++)i>=e.start(a)&&i<=e.end(a)-1&&(r=!1);r?(h===n.AUDIO&&t&&function(e){if(J.length>0){var t=J.findIndex((function(t){return t.start<=e&&t.end>e}));if(-1!==t){var r=J[t],n=J.slice(t+1);J=n,r&&(_("【Multi Audio】find multi audio chunk in buffer list after seeking: "+r.index),z.switchByModifyTrackId(r),ie(r))}else J.length=0}}(f.getTime()),m.getFragmentModel().clearExecutedRequestBySeeking(),le()):fe()}else fe();B=void 0}function le(){var e=de();e&&0!==e.length||fe(),Ae(e)}function de(){var e=[],t=ge();if(!t||0===t.length)return e;var r=f.getTime(),n=t.end(t.length-1)+.5,i=m.getFragmentModel().getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:r,threshold:Oe})[0];if(i){var o={start:0,end:i.startTime-Ie},a=m.getFragmentModel().getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:i.startTime-i.duration/2,threshold:Oe})[0];a&&a.startTime!=i.startTime&&(o.end=a.startTime),o.start<o.end&&o.end>t.start(0)&&e.push(o);var s={start:i.startTime+i.duration+Ie,end:n},u=m.getFragmentModel().getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:i.startTime+i.duration+Ie,threshold:Oe})[0];u&&u.startTime!==i.startTime&&(s.start=u.startTime+u.duration+Ie),s.start<s.end&&s.start<n&&e.push(s)}else _("getAllRangesWithSafetyFactor for",h,"- No request found in current time position, removing full buffer 0 -",n),e.push({start:0,end:n});return e}function fe(){H||(ve(),_e())}function he(){Se()}function ye(){Se()}function me(e,t){var r=O&&ge(),n=0,i=0,o=null,a=null,s=0,u=void 0,c=void 0,l=t||.15;if(null!=r){for(c=0,u=r.length;c<u;c++)if(n=r.start(c),i=r.end(c),null===o)s=Math.abs(n-e),(e>=n&&e<i||s<=l)&&(o=n,a=i);else{if(!((s=n-a)<=l))break;a=i}if(null!==o)return{start:o,end:a}}return null}function ge(){var e=O.getAllBufferRanges();if(0===e.length)return[];for(var t=e.start(0),r=e.start(0),n=[],i=0;i<e.length;i++)Math.abs(e.start(i)-r)<=.5||Math.abs(e.start(i)-r-5)<=.1?(r=e.end(i),Math.abs(e.start(i)-r-5)<=.1&&(_("Browser has dropped five seconds buffer from "+r+"s to "+e.start(i)+"s"),m.getFragmentModel().removeExecutedRequestsInTimeRange(r,e.start(i)),c.setIndexHandlerTime(m,r))):(r>t&&n.push({start:t,end:r}),t=e.start(i),r=e.end(i));return r>t&&n.push({start:t,end:r}),{length:n.length,start:function(e){return n[e].start},end:function(e){return n[e].end}}}function ve(){var e,t;f&&(e=function(){var e=f.getTime();if(B){var t=ge();t&&t.length&&(e=Math.max(t.start(0),B))}return e}()||0,S=null===(t=me(e,void 0))?0:t.end-e,r.trigger(p.BUFFER_LEVEL_UPDATED,{sender:v,bufferLevel:S}),Se())}function _e(){
m&&s&&m.getStreamInfo().id===s.getActiveStreamInfo().id&&(i.addBufferState(h,N,m.getScheduleController().getBufferTarget()),i.addBufferLevel(h,new Date,1e3*S))}function Ee(){P>=I-1&&!b&&void 0===O.discharge&&(b=!0,_("[BufferController]["+h+"] checkIfBufferingCompleted trigger BUFFERING_COMPLETED"),r.trigger(p.BUFFERING_COMPLETED,{sender:v,streamInfo:m.getStreamInfo()}))}function Se(){if("audio"===h||"video"===h){var e=f.getTimeToStreamEnd()-S;if(j&&!b&&f&&e<.5)if(f.getTimeToStreamEnd()>.5){for(var t=c.getIndexHandlerTime(m),n=m.getIndexHandler(),i=m.getCurrentRepresentationInfo(),a=n.getIndex(),s=c.getFragmentRequestForTime(m,i,t,{keepIdx:!1});s&&s.action!==y.ACTION_COMPLETE&&m.getFragmentModel().isFragmentLoaded(s);)s=c.getNextFragmentRequest(m,i);n.setIndex(a),s&&s.action===y.ACTION_COMPLETE?(b=!0,j=!1,_("[BufferController]["+h+"] checkIfSufficientBuffer trigger BUFFERING_COMPLETED"),r.trigger(p.BUFFERING_COMPLETED,{sender:v,streamInfo:m.getStreamInfo()})):b=!1}else _("[BufferController]["+h+"] handle the fragment which duration may be less than 0.5s");S<Ie&&!b?we(De):(b||S>=o.getStableBufferTime())&&we(Pe)}}function we(e){N===e||e===De&&0===f.getTime()||(N=e,_e(),r.trigger(p.BUFFER_LEVEL_STATE_CHANGED,{sender:v,state:e,mediaType:h,streamInfo:m.getStreamInfo()}),r.trigger(e===Pe?p.BUFFER_LOADED:p.BUFFER_EMPTY,{mediaType:h}),_(e===Pe?"Got enough buffer to start for "+h:"Waiting for more buffer before starting playback for "+h))}function Ae(e){e&&O&&0!==e.length&&(V.push.apply(V,e),M||Ne())}function Ne(){if(0===V.length||!O)return _("Nothing to prune, halt pruning"),V=[],void(M=!1);var e=O.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return _("SourceBuffer is empty (or does not exist), halt pruning"),V=[],void(M=!1);var t=V.shift();_("Removing",h,"buffer from:",t.start,"to",t.end),M=!0;var r=f.getTime();r<t.end&&(b=!1,P=0,H||(m.getScheduleController().setSeekTarget(r),c.setIndexHandlerTime(m,r)));var n=s.getDuration()-1;n&&0===t.start&&t.end>=n&&(t.force=!0),O.remove(t.start,t.end,t.force)}function ke(e){O===e.buffer&&(_("[BufferController][",h,"] onRemoved buffer from:",e.from,"to",e.to),0===V.length&&(M=!1),e.unintended&&(_("[BufferController][",h,"] detected unintended removal from:",e.from,"to",e.to,"setting index handler time to",e.from),c.setIndexHandlerTime(m,e.from)),M?Ne():(H?(H=!1,q&&ie(q)):(_("onRemoved : call updateBufferLevel"),ve()),r.trigger(p.BUFFER_CLEARED,{sender:v,from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:He()})))}function Le(e){0!==e&&(O&&O.updateTimestampOffset?O.updateTimestampOffset(e):Y=e)}function xe(e){if(e.sender.getStreamProcessor()===m&&!e.error){var t=0;try{t=e.currentRepresentation.segmentAvailabilityRange.start}catch(e){}Le(t)}}function Me(e){e.fragmentModel===m.getFragmentModel()&&(I=e.request.index,Ee())}function Fe(e){var t=O&&ge();t&&e.newMediaInfo.type===h&&e.newMediaInfo.streamInfo.id===m.getStreamInfo().id&&(_("[BufferController]["+h+"] track change asked"),u.getSwitchMode(h)===pe.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&t&&t.length>0&&f.getTimeToStreamEnd()>Ie&&(b=!1,I=Number.POSITIVE_INFINITY))}function Ue(){++L*(o.getWallclockTimeUpdateInterval()/1e3)>=o.getBufferPruningInterval()&&(L=0,O&&h!==n.FRAGMENTED_TEXT&&(b||Ae(function(){var e=[],t=ge();if(!t||0===t.length)return e;var r=f.getTime(),n={start:Math.max(0,r-o.getBufferToKeep()),end:r+o.getBufferAheadToKeep()},i=m.getFragmentModel().getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:r,threshold:Oe})[0];if(i)n.start=Math.min(i.startTime,n.start),n.end=Math.max(i.startTime+i.duration,n.end);else if(0===r&&f.getIsDynamic())return[];if(t.start(0)<=n.start){for(var a={start:0,end:n.start},s=0;s<t.length&&t.end(s)<=n.start;s++)a.end=t.end(s);a.start<a.end&&e.push(a)}if(t.end(t.length-1)>=n.end){var u={start:n.end,end:t.end(t.length-1)+Oe};u.start<u.end&&e.push(u)}return e}())))}function Be(){Se()}function je(){if(o.getAppendingSourceState()){b=!1,I=Number.POSITIVE_INFINITY,U.reset();var e=o.getCachedDurationOffset("offset");c.setIndexHandlerTime(m,e),m.resetPreloadData(),m.getFragmentModel().resetInitialSettings()}}function Ve(e,t){A=e,O&&t&&"function"==typeof O.discharge&&(C=O,te(t))}function Ge(){var e,t=ge(),r=0,n=void 0;if(!t)return r;for(n=0,e=t.length;n<e;n++)r+=t.end(n)-t.start(n);return r}function He(){return Ge()<w}function qe(e){w=Number.POSITIVE_INFINITY,N=void 0,E=oe.QUALITY_DEFAULT,I=Number.POSITIVE_INFINITY,P=0,k=null,b=!1,x=!1,M=!1,j=!1,S=0,L=0,V=[],W=[],O&&(e||O.abort(),O.reset(),O=null),H=!1,J=[]}return v={getBufferControllerType:function(){return Ce},initialize:function(e){Ve(e),E=l.getQualityFor(h,m.getStreamInfo()),r.on(p.DATA_UPDATE_COMPLETED,xe,this),r.on(p.INIT_FRAGMENT_LOADED,re,this),r.on(p.MEDIA_FRAGMENT_LOADED,ne,this),r.on(p.QUALITY_CHANGE_REQUESTED,ue,this),r.on(p.STREAM_COMPLETED,Me,this),r.on(p.PLAYBACK_PLAYING,ye,this),r.on(p.PLAYBACK_PROGRESS,fe,this),r.on(p.PLAYBACK_TIME_UPDATED,fe,this),r.on(p.PLAYBACK_RATE_CHANGED,Be,this),r.on(p.PLAYBACK_SEEKING,ce,this),r.on(p.PLAYBACK_STALLED,he,this),r.on(p.WALLCLOCK_TIME_UPDATED,Ue,this),r.on(p.CURRENT_TRACK_CHANGED,Fe,this,d.EVENT_PRIORITY_HIGH),r.on(p.SOURCEBUFFER_REMOVE_COMPLETED,ke,this),r.on(p.BUFFER_CREATED,ae,this),r.on(p.APPENDING_NEXT_SOURCE,je,this),h===n.AUDIO&&o.getEnableMultipleAudioTracks()&&(r.on(p.SWITCH_AUDIO_TRACK_REQUEST,$,this),r.on(p.SWITCH_AUDIO_TRACK_RENDERED,ee,this),r.on(p.PLAYBACK_TIME_UPDATED,X,this))},createBuffer:te,dischargePreBuffer:function(){if(O&&C&&"function"==typeof C.discharge){var e=C.getAllBufferRanges();if(e.length>0){for(var t="Beginning "+h+"PreBuffer discharge, adding buffer for:",r=0;r<e.length;r++)t+=" start: "+e.start(r)+", end: "+e.end(r)+";";_(t)}else _("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");for(var n=C.discharge(),i=null,o=0;o<n.length;o++){var a=n[o],s=U.extract(a.streamId,a.representationId);s&&(i!==s&&(O.append(s),i=s),O.append(a))}C.reset(),C=null}},getType:function(){return h},getStreamProcessor:function(){return m},setSeekStartTime:function(e){B=e},getBuffer:function(){return O},getBufferLevel:function(){return S},getRangeAt:me,setMediaSource:Ve,getMediaSource:function(){return A},getIsBufferingCompleted:function(){return b},switchInitData:function(e,t,n){var i=U.extract(e,t);H=!0===n&&n,K=o.getAppendingSourceState(),i&&!K?(_("Append Init fragment",h," with representationId:",i.representationId," and quality:",i.quality),ie(i)):(K&&(K=!1,H=!1),r.trigger(p.INIT_REQUESTED,{sender:v}))},getIsPruningInProgress:function(){return M},reset:function(e){r.off(p.DATA_UPDATE_COMPLETED,xe,this),r.off(p.QUALITY_CHANGE_REQUESTED,ue,this),r.off(p.INIT_FRAGMENT_LOADED,re,this),r.off(p.MEDIA_FRAGMENT_LOADED,ne,this),r.off(p.STREAM_COMPLETED,Me,this),r.off(p.CURRENT_TRACK_CHANGED,Fe,this),r.off(p.PLAYBACK_PLAYING,ye,this),r.off(p.PLAYBACK_PROGRESS,fe,this),r.off(p.PLAYBACK_TIME_UPDATED,fe,this),r.off(p.PLAYBACK_RATE_CHANGED,Be,this),r.off(p.PLAYBACK_SEEKING,ce,this),r.off(p.PLAYBACK_STALLED,he,this),r.off(p.WALLCLOCK_TIME_UPDATED,Ue,this),r.off(p.SOURCEBUFFER_REMOVE_COMPLETED,ke,this),r.off(p.BUFFER_CREATED,ae,this),r.off(p.APPENDING_NEXT_SOURCE,je,this),h===n.AUDIO&&o.getEnableMultipleAudioTracks()&&(r.off(p.SWITCH_AUDIO_TRACK_REQUEST,$,this),r.off(p.SWITCH_AUDIO_TRACK_RENDERED,ee,this),r.off(p.PLAYBACK_TIME_UPDATED,X,this),z&&(z.reset(),z=null)),clearInterval(Z),Z=-1,qe(e)},getStoreBufferLevel:function(){if(J.length){var e=f.getTime();return J[J.length-1].end-e}return 0},getMultiBufferRanges:function(){for(var e=ge(),t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});if(J&&J.length>0){var n=t.length,i=J[J.length-1].end;t.length>0?t[n-1].end=i:t.push({start:J[0].start,end:i})}return t},getBufferRanges:ge},_=g(t).getInstance().log.bind(v),U=Te(t).getInstance(),G=[],W=[],Y=0,h===n.AUDIO&&o.getEnableMultipleAudioTracks()&&(_("【Multi Audio】enable multiple audio tracks and init audio track controller"),(z=Re(t).create({bufferController:v,mediaPlayerModel:o,playbackController:f})).initialize(),Z=setInterval((function(){X({time:f.getTime()})}),50)),qe(),v}Ne.__dashjs_factory_name=Ce;var ke=s.a.getClassFactory(Ne);ke.BUFFER_LOADED=Pe,ke.BUFFER_EMPTY=De,
s.a.updateClassFactory(Ne.__dashjs_factory_name,ke);var Le=ke,xe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null};function Me(){var e=void 0;return{initialize:function(t){if(e=new xe,!t)return null;var r=t.indexOf("#");if(-1!==r)for(var n=t.substr(r+1).split("&"),i=0,o=n.length;i<o;++i){var a=n[i],s=a.indexOf("=");if(-1!==s){var u=a.substring(0,s);e.hasOwnProperty(u)&&(e[u]=a.substr(s+1))}}},getURIFragmentData:function(){return e}}}Me.__dashjs_factory_name="URIFragmentModel";var Fe=s.a.getSingletonFactory(Me);function Ue(){var e,t=this.context,r=g(t).getInstance().log,i=d(t).getInstance(),o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,y=void 0,m=void 0,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,T=void 0,w=void 0,A=void 0;function R(e){!b&&e.fromStreamInfo&&void 0!==m[e.fromStreamInfo.id]&&(delete _[e.fromStreamInfo.id],delete m[e.fromStreamInfo.id])}function P(){var e=B(!0),t=b?e-E.start:0;return parseFloat((e+(E.duration-t)-k()).toFixed(5))}function D(){if(E&&f&&f.getElement())return f.play();T=!0}function I(){return E&&f?f.isPaused():null}function O(){E&&f&&f.pause()}function C(){return E&&f?f.isSeeking():null}function N(e){E&&f&&(i.trigger(p.PLAYBACK_SEEK_ASKED),r("Requesting seek to time: "+e+" from "+k()),f.setCurrentTime(e))}function k(){return E&&f?f.getTime():null}function L(){return E&&f?f.getPlaybackRate():null}function x(){return E&&f?f.getEnded():null}function M(){return b}function F(){h=NaN,T=!1,m={},v=0,A=0,_={},f&&(i.off(p.DATA_UPDATE_COMPLETED,H,this),i.off(p.BUFFER_LEVEL_STATE_CHANGED,ie,this),i.off(p.BYTES_APPENDED_END_FRAGMENT,ne,this),i.off(p.PERIOD_SWITCH_STARTED,R,this),V(),f.removeEventListener("canplay",q),f.removeEventListener("play",W),f.removeEventListener("waiting",Y),f.removeEventListener("playing",K),f.removeEventListener("pause",Q),f.removeEventListener("error",re),f.removeEventListener("seeking",z),f.removeEventListener("seeked",Z),f.removeEventListener("timeupdate",J),f.removeEventListener("progress",X),f.removeEventListener("ratechange",$),f.removeEventListener("loadedmetadata",ee),f.removeEventListener("ended",te),f.removeEventListener("stalled",oe)),f=null,E=null,b=null,y=null}function U(){var e=Fe(t).getInstance().getURIFragmentData(),r=void 0;if(e){r={};var n=parseInt(e.r,10);n>=0&&E&&n<E.manifestInfo.DVRWindowSize&&null===e.t&&(e.t=Math.floor(Date.now()/1e3)-E.manifestInfo.DVRWindowSize+n),r.fragS=parseInt(e.s,10),r.fragT=parseInt(e.t,10)}return r}function B(e,t){var r,n=void 0,i=U();if(r=i?e?E.start||S.getPlayAt():isNaN(i.fragS)?i.fragT:i.fragS:S.getPlayAt()||0,b)isNaN(r)||((n=r-E.manifestInfo.availableFrom.getTime()/1e3)>h||n<(isNaN(t)?NaN:t-E.manifestInfo.DVRWindowSize))&&(n=null),n=n||h;else if(!isNaN(r)&&r<Math.max(E.manifestInfo.duration,E.duration)&&r>=0)n=r;else{var o=m[E.id];n=void 0!==o?Math.max(void 0!==o.audio?o.audio:0,void 0!==o.video?o.video:0,E.start):E.start}return n}function j(){null===y&&(y=setInterval((function(){var e;i.trigger(p.WALLCLOCK_TIME_UPDATED,{isDynamic:b,time:new Date}),M()&&I()&&(e=Date.now(),(!w||e>w+500)&&(w=e,J()))}),S.getWallclockTimeUpdateInterval()))}function V(){clearInterval(y),y=null}function G(){if(!I()&&b&&0!==f.getReadyState()){var e=k(),t=function(e){var t=a.getReadOnlyMetricsFor(n.VIDEO)||a.getReadOnlyMetricsFor(n.AUDIO),r=s.getCurrentDVRInfo(t),i=r?r.range:null,o=void 0;if(!i)return NaN;if(e>i.end)o=Math.max(i.end-2*E.manifestInfo.minBufferTime,i.start);else{if(!(e+.25<i.start))return e;o=i.start}return o}(e);!isNaN(t)&&t!==e&&N(t)}}function H(e){if(!e.error){var t=l.convertDataToRepresentationInfo(e.currentRepresentation).mediaInfo.streamInfo;E.id===t.id&&(E=t,G())}}function q(){i.trigger(p.CAN_PLAY)}function W(){r("Native video element event: play"),S.getStartPlaybackTime()||S.setStartPlaybackTime((new Date).getTime()),G(),j(),i.trigger(p.PLAYBACK_STARTED,{startTime:k()})}function Y(){r("Native video element event: waiting"),i.trigger(p.PLAYBACK_WAITING,{playingTime:k()})}function K(){r("Native video element event: playing"),i.trigger(p.PLAYBACK_PLAYING,{playingTime:k()})}function Q(){r("Native video element event: pause"),i.trigger(p.PLAYBACK_PAUSED,{ended:x()})}function z(){var e=k();r("Seeking to: "+e),j(),S&&S.setLastStartSeekTime((new Date).getTime()),i.trigger(p.PLAYBACK_SEEKING,{seekTime:e})}function Z(){r("Native video element event: seeked"),i.trigger(p.PLAYBACK_SEEKED)}function J(){var e=k();i.trigger(p.PLAYBACK_TIME_UPDATED,{timeToEnd:P(),time:e})}function X(){i.trigger(p.PLAYBACK_PROGRESS)}function $(){var e=L();r("Native video element event: ratechange: "+e+" currentTime: "+k()),i.trigger(p.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function ee(){r("Native video element event: loadedmetadata"),i.trigger(p.PLAYBACK_METADATA_LOADED),j()}function te(){r("Native video element event: ended"),O(),V(),i.trigger(p.PLAYBACK_ENDED,{isNativeEnded:!0})}function re(e){var t=e.target||e.srcElement;i.trigger(p.PLAYBACK_ERROR,{error:t.error})}function ne(e){var t,n=void 0,i=e.bufferedRanges;if(i&&i.length&&(!m[E.id]||!0!==m[E.id].started)){var a=e.sender.getType();void 0===_[E.id]&&(_[E.id]=[]),_[E.id][a]=i,void 0===m[E.id]&&(m[E.id]=[],m[E.id].started=!1),void 0===m[E.id][a]&&(m[E.id][a]=Math.max(i.start(0),E.start));var s=o.isVideoTrackPresent(),u=o.isAudioTrackPresent();if(t=B(!1),u&&s){if(!isNaN(m[E.id].audio)&&!isNaN(m[E.id].video)&&(m[E.id].audio<m[E.id].video?(n=m[E.id].video>t?m[E.id].video:t,i=_[E.id].audio):(n=m[E.id].audio>t?m[E.id].audio:t,i=_[E.id].video),function(e,t){if(t&&t.length>0)for(var r=0,n=t.length;r<n;r++)if(e>=t.start(r)&&e<t.end(r))return!0;return!1}(n,i))){var c=k();!C()&&0!==n&&n>c&&(N(n+.2),r("Playback controller seek hack",n+.2)),m[E.id].started=!0}}else m[E.id][a]&&(n=m[E.id][a]>t?m[E.id][a]:t,C()||N(n),m[E.id].started=!0)}}function ie(e){e.streamInfo.id===E.id&&f.setStallState(e.mediaType,e.state===Le.BUFFER_EMPTY)}function oe(e){r("Native video element event: stalled",e),i.trigger(p.PLAYBACK_STALLED,{e:e})}return e={initialize:function(e){E=e,f.addEventListener("canplay",q),f.addEventListener("play",W),f.addEventListener("waiting",Y),f.addEventListener("playing",K),f.addEventListener("pause",Q),f.addEventListener("error",re),f.addEventListener("seeking",z),f.addEventListener("seeked",Z),f.addEventListener("timeupdate",J),f.addEventListener("progress",X),f.addEventListener("ratechange",$),f.addEventListener("loadedmetadata",ee),f.addEventListener("ended",te),f.addEventListener("stalled",oe),b=E.manifestInfo.isDynamic,h=E.start,i.on(p.DATA_UPDATE_COMPLETED,H,this),i.on(p.BYTES_APPENDED_END_FRAGMENT,ne,this),i.on(p.BUFFER_LEVEL_STATE_CHANGED,ie,this),i.on(p.PERIOD_SWITCH_STARTED,R,this),T&&(T=!1,D())},setConfig:function(e){e&&(e.streamController&&(o=e.streamController),e.metricsModel&&(a=e.metricsModel),e.dashMetrics&&(s=e.dashMetrics),e.manifestModel&&(u=e.manifestModel),e.dashManifestModel&&(c=e.dashManifestModel),e.mediaPlayerModel&&(S=e.mediaPlayerModel),e.adapter&&(l=e.adapter),e.videoModel&&(f=e.videoModel))},getStartTimeFromUriParameters:U,getStreamStartTime:B,getTimeToStreamEnd:P,getTime:k,getPlaybackRate:L,getPlayedRanges:function(){return E&&f?f.getPlayedRanges():null},getEnded:x,getIsDynamic:M,getStreamController:function(){return o},setLiveStartTime:function(e){h=e},getLiveStartTime:function(){return h},computeLiveDelay:function(e,t){var r,i=c.getMpd(u.getValue()),o=void 0;if(r=S.getUseSuggestedPresentationDelay()&&i.hasOwnProperty(n.SUGGESTED_PRESENTATION_DELAY)?i.suggestedPresentationDelay:S.getLowLatencyEnabled()?0:S.getLiveDelay()?S.getLiveDelay():isNaN(e)?2*E.manifestInfo.minBufferTime:e*S.getLiveDelayFragmentCount(),i.availabilityStartTime&&(A=i.availabilityStartTime.getTime()),t>0){var a=Math.max(t-10,t/2);o=Math.min(r,a)}else o=r;return v=o,o},getLiveDelay:function(){return v},getCurrentLiveLatency:function(){if(!b||isNaN(A))return NaN;var e=k();return isNaN(e)||0===e?0:(Math.round((new Date).getTime()-(1e3*e+A))/1e3).toFixed(3)},play:D,isPaused:I,pause:O,isSeeking:C,seek:N,getDuration:function(){return f.getElement().duration},reset:F
},F(),e}Ue.__dashjs_factory_name="PlaybackController";var Be=s.a.getSingletonFactory(Ue);function je(e){var t=(e=e||{}).timelineConverter,r=e.streamProcessor;return{getLiveEdge:function(){!function(){if(!(t&&t.hasOwnProperty("getExpectedLiveEdge")&&r&&r.hasOwnProperty("getCurrentRepresentationInfo")))throw new Error("Missing config parameter(s)")}();var e=r.getCurrentRepresentationInfo(),n=e.DVRWindow.end;return e.useCalculatedLiveEdgeTime&&(n=t.getExpectedLiveEdge(),t.setClientTimeOffset(n-e.DVRWindow.end)),n},reset:function(){t=null,r=null}}}je.__dashjs_factory_name="LiveEdgeFinder";var Ve=s.a.getClassFactory(je);function Ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var He=function e(){Ge(this,e),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};He.INITIAL_PLAYOUT_START_REASON="initial_playout",He.SEEK_START_REASON="seek",He.RESUME_FROM_PAUSE_START_REASON="resume",He.METRICS_COLLECTION_START_REASON="metrics_collection_start";var qe=function e(){Ge(this,e),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};function We(e){e=e||{};var t=!1,r=this.context,i=d(r).getInstance(),o=e.dashMetrics,a=e.metricsModel,s=e.mediaPlayerModel,u=e.abrController;function c(e,r,i){var c=NaN,l=e.getCurrentRepresentationInfo();if(r===n.FRAGMENTED_TEXT);else if(r===n.AUDIO&&i){var d=o.getCurrentBufferLevel(a.getReadOnlyMetricsFor(n.VIDEO));c=isNaN(l.fragmentDuration)?d:Math.max(d,l.fragmentDuration),t&&(c=Math.min(c,s.getStableBufferTime()))}else{var f=l.mediaInfo.streamInfo;c=u.isPlayingAtTopQuality(f)&&!t?f.manifestInfo.duration>=s.getLongFormContentDurationThreshold()?s.getBufferTimeAtTopQualityLongForm():s.getBufferTimeAtTopQuality():s.getStableBufferTime()}return c}function l(){t=!0}var f={execute:function(e,t,r,n){return(n&&n+o.getCurrentBufferLevel(a.getReadOnlyMetricsFor(t))||o.getCurrentBufferLevel(a.getReadOnlyMetricsFor(t)))<c(e,t,r)},getBufferTarget:c};return function(){i.on(p.QUOTA_EXCEEDED,l,this)}(),f}qe.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",qe.REBUFFERING_REASON="rebuffering",qe.USER_REQUEST_STOP_REASON="user_request",qe.END_OF_PERIOD_STOP_REASON="end_of_period",qe.END_OF_CONTENT_STOP_REASON="end_of_content",qe.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",qe.FAILURE_STOP_REASON="failure",We.__dashjs_factory_name="BufferLevelRule";var Ye=s.a.getClassFactory(We);function Ke(e){e=e||{};var t=this.context,r=g(t).getInstance().log,n=e.adapter;return{execute:function(e,t){var i=e.getCurrentRepresentationInfo(),o=i.mediaInfo.type,a=e.getScheduleController(),s=a.getSeekTarget(),u=!isNaN(s),c=e.getBufferController(),l=u?s:n.getIndexHandlerTime(e);if(isNaN(l))return null;if(u&&a.setSeekTarget(NaN),c){var d=c.getRangeAt(l);null===d||u||(r("Prior to making a request for time, NextFragmentRequestRule is aligning index handler's currentTime with bufferedRange.end for",o,".",l,"was changed to",d.end),l=d.end)}var f=void 0;if(t)l=t.startTime+t.duration/2,f=n.getFragmentRequestForTime(e,i,l,{timeThreshold:0,ignoreIsFinished:!0});else{for(f=n.getFragmentRequestForTime(e,i,l,{keepIdx:!u});f&&f.action!==y.ACTION_COMPLETE&&e.getFragmentModel().isFragmentLoaded(f);)f=n.getNextFragmentRequest(e,i);f&&(isNaN(f.startTime+f.duration)||n.setIndexHandlerTime(e,f.startTime+f.duration),f.delayLoadingTime=(new Date).getTime()+a.getTimeToLoadDelay(),a.setTimeToLoadDelay(0))}return f}}}Ke.__dashjs_factory_name="NextFragmentRequestRule";var Qe=s.a.getClassFactory(Ke);function ze(e){e=e||{};var t,r=this.context,i=d(r).getInstance(),o=e.metricsModel,a=e.adapter,s=e.dashMetrics,u=e.dashManifestModel,c=e.timelineConverter,l=e.mediaPlayerModel,f=e.abrController,h=e.playbackController,y=e.streamController,m=e.type,v=e.streamProcessor,_=e.mediaController,E=void 0,b=void 0,S=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,I=void 0,O=void 0,C=void 0,N=void 0,k=void 0,L=void 0,x=void 0,M=void 0,F=void 0,U=void 0,B=void 0,j=void 0,V=void 0,G=void 0,H=void 0,q={video:-1,audio:-1};function W(){S&&!v.isBufferingCompleted()?(E("[ScheduleController][",m,"] start"),we(),A=!1,w&&(w=!1),J(!1),z(0)):E("[ScheduleController][",m,"] start denied")}function Y(){A||(E("[ScheduleController][",m,"] stop"),A=!0,clearTimeout(C))}function K(e,t){F[t]=F[t]||{};var r=f.getTopQualityIndexFor(e,t);return F[t][e]!=r&&(E("Top quality "+e+" index has changed from "+F[t][e]+" to "+r),F[t][e]=r,!0)}function Q(){var e=v.getBufferController();if(A||I||h.isPaused()&&!x)E("[ScheduleController][",m,"] - schedule stop!");else if(e.getIsBufferingCompleted())E("Schedule stop because buffering is completed!");else{!function(){var e=1.5*(S.fragmentDuration||5),t=b.getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:h.getTime()+e,threshold:0})[0];if(t&&-1===B.indexOf(t)&&!u.getIsTextTrack(m)){var r=l.getFastSwitchEnabled(),n=v.getBufferLevel(),i=f.getAbandonmentStateFor(m);t.mediaType&&f.setCurrentSegmentInfoFor(t.mediaType,{index:t.index,startTime:t.startTime,duration:t.duration,url:t.url});var o=!_.isCurrentTrack(t.mediaInfo)&&_.getSwitchMode(t.mediaInfo.type)===pe.TRACK_SWITCH_MODE_NEVER_REPLACE,a=t.quality!==S.quality;r&&(o||a)&&n>=e&&i!==oe.ABANDON_LOAD?(ee(t),E("Reloading outdated fragment at index: ",t.index)):t.quality>S.quality&&(E("The buffer has better quality it in then what we would request so set append point to end of buffer!!"),be(h.getTime()+v.getBufferLevel()))}}();var t=B.length>0,r=v.getStreamInfo();V||isNaN(U)||j||t||K(S.mediaInfo.type,r.id)||k.execute(v,m,y.isVideoTrackPresent(),e.getStoreBufferLevel())?(J(!0),t||j||f.checkPlaybackQuality(m),function(){i.trigger(p.GET_NEXT_FRAGMENT,{mediaType:m,currentTime:v.getPlaybackController().getTime(),bufferLevel:v.getBufferLevel(),bufferResetInProgress:V,lastInitQuality:isNaN(U),switchTrack:j,isReplacement:t,hasTopQualityChanged:K(S.mediaInfo.type,r.id),bufferLevelRule:k.execute(v,m,y.isVideoTrackPresent(),e.getStoreBufferLevel()),final:V||isNaN(U)||j||t||K(S.mediaInfo.type,r.id)||k.execute(v,m,y.isVideoTrackPresent(),e.getStoreBufferLevel())});var n=v.getFragmentController();if(S.quality!==U)E("ScheduleController - "+m+" - quality has changed at "+h.getTime()+", get init request for representationid = "+S.id),U=S.quality,v.switchInitData(S.id);else if(j)E("ScheduleController - "+m+" - switch track has been asked, get init request for "+m+" with representationid = "+S.id),V=_.getSwitchMode(m)===pe.TRACK_SWITCH_MODE_ALWAYS_REPLACE,v.switchInitData(S.id,V),U=S.quality,j=!1;else{var o=B.shift();if(n.isInitializationRequest(o))v.switchInitData(o.representationId);else{var a=void 0;v.getBufferController().getIsPruningInProgress()||!(a=L.execute(v,o))&&r.manifestInfo&&r.manifestInfo.isDynamic&&E("getNextFragment - "+m+" - Playing at the bleeding live edge and frag is not available yet"),a?(E("ScheduleController - "+m+" - getNextFragment - request is "+a.url),"video"===m&&f.getAutoSwitchBitrateFor(m)&&Object.keys(q).forEach((function(e){-1!==q[e]&&(a.isSwitchingQn=!0)})),b.executeRequest(a)):(J(!1),z(300))}}}()):z(300)}}function z(e){clearTimeout(C),C=setTimeout(Q,e)}function Z(e){e.sender&&e.sender.getStreamProcessor()===v&&X(S.quality)}function J(e){I!==e?I=e:E("[ScheduleController][",m,"] isFragmentProcessingInProgress is already equal to",e)}function X(e){var t=a.getInitRequest(v,e);t&&(t.mediaType&&f.setCurrentSegmentInfoFor(t.mediaType,{index:t.index,startTime:t.startTime,duration:t.duration,url:t.url}),J(!0),b.executeRequest(t))}function $(){j=!0}function ee(e){B.push(e)}function te(e){if(m===e.mediaType&&v.getStreamInfo().id===e.streamInfo.id){if(null==(S=v.getRepresentationInfoForQuality(e.newQuality)))throw new Error("Unexpected error! - currentRepresentationInfo is null or undefined");q[m]=e.newQuality,Te(new Date,qe.REPRESENTATION_SWITCH_STOP_REASON),we(),h.isPaused()&&(H={type:m,oldQuality:e.oldQuality})}}function re(e){if(h&&b){var t=b.getRequests({state:T.FRAGMENT_MODEL_EXECUTED,time:h.getTime(),threshold:0})[0];t&&h.getTime()>=t.startTime&&((!M.mediaInfo||t.mediaInfo.type===M.mediaInfo.type&&t.mediaInfo.id!==M.mediaInfo.id)&&e&&i.trigger(p.TRACK_CHANGE_RENDERED,{
mediaType:m,oldMediaInfo:M.mediaInfo,newMediaInfo:t.mediaInfo}),t.quality===M.quality&&t.adaptationIndex===M.adaptationIndex||!e||q[m]===t.quality&&(i.trigger(p.QUALITY_CHANGE_RENDERED,{mediaType:m,oldQuality:M.quality,newQuality:t.quality}),q[m]=-1,H=null),M={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function ne(e){e.error||e.sender.getStreamProcessor()!==v||(S=a.convertDataToRepresentationInfo(e.currentRepresentation),l.getAppendingSourceState()&&$())}function ie(e){e.error||v.getStreamInfo().id!==e.streamInfo.id||(S=v.getCurrentRepresentationInfo(),w&&(h.getIsDynamic()?(c.setTimeSyncCompleted(!0),function(){var e=v.getLiveEdgeFinder();if(e){var t=e.getLiveEdge(),r=S.mediaInfo.streamInfo.manifestInfo.DVRWindowSize/2,i=t-h.computeLiveDelay(S.fragmentDuration,r),u=a.getFragmentRequestForTime(v,S,i,{ignoreIsFinished:!0});if(l.getLowLatencyEnabled()){var d=u.duration<l.getLiveDelay()?u.startTime:u.startTime+u.duration-l.getLiveDelay();h.setLiveStartTime(d)}else h.setLiveStartTime(u.startTime);(N=h.getStreamStartTime(!1,t))>S.mediaInfo.streamInfo.start+S.mediaInfo.streamInfo.duration&&h.seek(N);var f=s.getCurrentManifestUpdate(o.getMetricsFor(n.STREAM));o.updateManifestUpdateInfo(f,{currentTime:N,presentationStartTime:t,latency:t-N,clientTimeOffset:c.getClientTimeOffset()})}}()):(N=h.getStreamStartTime(!1),v.getBufferController().setSeekStartTime(N))),A&&W())}function ae(e){e.fragmentModel===b&&(Y(),J(!1),E("[ScheduleController] Stream is complete"),l.getAppendingSourceState()&&W())}function se(e){e.sender===b&&(E("[ScheduleController][",m,"] - onFragmentLoadingCompleted"),u.getIsTextTrack(m)&&J(!1),e.error&&e.request.serviceLocation&&!A&&J(!1),V&&(G=e.request),h.isPaused()&&H&&e.request.quality===q[m]&&(i.trigger(p.QUALITY_CHANGE_RENDERED,{mediaType:m,oldQuality:M.quality||H.oldQuality,newQuality:e.request.quality}),q[m]=-1,H=null))}function ue(){re(!0)}function ce(e){e.sender.getStreamProcessor()!==v||e.fromMulti||(V&&!isNaN(e.startTime)&&(V=!1,b.addExecutedRequest(G)),J(!1),z(0))}function le(e){e.streamProcessor===v&&(E("[ScheduleController][onFragmentLoadingAbandoned] for "+m+", request: "+e.request.url+" has been aborted"),h.isSeeking()||j||(E("[ScheduleController][onFragmentLoadingAbandoned] for "+m+", request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),ee(e.request)),J(!1),z(0))}function de(e){e.sender.getStreamProcessor()===v&&Y()}function fe(e){e.sender.getStreamProcessor()===v&&(e.unintended?v.getFragmentModel().removeExecutedRequestsAfterTime(e.from,v.getStreamInfo().duration):m===n.AUDIO&&l.getEnableMultipleAudioTracks()?v.getFragmentModel().syncExecutedRequestsWithMultipleLevels(v.getBufferController().getMultiBufferRanges(),v.getStreamInfo().duration):v.getFragmentModel().syncExecutedRequestsWithBufferedRange(v.getBufferController().getBuffer().getAllBufferRanges(),v.getStreamInfo().duration),e.hasEnoughSpaceToAppend&&A&&W())}function he(e){e.sender.getStreamProcessor()!==v||e.state!==Le.BUFFER_EMPTY||h.isSeeking()||(E("[ScheduleController][",m,"] - Buffer is empty! Stalling!"),Te(new Date,qe.REBUFFERING_REASON))}function ye(e){e.sender.getStreamProcessor()===v&&(Y(),J(!1))}function me(){b.abortRequests(),Y()}function ge(e){e.sender.getStreamProcessor()===v&&X(e.index)}function ve(){!A&&x||W()}function _e(e){N=e.seekTime,Se(0),A&&W();var t=s.getCurrentManifestUpdate(o.getMetricsFor(n.STREAM)),r=S.DVRWindow&&h?S.DVRWindow.end-h.getTime():NaN;o.updateManifestUpdateInfo(t,{latency:r}),I?function(){var e=N,t=b.getLoadingRequests(),r=v.getBufferController().getBufferRanges(),n=!1;if(!e||t.length>1||0===t.length)return!0;var i=t[0];if(i&&(isNaN(i.index)||isNaN(i.startTime)&&isNaN(i.duration)))return!0;for(var o=0;o<r.length;o++){var a=r.start(o),s=r.end(o);if(e>=a-.5&&e<=s+.5){n=!0;break}}if(n){if(i.startTime>e)return E("[ScheduleController][onPlaybackSeeking] seekTime is inside the range and less then the startTime of loadingRequest",e,i),!1}else if(e>=i.startTime&&e<i.startTime+i.duration)return E("[ScheduleController][onPlaybackSeeking] seekTime is outside the range but inside the time range of loadingRequest",e,i),!1;return!0}()?(E("[ScheduleController][onPlaybackSeeking] for "+m+", call fragmentModel.abortRequests in order to seek quicker"),b.abortRequests(),q[m]>=0&&(a.setIndexHandlerTime(v,N),v.switchInitData(S.id)),J(!1),z(30)):E("[ScheduleController][onPlaybackSeeking] process the next schedule"):z(0)}function Ee(e){P&&(P.playbackspeed=e.playbackRate.toString())}function be(e){N=e}function Se(e){O=e}function Te(e,t){if(R&&!1===D){var r=P.start,n=e.getTime()-r.getTime();P.duration=n,P.stopreason=t,R.trace.push(P),D=!0}}function we(){R&&!0===D&&S&&(D=!1,(P=new qe).representationid=S.id,P.start=new Date,P.mstart=1e3*h.getTime(),P.playbackspeed=h.getPlaybackRate().toString())}function Ae(){U=NaN}function Re(){I=!1,O=0,N=NaN,R=null,P=null,D=!0,w=!0,U=NaN,M={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},F={},B=[],A=!0,j=!1,V=!1,G=null}return t={initialize:function(){b=v.getFragmentModel(),x=l.getScheduleWhilePaused(),k=Ye(r).create({abrController:f,dashMetrics:s,metricsModel:o,mediaPlayerModel:l}),L=Qe(r).create({adapter:a}),u.getIsTextTrack(m)&&i.on(p.TIMED_TEXT_REQUESTED,ge,this),i.on(p.QUALITY_CHANGE_REQUESTED,te,this),i.on(p.DATA_UPDATE_STARTED,de,this),i.on(p.DATA_UPDATE_COMPLETED,ne,this),i.on(p.FRAGMENT_LOADING_COMPLETED,se,this),i.on(p.STREAM_COMPLETED,ae,this),i.on(p.STREAM_INITIALIZED,ie,this),i.on(p.BUFFER_LEVEL_STATE_CHANGED,he,this),i.on(p.BUFFER_CLEARED,fe,this),i.on(p.BYTES_APPENDED_END_FRAGMENT,ce,this),i.on(p.INIT_REQUESTED,Z,this),i.on(p.QUOTA_EXCEEDED,ye,this),i.on(p.PLAYBACK_SEEKING,_e,this),i.on(p.PLAYBACK_STARTED,ve,this),i.on(p.PLAYBACK_RATE_CHANGED,Ee,this),i.on(p.PLAYBACK_TIME_UPDATED,ue,this),i.on(p.URL_RESOLUTION_FAILED,me,this),i.on(p.FRAGMENT_LOADING_ABANDONED,le,this),i.on(p.MANIFEST_UPDATED,Ae,this),m===n.AUDIO&&l.getEnableMultipleAudioTracks()&&i.on(p.MULTI_AUDIO_TRACK_APPEND,ce,this)},getType:function(){return m},getSeekTarget:function(){return N},setSeekTarget:be,setTimeToLoadDelay:Se,getTimeToLoadDelay:function(){return O},replaceRequest:ee,switchTrackAsked:$,isStarted:function(){return!1===A},start:W,stop:Y,reset:function(){i.off(p.DATA_UPDATE_STARTED,de,this),i.off(p.DATA_UPDATE_COMPLETED,ne,this),i.off(p.BUFFER_LEVEL_STATE_CHANGED,he,this),i.off(p.QUALITY_CHANGE_REQUESTED,te,this),i.off(p.FRAGMENT_LOADING_COMPLETED,se,this),i.off(p.STREAM_COMPLETED,ae,this),i.off(p.STREAM_INITIALIZED,ie,this),i.off(p.QUOTA_EXCEEDED,ye,this),i.off(p.BYTES_APPENDED_END_FRAGMENT,ce,this),i.off(p.BUFFER_CLEARED,fe,this),i.off(p.INIT_REQUESTED,Z,this),i.off(p.PLAYBACK_RATE_CHANGED,Ee,this),i.off(p.PLAYBACK_SEEKING,_e,this),i.off(p.PLAYBACK_STARTED,ve,this),i.off(p.PLAYBACK_TIME_UPDATED,ue,this),i.off(p.URL_RESOLUTION_FAILED,me,this),i.off(p.FRAGMENT_LOADING_ABANDONED,le,this),i.off(p.MANIFEST_UPDATED,Ae,this),u.getIsTextTrack(m)&&i.off(p.TIMED_TEXT_REQUESTED,ge,this),Y(),re(!1),Re()},setPlayList:function(e){R=e},getBufferTarget:function(){return k.getBufferTarget(v,m,y.isVideoTrackPresent())},finalisePlayList:function(e,t){Te(e,t),R=null}},E=g(r).getInstance().log.bind(t),Re(),t}ze.__dashjs_factory_name="ScheduleController";var Ze=s.a.getClassFactory(ze),Je=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init=function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",
this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.INBAND_EVENT_STREAM="InbandEventStream",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.ROLE_ASARRAY="Role_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.INTERACTIVE="interactive",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight"},e}()),Xe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0,this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}return e.hasInitialization=function(e){return null!==e.initialization||null!==e.range},e.hasSegments=function(e){return e.segmentInfoType!==Je.BASE_URL&&e.segmentInfoType!==Je.SEGMENT_BASE&&!e.indexRange},e}();function $e(){var e=this.context,t=d(e).getInstance(),r=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,y=void 0,m=void 0,g=void 0,v=void 0,_=void 0,E=void 0,b=[];function S(){return a}function T(){return u}function A(){i=null,o=-1,a=!0,s=[],c=null,f=null,h=null,y=null,m=null,g=null,v=null}function R(){var e=new Date,t=T(),r=1e3*f.getTime();h.addRepresentationSwitch(t.adaptation.type,e,r,t.id)}function P(){var e=_.getStreamInfo(),t=e?e.manifestInfo:null,r=t?t.isDynamic:null,n=m.calcSegmentAvailabilityRange(u,r);h.addDVRInfo(_.getType(),f.getTime(),t,n)}function D(e){return s[e]}function I(e){return s.indexOf(e)}function O(e){var n=e;a=!1,t.trigger(p.AST_IN_FUTURE,{delay:n}),setTimeout((function(){if(!S()){a=!0,t.trigger(p.DATA_UPDATE_STARTED,{sender:r}),s.forEach((function(e){e.segmentAvailabilityRange=null}));for(var e=0;e<s.length;e++)l.updateRepresentation(s[e],!0)}}),n)}function C(e){if(e.sender.getStreamProcessor()===_&&S()){var r=e.representation,o=h.getMetricsFor(n.STREAM),l=T().adaptation.type,d=h.getMetricsFor(T().adaptation.type),y=v.getCurrentManifestUpdate(o),m=!1,g=0,E=void 0,b=void 0;if(r.adaptation.period.mpd.manifest.type===Je.DYNAMIC&&!r.adaptation.period.mpd.manifest.ignorePostponeTimePeriod){var A=r.segmentAvailabilityRange.end-r.segmentAvailabilityRange.start;g=1e3*(f.computeLiveDelay(u.segmentDuration,_.getStreamInfo().manifestInfo.DVRWindowSize)-A)}if(g>0)return P(),O(g),b=new w(1,"Segments update failed",null),void t.trigger(p.DATA_UPDATE_COMPLETED,{sender:this,data:i,currentRepresentation:u,error:b});if(y){for(var D=0;D<y.representationInfo.length;D++)if((E=y.representationInfo[D]).index===r.index&&E.mediaType===_.getType()){m=!0;break}m||h.addManifestUpdateRepresentationInfo(y,r.id,r.index,r.adaptation.period.index,_.getType(),r.presentationTimeOffset,r.startNumber,r.segmentInfoType)}(function(e){var t=c.getQualityFor(e),r=_.getStreamInfo(),n=c.getTopQualityIndexFor(e,r.id),i=c.getMinAllowedIndexFor(e);void 0!==i&&t<i&&(t=i),t>n&&(t=n);for(var o=t;o<1;o++){var a=s[o].segmentInfoType;if(null===s[o].segmentAvailabilityRange||!Xe.hasInitialization(s[o])||(a===Je.SEGMENT_BASE||a===Je.BASE_URL)&&!s[o].segments)return!1}return!0})(l)&&(a=!1,c.setPlaybackQuality(_.getType(),_.getStreamInfo(),I(u)),h.updateManifestUpdateInfo(y,{latency:u.segmentAvailabilityRange.end-f.getTime()}),v.getCurrentRepresentationSwitch(d)||R(),t.trigger(p.DATA_UPDATE_COMPLETED,{sender:this,data:i,currentRepresentation:u}))}}function N(e){e.isDynamic&&function(e){for(var t=void 0,r=0,n=s.length;r<n;r++)(t=s[r]).segmentAvailabilityRange=m.calcSegmentAvailabilityRange(t,e)}(e.isDynamic)}function k(e){e.sender.getStreamProcessor()===_&&(E.getValue().doNotUpdateDVRWindowOnBufferUpdated||P())}function L(e){if(e.mediaType===_.getType()&&_.getStreamInfo().id===e.streamInfo.id&&e.oldQuality!==e.newQuality){var t=e.newQuality;b[t]||(b[t]=!0,l.updateRepresentation(s[t],!0)),u=D(e.newQuality);var r=c.getThroughputHistory().getAverageThroughput(e.mediaType);isNaN(r)||y.setSavedBitrateSettings(e.mediaType,r),R()}}function x(e){if(e.newDuration){var t=T();t&&t.adaptation.period&&(t.adaptation.period.duration=e.newDuration)}}return r={initialize:function(){l=_.getIndexHandler()},setConfig:function(e){e.abrController&&(c=e.abrController),e.domStorage&&(y=e.domStorage),e.metricsModel&&(h=e.metricsModel),e.dashMetrics&&(v=e.dashMetrics),e.dashManifestModel&&(g=e.dashManifestModel),e.playbackController&&(f=e.playbackController),e.timelineConverter&&(m=e.timelineConverter),e.manifestModel&&(E=e.manifestModel),e.streamProcessor&&(_=e.streamProcessor)},getData:function(){return i},getDataIndex:function(){return o},isUpdating:S,updateData:function(e,r,d){var f=_.getStreamInfo(),h=c.getTopQualityIndexFor(d,f.id),y=c.getMinAllowedIndexFor(d),m=void 0;if(a=!0,t.trigger(p.DATA_UPDATE_STARTED,{sender:this}),s=function(e){return o=g.getIndexForAdaptation(i,e.period.mpd.manifest,e.period.index),g.getRepresentationsForAdaptation(e)}(r),null!==i&&i.id==e.id||d===n.FRAGMENTED_TEXT||c.getThroughputHistory().getAverageThroughput(d)||c.getInitialBitrateFor(d,f),m=c.getQualityFor(d),void 0!==y&&m<y&&(m=y),m>h&&(m=h),u=D(m),i=e,d!==n.VIDEO&&d!==n.AUDIO&&d!==n.FRAGMENTED_TEXT)return a=!1,void t.trigger(p.DATA_UPDATE_COMPLETED,{sender:this,data:i,currentRepresentation:u});(b=[])[m]=!0,l.updateRepresentation(s[m],!0)},getStreamProcessor:function(){return _},getCurrentRepresentation:T,getRepresentationForQuality:D,getQualityForRepresentationId:function(e){return I(s.find((function(t){return t.id===e})))},reset:function(){t.off(p.QUALITY_CHANGE_REQUESTED,L,r),t.off(p.REPRESENTATION_UPDATED,C,r),t.off(p.WALLCLOCK_TIME_UPDATED,N,r),t.off(p.BUFFER_LEVEL_UPDATED,k,r),t.off(p.MANIFEST_VALIDITY_CHANGED,x,r),A(),b=[]}},A(),t.on(p.QUALITY_CHANGE_REQUESTED,L,r),
t.on(p.REPRESENTATION_UPDATED,C,r),t.on(p.WALLCLOCK_TIME_UPDATED,N,r),t.on(p.BUFFER_LEVEL_UPDATED,k,r),t.on(p.MANIFEST_VALIDITY_CHANGED,x,r),r}$e.__dashjs_factory_name="RepresentationController";var et=s.a.getClassFactory($e);function tt(){var e=void 0,t=/^[a-z][a-z0-9+\-.]*:/i,r=/^https?:\/\//i,n=/^https:\/\//i,i=/^([a-z][a-z0-9+\-.]*:\/\/[^\/]+)\/?/i,o=function(e,t){try{return new window.URL(e,t).toString()}catch(t){return e}},a=function(e,t){var r=s;if(!t)return e;if(!l(e))return e;d(e)&&(r=u),f(e)&&(r=c);var n=r(t),i="/"!==n.charAt(n.length-1)&&"/"!==e.charAt(0)?"/":"";return[n,e].join(i)};function s(e){var t=e.indexOf("/"),r=e.lastIndexOf("/");return-1!==t?r===t+1?e:(-1!==e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),e.substring(0,r+1)):""}function u(e){var t=e.match(i);return t?t[1]:""}function c(e){var r=e.match(t);return r?r[0]:""}function l(e){return!t.test(e)}function d(e){return l(e)&&"/"===e.charAt(0)}function f(e){return 0===e.indexOf("//")}return function(){try{new window.URL("x","http://y"),e=o}catch(e){}finally{e=e||a}}(),{parseBaseUrl:s,parseOrigin:u,parseScheme:c,isRelative:l,isPathAbsolute:d,isSchemeRelative:f,isHTTPURL:function(e){return r.test(e)},isHTTPS:function(e){return n.test(e)},resolve:function(t,r){return e(t,r)}}}tt.__dashjs_factory_name="URLUtils";var rt=s.a.getSingletonFactory(tt),nt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null};function it(e,t){for(;e.length<t;)e="0"+e;return e}function ot(e,t){return e.representation.startNumber+t}function at(e,t,r){var n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=t.length;if(!e)return e;for(;;){if((n=e.indexOf("$"+t))<0)return e;if((i=e.indexOf("$",n+c))<0)return e;if((o=e.indexOf("%0",n+c))>n&&o<i)switch(a=e.charAt(i-1),s=parseInt(e.substring(o+2,i-1),10),a){case"d":case"i":case"u":u=it(r.toString(),s);break;case"x":u=it(r.toString(16),s);break;case"X":u=it(r.toString(16),s).toUpperCase();break;case"o":u=it(r.toString(8),s);break;default:return e}else u=r;e=e.substring(0,n)+u+e.substring(i+1)}}function st(e,t,r,n){var i,o,a=void 0,s=void 0;return s=r.segmentDuration,isNaN(s)&&(s=r.adaptation.period.duration),i=parseFloat((r.adaptation.period.start+n*s).toFixed(5)),o=parseFloat((i+s).toFixed(5)),(a=new nt).representation=r,a.duration=s,a.presentationStartTime=i,a.mediaStartTime=e.calcMediaTimeFromPresentationTime(a.presentationStartTime,r),a.availabilityStartTime=e.calcAvailabilityStartTimeFromPresentationTime(a.presentationStartTime,r.adaptation.period.mpd,t),a.availabilityEndTime=e.calcAvailabilityEndTimeFromPresentationTime(o,r.adaptation.period.mpd,t),a.wallStartTime=e.calcWallTimeForSegment(a,t),a.replacementNumber=ot(a,n),a.availabilityIdx=n,a}function ut(e,t,r,n,i,o,a,s,u,c){var l,d,f=n/o,p=Math.min(i/o,r.adaptation.period.mpd.maxSegmentDuration),h=void 0;return d=(l=e.calcPresentationTimeFromMediaTime(f,r))+p,(h=new nt).representation=r,h.duration=p,h.mediaStartTime=f,h.presentationStartTime=l,h.availabilityStartTime=r.adaptation.period.mpd.manifest.loadedTime,h.availabilityEndTime=e.calcAvailabilityEndTimeFromPresentationTime(d,r.adaptation.period.mpd,t),h.wallStartTime=e.calcWallTimeForSegment(h,t),h.replacementTime=c||n,h.replacementNumber=ot(h,u),a=at(a,"Number",h.replacementNumber),a=at(a,"Time",h.replacementTime),h.media=a,h.mediaRange=s,h.availabilityIdx=u,h}function ct(e,t){if(!t||!t.segments)return null;var r=t.segments.length,n=void 0,i=void 0;if(e<r&&(n=t.segments[e])&&n.availabilityIdx===e)return n;for(i=0;i<r;i++)if((n=t.segments[i])&&n.availabilityIdx===e)return n;return null}function lt(e,t,r,n,i,o){var a=r.segmentDuration,s=r.adaptation.period.mpd.manifest.minBufferTime,u=r.segmentAvailabilityRange,c={start:e.calcPeriodRelativeTimeFromMpdRelativeTime(r,u.start),end:e.calcPeriodRelativeTimeFromMpdRelativeTime(r,u.end)},l=r.segments,d=2*a,f=o||Math.max(2*s,10*a),p=NaN,h=null,y=void 0;return c.start=Math.max(c.start,0),t&&!e.isTimeSyncCompleted()?{start:y=Math.floor(c.start/a),end:Math.floor(c.end/a)}:(p=l&&l.length>0?(h=ct(i,r))?e.calcPeriodRelativeTimeFromMpdRelativeTime(r,h.presentationStartTime):i>0?i*a:e.calcPeriodRelativeTimeFromMpdRelativeTime(r,n):i>0?i*a:t?c.end:c.start,{start:y=Math.floor(Math.max(p-d,c.start)/a),end:Math.floor(Math.min(y+f/a,c.end/a))})}function dt(e,t){var r=(e=e||{}).timelineConverter;return{getSegments:function(e,n,i,o){if(function(){if(!(r&&r.hasOwnProperty("calcMediaTimeFromPresentationTime")&&r.hasOwnProperty("calcSegmentAvailabilityRange")&&r.hasOwnProperty("calcMediaTimeFromPresentationTime")))throw new Error("Missing config parameter(s)")}(),!e)throw new Error("no representation");void 0===n&&(n=null);var a,s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,u=s.SegmentTimeline,c=s.SegmentURL_asArray,l=e.availableSegmentsNumber>0;a=o||(i>-1||null!==n?10:1/0);var d,f,p,h=0,y=0,m=-1,g=[],v=null,_=void 0,E=void 0,b=void 0,S=void 0,T=void 0,w=void 0,A=void 0,R=void 0,P=function(n,i){var o=s.media,a=n.mediaRange;return c&&(o=c[i].media||"",a=c[i].mediaRange),ut(r,t,e,h,n.d,R,o,a,m,n.tManifest)};for(R=e.timescale,d=u.S_asArray,p=i,null!==n&&(v=r.calcMediaTimeFromPresentationTime(n,e)),E=0,f=d.length;E<f;E++){if(S=0,(_=d[E]).hasOwnProperty("r")&&(S=_.r),_.hasOwnProperty("t")&&(y=(h=_.t)/R),S<0){if((w=d[E+1])&&w.hasOwnProperty("t"))T=w.t/R;else{var D=e.segmentAvailabilityRange?e.segmentAvailabilityRange.end:r.calcSegmentAvailabilityRange(e,t).end;T=r.calcMediaTimeFromPresentationTime(D,e),e.segmentDuration=_.d/R}S=Math.ceil((T-y)/(_.d/R))-1}if(A){if(l)break;m+=S+1}else for(b=0;b<=S;b++)if(m++,g.length>a){if(A=!0,l)break}else null!==v?y>=v-_.d/R*1.5&&g.push(P(_,m)):m>=p&&g.push(P(_,m)),y=(h+=_.d)/R}return l||(e.availableSegmentsNumber=m+1),g}}}dt.__dashjs_factory_name="TimelineSegmentsGetter";var ft=s.a.getClassFactory(dt);function pt(e,t){var r=e.timelineConverter;return{getSegments:function(e,n,i,o){var a,s,u,c,l=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate,d=e.segmentDuration,f=e.segmentAvailabilityRange,p=[],h=null,y=null,m=void 0;for(u=e.startNumber,a=(c=isNaN(d)&&!t?{start:u,end:u}:lt(r,t,e,n,i,o)).start,s=c.end,m=a;m<=s;m++)(y=st(r,t,e,m)).replacementTime=(u+m-1)*e.segmentDuration,h=at(h=l.media,"Number",y.replacementNumber),h=at(h,"Time",y.replacementTime),y.media=h,p.push(y),y=null;return isNaN(d)?e.availableSegmentsNumber=1:e.availableSegmentsNumber=Math.ceil((f.end-f.start)/d),p}}}pt.__dashjs_factory_name="TemplateSegmentsGetter";var ht=s.a.getClassFactory(pt);function yt(e,t){var r=(e=e||{}).timelineConverter;return{getSegments:function(e,n,i,o){var a,s,u,c,l=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,d=l.SegmentURL_asArray.length,f=[],p=void 0,h=void 0,y=void 0;for(c=e.startNumber,a=lt(r,t,e,n,i,o),s=Math.max(a.start,0),u=Math.min(a.end,l.SegmentURL_asArray.length-1),p=s;p<=u;p++)y=l.SegmentURL_asArray[p],(h=st(r,t,e,p)).replacementTime=(c+p-1)*e.segmentDuration,h.media=y.media?y.media:"",h.mediaRange=y.mediaRange,h.index=y.index,h.indexRange=y.indexRange,f.push(h),h=null;return e.availableSegmentsNumber=d,f}}}yt.__dashjs_factory_name="ListSegmentsGetter";var mt=s.a.getClassFactory(yt);function gt(e,t){var r,n=this.context,i=void 0,o=void 0,a=void 0;return r={getSegments:function(e,t,r,n,s){var u=void 0,c=e.segmentInfoType;c!==Je.SEGMENT_BASE&&c!==Je.BASE_URL&&function(e,t){
var r=e.segments,n=!1,i=void 0,o=void 0;return r&&0!==r.length?(o=r[0].availabilityIdx,i=r[r.length-1].availabilityIdx,n=t<o||t>i):n=!0,n}(e,r)?(c===Je.SEGMENT_TIMELINE?u=i.getSegments(e,t,r,s):c===Je.SEGMENT_TEMPLATE?u=o.getSegments(e,t,r,s):c===Je.SEGMENT_LIST&&(u=a.getSegments(e,t,r,s)),n&&n(e,u)):u=e.segments}},i=ft(n).create(e,t),o=ht(n).create(e,t),a=mt(n).create(e,t),r}gt.__dashjs_factory_name="SegmentsGetter";var vt=s.a.getClassFactory(gt);function _t(){return{modifyRequestURL:function(e){return e},modifyRequestHeader:function(e){return e}}}_t.__dashjs_factory_name="RequestModifier";var Et=s.a.getSingletonFactory(_t);function bt(e){var t=(e=e||{}).requestModifier;return{load:function(e){var r=new Date,n=e.request,i=new XMLHttpRequest;i.open(e.method,e.url,!0),n.responseType&&(i.responseType=n.responseType),n.range&&i.setRequestHeader("Range","bytes="+n.range),n.requestStartDate||(n.requestStartDate=r),t&&(i=t.modifyRequestHeader(i)),i.withCredentials=e.withCredentials,e.request.loadInfo={rType:"XHR",cdn:0,pdn:0,protocol:"TCP"},i.onload=e.onload,i.onloadend=e.onend,i.onerror=e.onerror,i.timeout=e.timeout,i.ontimeout=e.ontimeout,i.onprogress=e.progress,i.onabort=e.onabort,i.onNcFail=e.onNcFail,i.onreadystatechange=function(){if(2===i.readyState)e.onHeadersReceived();else if(4===i.readyState)try{var t=i.getAllResponseHeaders&&i.getAllResponseHeaders();t&&t.indexOf("quic")>-1&&e.request&&e.request.loadInfo&&(e.request.loadInfo.protocol="QUIC")}catch(e){}},i.send(),e.response=i},abort:function(e){e&&e.response&&e.response.abort()},getP2pType:function(){return""}}}bt.__dashjs_factory_name="XHRLoader";var St=s.a.getClassFactory(bt);function Tt(e){var t=void 0,r={cdn:0,p2p:0},n=void 0,i=(e=e||{}).p2pType,o=!1,a=g(this.context).getInstance().log,s="[P2PLoader]";return{load:function(u){n=u;var c=u.request;t||(t=new e.supplier(u.url,e.video,c.mediaType),a(s,"["+i+"] new sdk loader ["+c.mediaType+"]")),t.onDataArrival=function(e){var n=t&&t.loadInfo();n&&(c.p2pLoadInfo||(c.p2pLoadInfo={cdn:0,p2p:0}),c.p2pLoadInfo.url=n.url),u.progress&&u.progress(null,e,n&&{cdn:n.cdn-r.cdn,p2p:n.p2p-r.p2p,rType:"PCDN"}),r=n||r},t.onError=function(e,t){a(s,"["+i+"] error, status:"+e+", msg:"+t+", type:"+c.mediaType),u.response={status:e,statusText:t},o=!1,u.onerror(),u.onend()},t.onComplete=function(){a(s,"["+i+"] onComplete, type:"+n.request.mediaType),o=!1,u.onload(),u.onend()};var l=void 0;if(c.range){var d=c.range.split("-");l={from:parseInt(d[0]),to:parseInt(d[1]||"-1")}}else l={from:0,to:-1};a(s,"["+i+"] load "+c.mediaType+" url:"+u.url+", range: "+l.from+"-"+l.to),t.load(l,u.withCredentials);var f=t.loadInfo();f&&(c.p2pLoadInfo||(c.p2pLoadInfo={cdn:0,p2p:0}),c.p2pLoadInfo.url=f.url),o=!0},abort:function(){o=!1,t&&(t.abort(),t.onDataArrival=void 0,t.onError=void 0,t.onComplete=void 0),n.onabort(),n.onend(),a(s,"["+i+"] abort sdk ["+n.request.mediaType+"]")},destroySdk:function(){var e=function(){o=!1,t&&(t.destroy(),t=void 0,a(s,"["+i+"] destroy sdk ["+n.request.mediaType+"]")),r={cdn:0,p2p:0}};o?(t.onError=function(t,r){a(s,"["+i+"] error, status:"+t+", msg:"+r+", type:"+n.request.mediaType),n.response={status:t,statusText:r},n.onerror(),n.onend(),e()},t.onComplete=function(){a(s,"["+i+"] detroy sdk onComplete, type:"+n.request.mediaType),n.onload(),n.onend(),e()}):e()},getUrl:function(){return n.url||""},getP2pType:function(){return i}}}Tt.__dashjs_factory_name="P2PLoader";var wt=s.a.getClassFactory(Tt);function At(e){var t,r=void 0,n=void 0;t=(e=e||{}).hid;var i=!1;if(window.localStorage&&localStorage.getItem)try{var o=JSON.parse(localStorage.getItem("bp_nc_config"));o&&1===o.showLog&&(i=!0)}catch(e){}function a(){var e="bpNC";return t&&(e+="_"+t),window[e]}return g(this.context).getInstance().log,{load:function(e){r=e;var t=e.request,o=a();o&&(n=o.getToken(),o.getData({url:t.url,range:t.range,token:n,bitrate:t.bitrate||0,latency:t.latency||5e3}).then((function(r){if(i){var n=0,o="";r&&r.responseData&&(r.responseData.getDataTime&&(n=Math.round(8*r.responseData.gotDataByte/1e3/(r.responseData.getDataTime/1e3))),r.responseData.path&&(o=r.responseData.path),r.peers=r.responseData.usePeerSids&&r.responseData.usePeerSids.length||0),console.log("--\x3e "+o+" nc success, speed is",n,"Kbps, res:",r)}e.progress&&e.progress(null,r.responseData.data,{nc:r.responseData.data.byteLength,cdn:0,rType:"NC",url:t.url,ncBr:r.responseData.gotDataByteFromBr}),e.onNCInfo&&e.onNCInfo(r),e.onload&&e.onload(),e.onend&&e.onend()}),(function(r){if(i){var n=0,o="";r&&r.responseData&&(r.responseData.getDataTime&&(n=Math.round(8*r.responseData.gotDataByte/1e3/(r.responseData.getDataTime/1e3))),r.responseData.path&&(o=r.responseData.path),r.peers=r.responseData.usePeerSids&&r.responseData.usePeerSids.length||0),console.log("--\x3e "+o+" nc fail, speed is",n,"Kbps, res:",r)}if(e.onNCFail&&r.responseData){var a=r.responseData.data?r.responseData.data.byteLength:0,s=r.responseData.gotDataByte?r.responseData.gotDataByte:0;e.onNCFail({ncFail:a,nc:s,ncGotFail:s,cdn:0,rType:"NC",url:t.url,ncBr:r.responseData.gotDataByteFromBr||0})}e.onNCInfo&&e.onNCInfo(r),e.onerror&&e.onerror()})))},abort:function(e){var t=a();t&&n&&t.abortGetData(n),r&&(r.onNCInfo&&r.onNCInfo({code:4999,qn:parseInt(e.representationId,10)||0,responseData:{}}),r&&r.onabort&&r.onabort(),r&&r.onend&&r.onend())},getP2pType:function(){return""},disableRP:function(){var e=a();e&&"function"==typeof e.disableRP&&e.disableRP()}}}At.__dashjs_factory_name="NCLoader";var Rt=s.a.getClassFactory(At);function Pt(e){var t=(e=e||{}).requestModifier;function r(e,t){e.reader.read().then(t).catch((function(){}))}return{load:function(e){var n=new Date,i=e.request,o=new Headers;i.range&&o.append("Range","bytes="+i.range),i.requestStartDate||(i.requestStartDate=n),t&&t.modifyRequestHeader({setRequestHeader:function(e,t){o.append(e,t)}});var a=void 0;"function"==typeof window.AbortController&&(a=new AbortController,e.abortController=a);var s={method:e.method,headers:o,credentials:e.withCredentials?"include":void 0,signal:a?a.signal:void 0};fetch(e.url,s).then((function(t){e.response||(e.response={}),e.response.status=t.status,e.response.statusText=t.statusText,e.response.responseURL=t.url,t.ok||e.onerror();var n="",i=!0,o=!1,a=void 0;try{for(var s,u=t.headers.keys()[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;n+=c+": "+t.headers.get(c)+"\n"}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}if(e.response.responseHeaders=n,e.onHeadersReceived(),!t.body)return t.arrayBuffer().then((function(t){e.response.response=t;var r={loaded:t.byteLength,total:t.byteLength};e.progress(r),e.onload(),e.onend()}));var l=parseInt(t.headers.get("Content-Length"),10),d=0,f=!1,p=new Uint8Array,h=0;e.reader=t.body.getReader(),r(e,(function t(n){var i=n.value;if(n.done)return p&&(e.progress({loaded:d,total:isNaN(l)?d:l,lengthComputable:!0}),e.response.response=p.buffer),e.onload(),void e.onend();if(i&&i.length>0){p=function(e,t){if(0===e.length)return t;var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(p,i),d+=i.length;var o=be().getInstance().findLastTopIsoBoxCompleted(["moov","mdat"],p,h);if(o.found){var a=o.lastCompletedOffset+o.size,s=void 0;a===p.length?(s=p,p=new Uint8Array):(s=new Uint8Array(p.subarray(0,a)),p=p.subarray(a)),e.progress({data:s.buffer,lengthComputable:!1,noTrace:!0}),h=0}else h=o.lastCompletedOffset,f||(e.progress({lengthComputable:!1,noTrace:!0}),f=!0)}r(e,t)}))})).catch((function(t){e.onerror&&e.onerror(t)}))},abort:function(e){if(e.abortController)e.abortController.abort();else if(e.reader)try{e.reader.cancel()}catch(e){}}}}Pt.__dashjs_factory_name="FetchLoader";var Dt=s.a.getClassFactory(Pt);function It(){var e=this.context,t=d(e).getInstance();return{capabilityError:function(e){t.trigger(p.ERROR,{error:"capability",event:e})},downloadError:function(e,r,n,i,o){t.trigger(p.ERROR,{error:"download",event:{id:e,url:r,request:n},code:i,httpCode:o})},manifestError:function(e,r,n,i,o,a){t.trigger(p.ERROR,{error:"manifestError",event:{message:e,id:r,manifest:n,event:i},code:o,httpCode:a})},timedTextError:function(e,r,n){t.trigger(p.ERROR,{error:"cc",event:{message:e,id:r,cc:n}
})},mediaSourceError:function(e,r,n){t.trigger(p.ERROR,{error:"mediasource",event:e,code:r,decodeErrorType:n})},mediaKeySessionError:function(e){t.trigger(p.ERROR,{error:"key_session",event:e})},mediaKeyMessageError:function(e){t.trigger(p.ERROR,{error:"key_message",event:e})},mssError:function(e){t.trigger(p.ERROR,{error:"mssError",event:e})}}}It.__dashjs_factory_name="ErrorHandler";var Ot=s.a.getSingletonFactory(It);Ot.CAPABILITY_ERROR_MEDIASOURCE="mediasource",Ot.CAPABILITY_ERROR_MEDIAKEYS="mediakeys",Ot.DOWNLOAD_ERROR_ID_MANIFEST="manifest",Ot.DOWNLOAD_ERROR_ID_SIDX="SIDX",Ot.DOWNLOAD_ERROR_ID_CONTENT="content",Ot.DOWNLOAD_ERROR_ID_INITIALIZATION="initialization",Ot.DOWNLOAD_ERROR_ID_XLINK="xlink",Ot.DOWNLOAD_ERROR_ID_PCDN_SDK="pcdnsdk",Ot.MANIFEST_ERROR_ID_CODEC="codec",Ot.MANIFEST_ERROR_ID_PARSE="parse",Ot.MANIFEST_ERROR_ID_NOSTREAMS="nostreams",Ot.TIMED_TEXT_ERROR_ID_PARSE="parse",s.a.updateSingletonFactory(It.__dashjs_factory_name,Ot);var Ct=Ot;function Nt(){return{arraybuffer2string:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},base642ab:function(e){e=window.atob(e);for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return t},concat:function(e,t){var r=new Uint8Array(e),n=new Uint8Array(t),i=new Uint8Array(r.length+n.length);return i.set(r),i.set(n,r.length),i.buffer}}}Nt.__dashjs_factory_name="ArrayBufferHandler";var kt=s.a.getSingletonFactory(Nt);function Lt(e){e=e||{};var t=void 0,r=g(this.context).getInstance().log,n="[ExternalMediaSourceLoader]",i=e.loader;return{load:function(e){t=e;var o,a=e.request;if(i&&"function"==typeof i){var s=(o=a.url).match(/[^/]+.m4s/gi)&&o.match(/[^/]+.m4s/gi)[0];r(n+" start to get "+s+", range is "+a.range),e.request.loadInfo={rType:"exld",url:a.url},i({filename:s,range:a.range,url:a.url}).then((function(t){return function(e,t){0===e.code?(t.progress&&t.progress(null,e.data,null),t.onload&&t.onload(),t.onend&&t.onend()):(r(n+" Get data error, err code is "+e.code),this.onError("Get data error "+e.code,t))}(t,e)})).catch((function(t){return function(e,t){r(n+" Get data error, err is "+e),t.onerror&&t.onerror()}(t,e)}))}},abort:function(){t&&t.onabort&&t.onabort(),t&&t.onend&&t.onend()}}}Lt.__dashjs_factory_name="ExternalMediaSourceLoader";var xt=s.a.getClassFactory(Lt);function Mt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ft={video:null,audio:null};function Ut(e){e=e||{};var t,r=this.context,i=d(r).getInstance(),a=e.errHandler,s=e.videoModel,u=e.metricsModel,c=e.mediaPlayerModel,l=e.requestModifier,f=e.useFetch||!1,h=e.dashMetrics,y=B()?2:3,m=B()?20:15,v=g(r).getInstance().log,_=void 0,E=void 0,b=void 0,S=void 0,T=[],w=void 0,A={},R=kt(r).getInstance(),P=[],D=0,I=void 0,O=void 0,C=void 0,N=void 0,k=-1,L=0,x=[],M=void 0,U=e.preloadData;function B(){var e=(new Date).getHours();return![12,13,20,21].includes(e)}function j(e){x.length>5&&x.shift(),x.push(e)}function V(e,t){var r=e.url;if(!r||!r.includes("traceid="))return!1;if(t||e.urls.length<2)return!1;if(isNaN(e.index)||e.index<=2&&B())return!0;var n=s&&s.getElement(),i=n&&n.seeking,o=n&&n.currentTime||0,a=0;return n.buffered&&n.buffered.length&&(a=n.buffered.end(0)),!i&&a-o<7}function G(e){e&&e.beforeSeekingRange&&(e.range=e.beforeSeekingRange,e.beforeSeekingRange=null,v("[HTTPLoader] Clear Seek More Bytes"))}function H(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=e.request,h="",y=0,m=0,g=0;if(G(d),d.range){var _=d.range.split("-");if(y=parseInt(_[0]),m=parseInt(_[1]),d.mediaType&&d.representationId&&U&&U[d.mediaType+"id"]===d.representationId+""&&U[d.mediaType]){if(m<U[d.mediaType].byteLength)return m+1===U[d.mediaType].byteLength&&(d.preloadEnd=1),void e.success(U[d.mediaType].slice(y,m+1));y<U[d.mediaType].byteLength&&(h=U[d.mediaType].slice(y,m+1),d.range=U[d.mediaType].byteLength+"-"+m,d.preloadEnd=1)}try{var P=!(!e.params||"boolean"!=typeof e.params.disableSeekDownloadMore)&&e.params.disableSeekDownloadMore;if(s&&!P){var N,x=s.getElement(),B=s.isSeeking(),Q=s.getPlaybackRate()||1,z=x&&x.currentTime||0,J=(d.startTime+d.duration-z)/Q,X="video"===d.mediaType?+d.representationId:0,$=-1;if(x.buffered&&x.buffered.length&&($=x.buffered.end(0)),N=$-z,X&&X<125&&B&&d.index>=2&&N<=0&&J<2.5&&J>=0){var ee=Math.min(1-J/5,.6);d.beforeSeekingRange=d.range;var te=d.range.split("-");y=parseInt(te[0]),m=parseInt(te[1]);var re=null,ne=0;if(M&&M[d.mediaType]&&(re=M[d.mediaType].find((function(e,t){return t>d.index})))){var ie=re.mediaRange.split("-");ne=ie.length&&+ie[1]-+ie[0]||0}var oe=Math.round(ne*ee);d.range=y+"-"+(m+oe),v("[HTTPLoader] Seeking Download More "+oe+" Bytes")}}}catch(e){}}var ae=s.getElement();d.currentTime=ae&&ae.currentTime;var se=d.NCInfo;if(se&&se.responseData&&se.responseData.availableData&&se.responseData.availableData.length>0){var ue=se.responseData.missingData;if(ue&&1===ue.length){var ce=ue[0].start,le=ue[0].end;ce>0&&le>0&&ce>=y&&le<=m&&(d.completeNCMissingRange=!0,d.originRange=d.range,d.range=ce+"-"+le)}}"video"===d.mediaType&&parseInt(d.representationId,10)>=80||(d.completeNCMissingRange=!1,d.originRange&&(d.range=d.originRange)),d.firstByteDate=null;var de=[],fe=d.representationId,pe=!0,he=!0,ye=new Date,me=ye,ge=0,ve=void 0,_e=A[fe]||0,Ee=!1,be=1,Se=0,Te=void 0,we=-1;if(d.urls&&d.urls.length>1&&_e&&(d.url=d.urls[_e],e.url=d.urls[_e]),!l||!u||!a)throw new Error("config object is not correct or missing");var Ae=l.modifyRequestURL(d.url),Re=!(!e.params||"boolean"!=typeof e.params.canUseNC)&&e.params.canUseNC,Pe=s&&s.getElement()&&s.getElement().playbackRate||1,De=(d.bufferLevel||0)/Pe,Ie=function(e){var t=0;try{var r=e&&e.mediaInfo&&e.mediaInfo.bitrateList,n=e&&e.representationId;if(n&&r&&r.length){var i=r.filter((function(e){return e.id===n}));i&&i.length&&(t=i[0].bandwidth)}}catch(e){}return t}(d);if(Ie>1048576){var Oe=parseInt(Ie/1024/1024,10),Ce=Math.min(10,2+1.5*Oe);De=Math.max(0,De-Ce)}else De=Math.max(0,De-2);var Ne=K({canUseNC:Re,rangeStart:y,mediaUrl:Ae,bufferLevel:De,bitrate:Ie,originBufferLevel:d&&d.bufferLevel||0,isSwitchingQn:!(!d||!d.isSwitchingQn)});Ne&&G(d);try{if(V(d,Ne)){if(!n&&d.urls.length){var ke=d.urls[1]||d.url;ke&&(Ae=d.url=ke)}we=1}}catch(e){}var Le=function(e){he=!1;var t=new Date;if(d.requestStartDate=ye,d.requestEndDate=t,d.firstByteDate=d.firstByteDate||t,G(d),function(e){if(e.p2pLoadInfo&&e.loadInfo){var t=function(e){for(var t in e)["url","rType"].indexOf(e)>-1||(r[t]=(r[t]||0)+(e[t]||0))},r={};t(e.p2pLoadInfo),t(e.loadInfo),r.rType="XHR",r.url=e.loadInfo.url||e.p2pLoadInfo.url||"",e.loadInfo=r}else e.loadInfo=e.p2pLoadInfo||e.loadInfo||{};"XHR"===e.loadInfo.rType&&(e.url&&e.url.indexOf("traceid=")>-1?e.loadInfo.pdn=e.bytesTotal||e.bytesLoaded||0:e.loadInfo.cdn=e.bytesTotal||e.bytesLoaded||0,e.loadInfo.url=e.url)}(d),e){if(Ne||!Ne&&d&&d.p2pLoadInfo&&d.p2pLoadInfo.nc){Ne&&(L=0);var r=d.requestEndDate,n=d.startLoadFragmentTime;n&&r&&j(r.getTime()-new Date(n).getTime())}}else if(Ne&&d&&d.mediaType){var i=k,o=d.index;d.p2pLoadInfo&&(isNaN(o)||o-i!=1&&-1!==i||L++),k=o}d.checkExistenceOnly||u.addHttpRequest(d.mediaType,null,d.type,d.url,ve.response?ve.response.responseURL:null,d.serviceLocation||null,d.range||null,d.requestStartDate,d.firstByteDate,d.requestEndDate,ve.response?ve.response.status:null,d.duration,ve.response&&ve.response.getAllResponseHeaders?ve.response.getAllResponseHeaders():ve.response?ve.response.responseHeaders:null,e?de:null)},xe=function(){if(clearTimeout(Se),-1!==E.indexOf(ve)){E.splice(E.indexOf(ve),1),Te=!1;var r=ve&&ve.response&&ve.response.status;if(he)if(Le(!1),e.params&&(e.params.canUseNC=!1),function(e){var t=e.NCInfo;return t&&t.responseData&&t.responseData.missingData&&t.responseData.missingData.length>0}(d)&&e.params&&(e.params.disableSeekDownloadMore=!0),t>0){var s=0,u=0;Date.now()-ye<50&&(u=!d.index||d.index<=2||performance&&performance.now&&performance.now()<1e4?1e3*(n+1)/100:1e3*(n+1),g=o.CONNECT_FRAGMENT_ERROR_OFFLINE),(r>=400&&r<500||r>=600)&&(u=0,s=0),Ne&&(u=0,s=0),D=setTimeout((function(){var o;c.setRetryTimes(n+1),Ne||n++;var a=ve.request,u=ve.request&&ve.request&&ve.request.NCInfo
;if(a.retryTimes=n,i.trigger(p.REQUEST_RETRYED,(Mt(o={retryTimes:n,representationId:fe,status:ve.response&&ve.response.status,url:a.url,mediaType:a.mediaType,range:a.range,rType:Ne?"NC":"XHR",code:(Ne?u&&u.code:ve.response&&ve.response.status)||g,index:a&&a.index,id:a&&a.representationId},"url",a&&a.url),Mt(o,"timeout",a.timeout),Mt(o,"latencyTime",a.latency),Mt(o,"downloadTime",(a.requestEndDate&&a.requestEndDate.getTime())-(a.requestStartDate&&a.requestStartDate.getTime())),o)),c.getP2pPermission()&&4203===r&&Y(),e.request.urls&&e.request.urls.length>1){var l=n%a.urls.length;a.urls&&a.urls.length&&a.urls[0].includes("traceid=")&&(we>0?l=(n+1)%a.urls.length:Ne?(W(a.mediaType)||0)<30&&(l=(n+1)%a.urls.length):l===A[fe]&&(l=(l+1)%a.urls.length)),A[fe]=l,_e=A[fe],e.request.url=a.urls[_e],e.url=a.urls[_e],t--,S.push(setTimeout((function(){v("[HTTPLoader] internalLoad failure retry, useNC: "+Ne),H(e,t,n)}),s))}else t--,S.push(setTimeout((function(){v("[HTTPLoader] internalLoad failure retry, useNC: "+Ne),H(e,t,n)}),s))}),u)}else a.downloadError(w[d.type].type,d.url,d,w[d.type].code,ve.response&&ve.response.status),e.error&&e.error(d,"error",ve.response&&ve.response.statusText,ve.response&&ve.response.status),e.complete&&e.complete(d,ve.response&&ve.response.statusText),q(d.mediaType)}},Me=function(e){var t=s.getPlaybackRate()||1,r=e.request,n=e.useNC,i=e.modifiedUrl,o=e.retryTimes,a=e.connectMaxTime,u=e.bitrate,c=a+1e3*o+50,l=r.timeout+3e3*o;if((n||i&&i.includes("traceid"))&&(c=function(e,t){var r=5e3,n=1e4,i=5e3;return e<15?i=r:e<20?i=1e3*parseInt(e-10,10):e>20&&(i=n),i=Math.min(i,n),i=Math.max(i,r),v("NCLoader latency, bufferLevel: "+e+", latencyTimeout: "+i),i}(r.bufferLevel),r.bitrate=u,r.latency=c,l=c+200),isNaN(r.bufferLevel)||!t||!r.bufferLevel)return{latencyTimeout:c,timeout:l};var d=r.bufferLevel/t*1e3,f=n?5e3:2e3,p=n?.6:.2,h=Math.max,y=Math.min;return{latencyTimeout:0|h(y(c,d*p),f),timeout:0|h(y(l,.6*d),5e3)}}({request:d,useNC:Ne,modifiedUrl:Ae,retryTimes:n,connectMaxTime:2e3,bitrate:Ie}),Fe=Me.latencyTimeout,Ue=Me.timeout;Se=setTimeout((function(){c.getP2pPermission()&&"function"==typeof Te.getP2pType&&Te.getP2pType()&&c.addP2pSDKErrorCount(),Ee=!0,Te.abort(ve),T.push(4106),e.connectTimeout&&e.connectTimeout(d,Fe,Ne),xe()}),Fe);var Be=new Uint8Array,je=function(e,t){var r=t||e.response.response,n=e.request;if(n&&n.beforeSeekingRange){var i=n.beforeSeekingRange.split("-"),o=parseInt(i[0]),a=parseInt(i[1]),s=new Uint8Array(r.slice(0,a-o+1));return n.range=n.beforeSeekingRange,n.beforeSeekingRange=null,s.buffer}return r},Ve=Z();if(Ve&&"function"==typeof Ve)Te=xt(r).create({requestModifier:l,loader:Ve});else if(Ne)Te=Rt(r).create({requestModifier:l,hid:I}),c.getUseP2P()||Te.disableRP(),i.trigger(p.CDN_LOAD_INFO,{NCInfo:{code:9999,qn:parseInt(d.representationId,10)||0,range:d.range,responseData:{}}});else if(f&&window.fetch&&"arraybuffer"===d.responseType)Te=Dt(r).create({requestModifier:l});else{var Ge=window.__DASH_P2P_TYPE__,He={yf:window.YFDashIO,xl:window.xyvp&&window.xyvp.Loader,ks:window.KSLoader,pear:window.PearDownloader,bili:window.DIYSdk},qe=void 0,We=void 0,Ye=void 0;if(Ge&&c.getP2pPermission()){var Ke=Ge.match(/([a-z]+)-([a-z0-9]+)/);Ke&&(qe=He[Ke[1]],Ye="cg2"===Ke[2],We="eg"===Ke[2]),qe||delete window.__DASH_P2P_TYPE__}We&&qe&&d.index>=0?Ft[d.mediaType]&&Ft[d.mediaType].getP2pType()&&function(e,t){var r=e.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)&&e.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)[1],n=t.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)&&t.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)[1];return r&&n&&r===n}(Ft[d.mediaType].getUrl(),Ae)?Te=Ft[d.mediaType]:(q(d.mediaType),Te=wt(r).create({video:s.getElement(),p2pType:Ge,supplier:qe}),Ft[d.mediaType]=Te):Ye&&qe&&"video"===d.mediaType&&Ae!==C&&(C=Ae,O&&O.destroy(),O=new qe(Ae,s.getElement(),"watch")),Te||(q(d.mediaType),Te=St(r).create({requestModifier:l}))}var Qe=d.checkExistenceOnly?F.HEAD:F.GET,ze=c.getXHRWithCredentialsForType(d.type);ve={url:Ae,method:Qe,withCredentials:ze,timeout:Ue,request:d,onload:function(){if(ve.response){if(ve.response.status>=200&&ve.response.status<=299){var t=je(ve);h&&(t=R.concat(h,t),d.range=y+"-"+m),Le(!0),e.success&&e.success(t,ve.response.statusText,ve.response.responseURL),e.complete&&e.complete(d,ve.response.statusText)}}else{var r=je(ve,Be);h&&(r=R.concat(h,r),d.range=y+"-"+m),Le(!0),e.success&&e.success(r,"",Ae),e.complete&&e.complete(d,"")}},onend:xe,onerror:xe,ontimeout:function(){T.push(4105),e.timeout&&e.timeout(d,be,Ue),xe()},progress:function(t,r,n){var i=new Date;if(n){for(var o in d.p2pLoadInfo||(d.p2pLoadInfo={}),n)["p2p","cdn","nc","ncBr","pdn"].indexOf(o)>-1?d.p2pLoadInfo[o]=(d.p2pLoadInfo[o]||0)+n[o]:d.p2pLoadInfo[o]=n[o];d.p2pLoadInfo.requestStartTime=ye}if(!t){if(t={lengthComputable:!1,total:0,loaded:0},r&&(Be=R.concat(Be,r),t.loaded=Be.byteLength),d.range){var a=d.range.split("-"),s=parseInt(a[0]),u=parseInt(a[1]);u&&(t.total=u-s+1)}t.loaded&&t.total&&(t.lengthComputable=!0)}pe&&(pe=!1,(be=i-ye)<2e3&&clearTimeout(Se),(!t.lengthComputable||t.lengthComputable&&t.total!==t.loaded)&&(d.firstByteDate=i)),t.lengthComputable&&(d.bytesLoaded=t.loaded,d.bytesTotal=t.total),t.noTrace||(de.push({s:me,d:i.getTime()-me.getTime(),b:[t.loaded?t.loaded-ge:0]}),me=i,ge=t.loaded),e.progress&&t.loaded&&e.progress(t.loaded)},onabort:function(){clearTimeout(Se),clearTimeout(D),e.abort&&!Ee&&e.abort(d)},onHeadersReceived:function(){d.headersReceivedDate=new Date,e.headersReceived&&e.headersReceived(ve.response&&ve.response.getAllResponseHeaders&&ve.response.getAllResponseHeaders())},onNCFail:function(e){if(e){for(var t in d.p2pLoadInfo||(d.p2pLoadInfo={}),e)["p2p","cdn","nc","ncFail","ncGotFail","ncBr","pdn"].indexOf(t)>-1?d.p2pLoadInfo[t]=(d.p2pLoadInfo[t]||0)+e[t]:d.p2pLoadInfo[t]=e[t];d.p2pLoadInfo.requestStartTime=ye}},onNCInfo:function(e){e.qn=parseInt(d.representationId,10)||0,d.NCInfo=e},loader:Te};var Ze=(new Date).getTime();if(isNaN(d.delayLoadingTime)||Ze>=d.delayLoadingTime)E.push(ve),Te.load(ve);else{var Je={httpRequest:ve};b.push(Je),Je.delayTimeout=setTimeout((function(){if(-1!==b.indexOf(Je)){b.splice(b.indexOf(Je),1);try{ye=new Date,me=ye,E.push(Je.httpRequest),Te.load(Je.httpRequest)}catch(e){Je.httpRequest.onerror()}}}),d.delayLoadingTime-Ze)}}function q(e){Ft[e]&&Ft[e].destroySdk&&(Ft[e].destroySdk(),Ft[e]=null)}function W(e){if(h)return-1!==[n.VIDEO,n.AUDIO,n.FRAGMENTED_TEXT].indexOf(e)&&h.getCurrentBufferLevel(u.getReadOnlyMetricsFor(e))||NaN}function Y(){i.trigger(p.PCDN_LOADED_ERROR,{code:o.DOWNLOAD_PCDN_DISABLED,from:1}),c.setP2pPermission(!1)}function K(e){if(!c.getUseNC())return!1;var t=e.canUseNC,r=e.rangeStart,n=e.mediaUrl,i=e.bufferLevel,o=e.bitrate,a=e.originBufferLevel,u=e.isSwitchingQn;if(isNaN(r)||r<0||!n||u)return!1;var l=function(){var e="bpNC";return I&&(e+="_"+I),window[e]}();if(!t||!l||"function"!=typeof l.allowDPGetDataByNC)return!1;var d=(""+n).split("?")[0].split("/"),f=d[d.length-1].split(".")[0].split("-").pop();if(!f)return!1;var p=parseInt(f,10);if(isNaN(p))return!1;var h,g=NaN,_=!1,E=1;if(s&&s.getElement()){var b=s.getElement(),S=b.currentTime,T=0;b.buffered&&b.buffered.length&&(T=b.buffered.end(0)),g=T-S,_=b&&b.seeking,E=b&&b.playbackRate||1}return!isNaN(g)&&!(!i||a/E<=((h=x.length)&&x.reduce((function(e,t){return e+t}))/h/1e3||0))&&(L>=y&&i/E<m?(v("[disableNc] cause ncLoaderFailedConstantlyTimes is "+L),!1):(v("Is Use NCLoader, "+l.allowDPGetDataByNC({rangeStart:r,qn:p,bufferRemaining:g,bufferLevel:i,isSeeking:_,bitrate:o,originBufferLevel:a})+","+JSON.stringify({rangeStart:r,qn:p,bufferRemaining:g,bufferLevel:i,isSeeking:_,bitrate:o,originBufferLevel:a})),l.allowDPGetDataByNC({rangeStart:r,qn:p,bufferRemaining:g,bufferLevel:i,isSeeking:_,bitrate:o,originBufferLevel:a})))}function Q(e){e&&e.hid&&(I=e.hid)}function z(e){e&&e.loader&&!N&&(N=e.loader,i.off(p.BIND_MEDIA_SOURCE_LOADER,z,_))}function Z(){var e=N||c.getExternalMediaLoader();return v("[getMediaSourceLoader] use media source loader is ",!!e),e}return U&&(U.video&&"string"==typeof U.video&&(U.video=R.base642ab(U.video)),U.audio&&"string"==typeof U.audio&&(U.audio=R.base642ab(U.audio))),_={load:function(e){
e.request&&(c.setRetryTimes(0),H(e,c.getRetryAttemptsForType(e.request.type),0))},abort:function(){O&&(O.destroy(),O=void 0,C=void 0),N&&(N=null),clearTimeout(D),P.forEach((function(e){return clearTimeout(e)})),S.forEach((function(e){return clearTimeout(e)})),S=[],b.forEach((function(e){return clearTimeout(e.delayTimeout)})),b=[],E.forEach((function(e){e&&e.request&&isNaN(e.request.index)||(e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e),e.onabort())})),E=[],i.off(p.INIT_HID,Q,_),i.off(p.BIND_MEDIA_SOURCE_LOADER,z,_)},setPreloadData:function(e){(U=e)&&(U.video&&"string"==typeof U.video&&(U.video=R.base642ab(U.video)),U.audio&&"string"==typeof U.audio&&(U.audio=R.base642ab(U.audio)))},setSegmentsInfo:function(e){e&&e.segments&&(M||(M={}),M[e.mediaType]=e.segments)}},i.on(p.INIT_HID,Q,_),i.on(p.BIND_MEDIA_SOURCE_LOADER,z,_),E=[],b=[],S=[],Mt(t={},F.MPD_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_MANIFEST,code:o.DOWNLOAD_MPD_ERROR}),Mt(t,F.XLINK_EXPANSION_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_XLINK,code:o.DOWNLOAD_XINK_ERROR}),Mt(t,F.INIT_SEGMENT_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_INITIALIZATION,code:o.DOWNLOAD_INIT_SEGMENT_ERROR}),Mt(t,F.MEDIA_SEGMENT_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_CONTENT,code:o.DOWNLOAD_MEDIA_SEGMENT_ERROR}),Mt(t,F.INDEX_SEGMENT_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_CONTENT,code:o.DOWNLOAD_INDEX_SEGMENT_ERROR}),Mt(t,F.BITSTREAM_SWITCHING_SEGMENT_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_CONTENT,code:o.DOWNLOAD_SWITCHING_SEGMENT_ERROR}),Mt(t,F.OTHER_TYPE,{type:Ct.DOWNLOAD_ERROR_ID_CONTENT,code:o.DOWNLOAD_OTHER_ERROR}),w=t,_}Ut.__dashjs_factory_name="HTTPLoader";var Bt=s.a.getClassFactory(Ut);function jt(){var e=this.context,t=g(e).getInstance().log,r=d(e).getInstance(),n=void 0,i=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0;function h(){if(!f||!f.hasOwnProperty("resolve"))throw new Error("setConfig function has to be called previously")}function m(e){if(e.url){var t=new y;return t.type=e.init?F.INIT_SEGMENT_TYPE:F.MEDIA_SEGMENT_TYPE,t.url=e.url,t.urls=e.urls,t.range=e.range.start+"-"+e.range.end,t.representationId=e.representationId,t.mediaType=e.mediaType,t}}function v(e,t,n){e?r.trigger(p.SEGMENTS_LOADED,{segments:e,representation:t,mediaType:n}):r.trigger(p.SEGMENTS_LOADED,{segments:null,representation:t,mediaType:n,error:new w(null,"error loading segments",null)})}return{setConfig:function(e){e.baseURLController&&(f=e.baseURLController),e.metricsModel&&(u=e.metricsModel),e.mediaPlayerModel&&(c=e.mediaPlayerModel),e.errHandler&&(n=e.errHandler),e.videoModel&&(i=e.videoModel)},initialize:function(){a=be(e).getInstance(),s=Et(e).getInstance(),l=Bt(e).create({errHandler:n,videoModel:i,metricsModel:u,mediaPlayerModel:c,requestModifier:s,preloadData:c.getPreloadData()})},loadInitialization:function e(n,i){h();var o=null,s=null,u=f.resolve(n.path),c=i||{init:!0,url:u?u.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500};t("Start searching for initialization.");var d=m(c);l.load({request:d,success:function(i){c.bytesLoaded=c.range.end,s=a.parse(i),(o=function(e){var r=e.getBox("ftyp"),n=e.getBox("moov"),i=null,o=void 0,a=void 0;return t("Searching for initialization."),n&&n.isComplete&&(o=r?r.offset:n.offset,a=n.offset+n.size-1,t("Found the initialization.  Range: "+(i=o+"-"+a))),i}(s))?(n.range=o,r.trigger(p.INITIALIZATION_LOADED,{representation:n})):(c.range.end=c.bytesLoaded+c.bytesToLoad,e(n,c))},error:function(){r.trigger(p.INITIALIZATION_LOADED,{representation:n})}}),t("Perform init search: "+c.url)},loadSegments:function e(r,i,s,u,d){if(h(),s&&(void 0===s.start||void 0===s.end)){var p=s?s.toString().split("-"):null;s=p?{start:parseFloat(p[0]),end:parseFloat(p[1])}:null}s.start=0,d=d||v;var y=null,g=null,_=!!s,E=f.resolve(r.path),b={init:!1,url:E?E.url:void 0,urls:E.urls,range:_?s:{start:0,end:1500},searching:!_,bytesLoaded:u?u.bytesLoaded:0,bytesToLoad:1500,representationId:r.id,mediaType:r.adaptation.type},S=m(b),T=function(){d(null,r,i)};l.load({request:S,success:function(s){if(b.bytesLoaded=b.range.end-b.range.start,y=a.parse(s),(g=y.getBox("sidx"))&&g.isComplete){var u=g.references,l=void 0,f=void 0;if(null!=u&&u.length>0&&(l=1===u[0].reference_type),l){t("Initiate multiple SIDX load."),b.range.end=b.range.start+g.size;var p=void 0,h=void 0,m=void 0,v=void 0,_=[],E=0,S=(g.offset||b.range.start)+g.size,w=function(e){e?(_=_.concat(e),++E>=h&&d(_,r,i)):d(null,r,i)};for(p=0,h=u.length;p<h;p++)m=S,v=S+u[p].referenced_size-1,S+=u[p].referenced_size,e(r,null,{start:m,end:v},b,w)}else{t("Parsing segments from SIDX."),f=function(e,t){for(var r=e.references,n=r.length,i=e.timescale,o=e.earliest_presentation_time,a=t.range.start+e.offset+e.first_offset+e.size,s=[],u=void 0,c=void 0,l=void 0,d=void 0,f=0;f<n;f++)l=r[f].subsegment_duration,d=r[f].referenced_size,(u=new nt).duration=l,u.startTime=o,u.timescale=i,c=a+d-1,u.mediaRange=a+"-"+c,s.push(u),o+=l,a+=d;return s}(g,b);try{var A=f[f.length-1],R=(A.duration+A.startTime)/A.timescale;r.adaptation.period.min?r.adaptation.period.min=Math.min(r.adaptation.period.min,R):r.adaptation.period.min=R;var P=c.getCachedDurationOffset("offset");r.adaptation.period.duration=parseFloat((P+r.adaptation.period.min).toFixed(5)),t("Set real min period duration "+r.adaptation.period.duration+" ( "+P+" )")}catch(e){t("Set real period error "+i)}d(f,r,i)}}else T(),n.mediaSourceError("Error parsing "+i+" response.",o.MEDIA_DECODE_ERROR)},error:T}),t("Perform SIDX load: "+b.url)},resetPreloadData:function(){l&&l.setPreloadData(c.getPreloadData())},reset:function(){l.abort(),l=null,n=null,a=null,s=null}}}jt.__dashjs_factory_name="SegmentBaseLoader";var Vt=s.a.getSingletonFactory(jt);function Gt(e){e=e||{};var t=this.context,r=d(t).getInstance(),i=rt(t).getInstance(),o=void 0,a=e.timelineConverter,s=e.dashMetrics,u=e.metricsModel,c=e.mediaPlayerModel,l=e.errHandler,f=e.baseURLController,h=void 0,m=void 0,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,T=void 0,A=void 0;function R(){v=-1,E=0,b=NaN,_=null,S=null,T=null}function P(e,t,r){var n=f.resolve(r.path),o=void 0,a=void 0,s=void 0;return n&&t!==n.url&&i.isRelative(t)?(o=n.url,a=n.urls||[],s=n.serviceLocation,t&&(o=i.resolve(t,o))):a=[o=t],!i.isRelative(o)&&(e.url=o,e.urls=a,e.serviceLocation=s,!0)}function D(e){var t=!1,r=S?S.getStreamInfo().manifestInfo.isDynamic:null;if(r||v!==e.availableSegmentsNumber){var n=ct(v,e);if(n){var i=parseFloat((n.presentationStartTime-e.adaptation.period.start).toFixed(5)),o=c.getCachedDurationOffset("duration"),a=o?Math.min(e.adaptation.period.duration,o):e.adaptation.period.duration;a=e.adaptation.period.duration,m(e.segmentInfoType+": "+i+" / "+a),t=(e.segmentInfoType!==Je.SEGMENT_TIMELINE||!r)&&i>=a}else m("isMediaFinished - no segment found")}else t=!0;return t}function I(e){T.getSegments(e,_,v,O)}function O(e,t){var r=S?S.getStreamInfo().manifestInfo.isDynamic:null;if(e.segments=t,t&&t.length>0&&(b=isNaN(b)?t[0].presentationStartTime:Math.min(t[0].presentationStartTime,b),r&&isNaN(a.getExpectedLiveEdge()))){var i=t[t.length-1].presentationStartTime,o=u.getMetricsFor(n.STREAM);a.setExpectedLiveEdge(i),u.updateManifestUpdateInfo(s.getCurrentManifestUpdate(o),{presentationStartTime:i})}}function C(e){if(!e)throw new Error("no representation");e.segments=null,I(e)}function N(e,t,r){var n=t.segments,i=n?n.length:null,o=-1,a=void 0,s=void 0,u=void 0,l=void 0,d=void 0;if(n&&i>0){for(r=null==r?c.getSegmentOverlapToleranceTime():r,d=0;d<i;d++)if(u=(s=n[d]).presentationStartTime,l=s.duration,e+(a=null==r?l/2:r)>=u&&e-a<u+l){o=s.availabilityIdx;break}0===e&&n[0].presentationStartTime>0&&(o=0)}return o}function k(e){if(null==e)return null;var t=new y,r=e.representation,n=r.adaptation.period.mpd.manifest.Period_asArray[r.adaptation.period.index].AdaptationSet_asArray[r.adaptation.index].Representation_asArray[r.index].bandwidth,i=e.media,o=S?S.getType():null;return i=at(i,"Number",e.replacementNumber),i=at(i,"Time",e.replacementTime),i=function(e){return e?e.split("$$").join("$"):e}(i=function(e,t){if(!t||!e||-1===e.indexOf("$RepresentationID$"))return e;var r=t.toString();return e.split("$RepresentationID$").join(r)}(i=at(i,"Bandwidth",n),r.id)),t.mediaType=o,t.type=F.MEDIA_SEGMENT_TYPE,
t.range=e.mediaRange,t.startTime=e.presentationStartTime,t.duration=e.duration,t.timescale=r.timescale,t.availabilityStartTime=e.availabilityStartTime,t.availabilityEndTime=e.availabilityEndTime,t.wallStartTime=e.wallStartTime,t.quality=r.index,t.index=e.availabilityIdx,t.mediaInfo=S.getMediaInfo(),t.adaptationIndex=r.adaptation.index,t.representationId=r.id,P(t,i,r)?t:void 0}function L(e,t,r){var n=void 0,i=S?S.getType():null,o=S?S.getStreamInfo().manifestInfo.isDynamic:null,a=v,s=!!r&&r.keepIdx,u=r?r.timeThreshold:null,c=!(!r||!r.ignoreIsFinished);return e?(_!==t&&(_=t,m("Getting the request for "+i+" time : "+t)),I(e),(v=N(t,e,u))<0&&(I(e),v=N(t,e,u)),v>0&&m("Index for "+i+" time "+t+" is "+v),!c&&D(e)?((n=new y).action=y.ACTION_COMPLETE,n.index=v,n.mediaType=i,n.mediaInfo=S.getMediaInfo(),m("Signal complete in getSegmentRequestForTime -",i)):n=k(ct(v,e)),s&&a>=0&&(v=e.segmentInfoType===Je.SEGMENT_TIMELINE&&o?v:a),n):null}function x(e){var t=e.representation;t.segments&&r.trigger(p.REPRESENTATION_UPDATED,{sender:this,representation:t})}function M(e){var t=S?S.getType():null,n=S?S.getStreamInfo().manifestInfo.isDynamic:null;if(!e.error&&t===e.mediaType){var i,o=e.segments,s=e.representation,u=[],l=0,d=void 0,f=void 0,h=void 0,y=0;for(c.getAppendingSourceState()&&(A=c.getCachedDurationOffset("offset"),y=o[0].startTime,v=0),d=0,i=o.length;d<i;d++)f=o[d],h=ut(a,n,s,f.startTime+A*f.timescale-y,f.duration,f.timescale,f.media,f.mediaRange,l),u.push(h),h=null,l++;s.segmentAvailabilityRange={start:u[0].presentationStartTime,end:u[i-1].presentationStartTime},s.availableSegmentsNumber=i,O(s,u),Xe.hasInitialization(s)&&r.trigger(p.REPRESENTATION_UPDATED,{sender:this,representation:s})}}return h={initialize:function(r){var n=(S=r)?S.getStreamInfo().manifestInfo.isDynamic:null;o.initialize(),T=vt(t).create(e,n)},getStreamProcessor:function(){return S},getInitRequest:function(e){var t=S?S.getType():null;return e?function(e,t){var r=new y,n=e.adaptation.period,i=n.start,o=S?S.getStreamInfo().manifestInfo.isDynamic:null;if(r.mediaType=t,r.type=F.INIT_SEGMENT_TYPE,r.range=e.range,r.availabilityStartTime=a.calcAvailabilityStartTimeFromPresentationTime(i,n.mpd,o),r.availabilityEndTime=a.calcAvailabilityEndTimeFromPresentationTime(i+n.duration,n.mpd,o),r.quality=e.index,r.mediaInfo=S?S.getMediaInfo():null,r.representationId=e.id,P(r,e.initialization,e))return r}(e,t):null},getSegmentRequestForTime:L,getNextSegmentRequest:function(e){var t=void 0,r=void 0,n=S?S.getType():null,i=S?S.getStreamInfo().manifestInfo.isDynamic:null;return e&&-1!==v?(_=null,v++,m("Getting the next request at index: "+v+", type: "+n),!ct(v,e)&&i?(m("No segment found at index: "+v+". Wait for next loop"),I(e),v--,null):(D(e)?((t=new y).action=y.ACTION_COMPLETE,t.index=v,t.mediaType=n,t.mediaInfo=S.getMediaInfo(),m("Signal complete -",n)):(I(e),t=k(r=ct(v,e)),!r&&i&&v--),t)):null},generateSegmentRequestForTime:function(e,t){var r=(e.segmentAvailabilityRange.end-e.segmentAvailabilityRange.start)/2;return e.segments=null,e.segmentAvailabilityRange={start:t-r,end:t+r},L(e,t,{keepIdx:!1,ignoreIsFinished:!0})},updateRepresentation:function(e,t){var n=Xe.hasInitialization(e),i=Xe.hasSegments(e),s=S?S.getType():null,u=S?S.getStreamInfo().manifestInfo.isDynamic:null,c=void 0;if(e.segmentDuration||e.segments||C(e),e.segmentAvailabilityRange=a.calcSegmentAvailabilityRange(e,u),e.segmentAvailabilityRange.end<e.segmentAvailabilityRange.start&&!e.useCalculatedLiveEdgeTime)return c=new w(1,"no segments are available yet",{availabilityDelay:e.segmentAvailabilityRange.start-e.segmentAvailabilityRange.end}),void r.trigger(p.REPRESENTATION_UPDATED,{sender:this,representation:e,error:c});t||(v=-1),e.segmentDuration&&C(e),n||o.loadInitialization(e),i||o.loadSegments(e,s,e.indexRange),n&&i&&r.trigger(p.REPRESENTATION_UPDATED,{sender:this,representation:e})},updateSegmentList:C,setCurrentTime:function(e){c.getCachedDurationOffset("duration")&&(e=Math.min(c.getCachedDurationOffset("duration"),e)),E=e},getCurrentTime:function(){return E},getEarliestTime:function(){return b},resetPreloadData:function(){o&&o.resetPreloadData()},reset:function(){R(),r.off(p.INITIALIZATION_LOADED,x,h),r.off(p.SEGMENTS_LOADED,M,h)},getIndex:function(){return v},setIndex:function(e){v=e}},m=g(t).getInstance().log.bind(h),R(),(o=Vt(t).getInstance()).setConfig({baseURLController:f,metricsModel:u,mediaPlayerModel:c,videoModel:e.videoModel,errHandler:l}),A=0,r.on(p.INITIALIZATION_LOADED,x,h),r.on(p.SEGMENTS_LOADED,M,h),h}Gt.__dashjs_factory_name="DashHandler";var Ht=s.a.getClassFactory(Gt);Ht.SEGMENTS_UNAVAILABLE_ERROR_CODE=1,s.a.updateClassFactory(Gt.__dashjs_factory_name,Ht);var qt=Ht;function Wt(e){e=e||{};var t=this.context,r=void 0,i=e.type,o=e.errHandler,a=e.mimeType,s=e.timelineConverter,u=e.adapter,c=e.manifestModel,l=e.mediaPlayerModel,d=e.stream,f=e.abrController,p=e.playbackController,h=e.streamController,y=e.mediaController,m=e.domStorage,v=e.metricsModel,_=e.dashMetrics,E=e.dashManifestModel,b=g(t).getInstance(),S=void 0,T=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,I=void 0,O=void 0,C=void 0;function N(){C=[]}function k(){A=[],w=null,N()}function L(){return d?d.getStreamInfo():null}function x(){return w}return S={initialize:function(g){(r=qt(t).create({mimeType:a,timelineConverter:s,dashMetrics:_,metricsModel:v,mediaPlayerModel:l,baseURLController:e.baseURLController,videoModel:e.videoModel,errHandler:o})).initialize(S),f.registerStreamType(i,S),(O=d.getFragmentController().getModel(i)).setStreamProcessor(S),R=function(e){var r=null;return e!==n.VIDEO&&e!==n.AUDIO||(r=Le(t).create({type:e,metricsModel:v,mediaPlayerModel:l,manifestModel:c,errHandler:o,streamController:h,mediaController:y,adapter:u,abrController:f,playbackController:p,streamProcessor:S})),r}(i),P=Ze(t).create({type:i,metricsModel:v,adapter:u,dashMetrics:_,dashManifestModel:E,timelineConverter:s,mediaPlayerModel:l,abrController:f,playbackController:p,streamController:h,streamProcessor:S,mediaController:y}),(I=et(t).create()).setConfig({abrController:f,domStorage:m,metricsModel:v,dashMetrics:_,dashManifestModel:E,manifestModel:c,playbackController:p,timelineConverter:s,streamProcessor:S}),R.initialize(g),P.initialize(),I.initialize()},isUpdating:function(){return!!I&&I.isUpdating()},getType:function(){return i},getBufferController:function(){return R},getFragmentModel:function(){return O},getScheduleController:function(){return P},getLiveEdgeFinder:function(){return D},getEventController:function(){return d?d.getEventController():null},getFragmentController:function(){return d?d.getFragmentController():null},getRepresentationController:function(){return I},getIndexHandler:function(){return r},getCurrentRepresentationInfo:function(){return u.getCurrentRepresentationInfo(I)},getRepresentationInfoForQuality:function(e){return u.getRepresentationInfoForQuality(I,e)},getBufferLevel:function(){return R.getBufferLevel()},switchInitData:function(e,t){R&&R.switchInitData(L().id,e,t)},isBufferingCompleted:function(){return!!R&&R.getIsBufferingCompleted()},createBuffer:function(){return R.getBuffer()||R.createBuffer(w)},getStreamInfo:L,updateMediaInfo:function(e){if(!(e===w||e&&w&&e.type!==w.type)){var t=(w=e).bitrateList.map((function(e){return{id:e.id,bandwidth:e.bandwidth}}));T("[mediaInfo] type: "+w.type+", bitrateList: "+JSON.stringify(t))}-1===A.indexOf(e)&&A.push(e),u.updateData(this)},switchTrackAsked:function(){P.switchTrackAsked()},getMediaInfoArr:function(){return A},getMediaInfo:x,getMediaSource:function(){return R.getMediaSource()},setMediaSource:function(e){R.setMediaSource(e,x())},dischargePreBuffer:function(){R.dischargePreBuffer()},getBuffer:function(){return R.getBuffer()},setBuffer:function(e){R.setBuffer(e)},registerExternalController:function(e){C.push(e)},unregisterExternalController:function(e){var t=C.indexOf(e);-1!==t&&C.splice(t,1)},getExternalControllers:function(){return C},unregisterAllExternalController:N,getPlaybackController:function(){return p},resetPreloadData:function(){O.resetPreloadData(),r.resetPreloadData()},reset:function(e){r.reset(),R&&(R.reset(e),R=null),P&&(P.reset(),P=null),I&&(I.reset(),I=null),
f&&f.unRegisterStreamType(i),C.forEach((function(e){e.reset()})),k(),i=null,d=null,D&&(D.reset(),D=null)}},p&&p.getIsDynamic()&&(D=Ve(t).create({timelineConverter:s,streamProcessor:S})),T=b.log.bind(S),k(),S}Wt.__dashjs_factory_name="StreamProcessor";var Yt=s.a.getClassFactory(Wt);function Kt(){var e,t="urn:mpeg:dash:event:2012",r=this.context,n=g(r).getInstance().log,i=d(r).getInstance(),o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,y=void 0,m=void 0;function v(){m=!1,o={},a={},s={},u=null,l=(c=100)/1e3}function _(){if(!f||!h||!y)throw new Error("setConfig function has to be called previously")}function E(){null!==u&&m&&(clearInterval(u),u=null,m=!1)}function b(e){if(1==e.eventStream.value){var t,r=e.eventStream.timescale||1,o=e.presentationTime/r;t=4294967295==e.presentationTime?NaN:(e.presentationTime+e.duration)/r,n("Manifest validity changed: Valid until: "+o+"; remaining duration: "+t),i.trigger(p.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:o,newDuration:t,newManifestValidAfter:NaN})}}function S(){T(a),T(o),function(){if(s)for(var e=y.getTime(),t=Object.keys(s),r=0;r<t.length;r++){var i=t[r],o=s[i];null!==o&&(o.duration+o.presentationTime)/o.eventStream.timescale<e&&(n("Remove Event "+i+" at time "+e),o=null,delete s[i])}}()}function T(e){var r,o=y.getTime();if(e)for(var a=Object.keys(e),u=0;u<a.length;u++){var c=a[u],d=e[c];void 0!==d&&(0==(r=d.presentationTime/d.eventStream.timescale)||r<=o&&r+l>o)&&(n("Start Event "+c+" at "+o),d.duration>0&&(s[c]=d),d.eventStream.schemeIdUri==t&&1==d.eventStream.value?0===d.duration&&0===d.presentationTimeDelta||(_(),h.refreshManifest()):i.trigger(d.eventStream.schemeIdUri,{event:d}),delete e[c])}}return e={addInlineEvents:function(e){if(_(),o={},e)for(var t=0;t<e.length;t++){var r=e[t];o[r.id]=r,n("Add inline event with id "+r.id)}n("Added "+e.length+" inline events")},addInbandEvents:function(e){_();for(var r=0;r<e.length;r++){var i=e[r];i.id in a?n("Repeated event with id "+i.id):(i.eventStream.schemeIdUri===t&&void 0===a[i.id]&&b(i),a[i.id]=i,n("Add inband event with id "+i.id))}},stop:E,start:function(){_(),n("Start Event Controller"),m||isNaN(c)||(m=!0,u=setInterval(S,c))},setConfig:function(e){e&&(e.manifestModel&&(f=e.manifestModel),e.manifestUpdater&&(h=e.manifestUpdater),e.playbackController&&(y=e.playbackController))},reset:function(){E(),v()}},v(),e}Kt.__dashjs_factory_name="EventController";var Qt=s.a.getClassFactory(Kt),zt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null},Zt=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this));return n.url=r||null,n.checkForExistenceOnly=!0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(y);function Jt(){return{verify:function(e){if(!e)return{verified:!1};var t=ve.a.parseBuffer(e),r=t.fetchAll("moof"),n=t.fetchAll("mdat"),i=t.fetchAll("trun"),o=e.byteLength,a="",s=r.length>0&&r.length===n.length&&i.length>=r.length,u=!0,c=0,l=!0;if(s){for(var d=0,f=r.length;d<f;d++){var p=r[d],h=n[d],y=p._parent,m=y&&y.boxes||null;Array.isArray(m)?m.forEach((function(e){c+=e.size})):c+=p.size+h.size,h.size!==h._raw.byteLength&&(l=!1,a+="The index "+d+" mdat box size error, decoded: "+h.size+", actually: "+h._raw.byteLength+". ")}o!==c&&(u=!1,l&&(a="Size error, decoded: "+c+", actually: "+o))}else a="Missing moof box and mdat box.";return{size:o,moofBoxesCount:r.length,isSizeCorrect:u,areAllBoxesInPairs:s,areAllMdatBoxesSizeCorrect:l,verified:u&&s&&l,msg:a}}}}Jt.__dashjs_factory_name="VerifySegment";var Xt=s.a.getSingletonFactory(Jt),$t="request timeout";function er(e){e=e||{};var t=this.context,r=d(t).getInstance(),n=Xt(t).getInstance(),i=g(t).getInstance().log,a=void 0,s=void 0,u=void 0;function c(e){s.setSegmentsInfo(e)}return a={checkForExistence:function(e){var t=function(t){r.trigger(p.CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:t})};if(e){var n=new Zt(e.url);s.load({request:n,success:function(){t(!0)},error:function(){t(!1)}})}else t(!1)},load:function t(u,c){c?c.hasOwnProperty("canUseNC")||(c.canUseNC=!0):c={canUseNC:!0};var l=function(t,n){if(!n&&(r.trigger(p.LOADING_COMPLETED,{request:u,response:t||null,error:n||null,sender:a}),u.preloadEnd)){e.mediaPlayerModel.setPreloadData(null);var i=e.abrController.getDefaultQualityFor(u.mediaType,!1);e.abrController.setPlaybackQuality(u.mediaType,e.streamController.getActiveStreamInfo(),i)}};u?(void 0===u.retry&&(u.retry=1),s.load({request:u,progress:function(e){r.trigger(p.LOADING_PROGRESS,{request:u}),e&&r.trigger(p.LOADING_DATA_PROGRESS,{request:u,response:e||null,error:null,sender:a})},success:function(e){try{if(u.completeNCMissingRange){i("CompleteNCMissingRange, "+u.range+" -> "+u.originRange),u.completeNCMissingRange=!1,u.NCInfo.responseData.missingData=[];var a=u.range.split("-"),s=u.originRange.split("-"),d=parseInt(a[0]),f=parseInt(a[1]),h=parseInt(s[0]),y=parseInt(s[1]),m=u.NCInfo.responseData.availableData;m.push({start:d,end:f,data:e}),m.sort((function(e,t){return e.start-t.start}));try{for(var g=new Uint8Array(y-h+1),v=0;v<m.length;v++)g.set(new Uint8Array(m[v].data),m[v].start-m[0].start);e=g.buffer,i("CompleteNCMissingRange, success")}catch(t){e=new Uint8Array(0).buffer,i("CompleteNCMissingRange, 0000"+JSON.stringify(t))}u.range=u.originRange}var _=void 0;if(u.range){var E=u.range&&u.range.split("-");_=E[1]-E[0]+1}var b={mediaType:u.mediaType,id:u.representationId,index:u.index,range:u.range,received:e&&e.byteLength||0,url:u.url,startTime:u.startTime,duration:u.duration,p2pLoadInfo:u.p2pLoadInfo,rType:c&&c.canUseNC?"NC":"XHR",retryTimes:u.retryTimes,timeout:u.timeout};e&&e.byteLength>3e7&&(b.code=o.DOWNLOAD_FRAGMENT_ERROR_RANGE,r.trigger(p.FRAGMENT_LOADED_ERROR,b));var S=function(e,t){try{if(e&&t){if(isNaN(e.index)||"MediaSegment"!==e.type)return{verified:!0};var o=n.verify(t);return o.mediaType=e.mediaType,o.quality=e.quality,o.index=e.index,o.id=e.representationId,o&&!o.verified&&(i("VERIFY_SEGMENT_WARNING: "+JSON.stringify(o)),r.trigger(p.VERIFY_SEGMENT_WARNING,o)),o}}catch(e){}return{verified:!1}}(u,e);e&&(e.byteLength===_||!_)&&S&&S.verified?(1===u.retry||(b.code=o.DOWNLOAD_FRAGMENT_ERROR_RETRY_SUCCESS,r.trigger(p.FRAGMENT_LOADED_ERROR,b)),l(e)):(b&&b.hasOwnProperty("type")&&delete b.type,S.verified||(e.byteLength===_?b.verifiedType=1:b.verifiedType=2),u.retry&&u.retry>0?(b.code=o.DOWNLOAD_FRAGMENT_ERROR,r.trigger(p.FRAGMENT_LOADED_ERROR,b),u.retry--,t(u,{canUseNC:!1,disableSeekDownloadMore:!0})):(b.code=o.DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE,r.trigger(p.FRAGMENT_LOADED_ERROR,b)))}catch(e){console.error("FragmentLoader Load Error: ",e)}},timeout:function(e,t,n){var i={mediaType:e.mediaType,id:e.representationId,index:e.index,range:e.range,received:e.bytesLoaded,url:e.url,startTime:e.startTime,duration:e.duration,total:e.bytesTotal,latency:t,timeout:n,p2pLoadInfo:e.p2pLoadInfo,rType:c&&c.canUseNC?"NC":"XHR",retryTimes:e.retryTimes};i.code=o.DOWNLOAD_FRAGMENT_ERROR_TIMEOUT,r.trigger(p.FRAGMENT_LOADED_ERROR,i),l(void 0,new w(1,$t))},error:function(e,t,r){l(void 0,new w(1,r,t))},abort:function(e){e&&r.trigger(p.LOADING_ABANDONED,{request:e,mediaType:e.mediaType,sender:a})},connectTimeout:function(e,t,n){if(e){var i={mediaType:e.mediaType,id:e.representationId,index:e.index,range:e.range,received:e.bytesLoaded||0,url:e.url,startTime:e.startTime,duration:e.duration,total:e.bytesTotal,timeout:t,p2pLoadInfo:e.p2pLoadInfo,rType:n?"NC":"XHR",retryTimes:e.retryTimes}
;i.code=o.CONNECT_FRAGMENT_ERROR_TIMEOUT,n&&(i.code=o.CONNECT_NC_FRAGMENT_ERROR_TIMEOUT),r.trigger(p.FRAGMENT_LOADED_ERROR,i),l(void 0,new w(1,$t))}},headersReceived:function(e){r.trigger(p.FRAGMENT_LOADING_HEADER_RECEIVED,{request:u,headers:e})},failedQuicklyReport:function(e,t){if(e){var n={mediaType:e.mediaType,id:e.representationId,index:e.index,range:e.range,received:e.bytesLoaded||0,url:e.url,startTime:e.startTime,duration:e.duration,total:e.bytesTotal,rType:t?"NC":"XHR",retryTimes:e.retryTimes};n.code=o.CONNECT_FRAGMENT_ERROR_OFFLINE,r.trigger(p.FRAGMENT_LOADED_ERROR,n)}},params:c})):l(void 0,new w(2,"request is null"))},abort:function(){s&&s.abort()},reset:function(){s&&(s.abort(),s=null),r.off(p.SEGMENTS_LOADED,c,a)},resetPreloadData:function(){u=e.mediaPlayerModel.getPreloadData(),s.setPreloadData(u)}},u=e.mediaPlayerModel.getPreloadData(),s=Bt(t).create({errHandler:e.errHandler,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,useFetch:e.mediaPlayerModel.getLowLatencyEnabled(),dashMetrics:e.dashMetrics,preloadData:u}),r.on(p.SEGMENTS_LOADED,c,a),a}er.__dashjs_factory_name="FragmentLoader";var tr=s.a.getClassFactory(er);tr.FRAGMENT_LOADER_ERROR_LOADING_FAILURE=1,tr.FRAGMENT_LOADER_ERROR_NULL_REQUEST=2,s.a.updateClassFactory(er.__dashjs_factory_name,tr);var rr=tr;function nr(e){e=e||{};var t,r=this.context,i=g(r).getInstance().log,o=d(r).getInstance(),a=e.errHandler,s=e.mediaPlayerModel,u=e.metricsModel,c=e.abrController,l=e.streamController,f=e.videoModel,h=void 0;function y(e){return e&&e.type&&e.type===F.INIT_SEGMENT_TYPE}function m(){for(var e in h)h[e].reset();h={}}function v(e){if(h[e.request.mediaType]===e.sender){var t=e.request,r=e.response,a=y(t),s=t.mediaInfo.streamInfo;if(e.error&&(e.request.mediaType!==n.AUDIO&&e.request.mediaType!==n.VIDEO&&e.request.mediaType!==n.FRAGMENTED_TEXT||o.trigger(p.SERVICE_LOCATION_BLACKLIST_ADD,{entry:e.request.serviceLocation})),r&&s){var u=function(e,t,r,n){var i=new zt;return i.streamId=r,i.mediaInfo=t.mediaInfo,i.segmentType=t.type,i.start=t.startTime,i.duration=t.duration,i.end=i.start+i.duration,i.bytes=e,i.index=t.index,i.quality=t.quality,i.representationId=t.representationId,i.endFragment=n,i}(r,t,s.id,e.type!==p.FRAGMENT_LOADING_PROGRESS);o.trigger(a?p.INIT_FRAGMENT_LOADED:p.MEDIA_FRAGMENT_LOADED,{chunk:u,fragmentModel:e.sender})}else i("No "+t.mediaType+" bytes to push or stream is inactive.")}}return t={getModel:function(t){var n=h[t];return n||(n=T(r).create({metricsModel:u,fragmentLoader:rr(r).create({metricsModel:u,videoModel:f,mediaPlayerModel:s,errHandler:a,requestModifier:Et(r).getInstance(),dashMetrics:e.dashMetrics,abrController:c,streamController:l})}),h[t]=n),n},isInitializationRequest:y,reset:function(){o.off(p.FRAGMENT_LOADING_COMPLETED,v,this),m()}},m(),o.on(p.FRAGMENT_LOADING_COMPLETED,v,t),t}nr.__dashjs_factory_name="FragmentController";var ir=s.a.getClassFactory(nr);function or(e){e=e||{};var t=this.context,r=g(t).getInstance().log,i=d(t).getInstance(),o=e.manifestModel,a=e.dashManifestModel,s=e.mediaPlayerModel,u=e.manifestUpdater,c=e.adapter,l=e.capabilities,f=e.errHandler,h=e.timelineConverter,y=e.metricsModel,m=e.abrController,v=e.playbackController,_=e.mediaController,E=e.videoModel,b=e.streamController,S=void 0,T=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,I=void 0,O=void 0,C=void 0,N=void 0;function k(){for(var e=T?T.length:0,t=0;t<e;t++)T[t].getFragmentModel().removeExecutedRequestsBeforeTime(F()+M()),T[t].reset();T=[],w=!1,A=!1,i.off(p.CURRENT_TRACK_CHANGED,G,S)}function L(){k(),R=null,P={},D=!1}function x(){v&&v.pause(),O&&(O.reset(),O=null),C&&(C.reset(),C=null),L(),r=null,i.off(p.DATA_UPDATE_COMPLETED,Q,S),i.off(p.BUFFERING_COMPLETED,K,S),i.off(p.KEY_ERROR,B,S),i.off(p.SERVER_CERTIFICATE_UPDATED,B,S),i.off(p.LICENSE_REQUEST_COMPLETE,B,S),i.off(p.KEY_SYSTEM_SELECTED,B,S),i.off(p.KEY_SESSION_CREATED,B,S),i.off(p.KEY_STATUSES_CHANGED,B,S)}function M(){return R?R.duration:NaN}function F(){return R?R.start:NaN}function U(){if(!(m&&m.hasOwnProperty("getBitrateList")&&c&&c.hasOwnProperty("getAllMediaInfoForType")&&c.hasOwnProperty("getEventsFor")))throw new Error("Missing config parameter(s)")}function B(e){e.error&&(f.mediaKeySessionError(e.error),r(e.error),x())}function j(e){return e.type===n.TEXT?e.mimeType:e.type}function V(e){var t,i=e.type,a=void 0;if(i===n.MUXED&&e)return r(a="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines"),f.manifestError(a,"multiplexedrep",o.getValue()),!1;if(i===n.TEXT||i===n.FRAGMENTED_TEXT||i===n.EMBEDDED_TEXT||i===n.IMAGE)return!0;if(t=e.codec,r(i+" codec: "+t),e.contentProtection&&!l.supportsEncryptedMedia())f.capabilityError("encryptedmedia");else if(!l.supportsCodec(t))return r(a=i+"Codec ("+t+") is not supported."),!1;return!0}function G(e){if(e.newMediaInfo.streamInfo.id===R.id){var t=z(e.oldMediaInfo);if(t){var i=v.getTime();r("Stream -  Process track changed at current time "+i);var a=e.newMediaInfo,s=o.getValue();r("Stream -  Update stream controller"),s.refreshManifestOnSwitchTrack?(r("Stream -  Refreshing manifest for switch track"),N=e,u.refreshManifest()):(t.updateMediaInfo(a),a.type!==n.FRAGMENTED_TEXT&&(m.updateTopQualityIndex(a),t.switchTrackAsked(),t.getFragmentModel().abortRequests()))}}}function H(i,u){var l=c.getAllMediaInfoForType(R,i),d=null;if(l&&0!==l.length){for(var p=0,g=l.length;p<g;p++)if(d=l[p],i===n.EMBEDDED_TEXT);else{if(!V(d))continue;_.addTrack(d)}i!==n.EMBEDDED_TEXT&&0!==_.getTracksFor(i,R).length&&(_.checkInitialMediaSettingsForType(i,R),function(r,i,u,l){var d=Yt(t).create({type:j(r),mimeType:r.mimeType,timelineConverter:h,adapter:c,manifestModel:o,dashManifestModel:a,mediaPlayerModel:s,metricsModel:y,dashMetrics:e.dashMetrics,baseURLController:e.baseURLController,stream:S,abrController:m,domStorage:e.domStorage,playbackController:v,mediaController:_,streamController:b,videoModel:E,errHandler:f});if(d.initialize(u),m.updateTopQualityIndex(r),T.push(d),r.type===n.TEXT||r.type===n.FRAGMENTED_TEXT){for(var p=void 0,g=0;g<i.length;g++)i[g].index===r.index&&(p=g),d.updateMediaInfo(i[g]);r.type===n.FRAGMENTED_TEXT&&d.updateMediaInfo(i[p])}else d.updateMediaInfo(r)}(_.getCurrentTrackFor(i,R),l,u))}else r("No "+i+" data.")}function q(e){var t=a.getAdaptationForType(o.getValue(),R.index,e,R);if(!t||!Array.isArray(t.Representation_asArray))return null;t.Representation_asArray=t.Representation_asArray.filter((function(e,n){if(0===n)return!0;var i=a.getCodec(t,n,!0);return!!l.supportsCodec(i)||(r("[Stream] codec not supported: "+i),!1)}))}function W(){for(var e=T.length,t=P.audio||P.video?new Error(1,"Data update failed",null):null,r=0;r<e;r++)if(T[r].isUpdating()||D)return;if(A){if(I)for(var o=0;o<e&&T[o];o++)T[o].getType()!==n.AUDIO&&T[o].getType()!==n.VIDEO&&T[o].getType()!==n.FRAGMENTED_TEXT||I.initializeForMedia(T[o].getMediaInfo());i.trigger(p.STREAM_INITIALIZED,{streamInfo:R,error:t})}}function Y(){for(var e=0,t=T.length;e<t;e++)T[e].createBuffer()}function K(e){if(e.streamInfo===R){var t=Z(),o=t.length;if(0!==o){for(var a=0;a<o;a++)if(!t[a].isBufferingCompleted()&&(t[a].getType()===n.AUDIO||t[a].getType()===n.VIDEO))return void r("[Stream] onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because streamProcessor "+t[a].getType()+" is not buffering completed");r("[Stream] onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),i.trigger(p.STREAM_BUFFERING_COMPLETED,{streamInfo:R})}else r("[Stream] onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}}function Q(e){var t=e.sender.getStreamProcessor();t.getStreamInfo()===R&&(P[t.getType()]=e.error,W())}function z(e){return!!e&&Z().filter((function(t){return t.getType()===e.type}))[0]}function Z(){for(var e=T.length,t=[],r=void 0,i=void 0,o=0;o<e;o++)(r=(i=T[o]).getType())!==n.AUDIO&&r!==n.VIDEO&&r!==n.FRAGMENTED_TEXT||t.push(i);return t}return S={initialize:function(e,t){R=e,(I=t)&&(i.on(p.KEY_ERROR,B,S),i.on(p.SERVER_CERTIFICATE_UPDATED,B,S),i.on(p.LICENSE_REQUEST_COMPLETE,B,S),i.on(p.KEY_SYSTEM_SELECTED,B,S),
i.on(p.KEY_SESSION_CREATED,B,S),i.on(p.KEY_STATUSES_CHANGED,B,S))},activate:function(e){w||(i.on(p.CURRENT_TRACK_CHANGED,G,S),function(e){U();var i=void 0,a=E.getElement();if(C||((C=Qt(t).create()).setConfig({manifestModel:o,manifestUpdater:u,playbackController:v}),i=c.getEventsFor(R),C.addInlineEvents(i)),D=!0,q(n.VIDEO),q(n.AUDIO),(null===a||a&&("VIDEO"===a.nodeName||"BWP-VIDEO"===a.nodeName))&&H(n.VIDEO,e),H(n.AUDIO,e),"open"!==e.readyState?(e.addEventListener("sourceopen",Y,!1),e.addEventListener("webkitsourceopen",Y,!1)):Y(),A=!0,D=!1,0===T.length){var s="No streams to play.";f.manifestError(s,"nostreams",o.getValue()),r(s)}else W()}(e),w=!0)},deactivate:k,getDuration:M,getStartTime:F,getId:function(){return R?R.id:NaN},getStreamInfo:function(){return R},getFragmentController:function(){return O},getEventController:function(){return C},getBitrateListFor:function(e){U();var t=function(e){for(var t=T.length,r=null,n=0;n<t;n++)if((r=T[n]).getType()===e)return r.getMediaInfo();return null}(e);return m.getBitrateList(t)},startEventController:function(){C&&C.start()},stopEventController:function(){C&&C.stop()},updateData:function(e){if(r("Manifest updated... updating data system wide."),w=!1,D=!0,R=e,C){var t=c.getEventsFor(R);C.addInlineEvents(t)}q(n.VIDEO),q(n.AUDIO);for(var i=0,o=T.length;i<o;i++){var a=T[i],s=c.getMediaInfoForType(R,a.getType());m.updateTopQualityIndex(s),a.updateMediaInfo(s)}if(N&&"fragmentedText"!==N.newMediaInfo.type){var u=z(N.oldMediaInfo);if(!u)return;u.switchTrackAsked(),N=void 0}D=!1,W()},reset:x,getProcessors:Z,setMediaSource:function(e){for(var t=0;t<T.length;)V(T[t].getMediaInfo())?(T[t].setMediaSource(e),t++):(T[t].reset(),T.splice(t,1));for(var n=0;n<T.length;n++)T[n].dischargePreBuffer();if(0===T.length){var i="No streams to play.";f.manifestError(i,"nostreams",o.getValue()),r(i)}}},L(),O=ir(t).create({mediaPlayerModel:s,videoModel:E,metricsModel:y,errHandler:f,dashMetrics:e.dashMetrics,abrController:m,streamController:b}),i.on(p.BUFFERING_COMPLETED,K,S),i.on(p.DATA_UPDATE_COMPLETED,Q,S),S}or.__dashjs_factory_name="Stream";var ar=s.a.getClassFactory(or);function sr(){var e=this.context,t=g(e).getInstance().log,r=d(e).getInstance(),n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0;function h(){n=NaN,a=!1,o=!0,y()}function y(){null!==i&&(clearInterval(i),i=null)}function m(e){y(),isNaN(e)&&!isNaN(n)&&(e=1e3*n),isNaN(e)||(t("Refresh manifest in "+e+" milliseconds."),i=setTimeout(E,e))}function v(){a=!0;var e=u.getValue(),t=e.url,r=c.getLocation(e);r&&(t=r),s.load(t)}function _(e){if(l.getAppendingSourceState()){var i=l.getCachedDurationOffset("offset");e.mediaPresentationDuration+=i,e.Period.duration+=i,e.Period_asArray.duration+=i}u.setValue(e);var a=new Date,s=(a.getTime()-e.loadedTime.getTime())/1e3;1e3*(n=c.getManifestUpdatePeriod(e,s))>2147483647&&(n=2147483.647),r.trigger(p.MANIFEST_UPDATED,{manifest:e}),t("Manifest has been refreshed at "+a+"["+a.getTime()/1e3+"] "),o||m()}function E(){o&&!l.getScheduleWhilePaused()||(a?m(l.getManifestUpdateRetryInterval()):v())}function b(e){e.error?f.manifestError(e.error.message,e.error.code,"","",e.error.errorCode,e.error.httpCode):_(e.manifest)}function S(){o=!1,m()}function T(){o=!0,y()}function w(){a=!1}return{initialize:function(){h(),r.on(p.STREAMS_COMPOSED,w,this),r.on(p.PLAYBACK_STARTED,S,this),r.on(p.PLAYBACK_PAUSED,T,this),r.on(p.INTERNAL_MANIFEST_LOADED,b,this)},setManifest:function(e){_(e)},refreshManifest:v,setConfig:function(e){e&&(e.manifestModel&&(u=e.manifestModel),e.dashManifestModel&&(c=e.dashManifestModel),e.mediaPlayerModel&&(l=e.mediaPlayerModel),e.manifestLoader&&(s=e.manifestLoader),e.errHandler&&(f=e.errHandler))},reset:function(){r.off(p.PLAYBACK_STARTED,S,this),r.off(p.PLAYBACK_PAUSED,T,this),r.off(p.STREAMS_COMPOSED,w,this),r.off(p.INTERNAL_MANIFEST_LOADED,b,this),h()}}}sr.__dashjs_factory_name="ManifestUpdater";var ur=s.a.getClassFactory(sr);function cr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var lr=1e3;function dr(){var e,t,r,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,d=void 0,f=void 0,p=void 0,h=void 0,y=void 0,m=void 0,g=void 0,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,T=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,I=void 0,O=void 0,C=void 0,N=void 0,k=void 0,L=void 0,x=void 0,M=void 0,U=void 0,B=void 0,j=void 0,V=void 0,G=void 0,H=void 0,q=void 0,W=void 0,Y=void 0,K=void 0,Q=void 0,z=void 0,Z=void 0,J=void 0,X=void 0,$=void 0,ee=void 0,te=void 0;function re(e){var t=void 0;for(t=0;t<I.length;t++)if(I[t].rulename===e)return t;return-1}function ne(e){V=e}return e={setPlayerId:function(e){ee=e},getPlayerId:function(){return ee},setABRStrategy:function(e){A=e},getABRStrategy:function(){return A},setUseDefaultABRRules:function(e){R=e},getUseDefaultABRRules:function(){return R},getABRCustomRules:function(){return I},addABRCustomRule:function(e,t,r){var n=re(t);-1===n?I.push({type:e,rulename:t,rule:r}):(I[n].type=e,I[n].rule=r)},removeABRCustomRule:function(e){var t=re(e);-1!==t&&I.splice(t,1)},removeAllABRCustomRule:function(){I=[]},setBandwidthSafetyFactor:function(e){E=e},getBandwidthSafetyFactor:function(){return E},setAbandonLoadTimeout:function(e){b=e},getAbandonLoadTimeout:function(){return b},setLastBitrateCachingInfo:function(e,t){p.enabled=e,void 0===t||isNaN(t)||"number"!=typeof t||(p.ttl=t)},getLastBitrateCachingInfo:function(){return p},setLastMediaSettingsCachingInfo:function(e,t){h.enabled=e,void 0===t||isNaN(t)||"number"!=typeof t||(h.ttl=t)},getLastMediaSettingsCachingInfo:function(){return h},setStableBufferTime:function(e){y=e},getStableBufferTime:function(){return isNaN(y)?D?20:12:y},setBufferTimeAtTopQuality:function(e){m=e},getBufferTimeAtTopQuality:function(){return m},setBufferTimeAtTopQualityLongForm:function(e){g=e},getBufferTimeAtTopQualityLongForm:function(){return g},setLongFormContentDurationThreshold:function(e){v=e},getLongFormContentDurationThreshold:function(){return v},setSegmentOverlapToleranceTime:function(e){_=e},getSegmentOverlapToleranceTime:function(){return _},getCacheLoadThresholdForType:function(e){return C[e]},setCacheLoadThresholdForType:function(e,t){C[e]=t},setBufferToKeep:function(e){l=e},getBufferToKeep:function(){return l},setBufferAheadToKeep:function(e){d=e},getBufferAheadToKeep:function(){return d},setBufferPruningInterval:function(e){f=e},getBufferPruningInterval:function(){return f},setFragmentRetryAttempts:function(e){S[F.MEDIA_SEGMENT_TYPE]=e},getFragmentRetryAttempts:function(){return S[F.MEDIA_SEGMENT_TYPE]},setManifestRetryAttempts:function(e){S[F.MPD_TYPE]=e},getManifestRetryAttempts:function(){return S[F.MPD_TYPE]},setRetryAttemptsForType:function(e,t){S[e]=t},getRetryAttemptsForType:function(e){return S[e]},setFragmentRetryInterval:function(e){T[F.MEDIA_SEGMENT_TYPE]=e},getFragmentRetryInterval:function(){return T[F.MEDIA_SEGMENT_TYPE]},setManifestRetryInterval:function(e){T[F.MPD_TYPE]=e},getManifestRetryInterval:function(){return T[F.MPD_TYPE]},setRetryIntervalForType:function(e,t){T[e]=t},getRetryIntervalForType:function(e){return T[e]},setWallclockTimeUpdateInterval:function(e){w=e},getWallclockTimeUpdateInterval:function(){return w},setScheduleWhilePaused:function(e){c=e},getScheduleWhilePaused:function(){return c},getUseSuggestedPresentationDelay:function(){return o},setUseSuggestedPresentationDelay:function(e){o=e},setLiveDelayFragmentCount:function(e){s=e},getLiveDelayFragmentCount:function(){return s},getLiveDelay:function(){return L?u||3:u},setLiveDelay:function(e){u=e},setUseManifestDateHeaderTimeSource:function(e){i=e},getUseManifestDateHeaderTimeSource:function(){return i},setUTCTimingSources:function(e){a=e},getUTCTimingSources:function(){return a},setXHRWithCredentialsForType:function e(t,r){t?P[t]=!!r:Object.keys(P).forEach((function(t){e(t,r)}))},getXHRWithCredentialsForType:function(e){var t=P[e];return void 0===t?P.default:t},setFastSwitchEnabled:function(e){D=e},getFastSwitchEnabled:function(){return D},setMovingAverageMethod:function(e){O=e},getMovingAverageMethod:function(){return O},setJumpGaps:function(e){N=e},
getJumpGaps:function(){return N},setSmallGapLimit:function(e){k=e},getSmallGapLimit:function(){return k},getLowLatencyEnabled:function(){return L},setLowLatencyEnabled:function(e){L=e},getPreloadData:function(){return x},setPreloadData:function(e){x=e},setManifestUpdateRetryInterval:function(e){M=e},getManifestUpdateRetryInterval:function(){return M},setAppendingSourceState:function(e){e!==U&&(U=e)},getAppendingSourceState:function(){return U},setCachedDurationOffset:function(e,t){t=parseFloat(t.toFixed(5)),B[e]=t},getCachedDurationOffset:function(e){return e?B[e]:B},clearCachedDruationOffset:function(){B={offset:0,duration:0}},setEndOfStreamState:function(e){j=e},getEndOfStreamState:function(){return j},setP2pPermission:ne,getP2pPermission:function(){return V},addP2pSDKErrorCount:function(){(G+=1)>12&&ne(!1)},getP2pSDKErrorCount:function(){return G},addBufferingCount:function(){H+=1},getBufferingCount:function(){return H},setExternalMediaLoader:function(e){X=e},getExternalMediaLoader:function(){return X},getFactorByBufferLevel:function(e){return.7},setLastStartSeekTime:function(e){q=e},getLastStartSeekTime:function(){return q},getStartPlaybackTime:function(){return W},setStartPlaybackTime:function(e){W=e},resetStartAndSeekTime:function(){q=0,W=0},reset:function(){},getAudioTrackId:function(){return Y},setAudioTrackId:function(e){Y=e},getEnableMultipleAudioTracks:function(){return K},setEnableMultipleAudioTracks:function(e){K=e},getAudioTrackIds:function(){return Q},setAudioTrackIds:function(e){e&&Array.isArray(e)&&(Q=e)},setDeviationReset:function(e){z=e},getDeviationReset:function(e){return z},setRetryTimes:function(e){Z=e},getRetryTimes:function(){return Z},setPlayAt:function(e){J=e},getPlayAt:function(){return J},getUseNC:function(){return $},setUseNC:function(e){$=e},getUseP2P:function(){return te},setUseP2P:function(e){te=e}},a=[],o=!1,i=!0,c=!0,A=n.ABR_STRATEGY_DYNAMIC,R=!0,D=!1,p={enabled:!0,ttl:36e4},h={enabled:!0,ttl:36e4},s=4,u=void 0,l=20,d=80,f=10,y=NaN,m=30,g=60,v=600,_=.2,E=.6,b=1e4,w=50,N=!1,k=1.8,M=100,P={default:!1},I=[],O=n.MOVING_AVERAGE_SLIDING_WINDOW,L=!1,U=!1,z=!1,B={time:0,duration:0,offset:0},cr(t={},F.MPD_TYPE,3),cr(t,F.XLINK_EXPANSION_TYPE,1),cr(t,F.MEDIA_SEGMENT_TYPE,3),cr(t,F.INIT_SEGMENT_TYPE,3),cr(t,F.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),cr(t,F.INDEX_SEGMENT_TYPE,3),cr(t,F.OTHER_TYPE,3),S=t,cr(r={},F.MPD_TYPE,500),cr(r,F.XLINK_EXPANSION_TYPE,500),cr(r,F.MEDIA_SEGMENT_TYPE,lr),cr(r,F.INIT_SEGMENT_TYPE,lr),cr(r,F.BITSTREAM_SWITCHING_SEGMENT_TYPE,lr),cr(r,F.INDEX_SEGMENT_TYPE,lr),cr(r,F.OTHER_TYPE,lr),T=r,(C={})[n.VIDEO]=25,C[n.AUDIO]=5,j=!0,V=!0,G=0,H=0,q=0,W=0,X=null,Y=1,K=!1,Q=[],Z=0,J=0,$=!0,te=!0,e}dr.__dashjs_factory_name="MediaPlayerModel";var fr=s.a.getSingletonFactory(dr);fr.DEFAULT_UTC_TIMING_SOURCE={scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"http://time.akamai.com/?iso"},s.a.updateSingletonFactory(dr.__dashjs_factory_name,fr);var pr=fr,hr=new(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this));return r.AST_IN_FUTURE="astInFuture",r.BUFFER_EMPTY="bufferStalled",r.BUFFER_LOADED="bufferLoaded",r.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",r.ERROR="error",r.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",r.FRAGMENT_LOADING_HEADER_RECEIVED="fragmentLoadingHeaderReceived",r.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",r.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",r.FRAGMENT_P2P_LOAD_INFO="fragmentP2pLoadInfo",r.CDN_LOAD_INFO="cdnLoadInfo",r.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",r.FRAGMENT_LOADED_ERROR="fragmentLoadedError",r.PCDN_LOADED_ERROR="pcdnLoadedError",r.LOG="log",r.MANIFEST_LOADED="manifestLoaded",r.METRICS_CHANGED="metricsChanged",r.METRIC_CHANGED="metricChanged",r.METRIC_ADDED="metricAdded",r.METRIC_UPDATED="metricUpdated",r.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",r.PERIOD_SWITCH_STARTED="periodSwitchStarted",r.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",r.QUALITY_CHANGE_DOWNLOADED="qualityChangeDownloaded",r.QUALITY_CHANGE_RENDERED="qualityChangeRendered",r.TRACK_CHANGE_RENDERED="trackChangeRendered",r.SOURCE_INITIALIZED="sourceInitialized",r.STREAM_INITIALIZED="streamInitialized",r.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",r.TEXT_TRACKS_ADDED="allTextTracksAdded",r.TEXT_TRACK_ADDED="textTrackAdded",r.TTML_PARSED="ttmlParsed",r.TTML_TO_PARSE="ttmlToParse",r.CAN_PLAY="canPlay",r.PLAYBACK_ENDED="playbackEnded",r.PLAYBACK_ERROR="playbackError",r.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",r.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",r.PLAYBACK_PAUSED="playbackPaused",r.PLAYBACK_PLAYING="playbackPlaying",r.PLAYBACK_PROGRESS="playbackProgress",r.PLAYBACK_RATE_CHANGED="playbackRateChanged",r.PLAYBACK_SEEKED="playbackSeeked",r.PLAYBACK_SEEKING="playbackSeeking",r.PLAYBACK_SEEK_ASKED="playbackSeekAsked",r.PLAYBACK_STALLED="playbackStalled",r.PLAYBACK_STARTED="playbackStarted",r.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",r.PLAYBACK_WAITING="playbackWaiting",r.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",r.DELAY_TO_APPEND_TO_BUFFER="delayToAppendBuffer",r.GET_NEXT_FRAGMENT="getNextFragment",r.APPENDING_NEXT_SOURCE="appendingNextSource",r.APPENDED_NEXT_SOURCE="appendedNextSource",r.APPENDED_NEXT_SOURCE_DURATION_CHANGED="appendedNextSourceDurationChanged",r.START_OFFSET_TIME_WARNING="startOffsetTimeWarning",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(f.a));function yr(){var e=this.context,t=g(e).getInstance().log,r=d(e).getInstance(),i=rt(e).getInstance(),o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0;function h(e){a=e}function y(e){o=e}function m(e){var t=Date.parse(e);return isNaN(t)&&(t=function(e){var t=void 0,r=void 0,n=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e);return t=Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[4],10),parseInt(n[5],10),n[6]&&(parseInt(n[6],10)||0),n[7]&&1e3*parseFloat(n[7])||0),n[9]&&n[10]&&(r=60*parseInt(n[9],10)+parseInt(n[10],10),t+=("+"===n[8]?-1:1)*r*60*1e3),new Date(t).getTime()}(e)),t}function v(e){return Date.parse(e)}function _(e){return Date.parse(e)}function E(e,t,r){r()}function b(e,t,r){var n=m(e);isNaN(n)?r():t(n)}function S(e,t,r,n,o){var a,s,u=!1,c=new XMLHttpRequest,l=o?F.HEAD:F.GET,d=t.match(/\S+/g);if(t=d.shift(),a=function(){u||(u=!0,d.length?S(e,d.join(" "),r,n,o):n())},s=function(){var t=void 0,n=void 0;200===c.status&&(t=o?c.getResponseHeader("Date"):c.response,n=e(t),isNaN(n)||(r(n),u=!0))},i.isRelative(t)){var p=f.resolve();p&&(t=i.resolve(t,p.url))}c.open(l,t),c.timeout=5e3,c.onload=s,c.onloadend=a,c.send()}function T(e,t,r){S(_,e,t,r,!0)}function A(e,t,n){h(!1),r.trigger(p.TIME_SYNCHRONIZATION_COMPLETED,{time:t,offset:n,error:e?new w(1):null})}function R(e,r){var i=r||0,a=e[i],d=function(e,t){var r,i,a,u=!e||!t;u&&s?(r=c.getReadOnlyMetricsFor(n.STREAM),a=null!==(i=l.getLatestMPDRequestHeaderValueByID(r,"Date"))?new Date(i).getTime():Number.NaN,isNaN(a)?A(!0):(y(a-(new Date).getTime()),A(!1,a/1e3,o))):A(u,e,t)};h(!0),a?u.hasOwnProperty(a.schemeIdUri)?u[a.schemeIdUri](a.value,(function(e){var r=(new Date).getTime(),n=e-r;y(n),t("Local time:      "+new Date(r)),t("Server time:     "+new Date(e)),t("Difference (ms): "+n),d(e,n)}),(function(){R(e,i+1)})):R(e,i+1):(y(0),d())}return{initialize:function(e,t){s=t,o=0,a=!1,u={"urn:mpeg:dash:utc:http-head:2014":T,"urn:mpeg:dash:utc:http-xsdate:2014":S.bind(null,m),"urn:mpeg:dash:utc:http-iso:2014":S.bind(null,v),"urn:mpeg:dash:utc:direct:2014":b,"urn:mpeg:dash:utc:http-head:2012":T,"urn:mpeg:dash:utc:http-xsdate:2012":S.bind(null,m),
"urn:mpeg:dash:utc:http-iso:2012":S.bind(null,v),"urn:mpeg:dash:utc:direct:2012":b,"urn:mpeg:dash:utc:http-ntp:2014":E,"urn:mpeg:dash:utc:ntp:2014":E,"urn:mpeg:dash:utc:sntp:2014":E},a||R(e)},getOffsetToDeviceTimeMs:function(){return o},setConfig:function(e){e&&(e.metricsModel&&(c=e.metricsModel),e.dashMetrics&&(l=e.dashMetrics),e.baseURLController&&(f=e.baseURLController))},reset:function(){h(!1)}}}yr.__dashjs_factory_name="TimeSyncController";var mr=s.a.getSingletonFactory(yr);mr.TIME_SYNC_FAILED_ERROR_CODE=1,mr.HTTP_TIMEOUT_MS=5e3,s.a.updateSingletonFactory(yr.__dashjs_factory_name,mr);var gr=mr,vr=r(14),_r=r.n(vr);function Er(){return{areEqual:function(e,t){return _r()(e,t)}}}Er.__dashjs_factory_name="ObjectUtils";var br=s.a.getSingletonFactory(Er),Sr=NaN,Tr=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data={baseUrls:t||null,selectedIdx:r||Sr},this.children=[]};function wr(){var e,t=void 0,r=void 0,n=this.context,i=br(n).getInstance();function o(e,t,n){var o=r.getBaseURLsFromElement(n);e[t]?i.areEqual(o,e[t].data.baseUrls)||(e[t].data.baseUrls=o,e[t].data.selectedIdx=Sr):e[t]=new Tr(o)}function a(e,r){var n=r||t;e(n.data),n.children&&n.children.forEach((function(t){return a(e,t)}))}function s(){t=new Tr}return e={reset:s,update:function(e){!function(e){var n=r.getBaseURLsFromElement(e);i.areEqual(n,t.data.baseUrls)||(t.data.baseUrls=n,t.data.selectedIdx=Sr),e.Period_asArray&&e.Period_asArray.forEach((function(e,n){o(t.children,n,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach((function(e,i){o(t.children[n].children,i,e),e.Representation_asArray&&e.Representation_asArray.sort(r.getRepresentationSortFunction()).forEach((function(e,r){o(t.children[n].children[i].children,r,e)}))}))}))}(e)},getForPath:function(e){var r=t,n=[r.data];return e&&e.forEach((function(e){(r=r.children[e])&&n.push(r.data)})),n.filter((function(e){return e.baseUrls.length}))},invalidateSelectedIndexes:function(e){a((function(t){isNaN(t.selectedIdx)||e===t.baseUrls[t.selectedIdx].serviceLocation&&(t.selectedIdx=Sr)}))},setConfig:function(e){e.dashManifestModel&&(r=e.dashManifestModel)}},s(),e}wr.__dashjs_factory_name="BaseURLTreeModel";var Ar=s.a.getClassFactory(wr);function Rr(e){return e=e||{},{select:function(e){return e&&function(e){var t=0,r=[],n=0,i=void 0,o=void 0;if((o=e.sort((function(e,t){var r=e.dvb_priority-t.dvb_priority;return isNaN(r)?0:r})).filter((function(e,t,r){return!t||r[0].dvb_priority&&e.dvb_priority&&r[0].dvb_priority===e.dvb_priority}))).length)return o.length>1&&(o.forEach((function(e){t+=e.dvb_weight,r.push(t)})),i=Math.floor(Math.random()*(t-1)),r.every((function(e,t){return n=t,!(i<e)}))),o[n]}((t=[],e.filter((function(){return!0})).filter((function(e){return!t.length||!e.dvb_priority||-1===t.indexOf(e.dvb_priority)}))));var t}}}Rr.__dashjs_factory_name="DVBSelector";var Pr=s.a.getClassFactory(Rr);function Dr(e){return e=e||{},{select:function(e){var t=0,r=void 0;return e&&e.some((function(e,r){return t=r,!0}))&&(r=e[t]),r}}}Dr.__dashjs_factory_name="BasicSelector";var Ir=s.a.getClassFactory(Dr),Or="Failed to resolve a valid URL";function Cr(){var e,t=this.context,r=d(t).getInstance(),n=void 0,i=void 0,o=void 0,a=void 0;return e={chooseSelectorFromManifest:function(e){!function(){if(!n||!n.hasOwnProperty("getIsDVB"))throw new Error("Missing config parameter(s)")}(),a=n.getIsDVB(e)?o:i},select:function(e){var t=e.baseUrls,n=e.selectedIdx;if(!isNaN(n))return t[n];var i=a.select(t);if(i)return e.selectedIdx=t.indexOf(i),i;r.trigger(p.URL_RESOLUTION_FAILED,{error:new Error(1,Or)})},reset:function(){},setConfig:function(e){e.selector&&(a=e.selector),e.dashManifestModel&&(n=e.dashManifestModel)}},i=Ir(t).create({}),o=Pr(t).create({}),a=i,e}Cr.__dashjs_factory_name="BaseURLSelector";var Nr=s.a.getClassFactory(Cr);Nr.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=1,Nr.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE=Or,s.a.updateClassFactory(Cr.__dashjs_factory_name,Nr);var kr=Nr,Lr=function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=r||t||"",this.dvb_priority=n||1,this.dvb_weight=i||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0};Lr.DEFAULT_DVB_PRIORITY=1,Lr.DEFAULT_DVB_WEIGHT=1;var xr=Lr;function Mr(){var e,t=void 0,r=this.context,n=d(r).getInstance(),i=rt(r).getInstance(),o=void 0,a=void 0;return e={reset:function(){o.reset(),a.reset()},initialize:function(e){var r;o.setConfig({dashManifestModel:t}),a.setConfig({dashManifestModel:t}),r=e,o.update(r),a.chooseSelectorFromManifest(r)},resolve:function(e){var t=o.getForPath(e).reduce((function(e,t){var r=a.select(t);return r?(i.isRelative(r.url)?e.url=i.resolve(r.url,e.url):(e.url=r.url,e.serviceLocation=r.serviceLocation),e.urls=r.urls,e.availabilityTimeOffset=r.availabilityTimeOffset,e.availabilityTimeComplete=r.availabilityTimeComplete,e):new xr}),new xr);if(!i.isRelative(t.url))return t},setConfig:function(e){e.baseURLTreeModel&&(o=e.baseURLTreeModel),e.baseURLSelector&&(a=e.baseURLSelector),e.dashManifestModel&&(t=e.dashManifestModel)}},o=Ar(r).create(),a=kr(r).create(),n.on(p.SERVICE_LOCATION_BLACKLIST_CHANGED,(function(e){o.invalidateSelectedIndexes(e.entry)}),e),e}Mr.__dashjs_factory_name="BaseURLController";var Fr=s.a.getSingletonFactory(Mr);function Ur(){return{createMediaSource:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e&&window.BwpElement&&e instanceof window.BwpElement&&window.BwpMediaSource)return new BwpMediaSource;var t="WebKitMediaSource"in window;return"MediaSource"in window?new MediaSource:t?new WebKitMediaSource:null},attachMediaSource:function(e,t){var r;return r=window.BwpMediaSource&&e instanceof window.BwpMediaSource&&e.createObjectURL?e.createObjectURL():window.URL.createObjectURL(e),t.setSource(r),r},detachMediaSource:function(e){e.setSource(null)},setDuration:function e(t,r){return t.duration!=r&&function(e,t){var r=void 0,n=function(){for(var t=!1,r=0;r<e.length;r++)e[r].updating&&(t=!0);return t};if(e.length&&n()){var i=function(){n()||(clearInterval(r),t())},o=function e(){this.removeEventListener("updateend",e,!1),this.removeEventListener("abort",e,!1),this.removeEventListener("error",e,!1),n()||t()};if("function"==typeof e[0].addEventListener)try{for(var a=0;a<e.length;a++)e[a].updating&&(e[a].addEventListener("updateend",o,!1),e[a].addEventListener("abort",o,!1),e[a].addEventListener("error",o,!1))}catch(e){r=setInterval(i,50)}else r=setInterval(i,50)}else t()}(t.sourceBuffers,(function(){if("open"===t.readyState)t.duration=r;else var n=setTimeout((function(){clearTimeout(n),e(t,r)}),50)})),t.duration},setSeekable:function(e,t,r){e&&"function"==typeof e.setLiveSeekableRange&&"function"==typeof e.clearLiveSeekableRange&&"open"===e.readyState&&t>=0&&t<r&&(e.clearLiveSeekableRange(),e.setLiveSeekableRange(t,r))},signalEndOfStream:function(e){var t=e.sourceBuffers,r=t.length;if("open"===e.readyState){for(var n=0;n<r;n++){if(t[n].updating)return;if(0===t[n].buffered.length)return}e.endOfStream()}}}}Ur.__dashjs_factory_name="MediaSourceController";var Br=s.a.getSingletonFactory(Ur);function jr(){var e=this.context,t=g(e).getInstance().log,r=d(e).getInstance(),a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,y=void 0,m=void 0,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,T=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,I=void 0,O=void 0,C=void 0,N=void 0,k=void 0,L=void 0,x=void 0,M=void 0,F=void 0,U=void 0,B=void 0,j=void 0,V=void 0,G=void 0,H=void 0,q=void 0,W=void 0,Y=void 0,K=void 0,Q=void 0,z=void 0,Z=void 0;function J(){if(he()){var e=F.getPlaybackQuality();if(e&&y.addDroppedFrames(n.VIDEO,e),!B.getJumpGaps()||!I||0===I.getProcessors().length||U.isSeeking()||j||k||L||x)return;!function(){var e=U.getTime(),n=F.getEnded(),i=F.getVideoBufferRanges(),o=!1,a=void 0;if(!(i.length<=0||n)&&1!==i.length){for(var s=0;s<i.length;s++)if(e>=i[s].start&&e<=i[s].end){a=s,o=!0;break}if(o){var u=i.slice(a);if(u[0].end-e<.5){if(1===u.length)return
;for(var c=1;c<u.length;c++)if(u[c].end-u[c].start>=1)return t("Gap has been prdiected,seek from ",e," to ",u[c].start),U.seek(u[c].start),void r.trigger(p.PREDICT_SEEK,{currentTime:e,bufferRanges:i,destination:u[c].start});U.seek(u[u.length-1].start)}}}}()}}function X(){if(!(!B.getJumpGaps()||!I||0===I.getProcessors().length||U.isSeeking()||j||k||L||x)&&++K>=2){var e=U.getTime();Z===e?function(e){for(var n=I.getProcessors(),i=B.getSmallGapLimit(),o=void 0,a=0;a<n.length;a++){var s=n[a].getBuffer(),u=s&&s.getAllBufferRanges&&s.getAllBufferRanges(),c=void 0;if(u&&!(u.length<=1)){for(var l=0;l<u.length;l++)if(e<u.start(l)){c=u.start(l);break}if(c>0){var d=c-e;d>0&&d<=i&&(void 0===o||c>o)&&(o=c)}}}var f=U.getTimeToStreamEnd();if(void 0===o&&!isNaN(f)&&f<i&&(o=e+f),o>0)if(!isNaN(f)&&o>=e+f){t("Jumping media gap (discontinuity) at time ",e,". Jumping to end of the stream");var h=F.getVideoBufferRanges();if(h&&h.length){var y=h[h.length-1].end;!y||Q||F.getEnded()||(Q=!0,U.seek(y+1),r.trigger(p.JUMP_MEDIA_GAP,{time:e,seekToPosition:y+1,toEnd:!0}),t("Stuck in ending. Jumping to end of the stream."))}}else r.trigger(p.JUMP_MEDIA_GAP,{time:e,seekToPosition:o,toEnd:!1}),t("Jumping media gap (discontinuity) at time ",e,". Jumping to time position",o),U.seek(o)}(e):Z=e,K=0}}function $(e){var t=oe(e.seekTime);Y&&(re(),W=!1),t&&t!==I?(me(qe.END_OF_PERIOD_STOP_REASON),se(I,t,e.seekTime)):me(qe.USER_REQUEST_STOP_REASON),ge(He.SEEK_START_REASON)}function ee(){t("[StreamController][onPlaybackStarted]"),V?(V=!1,ge(He.INITIAL_PLAYOUT_START_REASON)):j&&(j=!1,ge(He.RESUME_FROM_PAUSE_START_REASON),ne())}function te(e){t("[StreamController][onPlaybackPaused]"),e.ended||(j=!0,me(qe.USER_REQUEST_STOP_REASON),ne())}function re(){t("[StreamController][toggleEndPeriodTimer] stop end period timer."),clearTimeout(Y),Y=void 0}function ne(){if(W)if(Y)re();else{var e=U.getTimeToStreamEnd(),n=e>0?1e3*e:0;t("[StreamController][toggleEndPeriodTimer] start-up of timer to notify PLAYBACK_ENDED event. It will be triggered in "+n+" milliseconds"),Y=setTimeout((function(){r.trigger(p.PLAYBACK_ENDED)}),n)}}function ie(){var e=_e().isLast,r=B.getEndOfStreamState();M&&e?(t("[StreamController][onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),r&&v.signalEndOfStream(M)):M&&void 0===Y&&(t("[StreamController][onStreamBufferingCompleted] end of period detected"),W=!0,!1===j&&ne())}function oe(e){var t=0,r=null,n=D.length;n>0&&(t+=D[0].getStartTime());for(var i=0;i<n;i++)if(r=D[i],e<(t=parseFloat((t+r.getDuration()).toFixed(5))))return r;return null}function ae(e){var r=function(){if(I){var e=I.getStreamInfo().start,t=I.getStreamInfo().duration;return D.filter((function(r){return r.getStreamInfo().start===parseFloat((e+t).toFixed(5))}))[0]}}();r?(q=void 0,H=void 0,se(I,r,NaN)):t("StreamController no next stream found"),me(r?qe.END_OF_PERIOD_STOP_REASON:qe.END_OF_CONTENT_STOP_REASON),Y=void 0,W=!1;try{if(B.getEndOfStreamState()){var n=Re("video"),i=Re("audio");isNaN(n)&&isNaN(i)||(U.seek(U.getTime()-.3),v.signalEndOfStream(M))}}catch(e){console.error("Hack PLAYBACK_END trigger native ended event error",e)}}function se(e,t,n){!k&&t&&e!==t&&(k=!0,r.trigger(p.PERIOD_SWITCH_STARTED,{fromStreamInfo:e?e.getStreamInfo():null,toStreamInfo:t.getStreamInfo()}),e&&(e.stopEventController(),e.deactivate()),I=t,U.initialize(I.getStreamInfo()),F.getElement()?ue(n,e,!1):function(e){ce(e)}(n))}function ue(e,n,i){var o=void 0;function a(){M&&(t("MediaSource is open!"),window.URL.revokeObjectURL(o),M.removeEventListener("sourceopen",a),M.removeEventListener("webkitsourceopen",a),le(),n||r.trigger(p.SOURCE_INITIALIZED),i&&I.setMediaSource(M))}M?v.detachMediaSource(F):M=v.createMediaSource(F.getElement()),ce(e),M.addEventListener("sourceopen",a,!1),M.addEventListener("webkitsourceopen",a,!1),o=v.attachMediaSource(M,F),t("MediaSource attached to element.  Waiting on open...")}function ce(e){if(I.activate(M),q=ye(n.AUDIO),H=ye(n.VIDEO),!V)if(isNaN(e)){var t=U.getStreamStartTime(!0);I.getProcessors().forEach((function(e){h.setIndexHandlerTime(e,t)}))}else U.seek(e);I.startEventController(),!N&&V||U.play(),k=!1,r.trigger(p.PERIOD_SWITCH_COMPLETED,{toStreamInfo:I.getStreamInfo()})}function le(e){var r=e||I.getStreamInfo().manifestInfo.duration,n=v.setDuration(M,r);t("Duration successfully set to: "+n)}function de(e){for(var t=0,r=D.length;t<r;t++)if(D[t].getId()===e.id)return D[t];return null}function fe(){var t=l.getValue();O&&(r.trigger(p.PROTECTION_CREATED,{controller:O,manifest:t}),O.setMediaElement(F.getElement()),C&&O.setProtectionData(C)),function(){try{var t=h.getStreamsInfo();if(0===t.length)throw new Error("There are no streams");var i=m.getCurrentManifestUpdate(y.getMetricsFor(n.STREAM));y.updateManifestUpdateInfo(i,{currentTime:U.getTime(),buffered:F.getBufferRange(),presentationStartTime:t[0].start,clientTimeOffset:P.getClientTimeOffset()});for(var o=0,c=t.length;o<c;o++){var d=t[o],g=de(d);g?g.updateData(d):(g=ar(e).create({manifestModel:l,dashManifestModel:f,mediaPlayerModel:B,metricsModel:y,dashMetrics:m,manifestUpdater:u,adapter:h,timelineConverter:P,capabilities:s,errHandler:R,baseURLController:E,domStorage:b,abrController:S,playbackController:U,mediaController:T,videoModel:F,streamController:a}),D.push(g),g.initialize(d,O)),y.addManifestUpdateStreamInfo(i,d.id,d.index,d.start,d.duration)}if(!I){var v=U.getStartTimeFromUriParameters(),_=null;v&&(_=oe(isNaN(v.fragS)?v.fragT:v.fragS)),se(null,null!==_?_:D[0],NaN)}r.trigger(p.STREAMS_COMPOSED)}catch(e){R.manifestError(e.message,"nostreamscomposed",l.getValue()),x=!0,we()}}()}function pe(e){if(e.error)x=!0,we();else{var r=e.manifest;B.getAppendingSourceState()&&le(r.mediaPresentationDuration),h.updatePeriods(r);var i=h.getStreamsInfo(void 0,1)[0],o=h.getMediaInfoForType(i,n.VIDEO)||h.getMediaInfoForType(i,n.AUDIO),a=void 0;o&&(a=f.getUseCalculatedLiveEdgeTimeForAdaptation(h.getDataForMedia(o)))&&(t("SegmentTimeline detected using calculated Live Edge Time"),B.setUseManifestDateHeaderTimeSource(!1));var s=f.getUTCTimingSources(e.manifest),u=!f.getIsDynamic(r)||a?s:s.concat(B.getUTCTimingSources()),c=A.isHTTPS(e.manifest.url);u.forEach((function(e){e.value.replace(/.*?:\/\//g,"")===pr.DEFAULT_UTC_TIMING_SOURCE.value.replace(/.*?:\/\//g,"")&&(e.value=e.value.replace(c?new RegExp(/^(http:)?\/\//i):new RegExp(/^(https:)?\/\//i),c?"https://":"http://"),t("Matching default timing source protocol to manifest protocol: ",e.value))})),E.initialize(r),_.setConfig({metricsModel:y,dashMetrics:m,baseURLController:E}),_.initialize(u,B.getUseManifestDateHeaderTimeSource())}}function he(){return H}function ye(e){var t=!1;return I&&I.getProcessors().forEach((function(r){r.getMediaInfo().type===e&&(t=!0)})),t}function me(e,t){t=t||new Date,G&&(I&&I.getProcessors().forEach((function(r){var n=r.getScheduleController();n&&n.finalisePlayList(t,e)})),y.addPlayList(G),G=null)}function ge(e){(G=new He).start=new Date,G.mstart=1e3*U.getTime(),G.starttype=e,I&&I.getProcessors().forEach((function(e){var t=e.getScheduleController();t&&t.setPlayList(G)}))}function ve(e){if(e.error){var r="",n=o.MEDIA_ERROR,i=void 0;switch(this.MEDIA_DOWNLOAD_ERROR=5001,e.error.code){case 1:r="MEDIA_ERR_ABORTED",n=o.MEDIA_ABORTED_ERROR;break;case 2:r="MEDIA_ERR_NETWORK",n=o.MEDIA_NETWORK_ERROR;break;case 3:r="MEDIA_ERR_DECODE",n=o.MEDIA_DECODE_ERROR,i=function(e){var t=o.MEDIA_DECODE_ERROR_UNKNOWN;return String.prototype.includes.call(e,"video")?t=o.MEDIA_DECODE_ERROR_VIDEO:String.prototype.includes.call(e,"audio")&&(t=o.MEDIA_DECODE_ERROR_AUDIO),t}(e.error.message);break;case 4:r="MEDIA_ERR_SRC_NOT_SUPPORTED",n=o.MEDIA_SUPPORTED_ERROR;break;case 5:r="MEDIA_ERR_ENCRYPTED",n=o.MEDIA_ENCRYPTED_ERROR;break;default:r="UNKNOWN",n=o.MEDIA_UNKNOWN_ERROR}e.errorCode=n,L=!0,e.error.message&&(r+=" ("+e.error.message+")"),e.error.msExtendedCode&&(r+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),t("Video Element Error: "+r),e.error&&t(e.error),R.mediaSourceError(r,n,i),we()}}function _e(){return I?I.getStreamInfo():null}function Ee(){
if(!(c&&c.hasOwnProperty("load")&&P&&P.hasOwnProperty("initialize")&&P.hasOwnProperty("reset")&&P.hasOwnProperty("getClientTimeOffset")))throw new Error("setConfig function has to be called previously")}function be(e){isNaN(e.newDuration)||le(e.newDuration)}function Se(){D=[],O=null,k=!1,I=null,L=!1,x=!1,H=void 0,q=void 0,V=!0,j=!1,N=!0,G=null,Y=void 0,W=!1,K=0,Q=!1}function we(){Ee(),z&&(clearTimeout(z),z=null),_.reset(),me(L||x?qe.FAILURE_STOP_REASON:qe.USER_REQUEST_STOP_REASON);for(var e=0,t=D?D.length:0;e<t;e++)D[e].reset(L);r.off(p.PLAYBACK_TIME_UPDATED,J,this),r.off(p.BYTES_APPENDED_END_FRAGMENT,J,this),r.off(p.PLAYBACK_SEEKING,$,this),r.off(p.PLAYBACK_ERROR,ve,this),r.off(p.PLAYBACK_STARTED,ee,this),r.off(p.PLAYBACK_PAUSED,te,this),r.off(p.PLAYBACK_ENDED,ae,this),r.off(p.MANIFEST_UPDATED,pe,this),r.off(p.STREAM_BUFFERING_COMPLETED,ie,this),r.off(hr.METRIC_ADDED,Ae,this),r.off(p.MANIFEST_VALIDITY_CHANGED,be,this),E.reset(),u.reset(),y.clearAllCurrentMetrics(),l.setValue(null),c.reset(),P.reset(),w.reset(),M&&(v.detachMediaSource(F),M=null),F=null,O&&(O.setMediaElement(null),O=null,C=null,l.getValue()&&r.trigger(p.PROTECTION_DESTROYED,{data:l.getValue().url})),r.trigger(p.STREAM_TEARDOWN_COMPLETE),Se()}function Ae(e){e.metric===i.DVR_INFO&&e.mediaType===n.AUDIO&&v.setSeekable(M,e.value.range.start,e.value.range.end)}function Re(e){return-1!==[n.VIDEO,n.AUDIO,n.FRAGMENTED_TEXT].indexOf(e)?m.getCurrentBufferLevel(y.getReadOnlyMetricsFor(e))||NaN:(t("Warning  - getBufferLength requested for invalid type"),NaN)}return a={initialize:function(t,n){Ee(),N=t,C=n,P.initialize(),(u=ur(e).create()).setConfig({manifestModel:l,dashManifestModel:f,mediaPlayerModel:B,manifestLoader:c,errHandler:R}),u.initialize(),E.setConfig({dashManifestModel:f}),r.on(p.TIME_SYNCHRONIZATION_COMPLETED,fe,this),r.on(p.PLAYBACK_SEEKING,$,this),r.on(p.PLAYBACK_TIME_UPDATED,J,this),r.on(p.BYTES_APPENDED_END_FRAGMENT,J,this),r.on(p.PLAYBACK_ENDED,ae,this),r.on(p.PLAYBACK_ERROR,ve,this),r.on(p.PLAYBACK_STARTED,ee,this),r.on(p.PLAYBACK_PAUSED,te,this),r.on(p.MANIFEST_UPDATED,pe,this),r.on(p.STREAM_BUFFERING_COMPLETED,ie,this),r.on(p.MANIFEST_VALIDITY_CHANGED,be,this),r.on(p.WALLCLOCK_TIME_UPDATED,X,this),r.on(hr.METRIC_ADDED,Ae,this)},getActiveStreamInfo:_e,isVideoTrackPresent:he,isAudioTrackPresent:function(){return q},switchToVideoElement:function(e){U.initialize(I.getStreamInfo()),ue(e,null,!0)},getStreamById:function(e){return D.filter((function(t){return t.getId()===e}))[0]},getStreamForTime:oe,getDuration:function(){if(I)return I.getStreamInfo().duration},getTimeRelativeToStreamId:function(e,t){for(var r=null,n=0,i=0,o=null,a=D.length,s=0;s<a;s++){if(i=(r=D[s]).getStartTime(),o=r.getDuration(),Number.isFinite(i)&&(n=i),r.getId()===t)return e-n;Number.isFinite(o)&&(n+=o)}return null},load:function(e,t,r){Ee(),c.load(e,t,r)},loadWithManifest:function(e){!function(){if(!u||!u.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}(),u.setManifest(e)},getActiveStreamProcessors:function(){return I?I.getProcessors():[]},setConfig:function(e){e&&(e.capabilities&&(s=e.capabilities),e.manifestLoader&&(c=e.manifestLoader),e.manifestModel&&(l=e.manifestModel),e.dashManifestModel&&(f=e.dashManifestModel),e.mediaPlayerModel&&(B=e.mediaPlayerModel),e.protectionController&&(O=e.protectionController),e.adapter&&(h=e.adapter),e.metricsModel&&(y=e.metricsModel),e.dashMetrics&&(m=e.dashMetrics),e.errHandler&&(R=e.errHandler),e.timelineConverter&&(P=e.timelineConverter),e.videoModel&&(F=e.videoModel),e.playbackController&&(U=e.playbackController),e.domStorage&&(b=e.domStorage),e.abrController&&(S=e.abrController),e.mediaController&&(T=e.mediaController))},setProtectionData:function(e){C=e},setMediaDuration:le,setAppendWindowEnd:function(e){if(e)for(var t=I.getProcessors(),r=0;r<t.length;r++){var n=t[r].getBuffer();n&&n.setAppendWindowEnd(e)}},reset:we},_=gr(e).getInstance(),E=Fr(e).getInstance(),v=Br(e).getInstance(),w=Te(e).getInstance(),A=rt(e).getInstance(),Se(),a}jr.__dashjs_factory_name="StreamController";var Vr=s.a.getSingletonFactory(jr),Gr=function(e){function t(r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this));return o.url=r||null,o.type=i||null,o.mediaType=n.STREAM,o.responseType="",o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(y);function Hr(e){e=e||{};var t=this.context,r=d(t).getInstance(),n=Bt(t).create({errHandler:e.errHandler,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier});return{load:function(e,t,i){var o=function(e){function t(t,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(n,o){t.resolved=!0,t.resolvedContent=n||null,r.trigger(p.XLINK_ELEMENT_LOADED,{element:t,resolveObject:i,error:n||o?null:new w(1,"Failed loading Xlink element: "+e)})}));if("urn:mpeg:dash:resolve-to-zero:2013"===e)o(null,!0);else{var a=new Gr(e,F.XLINK_TYPE);n.load({request:a,success:function(e){o(e)},error:function(){o(null)}})}},reset:function(){n&&(n.abort(),n=null)}}}Hr.__dashjs_factory_name="XlinkLoader";var qr=s.a.getClassFactory(Hr);qr.XLINK_LOADER_ERROR_LOADING_FAILURE=1,s.a.updateClassFactory(Hr.__dashjs_factory_name,qr);var Wr=qr,Yr=function(e){void 0===(e=e||{}).escapeMode&&(e.escapeMode=!0),void 0===e.attributePrefix&&(e.attributePrefix="_"),e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1),void 0===e.ignoreRoot&&(e.ignoreRoot=!1);var t=1;function r(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function n(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function i(e,t,r,n){for(var i=0;i<e.length;i++){var o=e[i];if("string"==typeof o){if(o==n)break}else if(o instanceof RegExp){if(o.test(n))break}else if("function"==typeof o&&o(t,r,n))break}return i!=e.length}function o(t,r,n){"property"===e.arrayAccessForm&&(t[r]instanceof Array?t[r+"_asArray"]=t[r]:t[r+"_asArray"]=[t[r]]),!(t[r]instanceof Array)&&e.arrayAccessFormPaths.length>0&&i(e.arrayAccessFormPaths,t,r,n)&&(t[r]=[t[r]])}function a(e){var t=e.split(/[-T:+Z]/g),r=new Date(t[0],t[1]-1,t[2]),n=t[5].split(".");if(r.setHours(t[3],t[4],n[0]),n.length>1&&r.setMilliseconds(n[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),r.setMinutes(r.getMinutes()-i-r.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())));return r}function s(r,n,o,a){return!(n==t&&e.xmlElementsFilter.length>0)||i(e.xmlElementsFilter,r,o,a)}function u(n,c){if(9==n.nodeType){for(var l=new Object,d=n.childNodes,f=0;f<d.length;f++)(h=d[f]).nodeType==t&&(e.ignoreRoot?l=u(h):(l={})[y=r(h)]=u(h));return l}if(n.nodeType==t){(l=new Object).__cnt=0;var p=[];for(d=n.childNodes,f=0;f<d.length;f++){var h,y=r(h=d[f]);if(8!=h.nodeType){var m=c+"."+y;if(s(l,h.nodeType,y,m))if(l.__cnt++,null==l[y]){var g=u(h,m);("#text"!=y||/[^\s]/.test(g))&&((v={})[y]=g,p.push(v)),l[y]=g,o(l,y,m)}else{var v
;null!=l[y]&&(l[y]instanceof Array||(l[y]=[l[y]],o(l,y,m))),g=u(h,m),("#text"!=y||/[^\s]/.test(g))&&((v={})[y]=g,p.push(v)),l[y][l[y].length]=g}}}l.__children=p;for(var _=r(n),E=0;E<n.attributes.length;E++){var b=n.attributes[E];l.__cnt++;for(var S=b.value,T=0,w=e.matchers.length;T<w;T++){var A=e.matchers[T];A.test(b,_)&&(S=A.converter(b.value))}l[e.attributePrefix+b.name]=S}var R=function(e){return e.prefix}(n);return null!=R&&""!=R&&(l.__cnt++,l.__prefix=R),null!=l["#text"]&&(l.__text=l["#text"],l.__text instanceof Array&&(l.__text=l.__text.join("\n")),e.stripWhitespaces&&(l.__text=l.__text.trim()),delete l["#text"],"property"==e.arrayAccessForm&&delete l["#text_asArray"],l.__text=function(t,r,n){if(e.datetimeAccessFormPaths.length>0){var o=n.split(".#")[0];return i(e.datetimeAccessFormPaths,t,r,o)?a(t):t}return t}(l.__text,y,c+"."+y)),null!=l["#cdata-section"]&&(l.__cdata=l["#cdata-section"],delete l["#cdata-section"],"property"==e.arrayAccessForm&&delete l["#cdata-section_asArray"]),0==l.__cnt&&"text"==e.emptyNodeForm?l="":1==l.__cnt&&null!=l.__text?l=l.__text:1!=l.__cnt||null==l.__cdata||e.keepCData?l.__cnt>1&&null!=l.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==l.__text||""==l.__text.trim())&&delete l.__text:l=l.__cdata,delete l.__cnt,!e.enableToStringFunc||null==l.__text&&null==l.__cdata||(l.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),l}if(3==n.nodeType||4==n.nodeType)return n.nodeValue}function c(t,r,i,o){var a="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+r;if(null!=i)for(var s=0;s<i.length;s++){var u=i[s],c=t[u];e.escapeMode&&(c=n(c)),a+=" "+u.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?a+='"'+c+'"':a+="'"+c+"'"}return a+(o?"/>":">")}function l(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function d(t,r){return"property"==e.arrayAccessForm&&(i="_asArray",-1!==(n=r.toString()).indexOf(i,n.length-8))||0==r.toString().indexOf(e.attributePrefix)||0==r.toString().indexOf("__")||t[r]instanceof Function;var n,i}function f(e){var t=0;if(e instanceof Object)for(var r in e)d(e,r)||t++;return t}function p(t,r,n){return 0==e.jsonPropertiesFilter.length||""==n||i(e.jsonPropertiesFilter,t,r,n)}function h(t){var r=[];if(t instanceof Object)for(var n in t)-1==n.toString().indexOf("__")&&0==n.toString().indexOf(e.attributePrefix)&&r.push(n);return r}function y(t){var r="";return t instanceof Object?r+=function(t){var r="";return null!=t.__cdata&&(r+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e.escapeMode?r+=n(t.__text):r+=t.__text),r}(t):null!=t&&(e.escapeMode?r+=n(t):r+=t),r}function m(e,t){return""===e?t:e+"."+t}function g(e,t,r,n){var i="";if(0==e.length)i+=c(e,t,r,!0);else for(var o=0;o<e.length;o++)i+=c(e[o],t,h(e[o]),!1),i+=v(e[o],m(n,t)),i+=l(e[o],t);return i}function v(e,t){var r="";if(f(e)>0)for(var n in e)if(!d(e,n)&&(""==t||p(e,n,m(t,n)))){var i=e[n],o=h(i);null==i||null==i?r+=c(i,n,o,!0):i instanceof Object?i instanceof Array?r+=g(i,n,o,t):i instanceof Date?(r+=c(i,n,o,!1),r+=i.toISOString(),r+=l(i,n)):f(i)>0||null!=i.__text||null!=i.__cdata?(r+=c(i,n,o,!1),r+=v(i,m(t,n)),r+=l(i,n)):r+=c(i,n,o,!0):(r+=c(i,n,o,!1),r+=y(i),r+=l(i,n))}return r+y(e)}this.parseXmlString=function(e){var t;if(window.ActiveXObject||window,void 0===e)return null;if(window.DOMParser){var r=new window.DOMParser;try{(t=r.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?a(e):e},this.xml2json=function(e){return u(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return v(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}},Kr="onLoad",Qr="Period",zr="AdaptationSet";function Zr(e){e=e||{};var t=this.context,r=d(t).getInstance(),n=rt(t).getInstance(),i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=void 0;function l(e,t,r){var i={},o=void 0,a=void 0;i.elements=e,i.type=t,i.resolveType=r,0===i.elements.length&&h(i);for(var s=0;s<i.elements.length;s++)o=i.elements[s],a=n.isHTTPURL(o.url)?o.url:o.originalContent.BaseURL+o.url,c.load(a,o,i)}function f(e){var t,r=void 0,n="";if(r=e.element,t=e.resolveObject,r.resolvedContent){var i=0;0===r.resolvedContent.indexOf("<?xml")&&(i=r.resolvedContent.indexOf("?>")+2),n=r.resolvedContent.substr(0,i)+"<response>"+r.resolvedContent.substr(i)+"</response>",r.resolvedContent=u.xml_str2json(n)}(function(e){var t=void 0;for(t=0;t<e.elements.length;t++)if(!1===e.elements[t].resolved)return!1;return!0})(t)&&h(t)}function h(e){var t=[],n=void 0,i=void 0;if(function(e){var t=[],r=void 0,n=void 0,i=void 0,o=void 0,u=void 0,c=void 0;for(o=e.elements.length-1;o>=0;o--){if(n=(r=e.elements[o]).type+"_asArray",r.resolvedContent){if(r.resolvedContent)for(u=0;u<r.resolvedContent[n].length;u++)i=r.resolvedContent[n][u],t.push(i)}else delete r.originalContent["xlink:actuate"],delete r.originalContent["xlink:href"],t.push(r.originalContent);for(r.parentElement[n].splice(r.index,1),c=0;c<t.length;c++)r.parentElement[n].splice(r.index+c,0,t[c]);t=[]}e.elements.length>0&&a.run(s)}(e),"onActuate"===e.resolveType&&r.trigger(p.XLINK_READY,{manifest:s}),e.resolveType===Kr)switch(e.type){case Qr:for(n=0;n<s.Period_asArray.length;n++)(i=s.Period_asArray[n]).hasOwnProperty("AdaptationSet_asArray")&&(t=t.concat(y(i.AdaptationSet_asArray,i,zr,Kr))),i.hasOwnProperty("EventStream_asArray")&&(t=t.concat(y(i.EventStream_asArray,i,"EventStream",Kr)));l(t,zr,Kr);break;case zr:r.trigger(p.XLINK_READY,{manifest:s})}}function y(e,t,r,n){var i=[],o=void 0,a=void 0,s=void 0;for(a=e.length-1;a>=0;a--)(o=e[a]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===o["xlink:href"]&&e.splice(a,1);for(a=0;a<e.length;a++)(o=e[a]).hasOwnProperty("xlink:href")&&o.hasOwnProperty("xlink:actuate")&&o["xlink:actuate"]===n&&(s=m(o["xlink:href"],t,r,a,n,o),i.push(s));return i}function m(e,t,r,n,i,o){return{url:e,parentElement:t,type:r,index:n,resolveType:i,originalContent:o,resolvedContent:null,resolved:!1}}return i={resolveManifestOnLoad:function(e){u=new Yr({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:o}),l(y((s=e).Period_asArray,s,Qr,Kr),Qr,Kr)},setMatchers:function(e){e&&(o=e)},setIron:function(e){e&&(a=e)},reset:function(){r.off(p.XLINK_ELEMENT_LOADED,f,i),c&&(c.reset(),c=null)}},r.on(p.XLINK_ELEMENT_LOADED,f,i),c=Wr(t).create({errHandler:e.errHandler,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),i}Zr.__dashjs_factory_name="XlinkController";var Jr=s.a.getClassFactory(Zr),Xr="function"==typeof Symbol&&"symbol"==c(Symbol.iterator)?function(e){return c(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":c(e)};function $r(e){function t(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function r(e,r,n){for(var i=0,o=e.length;i<o;++i){var a=e[i];if(r[a.name])if(n[a.name]){if(a.merge){var s=r[a.name],u=n[a.name];"object"===(void 0===s?"undefined":Xr(s))&&"object"===(void 0===u?"undefined":Xr(u))?t(s,u):n[a.name]=s+u}}else n[a.name]=r[a.name]}}function n(e,t){for(var i=0,o=e.children.length;i<o;++i){var a=e.children[i],s=t[a.name+"_asArray"];if(s)for(var u=0,c=s.length;u<c;++u){var l=s[u];r(e.properties,t,l),n(a,l)}}}return{run:function(t){if(null===t||"object"!==(void 0===t?"undefined":Xr(t)))return t;if("period"in e)for(var r=e.period,i=t.Period_asArray,o=0,a=i.length;o<a;++o){var s=i[o];if(n(r,s),"adaptationset"in e){var u=s.AdaptationSet_asArray;if(u)for(var c=e.adaptationset,l=0,d=u.length;l<d;++l)n(c,u[l])}}return t}}}
$r.__dashjs_factory_name="ObjectIron";var en=s.a.getClassFactory($r),tn=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),rn=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._test=t,this._converter=r}return tn(e,[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}]),e}();function nn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var on=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this,(function(e,t){var r,n=(nn(r={},Je.MPD,[Je.ID,Je.PROFILES]),nn(r,Je.PERIOD,[Je.ID]),nn(r,Je.BASE_URL,[Je.SERVICE_LOCATION,Je.BYTE_RANGE]),nn(r,Je.SEGMENT_BASE,[Je.INDEX_RANGE]),nn(r,Je.INITIALIZATION,[Je.RANGE]),nn(r,Je.REPRESENTATION_INDEX,[Je.RANGE]),nn(r,Je.SEGMENT_LIST,[Je.INDEX_RANGE]),nn(r,Je.BITSTREAM_SWITCHING,[Je.RANGE]),nn(r,Je.SEGMENT_URL,[Je.MEDIA_RANGE,Je.INDEX_RANGE]),nn(r,Je.SEGMENT_TEMPLATE,[Je.INDEX_RANGE,Je.MEDIA,Je.INDEX,Je.INITIALIZATION_MINUS,Je.BITSTREAM_SWITCHING_MINUS]),nn(r,Je.ASSET_IDENTIFIER,[Je.VALUE,Je.ID]),nn(r,Je.EVENT_STREAM,[Je.VALUE]),nn(r,Je.ADAPTATION_SET,[Je.PROFILES,Je.MIME_TYPE,Je.SEGMENT_PROFILES,Je.CODECS,Je.CONTENT_TYPE]),nn(r,Je.FRAME_PACKING,[Je.VALUE,Je.ID]),nn(r,Je.AUDIO_CHANNEL_CONFIGURATION,[Je.VALUE,Je.ID]),nn(r,Je.CONTENT_PROTECTION,[Je.VALUE,Je.ID]),nn(r,Je.ESSENTIAL_PROPERTY,[Je.VALUE,Je.ID]),nn(r,Je.SUPPLEMENTAL_PROPERTY,[Je.VALUE,Je.ID]),nn(r,Je.INBAND_EVENT_STREAM,[Je.VALUE,Je.ID]),nn(r,Je.ACCESSIBILITY,[Je.VALUE,Je.ID]),nn(r,Je.ROLE,[Je.VALUE,Je.ID]),nn(r,Je.RATING,[Je.VALUE,Je.ID]),nn(r,Je.VIEWPOINT,[Je.VALUE,Je.ID]),nn(r,Je.CONTENT_COMPONENT,[Je.CONTENT_TYPE]),nn(r,Je.REPRESENTATION,[Je.ID,Je.DEPENDENCY_ID,Je.MEDIA_STREAM_STRUCTURE_ID]),nn(r,Je.SUBSET,[Je.ID]),nn(r,Je.METRICS,[Je.METRICS_MINUS]),nn(r,Je.REPORTING,[Je.VALUE,Je.ID]),r);if(n.hasOwnProperty(t)){var i=n[t];return void 0!==i&&i.indexOf(e.name)>=0}return!1}),(function(e){return String(e)})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(rn),an=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,sn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this,(function(e){for(var t=[Je.MIN_BUFFER_TIME,Je.MEDIA_PRESENTATION_DURATION,Je.MINIMUM_UPDATE_PERIOD,Je.TIMESHIFT_BUFFER_DEPTH,Je.MAX_SEGMENT_DURATION,Je.MAX_SUBSEGMENT_DURATION,n.SUGGESTED_PRESENTATION_DELAY,Je.START,n.START_TIME,Je.DURATION],r=t.length,i=0;i<r;i++)if(e.nodeName===t[i])return an.test(e.value);return!1}),(function(e){var t=an.exec(e),r=31536e3*parseFloat(t[2]||0)+2592e3*parseFloat(t[4]||0)+86400*parseFloat(t[6]||0)+3600*parseFloat(t[8]||0)+60*parseFloat(t[10]||0)+parseFloat(t[12]||0);return void 0!==t[1]&&(r=-r),r})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(rn),un=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,cn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this,(function(e){return un.test(e.value)}),(function(e){var t=un.exec(e),r=void 0;if(r=Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[4],10),parseInt(t[5],10),t[6]&&parseInt(t[6],10)||0,t[7]&&1e3*parseFloat(t[7])||0),t[9]&&t[10]){var n=60*parseInt(t[9],10)+parseInt(t[10],10);r+=("+"===t[8]?-1:1)*n*60*1e3}return new Date(r)})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(rn),ln=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,dn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this,(function(e){return ln.test(e.value)}),(function(e){return parseFloat(e)})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(rn),fn=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),pn=function(){function e(t){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t,this._merge=(r=t)&&r.length&&r.charAt(0)===r.charAt(0).toUpperCase()}return fn(e,[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}]),e}(),hn=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),yn=function(){function e(t,r,n){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t||"",this._properties=[],this._children=n||[],Array.isArray(r)&&r.forEach((function(e){i._properties.push(new pn(e))}))}return hn(e,[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}]),e}(),mn=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=[Je.PROFILES,Je.WIDTH,Je.HEIGHT,Je.SAR,Je.FRAMERATE,Je.AUDIO_SAMPLING_RATE,Je.MIME_TYPE,Je.SEGMENT_PROFILES,Je.CODECS,Je.MAXIMUM_SAP_PERIOD,Je.START_WITH_SAP,Je.MAX_PLAYOUT_RATE,Je.CODING_DEPENDENCY,Je.SCAN_TYPE,Je.FRAME_PACKING,Je.AUDIO_CHANNEL_CONFIGURATION,Je.CONTENT_PROTECTION,Je.ESSENTIAL_PROPERTY,Je.SUPPLEMENTAL_PROPERTY,Je.INBAND_EVENT_STREAM];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this,Je.ADAPTATION_SET,r,[new yn(Je.REPRESENTATION,r,[new yn(Je.SUB_REPRESENTATION,r)])]))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,
enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(yn),gn=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=[Je.SEGMENT_BASE,Je.SEGMENT_TEMPLATE,Je.SEGMENT_LIST];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this,Je.PERIOD,r,[new yn(Je.ADAPTATION_SET,r,[new yn(Je.REPRESENTATION,r)])]))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(yn);function vn(){var e,t=this.context,r=g(t).getInstance().log,n=void 0,i=void 0,o=void 0;return e={parse:function(e){var t,n=window.performance.now();if(!(t=i.xml_str2json(e)))throw new Error("parsing the manifest failed");var a=window.performance.now();o.run(t);var s=window.performance.now();return r("Parsing complete: ( xml2json: "+(a-n).toPrecision(3)+"ms, objectiron: "+(s-a).toPrecision(3)+"ms, total: "+((s-n)/1e3).toPrecision(3)+"s)"),t},getMatchers:function(){return n},getIron:function(){return o}},n=[new sn,new cn,new dn,new on],i=new Yr({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:n}),o=en(t).create({adaptationset:new mn,period:new gn}),e}vn.__dashjs_factory_name="DashParser";var _n=s.a.getClassFactory(vn),En="function"==typeof Symbol&&"symbol"==c(Symbol.iterator)?function(e){return c(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":c(e)};function bn(){var e,t=this.context,r=g(t).getInstance().log,n=void 0;function i(e,t){return t?e&&e.replace(/http:\/\//g,"https://"):e}return e={parse:function(e,t){var n={},o=window.performance.now(),a=function(e){var t=e&&(e.ContentProtection||e.content_protection);return t?t.pssh?{schemeIdUri:t.schemeIdUri||t.scheme_id_uri,value:t.value,pssh:t.pssh}:{schemeIdUri:t.schemeIdUri||t.scheme_id_uri,value:t.value}:null};try{e=function e(t){var r={};if(t instanceof Object){var n=function(n){var i=n.replace(/[\x41-\x5A]/g,(function(e,t){var r=String.fromCharCode(e.charCodeAt(0)+32);return t?"_"+r:r}));"[object Array]"===Object.prototype.toString.call(t[n])?(r[i]=[],t[n].forEach((function(t){r[i].push(e(t))}))):"[object Object]"===Object.prototype.toString.call(t[n])?r[i]=e(t[n]):r[i]=t[n]};for(var i in t)n(i)}else r=t;return r}(e)}catch(e){throw new Error("Convert bilibili mpd failed, "+e)}if(n.ProgramInformation={Title:""},n.loadedTime=new Date,n.mediaPresentationDuration=e.duration,n.minBufferTime=e.min_buffer_time,n.profiles="urn:mpeg:dash:profile:isoff-on-demand:2011",n.xmlns="urn:mpeg:dash:profile:isoff-on-demand:2011",n.type="static",n.interactive="interactive"===e.type,n.originalUrl=location.href,n.url=location.href,n.Period={duration:e.duration,AdaptationSet:[]},e.video&&(n.Period.AdaptationSet[0]={},n.Period.AdaptationSet[0].Representation=e.video.map((function(e){var r=a(e),o={__text:i(e.base_url,t)};return e.backup_url&&e.backup_url.forEach((function(e,r){o["backupUrl"+(r+1)]=i(e,t)})),r&&!n.Period.AdaptationSet[0].ContentProtection&&(n.Period.AdaptationSet[0].ContentProtection=r),{BaseURL:o,ContentProtection:r,SegmentBase:{Initialization:{range:e.segment_base.initialization},indexRange:e.segment_base.index_range,indexRangeExact:"true"},bandwidth:e.bandwidth,codecs:e.codecs,frameRate:e.frame_rate,height:e.height,width:e.width,id:e.id+"",mimeType:e.mime_type,sar:e.sar,startWithSAP:e.start_with_sap}}))),e.audio&&(n.Period.AdaptationSet[1]={},n.Period.AdaptationSet[1].Representation=e.audio.map((function(e){var r=a(e),o={__text:i(e.base_url,t)};return e.backup_url&&e.backup_url.forEach((function(e,r){o["backupUrl"+(r+1)]=i(e,t)})),r&&!n.Period.AdaptationSet[1].ContentProtection&&(n.Period.AdaptationSet[1].ContentProtection=r),{BaseURL:o,ContentProtection:r,SegmentBase:{Initialization:{range:e.segment_base.initialization},indexRange:e.segment_base.index_range,indexRangeExact:"true"},bandwidth:e.bandwidth,codecs:e.codecs,id:e.id+"",mimeType:e.mime_type}}))),n.ProgramInformation={Title:""},function e(t){var r="[object Array]"!==Object.prototype.toString.call(t);for(var n in t)"object"===En(t[n])&&(e(t[n]),r&&(t[n+"_asArray"]="[object Array]"===Object.prototype.toString.call(t[n])?t[n]:[t[n]]))}(n),!n)throw new Error("parsing the manifest failed");var s=window.performance.now(),u=window.performance.now();return r("Parsing complete: ( xml2json: "+(s-o).toPrecision(3)+"ms, objectiron: "+(u-s).toPrecision(3)+"ms, total: "+((u-o)/1e3).toPrecision(3)+"s)"),n},getMatchers:function(){return null},getIron:function(){return n}},n=en(t).create({adaptationset:new mn,period:new gn}),e}bn.__dashjs_factory_name="DashBilibiliParser";var Sn=s.a.getClassFactory(bn);function Tn(e){e=e||{};var t=this.context,r=d(t).getInstance(),i=rt(t).getInstance(),a=g(t).getInstance().log,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=e.mssHandler,y=e.errHandler;function m(e){r.trigger(p.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}function v(e,s,u,d){if(c){var y=void 0,m=void 0,g=void 0;if(window.location&&window.location&&"https:"===window.location.protocol&&(f=!0),d&&d!==e?(m=i.parseBaseUrl(d),y=d):(i.isRelative(e)&&(e=i.resolve(e,window.location.href)),m=i.parseBaseUrl(e)),null===l&&(l=function(e){var r=null;return e.video||e.audio?Sn(t).create():e.indexOf("SmoothStreamingMedia")>-1?(h&&(r=h.createMssParser(),h.registerEvents()),r):e.indexOf("MPD")>-1?_n(t).create():r}(s)),null!==l){c.setMatchers(l.getMatchers()),c.setIron(l.getIron());try{g=l.parse(s,f)}catch(t){return void r.trigger(p.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new w(1,"Failed parsing manifest : "+(d?e:"MPD String"),null,o.MANIFEST_RESOLVE_ERROR)})}g?(g.url=y||e,g.originalUrl||(g.originalUrl=g.url),g.hasOwnProperty(n.LOCATION)&&(m=i.parseBaseUrl(g.Location_asArray[0]),a("BaseURI set by Location to: "+m)),g.baseUri=function(e,t){return t?e&&e.replace(/http:\/\//g,"https://"):e}(m,f),g.loadedTime=new Date,c.resolveManifestOnLoad(g)):r.trigger(p.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new w(1,"parsing failed",null,o.MANIFEST_ERROR)})}else r.trigger(p.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new w(1,"Failed detecting manifest type or manifest type unsupported : "+(d?e:"MPD String"),null,o.MANIFEST_TYPE_ERROR)})}}return s={load:function(e,t){if(f=t,!e||"string"!=typeof e||0!==e.indexOf("http")&&0!==e.indexOf("/"))v("",e,0,"");else{var n=new Gr(e,F.MPD_TYPE);u.load({request:n,success:function(t,r,n){v(e,t,0,n)},error:function(t,n,i,a){r.trigger(p.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new w(2,"Failed loading manifest: "+e+", "+i,null,o.MANIFEST_DOWNLOAD_ERROR,a)})}})}},reset:function(){r.off(p.XLINK_READY,m,s),c&&(c.reset(),c=null),u&&(u.abort(),u=null),h&&h.reset()}},r.on(p.XLINK_READY,m,s),u=Bt(t).create({errHandler:y,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),c=Jr(t).create({errHandler:y,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),l=null,s}Tn.__dashjs_factory_name="ManifestLoader";var wn=s.a.getClassFactory(Tn);wn.MANIFEST_LOADER_ERROR_PARSING_FAILURE=1,wn.MANIFEST_LOADER_ERROR_LOADING_FAILURE=2,s.a.updateClassFactory(Tn.__dashjs_factory_name,wn);var An=wn;function Rn(){var e,t=void 0;return e={supportsMediaSource:function(){var e="WebKitMediaSource"in window,t="MediaSource"in window;return e||t},supportsEncryptedMedia:function(){return t},supportsCodec:function(e){return!(!("MediaSource"in window)||!MediaSource.isTypeSupported(e))||!(!("WebKitMediaSource"in window)||!WebKitMediaSource.isTypeSupported(e))||!!(window.__ENABLE_WASM_PLAYER__&&"BwpMediaSource"in window&&BwpMediaSource.isTypeSupported(e))},
setEncryptedMediaSupported:function(e){t=e}},t=!1,e}Rn.__dashjs_factory_name="Capabilities";var Pn=s.a.getSingletonFactory(Rn);function Dn(){var e=this.context,t=d(e).getInstance(),r=void 0;return{getValue:function(){return r},setValue:function(e){r=e,e&&t.trigger(p.MANIFEST_LOADED,{data:e})}}}Dn.__dashjs_factory_name="ManifestModel";var In=s.a.getSingletonFactory(Dn),On=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]},Cn=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},Nn=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.mt=null,this.to=null,this.lto=null},kn=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.level=null},Ln=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=null,this.state=Le.BUFFER_EMPTY},xn=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.range=null,this.manifestInfo=null},Mn=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.droppedFrames=null};function Fn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Un=function e(){Fn(this,e),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},Bn=function e(){Fn(this,e),this.id=null,this.index=null,this.start=null,this.duration=null},jn=function e(){Fn(this,e),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},Vn=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},Gn=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadingRequests=[],this.executedRequests=[]};function Hn(){var e,t=this.context,r=d(t).getInstance(),o=void 0;function a(){r.trigger(p.METRICS_CHANGED)}function s(e){r.trigger(p.METRIC_CHANGED,{mediaType:e}),a()}function u(e,t,n){r.trigger(p.METRIC_UPDATED,{mediaType:e,metric:t,value:n}),s(e)}function c(e,t,n){r.trigger(p.METRIC_ADDED,{mediaType:e,metric:t,value:n}),s(e)}function l(e){var t=void 0;return o.hasOwnProperty(e)?t=o[e]:(t=new On,o[e]=t),t}function f(e,t,r){var n=l(e);n[t].push(r),n[t].length>1e3&&n[t].shift()}function h(e,t,r){f(e,t,r),c(e,t,r)}return e={clearCurrentMetricsForType:function(e){delete o[e],s(e)},clearAllCurrentMetrics:function(){o={},a()},getReadOnlyMetricsFor:function(e){return o.hasOwnProperty(e)?o[e]:null},getMetricsFor:l,addTcpConnection:function(e,t,r,n,o,a){var s=new Cn;return s.tcpid=t,s.dest=r,s.topen=n,s.tclose=o,s.tconnect=a,h(e,i.TCP_CONNECTION,s),s},addHttpRequest:function e(t,r,n,o,a,s,u,c,l,d,f,p,y,m){var g=new F;return a&&a!==o&&(e(t,null,n,o,null,null,u,c,null,null,null,p,null,null),g.actualurl=a),g.tcpid=r,g.type=n,g.url=o,g.range=u,g.trequest=c,g.tresponse=l,g.responsecode=f,g._tfinish=d,g._stream=t,g._mediaduration=p,g._responseHeaders=y,g._serviceLocation=s,m?m.forEach((function(e){!function(e,t,r,n){var i=new U;i.s=t,i.d=r,i.b=n,e.trace.push(i),e.interval||(e.interval=0),e.interval+=r}(g,e.s,e.d,e.b)})):(delete g.interval,delete g.trace),h(t,i.HTTP_REQUEST,g),g},addRepresentationSwitch:function(e,t,r,n,o){var a=new Nn;return a.t=t,a.mt=r,a.to=n,o?a.lto=o:delete a.lto,h(e,i.TRACK_SWITCH,a),a},addBufferLevel:function(e,t,r){var n=new kn;return n.t=t,n.level=r,h(e,i.BUFFER_LEVEL,n),n},addBufferState:function(e,t,r){var n=new Ln;return n.target=r,n.state=t,h(e,i.BUFFER_STATE,n),n},addDVRInfo:function(e,t,r,n){var o=new xn;return o.time=t,o.range=n,o.manifestInfo=r,h(e,i.DVR_INFO,o),o},addDroppedFrames:function(e,t){var r=new Mn,n=l(e).DroppedFrames;return r.time=t.creationTime,r.droppedFrames=t.droppedVideoFrames,n.length>0&&n[n.length-1]==r?n[n.length-1]:(h(e,i.DROPPED_FRAMES,r),r)},addSchedulingInfo:function(e,t,r,n,o,a,s,u,c){var l=new Vn;return l.mediaType=e,l.t=t,l.type=r,l.startTime=n,l.availabilityStartTime=o,l.duration=a,l.quality=s,l.range=u,l.state=c,h(e,i.SCHEDULING_INFO,l),l},addRequestsQueue:function(e,t,r){var n=new Gn;n.loadingRequests=t,n.executedRequests=r,l(e).RequestsQueue=n,c(e,i.REQUESTS_QUEUE,n)},addManifestUpdate:function(e,t,r,o,a,s,u,l,d,p){var h=new Un;return h.mediaType=e,h.type=t,h.requestTime=r,h.fetchTime=o,h.availabilityStartTime=a,h.presentationStartTime=s,h.clientTimeOffset=u,h.currentTime=l,h.buffered=d,h.latency=p,f(n.STREAM,i.MANIFEST_UPDATE,h),c(e,i.MANIFEST_UPDATE,h),h},updateManifestUpdateInfo:function(e,t){if(e){for(var r in t)e[r]=t[r];u(e.mediaType,i.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,r,n,o){if(e){var a=new Bn;return a.id=t,a.index=r,a.start=n,a.duration=o,e.streamInfo.push(a),u(e.mediaType,i.MANIFEST_UPDATE_STREAM_INFO,e),a}return null},addManifestUpdateRepresentationInfo:function(e,t,r,n,o,a,s,c){if(e){var l=new jn;return l.id=t,l.index=r,l.streamIndex=n,l.mediaType=o,l.startNumber=s,l.fragmentInfoType=c,l.presentationTimeOffset=a,e.representationInfo.push(l),u(e.mediaType,i.MANIFEST_UPDATE_TRACK_INFO,e),l}return null},addPlayList:function(e){var t=n.STREAM;return e.trace&&Array.isArray(e.trace)?e.trace.forEach((function(e){e.hasOwnProperty("subreplevel")&&!e.subreplevel&&delete e.subreplevel})):delete e.trace,h(t,i.PLAY_LIST,e),e},addDVBErrors:function(e){return h(n.STREAM,i.DVB_ERRORS,e),e},setConfig:function(e){e&&e.adapter&&e.adapter}},o={},e}Hn.__dashjs_factory_name="MetricsModel";var qn=s.a.getSingletonFactory(Hn);function Wn(){var e=void 0,t=void 0,r=void 0,n=void 0,i=this.context,o=g(i).getInstance().log,a=d(i).getInstance(),s=[];function u(){e&&(e.playbackRate=n||1,e.removeEventListener("canplay",u))}function c(){return s.length>0}function l(){if(e&&c()&&0===e.playbackRate){var t=document.createEvent("Event");t.initEvent("waiting",!0,!1),e.dispatchEvent(t)}}function f(){return e?e.buffered:null}return{initialize:function(){a.on(p.PLAYBACK_PLAYING,l,this)},setCurrentTime:function(t){if(e){if(e.currentTime==t)return;try{e.currentTime=t}catch(r){0===e.readyState&&r.code===r.INVALID_STATE_ERR&&setTimeout((function(){e.currentTime=t}),400)}}},play:function(){if(e){e.autoplay=!0;var t=e.play();return t&&"undefined"!=typeof Promise&&t instanceof Promise&&t.catch((function(e){"NotAllowedError"===e.name&&a.trigger(p.PLAYBACK_NOT_ALLOWED),o("Caught pending play exception - continuing ("+e+")")})),t}},isPaused:function(){return e?e.paused:null},pause:function(){e&&(e.pause(),e.autoplay=!1)},isSeeking:function(){return e?e.seeking:null},getTime:function(){return e?e.currentTime:null},getPlaybackRate:function(){return e?e.playbackRate:null},getPlayedRanges:function(){return e?e.played:null},getEnded:function(){return e?e.ended:null},setStallState:function(t,r){!function(t,r){r?function(t){var r=void 0;null===t||e.seeking||-1!==s.indexOf(t)||(s.push(t),e&&1===s.length&&((r=document.createEvent("Event")).initEvent("waiting",!0,!1),n=e.playbackRate,e.dispatchEvent(r)))}(t):function(t){var r,i=s.indexOf(t),o=void 0;null!==t&&(-1!==i&&s.splice(i,1),e&&!1===c()&&0===e.playbackRate&&(r=n||1,e&&(e.readyState<=2&&r>0?e.addEventListener("canplay",u):e.playbackRate=r),
e.paused||((o=document.createEvent("Event")).initEvent("playing",!0,!1),e.dispatchEvent(o))))}(t)}(t,r)},getElement:function(){return e},setElement:function(t){if(null!=t&&(!t||!t.nodeName||"VIDEO"!==t.nodeName&&"AUDIO"!==t.nodeName&&"BWP-VIDEO"!==t.nodeName))throw"element is not video or audio DOM type!";(e=t)&&(e.preload="auto")},setSource:function(t){e&&(t?e.src=t:(e.removeAttribute("src"),e.load()))},getSource:function(){return e?e.src:null},getVideoContainer:function(){return r},setVideoContainer:function(e){r=e},getTTMLRenderingDiv:function(){return t},setTTMLRenderingDiv:function(e){(t=e).style.position="absolute",t.style.display="flex",t.style.overflow="hidden",t.style.pointerEvents="none",t.style.top=0,t.style.left=0},getPlaybackQuality:function(){if(!e)return null;var t="webkitDroppedFrameCount"in e&&"webkitDecodedFrameCount"in e,r=null;return"getVideoPlaybackQuality"in e?r=e.getVideoPlaybackQuality():t&&(r={droppedVideoFrames:e.webkitDroppedFrameCount,totalVideoFrames:e.webkitDroppedFrameCount+e.webkitDecodedFrameCount,creationTime:new Date}),r},addEventListener:function(t,r){e&&e.addEventListener(t,r)},removeEventListener:function(t,r){e&&e.removeEventListener(t,r)},getReadyState:function(){return e?e.readyState:NaN},getBufferRange:f,getClientWidth:function(){return e?e.clientWidth:NaN},getClientHeight:function(){return e?e.clientHeight:NaN},getTextTracks:function(){return e?e.textTracks:[]},getTextTrack:function(t,r,n,i,o){if(e)for(var a=0;a<e.textTracks.length;a++)if(e.textTracks[a].kind===t&&(!r||e.textTracks[a].label==r)&&e.textTracks[a].language===n&&e.textTracks[a].isTTML===i&&e.textTracks[a].isEmbedded===o)return e.textTracks[a];return null},addTextTrack:function(t,r,n){return e?e.addTextTrack(t,r,n):null},appendChild:function(t){e&&(e.appendChild(t),void 0!==t.isTTML&&(e.textTracks[e.textTracks.length-1].isTTML=t.isTTML,e.textTracks[e.textTracks.length-1].isEmbedded=t.isEmbedded))},removeChild:function(t){e&&e.removeChild(t)},getVideoWidth:function(){return e?e.videoWidth:NaN},getVideoHeight:function(){return e?e.videoHeight:NaN},getVideoRelativeOffsetTop:function(){return e&&e.parentNode?e.getBoundingClientRect().top-e.parentNode.getBoundingClientRect().top:NaN},getVideoRelativeOffsetLeft:function(){return e&&e.parentNode?e.getBoundingClientRect().left-e.parentNode.getBoundingClientRect().left:NaN},setDataOffsetAttr:function(t){e&&e.setAttribute("data-offset",t)},getDuration:function(){return e?e.duration:null},getVideoBufferRanges:function(){var e=f();if(e){for(var t=[],r=e.length,n=0;n<r;n++)t.push({start:e.start(n),end:e.end(n)});return t}return[]},reset:function(){a.off(p.PLAYBACK_PLAYING,l,this)}}}Wn.__dashjs_factory_name="VideoModel";var Yn=s.a.getSingletonFactory(Wn),Kn=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],Qn="dashjs_?_bitrate",zn="dashjs_?_settings",Zn="localStorage",Jn="LastBitrate",Xn="LastMediaSettings";function $n(e){e=e||{};var t,r=this.context,n=g(r).getInstance().log,i=e.mediaPlayerModel,o=void 0;function a(e){if(void 0!==o)return o;o=!1;var t=void 0;try{"undefined"!=typeof window&&(t=window[e])}catch(e){return n("Warning: DOMStorage access denied: "+e.message),o}if(!t||e!==Zn&&"sessionStorage"!==e)return o;try{t.setItem("1","1"),t.removeItem("1"),o=!0}catch(e){n("Warning: DOMStorage is supported, but cannot be used: "+e.message)}return o}function s(){var e=6e5;return Math.round((new Date).getTime()/e)*e}function u(e,t){return a(e)&&i["get"+t+"CachingInfo"]().enabled}function c(){if(!i||!i.hasOwnProperty("getLastMediaSettingsCachingInfo"))throw new Error("Missing config parameter(s)")}return t={getSavedBitrateSettings:function(e){var t=NaN;if(c(),u(Zn,Jn)){var r=Qn.replace(/\?/,e);try{var o=JSON.parse(localStorage.getItem(r))||{},a=(new Date).getTime()-parseInt(o.timestamp,10)>=i.getLastMediaSettingsCachingInfo().ttl||!1,s=parseFloat(o.bitrate);isNaN(s)||a?a&&localStorage.removeItem(r):(t=s,n("Last saved bitrate for "+e+" was "+s))}catch(e){return null}}return t},setSavedBitrateSettings:function(e,t){if(u(Zn,Jn)&&t){var r=Qn.replace(/\?/,e);try{localStorage.setItem(r,JSON.stringify({bitrate:t.toFixed(3),timestamp:s()}))}catch(e){n(e.message)}}},getSavedMediaSettings:function(e){if(c(),!u(Zn,Xn))return null;var t=null,r=zn.replace(/\?/,e);try{var n=JSON.parse(localStorage.getItem(r))||{},o=(new Date).getTime()-parseInt(n.timestamp,10)>=i.getLastMediaSettingsCachingInfo().ttl||!1;t=n.settings,o&&(localStorage.removeItem(r),t=null)}catch(e){return null}return t},setSavedMediaSettings:function(e,t){if(u(Zn,Xn)){var r=zn.replace(/\?/,e);try{localStorage.setItem(r,JSON.stringify({settings:t,timestamp:s()}))}catch(e){n(e.message)}}}},a(Zn)&&Kn.forEach((function(e){var t=localStorage.getItem(e.oldKey);if(t){localStorage.removeItem(e.oldKey);try{localStorage.setItem(e.newKey,t)}catch(e){n(e.message)}}})),t}$n.__dashjs_factory_name="DOMStorage";var ei=s.a.getSingletonFactory($n),ti=r(5),ri=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},ni=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null},ii=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0},oi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.DVRWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null},ai=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},si=r(15),ui=r.n(si);function ci(){var e,t=void 0,r=void 0,i=void 0;function o(e,t){return t&&e?t.getRepresentationForQuality(e.quality):null}function a(e){return e&&e.streamInfo&&void 0!==e.streamInfo.id&&i[e.streamInfo.id]?i[e.streamInfo.id][e.index]:null}function s(e,t){for(var r=t.length,n=0;n<r;n++){var i=t[n];if(e.id===i.id)return i}return null}function u(e){var r=new ri,n=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],i=t.getRepresentationFor(e.index,n);return r.id=e.id,r.quality=e.index,r.bandwidth=t.getBandwidth(i),r.DVRWindow=e.segmentAvailabilityRange,r.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),r.MSETimeOffset=e.MSETimeOffset,r.useCalculatedLiveEdgeTime=e.useCalculatedLiveEdgeTime,r.mediaInfo=c(e.adaptation),r}function c(e){var r,n=new ni,i=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];return n.id=e.id,n.index=e.index,n.type=e.type,n.streamInfo=d(e.period),n.representationCount=t.getRepresentationCount(i),n.lang=t.getLanguageForAdaptation(i),r=t.getViewpointForAdaptation(i),n.viewpoint=r?r.value:void 0,n.accessibility=t.getAccessibilityForAdaptation(i).map((function(e){var t=e.value,r=t;return e.schemeIdUri&&e.schemeIdUri.search("cea-608")>=0&&void 0!==ui.a&&(r=t?"cea-608:"+t:"cea-608",n.embeddedCaptions=!0),r})),n.audioChannelConfiguration=t.getAudioChannelConfigurationForAdaptation(i).map((function(e){return e.value})),n.roles=t.getRolesForAdaptation(i).map((function(e){return e.value})),n.codec=t.getCodec(i),n.mimeType=t.getMimeType(i),
n.contentProtection=t.getContentProtectionData(i),n.bitrateList=t.getBitrateListForAdaptation(i),n.contentProtection&&n.contentProtection.forEach((function(e){e.KID=t.getKID(e)})),n.isText=t.getIsTextTrack(n.mimeType),n}function l(e,t,r){e.id=t,e.index=100+parseInt(t.substring(2,3)),e.type=n.EMBEDDED_TEXT,e.codec="cea-608-in-SEI",e.isText=!0,e.isEmbedded=!0,e.lang=r,e.roles=["caption"]}function d(e){var r,n,i=new ii;return i.id=e.id,i.index=e.index,i.start=e.start,i.duration=e.duration,i.manifestInfo=(r=e.mpd,(n=new oi).DVRWindowSize=r.timeShiftBufferDepth,n.loadedTime=r.manifest.loadedTime,n.availableFrom=r.availabilityStartTime,n.minBufferTime=r.manifest.minBufferTime,n.maxFragmentDuration=r.maxSegmentDuration,n.duration=t.getDuration(r.manifest),n.isDynamic=t.getIsDynamic(r.manifest),n),i.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(i.start+i.duration-i.manifestInfo.duration)<1,i}function f(){if(!t||!t.hasOwnProperty("getMpd")||!t.hasOwnProperty("getRegularPeriods"))throw new Error("setConfig function has to be called previously")}function p(e){if(!(e&&e.hasOwnProperty("getRepresentationController")&&e.hasOwnProperty("getIndexHandler")&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getType")&&e.hasOwnProperty("getStreamInfo")))throw new Error("streamProcessor parameter is missing or malformed!")}function h(e){if(!e||!e.hasOwnProperty("getRepresentationForQuality")||!e.hasOwnProperty("getCurrentRepresentation"))throw new Error("representationController parameter is missing or malformed!")}function y(e){if(null===e||isNaN(e)||e%1!=0)throw new Error("quality argument is not an integer")}function m(){r=[],i={}}return e={convertDataToRepresentationInfo:u,getDataForMedia:a,getStreamsInfo:function(e,n){var i=[],o=r;if(e){f();var a=t.getMpd(e);o=t.getRegularPeriods(a)}n||(n=o.length);for(var s=0;s<n;s++)i.push(d(o[s]));return i},getMediaInfoForType:function(e,n){if(0===r.length)return null;var o=r[0].mpd.manifest,a=t.getAdaptationForType(o,e.index,n,e);if(!a)return null;var u=s(e,r),l=u.id,d=t.getIndexForAdaptation(a,o,e.index);return i[l]=i[l]||t.getAdaptationsForPeriod(u),c(i[l][d])},getAllMediaInfoForType:function(e,o,a){var u,d=r,p=a,h=[],y=void 0,m=void 0,g=void 0,v=void 0,_=void 0;if(p){f();var E=t.getMpd(p);d=t.getRegularPeriods(E)}else{if(!(r.length>0))return h;p=r[0].mpd.manifest}var b=s(e,d),S=b.id,T=t.getAdaptationsForType(p,e.index,o!==n.EMBEDDED_TEXT?o:n.VIDEO);if(!T)return h;for(i[S]=i[S]||t.getAdaptationsForPeriod(b),v=0,u=T.length;v<u;v++)if(y=T[v],g=t.getIndexForAdaptation(y,p,e.index),m=c(i[S][g]),o===n.EMBEDDED_TEXT){var w=m.accessibility.length;for(_=0;_<w;_++)if(m){var A=m.accessibility[_];if(0===A.indexOf("cea-608:")){var R=A.substring(8).split(";");if("CC"===R[0].substring(0,2))for(_=0;_<R.length;_++)m||(m=c.call(this,i[S][g])),l(m,R[_].substring(0,3),R[_].substring(4)),h.push(m),m=null;else for(_=0;_<R.length;_++)m||(m=c.call(this,i[S][g])),l(m,"CC"+(_+1),R[_]),h.push(m),m=null}else 0===A.indexOf("cea-608")&&(l(m,n.CC1,"eng"),h.push(m),m=null)}}else o===n.IMAGE?(m.type=n.IMAGE,h.push(m),m=null):m&&h.push(m);return h},getCurrentRepresentationInfo:function(e){h(e);var t=e.getCurrentRepresentation();return t?u(t):null},getRepresentationInfoForQuality:function(e,t){h(e),y(t);var r=e.getRepresentationForQuality(t);return r?u(r):null},updateData:function(e){p(e);var n,i=s(e.getStreamInfo(),r),o=e.getMediaInfo(),u=a(o),c=e.getType(),l=void 0;n=o?o.id:null,r.length>0&&(l=n?t.getAdaptationForId(n,r[0].mpd.manifest,i.index):t.getAdaptationForIndex(o.index,r[0].mpd.manifest,i.index),e.getRepresentationController().updateData(l,u,c))},getInitRequest:function(e,t){var r,n=void 0,i=void 0;return p(e),y(t),n=e.getRepresentationController(),i=e.getIndexHandler(),r=n?n.getRepresentationForQuality(t):null,i?i.getInitRequest(r):null},getNextFragmentRequest:function(e,t){var r,n=void 0;return p(e),r=o(t,e.getRepresentationController()),(n=e.getIndexHandler())?n.getNextSegmentRequest(r):null},getFragmentRequestForTime:function(e,t,r,n){var i,a=void 0;return p(e),i=o(t,e.getRepresentationController()),(a=e.getIndexHandler())?a.getSegmentRequestForTime(i,r,n):null},generateFragmentRequestForTime:function(e,t,r){var n,i=void 0;return p(e),n=o(t,e.getRepresentationController()),(i=e.getIndexHandler())?i.generateSegmentRequestForTime(n,r):null},getIndexHandlerTime:function(e){p(e);var t=e.getIndexHandler();return t?t.getCurrentTime():NaN},setIndexHandlerTime:function(e,t){p(e);var r=e.getIndexHandler();r&&r.setCurrentTime(t)},getEventsFor:function(e,n){var i=[];if(0===r.length)return i;var u=r[0].mpd.manifest;return e instanceof ii?i=t.getEventsForPeriod(s(e,r)):e instanceof ni?i=t.getEventStreamForAdaptationSet(u,a(e)):e instanceof ri&&(i=t.getEventStreamForRepresentation(u,o(e,n.getRepresentationController()))),i},getEvent:function(e,t,r){if(!e||!t)return null;var n=new ai,i=e.scheme_id_uri,o=e.value,a=e.timescale,s=e.presentation_time_delta,u=e.event_duration,c=e.id,l=e.message_data,d=r*a+s;return t[i]?(n.eventStream=t[i],n.eventStream.value=o,n.eventStream.timescale=a,n.duration=u,n.id=c,n.presentationTime=d,n.messageData=l,n.presentationTimeDelta=s,n):null},setConfig:function(e){e&&e.dashManifestModel&&(t=e.dashManifestModel)},updatePeriods:function(e){if(!e)return null;f();var n=t.getMpd(e);r=t.getRegularPeriods(n),i={}},reset:m},m(),e}ci.__dashjs_factory_name="DashAdapter";var li=s.a.getSingletonFactory(ci),di=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.period=null,this.index=-1,this.type=null},fi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null};fi.DEFAULT_ID="defaultId";var pi=fi,hi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN},yi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""};function mi(e){e=e||{};var t=this.context,r=rt(t).getInstance(),i=e.mediaController,o=e.timelineConverter,s=e.adapter,u=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function c(e,t){var r=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=!1,c=!1;if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.hasOwnProperty("ContentComponent_asArray")&&e.ContentComponent_asArray,a=t!==n.TEXT?new RegExp(t):new RegExp("(vtt|ttml)"),e.Representation_asArray&&e.Representation_asArray.length&&e.Representation_asArray.length>0&&e.Representation_asArray[0].hasOwnProperty(Je.CODECS)&&(0===(s=e.Representation_asArray[0].codecs).search(n.STPP)||0===s.search(n.WVTT)))return t===n.FRAGMENTED_TEXT;if(e.hasOwnProperty(Je.MIME_TYPE)&&(u=a.test(e.mimeType),c=!0),!c)for(r=0,i=e.Representation_asArray&&e.Representation_asArray.length?e.Representation_asArray.length:0;!c&&r<i;)(o=e.Representation_asArray[r]).hasOwnProperty(Je.MIME_TYPE)&&(u=a.test(o.mimeType),c=!0),r++;return u}function l(e){return c(e,n.AUDIO)}function d(e){return c(e,n.VIDEO)}function f(e){return c(e,n.FRAGMENTED_TEXT)}function p(e){return c(e,n.MUXED)}function h(e){return c(e,n.IMAGE)}function y(e){return"text/vtt"===e||"application/ttml+xml"===e}function m(e){return e&&e.hasOwnProperty(Je.ROLE_ASARRAY)?e.Role_asArray:[]}function g(e){return m(e).filter((function(e){return e.value===Je.MAIN}))[0]}function v(e){return e&&void 0!==e.Representation_asArray&&null!==e.Representation_asArray&&e.Representation_asArray.sort((function(e,t){return e.bandwidth-t.bandwidth})),e}function _(e,t,r){
var n,i=e&&e.Period_asArray&&u(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[],o=void 0,a=[];for(o=0,n=i.length;o<n;o++)c(i[o],r)&&a.push(v(i[o]));return a}function E(e){var t=!1;return e&&e.hasOwnProperty("type")&&(t=e.type===Je.DYNAMIC),t}function b(e){return e&&e.EssentialProperty_asArray&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map((function(e){return{schemeIdUri:e.schemeIdUri,value:e.value}})):null}function S(e){if(e&&e.period&&u(e.period.index)){var t=e.period.mpd.manifest.Period_asArray[e.period.index];if(t&&t.AdaptationSet_asArray&&u(e.index))return v(t.AdaptationSet_asArray[e.index])}}function T(e){var t=e.S_asArray[e.S_asArray.length-1];return!t.hasOwnProperty("r")||t.r>=0}function w(e,t){if(!e)throw new Error("Period cannot be null or undefined");var r=pi.DEFAULT_ID+"_"+t;return e.hasOwnProperty(Je.ID)&&e.id.length>0&&"__proto__"!==e.id&&(r=e.id),r}function A(e,t){var r=[],i=void 0;if(!e)return r;for(i=0;i<e.length;i++){var o=new yi;if(o.timescale=1,o.representation=t,!e[i].hasOwnProperty(n.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");o.schemeIdUri=e[i].schemeIdUri,e[i].hasOwnProperty(Je.TIMESCALE)&&(o.timescale=e[i].timescale),e[i].hasOwnProperty(Je.VALUE)&&(o.value=e[i].value),r.push(o)}return r}function R(e){var t=[],n=e.BaseURL_asArray||[e.baseUri],i=!1;return n.some((function(n){if(n){var o=new xr,a=n.__text||n;r.isRelative(a)&&(i=!0,e.baseUri&&(a=r.resolve(a,e.baseUri))),o.url=a;for(var s=[],u=1;n["backupUrl"+u];u++)s.push(n["backupUrl"+u]);return o.urls=[o.url].concat(s),n.hasOwnProperty(Je.SERVICE_LOCATION)&&n.serviceLocation.length?o.serviceLocation=n.serviceLocation:o.serviceLocation=a,n.hasOwnProperty(Je.DVB_PRIORITY)&&(o.dvb_priority=n[Je.DVB_PRIORITY]),n.hasOwnProperty(Je.DVB_WEIGHT)&&(o.dvb_weight=n[Je.DVB_WEIGHT]),n.hasOwnProperty(Je.AVAILABILITY_TIME_OFFSET)&&(o.availabilityTimeOffset=n[Je.AVAILABILITY_TIME_OFFSET]),n.hasOwnProperty(Je.AVAILABILITY_TIME_COMPLETE)&&(o.availabilityTimeComplete="false"!==n[Je.AVAILABILITY_TIME_COMPLETE]),t.push(o),i}})),t}return{getIsTypeOf:c,getIsAudio:l,getIsVideo:d,getIsText:function(e){return c(e,n.TEXT)},getIsMuxed:p,getIsTextTrack:y,getIsFragmentedText:f,getIsImage:h,getIsMain:g,getLanguageForAdaptation:function(e){var t="";return e&&e.hasOwnProperty(Je.LANG)&&(t=e.lang.replace(/[^A-Za-z0-9-]/g,"")),t},getViewpointForAdaptation:function(e){return e&&e.hasOwnProperty(Je.VIEWPOINT)?e.Viewpoint:null},getRolesForAdaptation:m,getAccessibilityForAdaptation:function(e){return e&&e.hasOwnProperty(Je.ACCESSIBILITY_ASARRAY)?e.Accessibility_asArray:[]},getAudioChannelConfigurationForAdaptation:function(e){return e&&e.hasOwnProperty(Je.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]},getAdaptationForIndex:function(e,t,r){var n=t&&t.Period_asArray&&u(r)&&t.Period_asArray[r]?t.Period_asArray[r].AdaptationSet_asArray:null;return n&&u(e)?n[e]:null},getIndexForAdaptation:function(e,r,n){var i=r&&r.Period_asArray&&u(n)&&r.Period_asArray[n]?r.Period_asArray[n].AdaptationSet_asArray:[],o=i.length;if(e)for(var a=0;a<o;a++)if(br(t).getInstance().areEqual(i[a],e))return a;return-1},getAdaptationForId:function(e,t,r){var n,i=t&&t.Period_asArray&&u(r)&&t.Period_asArray[r]?t.Period_asArray[r].AdaptationSet_asArray:[],o=void 0;for(o=0,n=i.length;o<n;o++)if(i[o].hasOwnProperty(Je.ID)&&i[o].id===e)return i[o];return null},getAdaptationsForType:_,getAdaptationForType:function(e,t,r,n){var o=_(e,t,r);if(!o||0===o.length)return null;if(o.length>1&&n){var a=i.getCurrentTrackFor(r,n),u=s.getAllMediaInfoForType(n,r);if(a)for(var c=0,l=o.length;c<l;c++)if(i.isTracksEqual(a,u[c]))return o[c];for(var d=0,f=o.length;d<f;d++)if(g(o[d]))return o[d]}return o[0]},getCodec:function(e,t,r){if(e&&e.Representation_asArray&&e.Representation_asArray.length>0){var n=u(t)&&t>=0&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0],i=n.mimeType+';codecs="'+n.codecs+'"';return r&&void 0!==n.width&&(i+=';width="'+n.width+'";height="'+n.height+'"'),i}return null},getMimeType:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length>0?e.Representation_asArray[0].mimeType:null},getKID:function(e){return e&&e.hasOwnProperty(Je.CENC_DEFAULT_KID)?e[Je.CENC_DEFAULT_KID]:null},getContentProtectionData:function(e){return e&&e.hasOwnProperty(Je.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:E,getIsDVB:function(e){return function(e,t){var r=!1;return e&&e.profiles&&e.profiles.length>0&&(r=-1!==e.profiles.indexOf("urn:dvb:dash:profile:dvb-dash:2014")),r}(e)},getDuration:function(e){return e&&e.hasOwnProperty(Je.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE},getBandwidth:function(e){return e&&e.bandwidth?e.bandwidth:NaN},getManifestUpdatePeriod:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=NaN;return e&&e.hasOwnProperty(Je.MINIMUM_UPDATE_PERIOD)&&(r=e.minimumUpdatePeriod),isNaN(r)?r:Math.max(r-t,1)},getRepresentationCount:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length?e.Representation_asArray.length:0},getBitrateListForAdaptation:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length?v(e).Representation_asArray.map((function(e){return{id:e.id||"",bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanType:e.scanType||null}})):null},getRepresentationFor:function(e,t){return t&&t.Representation_asArray&&t.Representation_asArray.length>0&&u(e)?t.Representation_asArray[e]:null},getRepresentationsForAdaptation:function(e){var t=[],r=S(e),n=void 0,i=void 0;if(e&&e.period&&u(e.period.index)){var a=R(e.period.mpd.manifest);a&&(i=a[0])}if(r&&r.Representation_asArray)for(var s=0,c=r.Representation_asArray.length;s<c;++s){var l=r.Representation_asArray[s],d=new Xe;if(d.index=s,d.adaptation=e,l.hasOwnProperty(Je.ID)&&(d.id=l.id),l.hasOwnProperty(Je.CODECS)&&(d.codecs=l.codecs),l.hasOwnProperty(Je.CODEC_PRIVATE_DATA)&&(d.codecPrivateData=l.codecPrivateData),l.hasOwnProperty(Je.BANDWITH)&&(d.bandwidth=l.bandwidth),l.hasOwnProperty(Je.WIDTH)&&(d.width=l.width),l.hasOwnProperty(Je.HEIGHT)&&(d.height=l.height),l.hasOwnProperty(Je.SCAN_TYPE)&&(d.scanType=l.scanType),l.hasOwnProperty(Je.MAX_PLAYOUT_RATE)&&(d.maxPlayoutRate=l.maxPlayoutRate),l.hasOwnProperty(Je.SEGMENT_BASE)?(n=l.SegmentBase,d.segmentInfoType=Je.SEGMENT_BASE):l.hasOwnProperty(Je.SEGMENT_LIST)?(n=l.SegmentList).hasOwnProperty(Je.SEGMENT_TIMELINE)?(d.segmentInfoType=Je.SEGMENT_TIMELINE,d.useCalculatedLiveEdgeTime=T(n.SegmentTimeline)):(d.segmentInfoType=Je.SEGMENT_LIST,d.useCalculatedLiveEdgeTime=!0):l.hasOwnProperty(Je.SEGMENT_TEMPLATE)?((n=l.SegmentTemplate).hasOwnProperty(Je.SEGMENT_TIMELINE)?(d.segmentInfoType=Je.SEGMENT_TIMELINE,d.useCalculatedLiveEdgeTime=T(n.SegmentTimeline)):d.segmentInfoType=Je.SEGMENT_TEMPLATE,n.hasOwnProperty(Je.INITIALIZATION_MINUS)&&(d.initialization=n.initialization.split("$Bandwidth$").join(l.bandwidth).split("$RepresentationID$").join(l.id))):d.segmentInfoType=Je.BASE_URL,d.essentialProperties=b(l),n){if(n.hasOwnProperty(Je.INITIALIZATION)){var f=n.Initialization;f.hasOwnProperty(Je.SOURCE_URL)?d.initialization=f.sourceURL:f.hasOwnProperty(Je.RANGE)&&(d.range=f.range)}else l.hasOwnProperty(Je.MIME_TYPE)&&y(l.mimeType)&&(d.range=0);n.hasOwnProperty(Je.TIMESCALE)&&(d.timescale=n.timescale),n.hasOwnProperty(Je.DURATION)&&(d.segmentDuration=n.duration/d.timescale),n.hasOwnProperty(Je.MEDIA)&&(d.media=n.media),n.hasOwnProperty(Je.START_NUMBER)&&(d.startNumber=n.startNumber),n.hasOwnProperty(Je.INDEX_RANGE)&&(d.indexRange=n.indexRange),n.hasOwnProperty(Je.PRESENTATION_TIME_OFFSET)&&(d.presentationTimeOffset=n.presentationTimeOffset/d.timescale),n.hasOwnProperty(Je.AVAILABILITY_TIME_OFFSET)?d.availabilityTimeOffset=n.availabilityTimeOffset:i&&void 0!==i.availabilityTimeOffset&&(d.availabilityTimeOffset=i.availabilityTimeOffset),
n.hasOwnProperty(Je.AVAILABILITY_TIME_COMPLETE)?d.availabilityTimeComplete="false"!==n.availabilityTimeComplete:i&&void 0!==i.availabilityTimeComplete&&(d.availabilityTimeComplete=i.availabilityTimeComplete)}d.MSETimeOffset=o.calcMSETimeOffset(d),d.path=[e.period.index,e.index,s],t.push(d)}return t},getAdaptationsForPeriod:function(e){var t=e&&u(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,r=[],i=void 0,o=void 0,a=void 0;if(t&&t.AdaptationSet_asArray)for(a=0;a<t.AdaptationSet_asArray.length;a++)o=t.AdaptationSet_asArray[a],i=new di,o.hasOwnProperty(Je.ID)&&(i.id=o.id),i.index=a,i.period=e,p(o)?i.type=n.MUXED:l(o)?i.type=n.AUDIO:d(o)?i.type=n.VIDEO:f(o)?i.type=n.FRAGMENTED_TEXT:h(o)?i.type=n.IMAGE:i.type=n.TEXT,r.push(i);return r},getRegularPeriods:function(e){var t,r=!!e&&E(e.manifest),n=[],i=null,o=null,a=null,s=null,u=void 0;for(u=0,t=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;u<t;u++)(o=e.manifest.Period_asArray[u]).hasOwnProperty(Je.START)?(s=new pi).start=o.start:null!==i&&o.hasOwnProperty(Je.DURATION)&&null!==a?((s=new pi).start=parseFloat((a.start+a.duration).toFixed(5)),s.duration=o.duration):0!==u||r||((s=new pi).start=0),null!==a&&isNaN(a.duration)&&(a.duration=parseFloat((s.start-a.start).toFixed(5))),null!==s&&(s.id=w(o,u)),null!==s&&o.hasOwnProperty(Je.DURATION)&&(s.duration=o.duration),null!==s&&(s.index=u,s.mpd=e,n.push(s),i=o,a=s),o=null,s=null;return 0===n.length||null!==a&&isNaN(a.duration)&&(a.duration=parseFloat((function(e){var t=E(e.mpd.manifest),r=void 0;if(e.mpd.manifest.mediaPresentationDuration)r=e.mpd.manifest.mediaPresentationDuration;else if(e.duration)r=e.duration;else{if(!t)throw new Error("Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.");r=Number.POSITIVE_INFINITY}return r}(a)-a.start).toFixed(5))),n},getMpd:function(e){var t=new hi;return e&&(t.manifest=e,e.hasOwnProperty(Je.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):t.availabilityStartTime=new Date(e.loadedTime.getTime()),e.hasOwnProperty(Je.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty(Je.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty(Je.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(n.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty(Je.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty(Je.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration)),t},getEventsForPeriod:function(e){var t=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,r=t?t.Period_asArray:null,i=r&&e&&u(e.index)?r[e.index].EventStream_asArray:null,o=[],a=void 0,s=void 0;if(i)for(a=0;a<i.length;a++){var c=new yi;if(c.period=e,c.timescale=1,!i[a].hasOwnProperty(n.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(c.schemeIdUri=i[a].schemeIdUri,i[a].hasOwnProperty(Je.TIMESCALE)&&(c.timescale=i[a].timescale),i[a].hasOwnProperty(Je.VALUE)&&(c.value=i[a].value),s=0;s<i[a].Event_asArray.length;s++){var l=new ai;l.presentationTime=0,l.eventStream=c,i[a].Event_asArray[s].hasOwnProperty(Je.PRESENTATION_TIME)&&(l.presentationTime=i[a].Event_asArray[s].presentationTime),i[a].Event_asArray[s].hasOwnProperty(Je.DURATION)&&(l.duration=i[a].Event_asArray[s].duration),i[a].Event_asArray[s].hasOwnProperty(Je.ID)&&(l.id=i[a].Event_asArray[s].id),o.push(l)}}return o},getEventStreamForAdaptationSet:function(e,t){var r=void 0,n=void 0,i=void 0;return e&&e.Period_asArray&&t&&t.period&&u(t.period.index)&&(n=e.Period_asArray[t.period.index])&&n.AdaptationSet_asArray&&u(t.index)&&(i=n.AdaptationSet_asArray[t.index])&&(r=i.InbandEventStream_asArray),A(r,null)},getEventStreamForRepresentation:function(e,t){var r=void 0,n=void 0,i=void 0,o=void 0;return e&&e.Period_asArray&&t&&t.adaptation&&t.adaptation.period&&u(t.adaptation.period.index)&&(n=e.Period_asArray[t.adaptation.period.index])&&n.AdaptationSet_asArray&&u(t.adaptation.index)&&(i=n.AdaptationSet_asArray[t.adaptation.index])&&i.Representation_asArray&&u(t.index)&&(o=i.Representation_asArray[t.index])&&(r=o.InbandEventStream_asArray),A(r,t)},getUTCTimingSources:function(e){var t=E(e),r=!!e&&e.hasOwnProperty(Je.AVAILABILITY_START_TIME),i=e?e.UTCTiming_asArray:null,o=[];return(t||r)&&i&&i.forEach((function(e){var t=new a;e.hasOwnProperty(n.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty(Je.VALUE)&&(t.value=e.value.toString(),o.push(t)))})),o},getBaseURLsFromElement:R,getRepresentationSortFunction:function(){return function(e,t){return e.bandwidth-t.bandwidth}},getLocation:function(e){if(e&&e.hasOwnProperty(n.LOCATION))return e.Location=e.Location_asArray[0],e.Location},getUseCalculatedLiveEdgeTimeForAdaptation:function(e){var t=S(e).Representation_asArray[0],r=void 0;return t.hasOwnProperty(Je.SEGMENT_LIST)?!(r=t.SegmentList).hasOwnProperty(Je.SEGMENT_TIMELINE)||T(r.SegmentTimeline):!(!t.hasOwnProperty(Je.SEGMENT_TEMPLATE)||!(r=t.SegmentTemplate).hasOwnProperty(Je.SEGMENT_TIMELINE))&&T(r.SegmentTimeline)}}}mi.__dashjs_factory_name="DashManifestModel";var gi=s.a.getSingletonFactory(mi),vi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.round10=function(e,t){return function(e,t,r){return void 0===r||0==+r?Math[e](t):(r=+r,null===(t=+t)||isNaN(t)||"number"!=typeof r||r%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-r:-r)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+r:r))))}("round",e,t)},e}();function _i(e){var t=(e=e||{}).dashManifestModel,r=e.manifestModel;function n(e){return s(e,i.BUFFER_LEVEL)}function o(e){if(!e)return null;var t=e.HttpList,r=null,n=void 0;if(!t||t.length<=0)return null;for(n=t.length-1;n>=0;){if(t[n].responsecode){r=t[n];break}n--}return r}function a(e){return e&&e.HttpList?e.HttpList:[]}function s(e,t){if(!e)return null;var r=e[t];if(!r)return null;var n=r.length;return n<=0?null:r[n-1]}function u(e){var t={};if(!e)return t;for(var r=e.trim().split("\r\n"),n=0,i=r.length;n<i;n++){var o=r[n],a=o.indexOf(": ");a>0&&(t[o.substring(0,a)]=o.substring(a+2))}return t}function c(e,t,r){var n=void 0,i=void 0,o=void 0,a=void 0,s=void 0;if(e)for(n=e.AdaptationSet_asArray,a=0;a<n.length;a+=1)for(o=n[a].Representation_asArray,s=0;s<o.length;s+=1)if(t===(i=o[s]).id)return r?s:i;return null}function l(e,r){return t.getIsTypeOf(e,r)}return{getBandwidthForRepresentation:function(e,t){var n;return null===(n=c(r.getValue().Period_asArray[t],e))?null:n.bandwidth},getIndexForRepresentation:function(e,t){return function(e,t){var r=c(e,t,!0);return null!==r?r:-1}(r.getValue().Period_asArray[t],e)},getMaxIndexForBufferType:function(e,t){var n=r.getValue();return n?function(e,t){var r,n=void 0,i=void 0,o=void 0;if(!e||!t)return-1;for(r=e.AdaptationSet_asArray,o=0;o<r.length;o+=1)if(i=(n=r[o]).Representation_asArray,l(n,t))return i.length;return-1}(n.Period_asArray[t],e):-1},getCurrentRepresentationSwitch:function(e){return s(e,i.TRACK_SWITCH)},getLatestBufferLevelVO:n,getCurrentBufferLevel:function(e){var t=n(e);return t?vi.round10(t.level/1e3,-3):0},getCurrentHttpRequest:o,getHttpRequests:a,getCurrentDroppedFrames:function(e){return s(e,i.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(e){return s(e,i.SCHEDULING_INFO)},getCurrentDVRInfo:function(e){return s(e,i.DVR_INFO)},getCurrentManifestUpdate:function(e){return s(e,i.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(e,t){var r={},n=o(e);return n&&(r=u(n._responseHeaders)),void 0===r[t]?null:r[t]},getLatestMPDRequestHeaderValueByID:function(e,t){var r,n={},i=void 0,o=void 0;for(o=(r=a(e)).length-1;o>=0;o--)if((i=r[o]).type===F.MPD_TYPE){n=u(i._responseHeaders);break}return void 0===n[t]?null:n[t]},getRequestsQueue:function(e){return e?e.RequestsQueue:null}}}_i.__dashjs_factory_name="DashMetrics";var Ei=s.a.getSingletonFactory(_i);function bi(){var e=this.context,t=d(e).getInstance(),r=void 0,n=void 0,i=void 0;function o(e){r=e}
function a(e,t,n,i){return i?n&&t.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(t.availabilityStartTime.getTime()+1e3*(e+t.timeShiftBufferDepth)):t.availabilityEndTime:n?new Date(t.availabilityStartTime.getTime()+1e3*(e-r)):t.availabilityStartTime}function s(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*r)/1e3}function u(e){n||void 0!==e.offset&&(o(e.offset/1e3),n=!0)}function c(){r=0,n=!1,i=NaN}return{initialize:function(){c(),t.on(p.TIME_SYNCHRONIZATION_COMPLETED,u,this)},isTimeSyncCompleted:function(){return n},setTimeSyncCompleted:function(e){n=e},getClientTimeOffset:function(){return r},setClientTimeOffset:o,getExpectedLiveEdge:function(){return i},setExpectedLiveEdge:function(e){i=e},calcAvailabilityStartTimeFromPresentationTime:function(e,t,r){return a.call(this,e,t,r)},calcAvailabilityEndTimeFromPresentationTime:function(e,t,r){return a.call(this,e,t,r,!0)},calcPresentationTimeFromWallTime:s,calcPresentationTimeFromMediaTime:function(e,t){return e+(t.adaptation.period.start-t.presentationTimeOffset)},calcPeriodRelativeTimeFromMpdRelativeTime:function(e,t){return t-e.adaptation.period.start},calcMediaTimeFromPresentationTime:function(e,t){return e-t.adaptation.period.start+t.presentationTimeOffset},calcSegmentAvailabilityRange:function(e,t){var r=e.adaptation.period,i={start:r.start,end:r.start+r.duration};if(!t)return i;if(!n&&e.segmentAvailabilityRange)return e.segmentAvailabilityRange;var o=e.segmentDuration||(e.segments&&e.segments.length?e.segments[e.segments.length-1].duration:0),a=s(new Date,r),u=r.start+r.duration;i.start=Math.max(a-r.mpd.timeShiftBufferDepth,r.start);var c=void 0!==e.availabilityTimeOffset&&e.availabilityTimeOffset<o?o-e.availabilityTimeOffset:o;return i.end=a>=u&&a-c<u?u:a-c,i},calcWallTimeForSegment:function(e,t){var r=void 0,n=void 0,i=void 0;return t&&(r=e.representation.adaptation.period.mpd.suggestedPresentationDelay,n=e.presentationStartTime+r,i=new Date(e.availabilityStartTime.getTime()+1e3*n)),i},calcMSETimeOffset:function(e){var t=e.presentationTimeOffset;return e.adaptation.period.start-t},reset:function(){t.off(p.TIME_SYNCHRONIZATION_COMPLETED,u,this),c()}}}bi.__dashjs_factory_name="TimelineConverter";var Si=s.a.getSingletonFactory(bi),Ti=r(8),wi=r.n(Ti);function Ai(){var e="You must first call initialize() and set a source before calling this method",t="You must first call initialize() and set a valid source and view before calling this method",r="You must first call attachView() to set the video element before calling this method",u="You must first call attachSource() with a valid source before calling this method",c="MediaPlayer not initialized!",l=this.context,f=d(l).getInstance(),h=g(l).getInstance(),y=h.log,m=NaN,v=void 0,_=void 0,E=void 0,b=void 0,S=void 0,T=void 0,w=void 0,A=void 0,R=void 0,P=void 0,D=void 0,I=void 0,O=void 0,C=void 0,N=void 0,k=void 0,L=void 0,x=void 0,M=void 0,U=void 0,B=void 0,j=void 0,V=void 0,G=void 0,H=void 0,q=void 0,W=void 0,Y=void 0,K=void 0,Q=void 0,z=void 0,Z=void 0,J=void 0,X=void 0,$=void 0,ee={video:{},audio:{}},te={min:0,video:0,audio:0},re=null,ne={};function ie(){if(te.min&&U&&U.getDuration()>te.min&&Math.abs(U.getDuration()-te.min)>=1&&M)try{var e=+("0."+((te.min+"").split(".")[1]||0)),t=e<.1?0:e>=.1?.1:+(e-.03).toFixed(2);t&&t>0&&!isNaN(t)&&(M.setMediaDuration(te.min-t),M.setAppendWindowEnd(te.min-t),k.setDeviationReset(!0))}catch(e){}}function ae(){return!!_&&!!G.getElement()}function se(){return Object(ti.a)()}function ue(){if(!T)throw t;return U.isPaused()}function ce(e){var t=[n.VIDEO,n.AUDIO,n.FRAGMENTED_TEXT];if(e)return-1!==t.indexOf(e)?_e().getCurrentBufferLevel(Ee(e))||NaN:(y("Warning  - getBufferLength requested for invalid type"),NaN);var r=t.map((function(e){return Te(e).length>0?_e().getCurrentBufferLevel(Ee(e)):Number.MAX_VALUE})).reduce((function(e,t){return Math.min(e,t)}));return r===Number.MAX_VALUE?NaN:r}function le(e){var t=De(),r=U.getLiveDelay();if(!t)return 0;var n=t.range.start+e;return n>t.range.end-r&&(n=t.range.end-r),n}function de(e,r){if(!T)throw t;var n=be().currentTime;if(void 0!==e)n=M.getTimeRelativeToStreamId(n,e);else if(U.getIsDynamic()){var i=De();n=null===i?0:fe()-(i.range.end-i.time)}var o=k.getCachedDurationOffset("time");return r&&n-o>0&&(n-=o,n=Math.min(n,fe(void 0))),parseFloat(n.toFixed(5))}function fe(e){if(!T)throw t;var r=be().duration;if(U.getIsDynamic()){var n,i=De();if(!i)return 0;r=(n=i.range.end-i.range.start)<i.manifestInfo.DVRWindowSize?n:i.manifestInfo.DVRWindowSize}if(e){var o=be().currentTime,a=k.getCachedDurationOffset("time"),s=k.getCachedDurationOffset("offset");a?o>a&&(r=o<s?s-a:r-s):r=s?Math.min(r,s):r,r=parseFloat(r.toFixed(5))}return r}function he(e){w=e}function ye(e,t){me(e,t);var r=new a;r.schemeIdUri=e,r.value=t,k.getUTCTimingSources().push(r)}function me(e,t){var r=k.getUTCTimingSources();r.forEach((function(n,i){n.schemeIdUri===e&&n.value===t&&r.splice(i,1)}))}function ge(){ye(pr.DEFAULT_UTC_TIMING_SOURCE.scheme,pr.DEFAULT_UTC_TIMING_SOURCE.value)}function _e(){return B}function Ee(e){return N.getReadOnlyMetricsFor(e)}function be(){if(!G.getElement())throw r;return G.getElement()}function Se(e){if(!b)throw c;G.setElement(e),e&&(Pe(),function(){if(!I){var e=dashjs.MetricsReporting;if("function"==typeof e){var t=e(l).create();I=t.createMetricsReporting({log:y,eventBus:f,mediaElement:be(),dashManifestModel:j,metricsModel:N,events:p,constants:n,metricsConstants:i})}}}(),function(){if(!O){var e=dashjs.MssHandler;"function"==typeof e&&(O=e(l).create({eventBus:f,mediaPlayerModel:k,metricsModel:N,playbackController:U,protectionController:D,errHandler:L,events:p,constants:n,log:y,initSegmentType:F.INIT_SEGMENT_TYPE,BASE64:wi.a,ISOBoxer:ve.a}))}}(),M&&M.switchToVideoElement()),T&&Ae(),Ce()}function Te(t){if(!S)throw e;var r=M.getActiveStreamInfo();return r?P.getTracksFor(t,r):[]}function we(e){if(!b)throw c;"string"==typeof e&&Fe(l).getInstance().initialize(e),ee.video={},ee.audio={},_=e,(S||T)&&Ae(),ae()&&Ce()}function Ae(){T=!1,S=!1,C.reset(),M.reset(),U.reset(),A.reset(),P.reset(),D&&(D.reset(),D=null,Pe())}function Re(){return An(l).create({errHandler:L,videoModel:G,metricsModel:N,mediaPlayerModel:k,requestModifier:Et(l).getInstance(),mssHandler:O})}function Pe(){if(D)return D;var e=dashjs.Protection;if("function"==typeof e){var t=e(l).create();return p.extend(e.events),hr.extend(e.events,{publicOnly:!0}),x||(x=Pn(l).getInstance()),D=t.createProtectionSystem({log:y,errHandler:L,videoModel:G,capabilities:x,eventBus:f,events:p,BASE64:wi.a,constants:n,ignoreEmeEncryptedEvent:$})}return null}function De(){var e=N.getReadOnlyMetricsFor(n.VIDEO)||N.getReadOnlyMetricsFor(n.AUDIO);return B.getCurrentDVRInfo(e)}function Ie(e){var t=De();return t?e+(t.manifestInfo.availableFrom.getTime()/1e3+t.range.start):0}function Oe(){if(!S)throw e;var t=M.getActiveStreamInfo();return t?M.getStreamById(t.id):null}function Ce(){var e;!S&&_&&(S=!0,y("Streaming Initialized"),e=Re(),M||(M=Vr(l).getInstance()),P.setConfig({errHandler:L,domStorage:H}),M.setConfig({capabilities:x,manifestLoader:e,manifestModel:V,dashManifestModel:j,mediaPlayerModel:k,protectionController:D,adapter:C,metricsModel:N,dashMetrics:B,errHandler:L,timelineConverter:R,videoModel:G,playbackController:U,domStorage:H,abrController:A,mediaController:P}),U.setConfig({streamController:M,metricsModel:N,dashMetrics:B,manifestModel:V,mediaPlayerModel:k,dashManifestModel:j,adapter:C,videoModel:G}),A.setConfig({streamController:M,domStorage:H,mediaPlayerModel:k,metricsModel:N,dashMetrics:B,dashManifestModel:j,manifestModel:V,videoModel:G,adapter:C,initializeDate:Me()}),A.createAbrRulesCollection(),M.initialize(w,E),_.video||_.audio||"string"==typeof _?M.load(_,q):M.loadWithManifest(_,q)),!T&&ae()&&(T=!0,y("Playback Initialized"))}function Ne(e){var t=k.getCachedDurationOffset("offset");t&&e.time>=t&&Z&&(k.setCachedDurationOffset("time",t),Z=!1,G.setDataOffsetAttr(t),f.trigger(p.APPENDED_NEXT_SOURCE_DURATION_CHANGED,{offset:t,totalTime:e.time,totalDuration:fe(),time:de(void 0,!0),duration:te.min||fe(!0)}))}function ke(e){try{if(e&&e.mediaType&&e.segments){
var t=e.mediaType,r=ee[t],n=e.segments,i=e.representation&&e.representation.index,o=!0,a=[],s={},u=0,c=0;if(r.total&&r.total===n.length&&(r.segments.forEach((function(e,t){e.duration&&e.duration!==n[t].duration&&t<r.total-1&&Math.ceil(1e3*Math.abs(e.duration/e.timescale-n[t].duration/n[t].timescale))>100&&a.push(t)})),a.length)){o=!1,s={old:r.qualityIndex,new:i};var l=G.getTime(),d=Math.floor(l/5);-1===a.indexOf(d)&&-1===a.indexOf(d+1)&&-1===a.indexOf(d+2)&&(o=!0)}var f=0,p=e.segments&&e.segments[e.segments.length-1];p&&(f=(p.duration+p.startTime)/p.timescale,te[t]=f,(!te.min||te.min>0&&te.min>f)&&(te.min=f));var h=0;n&&n.length&&(h=n[0].startTime/n[0].timescale,P.setStartOffsetTimeForType(t,h),u=parseInt(n[0].mediaRange.split("-")[0],10),c=parseInt(n[n.length-1].mediaRange.split("-")[1],10),J=Math.max(J,h)),te.min===f&&k.getCachedDurationOffset("duration")&&h>0&&(te.min-=h),k.setCachedDurationOffset("duration",te.min+Y);var y={total:n&&n.length,segments:n,isDurationAllEqual:o,qualityIndex:i,realDuration:f,startOffsetTime:h,rangeStart:u,rangeEnd:c};o||(y.notEqualIndexList=a,y.notEqualQualityIndex=s),ee[e.mediaType]=y,"function"==typeof re&&re(t,y)}}catch(e){throw new Error("Parse segment loaded error, "+e)}}function Le(){K=!0;var e=G.getBufferRange(),t=G.getElement().duration,r=e&&e.length&&e.end(e.length-1),n=G.getTime(),i=[t,r,n+ce("video"),n+ce("audio")],o=i.filter((function(e){return!isNaN(e)})),a=o.reduce((function(e,t){return e+t}))/o.length,s=Math.min.apply(null,o);if(y("onStreamBufferingCompleted",Y,i,k.getAppendingSourceState(),Q),Math.abs(s-a)<1&&(Y=parseFloat(s.toFixed(5)),Q.length)){var u=Q.splice(0,1)[0];y("Appending delay next source",u),Ue(u.manifest,u.preloadData)}}function xe(e){if(U.getEnded()&&k.getAppendingSourceState()){var t=e.sender.getType();if(ne[t]=e.bufferLevel,ne.audio>0&&ne.video>0){var r=G.getBufferRange(),n=r&&r.length&&r.end(r.length-1),i=U.getTime();n>i+.01&&(console.log("Playing next appending source after prev playback ended.",ne),U.seek(i+.01),U.play())}}if(k.getAppendingSourceState()&&z){for(var o=k.getCachedDurationOffset("offset"),a=G.getBufferRange(),s=U.getTime(),u=0,c=0;c<a.length;c++)a.start(c)<s&&a.end(c)>=s&&(u=a.end(c));o>0&&u>o+1&&(k.setAppendingSourceState(!1),y("Appended Next Source, currentTime: "+s+" , buffered end: "+u),z=!1,f.trigger(p.APPENDED_NEXT_SOURCE,{time:s,ended:u}))}if(!X){var l=G.getBufferRange(),d=U.getTime(),h=l&&l.length&&l.start(0),m=k.getPlayAt();l&&l.length&&h>=J&&(X=!0,(m||d)<h&&f.trigger(p.START_OFFSET_TIME_WARNING,{time:h}))}}function Me(){return m}function Ue(e,t){if(y("Append Next Source",G.getTime(),G.isSeeking()),!b)throw c;if("string"==typeof e&&Fe(l).getInstance().initialize(e),G.isSeeking())f.on(p.PLAYBACK_SEEKED,(function t(){y("Seeked to append next source"),f.off(p.PLAYBACK_SEEKED,t),Ue(e)}));else{if(!K)return y("Stream buffering is not completed, delay to append!"),void(Q=[{manifest:e,preloadData:t}]);k.setAppendingSourceState(!0),k.setCachedDurationOffset("offset",Y),f.trigger(p.APPENDING_NEXT_SOURCE,{manifest:e,time:U.getTime(),offset:Y}),z=!0,Z=!0,K=!1,ee.video={},ee.audio={},_=e,te.min=0,te.video=0,te.audio=0,M.load(e,!0,!0)}}return v={initialize:function(e,t,r,n,i,o,a,s){var u;k.setExternalMediaLoader(o),k.setEnableMultipleAudioTracks(s),q=!!n,m=new Date,$=a,delete window.__DASH_P2P_TYPE__,x||(x=Pn(l).getInstance()),L=Ct(l).getInstance(),x.supportsMediaSource()?b||(b=!0,R=Si(l).getInstance(),A||(A=oe(l).getInstance()),U||(U=Be(l).getInstance()),P||(P=pe(l).getInstance()),C=li(l).getInstance(),j=gi(l).getInstance({mediaController:P,timelineConverter:R,adapter:C}),V=In(l).getInstance(),B=Ei(l).getInstance({manifestModel:V,dashManifestModel:j}),N=qn(l).getInstance(),H=ei(l).getInstance({mediaPlayerModel:k}),C.setConfig({dashManifestModel:j,mediaPlayerModel:k}),N.setConfig({adapter:C}),ge(),he(void 0===r||r),e&&Se(e),t&&we(t),o&&(u=o,f.trigger(p.BIND_MEDIA_SOURCE_LOADER,{loader:u})),f.trigger(p.INIT_HID,{hid:i}),y("[dash.js "+se()+"] MediaPlayer has been initialized")):L.capabilityError("mediasource")},setConfig:function(e){e&&(e.capabilities&&(x=e.capabilities),e.streamController&&(M=e.streamController),e.playbackController&&(U=e.playbackController),e.mediaPlayerModel&&(k=e.mediaPlayerModel),e.abrController&&(A=e.abrController),e.mediaController&&(P=e.mediaController))},on:function(e,t,r){f.on(e,t,r)},once:function(e,t,r){f.once(e,t,r)},off:function(e,t,r){f.off(e,t,r)},extend:function(e,t,r){s.a.extend(e,t,r,l)},attachView:Se,attachSource:we,isReady:ae,preload:function(){if(G.getElement()||S)return!1;if(!_)throw u;Ce()},play:function(){if(!T)throw t;if(!w||ue()&&T)return U.play()},isPaused:ue,pause:function(){if(!T)throw t;U.pause()},isSeeking:function(){if(!T)throw t;return U.isSeeking()},isDynamic:function(){if(!T)throw t;return U.getIsDynamic()},seek:function(e,r){if(!T)throw t;if("number"!=typeof e||isNaN(e))throw"MediaPlayer Invalid Arguments!";var n=U.getIsDynamic()?le(e):e;r&&(n+=k.getCachedDurationOffset("time")),U.seek(n)},setPlaybackRate:function(e){if(!G.getElement())throw r;be().playbackRate=e},getPlaybackRate:function(){if(!G.getElement())throw r;return be().playbackRate},setMute:function(e){if(!G.getElement())throw r;be().muted=e},isMuted:function(){if(!G.getElement())throw r;return be().muted},setVolume:function(e){if(!G.getElement())throw r;be().volume=e},getVolume:function(){if(!G.getElement())throw r;return be().volume},time:de,duration:fe,timeAsUTC:function(){if(!T)throw t;return de()<0?NaN:Ie(de())},durationAsUTC:function(){if(!T)throw t;return Ie(fe())},getActiveStream:Oe,getDVRWindowSize:function(){var e=De();return e?e.manifestInfo.DVRWindowSize:0},getDVRSeekOffset:le,convertToTimeCode:function(e){e=Math.max(e,0);var t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(r<10?"0"+r.toString():r.toString())+":"+(n<10?"0"+n.toString():n.toString())},formatUTC:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=new Date(1e3*e),o=i.toLocaleDateString(t),a=i.toLocaleTimeString(t,{hour12:r});return n?a+" "+o:a},getVersion:se,getDebug:function(){return h},getBufferLength:ce,getVideoContainer:function(){return G?G.getVideoContainer():null},getTTMLRenderingDiv:function(){return G?G.getTTMLRenderingDiv():null},getVideoElement:be,getSource:function(){if(!_)throw u;return _},setLiveDelayFragmentCount:function(e){k.setLiveDelayFragmentCount(e)},setLiveDelay:function(e){k.setLiveDelay(e)},getLiveDelay:function(){return k.getLiveDelay()},getCurrentLiveLatency:function(){if(!b)throw c;return T?U.getCurrentLiveLatency():NaN},useSuggestedPresentationDelay:function(e){k.setUseSuggestedPresentationDelay(e)},enableLastBitrateCaching:function(e,t){k.setLastBitrateCachingInfo(e,t)},enableLastMediaSettingsCaching:function(e,t){k.setLastMediaSettingsCachingInfo(e,t)},setMaxAllowedBitrateFor:function(e,t){A.setMaxAllowedBitrateFor(e,t)},getMaxAllowedBitrateFor:function(e){return A.getMaxAllowedBitrateFor(e)},getTopBitrateInfoFor:function(t){if(!S)throw e;return A.getTopBitrateInfoFor(t)},setMinAllowedBitrateFor:function(e,t){A.setMinAllowedBitrateFor(e,t)},getMinAllowedBitrateFor:function(e){return A.getMinAllowedBitrateFor(e)},setMaxAllowedRepresentationRatioFor:function(e,t){A.setMaxAllowedRepresentationRatioFor(e,t)},getMaxAllowedRepresentationRatioFor:function(e){return A.getMaxAllowedRepresentationRatioFor(e)},setAutoPlay:he,getAutoPlay:function(){return w},setScheduleWhilePaused:function(e){k.setScheduleWhilePaused(e)},getScheduleWhilePaused:function(){return k.getScheduleWhilePaused()},getDashMetrics:_e,getMetricsFor:Ee,getQualityFor:function(t){if(!S)throw e;return A.getQualityFor(t,M.getActiveStreamInfo())},setQualityFor:function(t,r){if(!S)throw e;A.setPlaybackQuality(t,M.getActiveStreamInfo(),r)},updatePortalSize:function(){A.setElementSize(),A.setWindowResizeEventCalled(!0)},getLimitBitrateByPortal:function(){return A.getLimitBitrateByPortal()},setLimitBitrateByPortal:function(e){A.setLimitBitrateByPortal(e)},getUsePixelRatioInLimitBitrateByPortal:function(){return A.getUsePixelRatioInLimitBitrateByPortal()},
setUsePixelRatioInLimitBitrateByPortal:function(e){A.setUsePixelRatioInLimitBitrateByPortal(e)},getBitrateInfoListFor:function(t){if(!S)throw e;var r=Oe();return r?r.getBitrateListFor(t):[]},setInitialBitrateFor:function(e,t){A.setInitialBitrateFor(e,t)},getInitialBitrateFor:function(t){if(!S)throw e;return A.getInitialBitrateFor(t)},setInitialRepresentationRatioFor:function(e,t){A.setInitialRepresentationRatioFor(e,t)},getInitialRepresentationRatioFor:function(e){return A.getInitialRepresentationRatioFor(e)},getStreamsFromManifest:function(t){if(!S)throw e;return C.getStreamsInfo(t)},getTracksFor:Te,getTracksForTypeFromManifest:function(t,r,n){if(!S)throw e;return(n=n||C.getStreamsInfo(r,1)[0])?C.getAllMediaInfoForType(n,t,r):[]},getCurrentTrackFor:function(t){if(!S)throw e;var r=M.getActiveStreamInfo();return r?P.getCurrentTrackFor(t,r):null},setInitialMediaSettingsFor:function(e,t){if(!b)throw c;P.setInitialSettings(e,t)},getInitialMediaSettingsFor:function(e){if(!b)throw c;return P.getInitialSettings(e)},setCurrentTrack:function(t){if(!S)throw e;P.setTrack(t)},getTrackSwitchModeFor:function(e){if(!b)throw c;return P.getSwitchMode(e)},setTrackSwitchModeFor:function(e,t){if(!b)throw c;P.setSwitchMode(e,t)},setSelectionModeForInitialTrack:function(e){if(!b)throw c;P.setSelectionModeForInitialTrack(e)},getSelectionModeForInitialTrack:function(){if(!b)throw c;return P.getSelectionModeForInitialTrack()},setFastSwitchEnabled:function(e){k.setFastSwitchEnabled(e)},getFastSwitchEnabled:function(){return k.getFastSwitchEnabled()},setMovingAverageMethod:function(e){e===n.MOVING_AVERAGE_SLIDING_WINDOW||e===n.MOVING_AVERAGE_EWMA?k.setMovingAverageMethod(e):y("Warning: Ignoring setMovingAverageMethod("+e+") - unknown value.")},getMovingAverageMethod:function(){return k.getMovingAverageMethod()},getAutoSwitchQualityFor:function(e){return A.getAutoSwitchBitrateFor(e)},setAutoSwitchQualityFor:function(e,t){A.setAutoSwitchBitrateFor(e,t)},setABRStrategy:function(e){e===n.ABR_STRATEGY_DYNAMIC||e===n.ABR_STRATEGY_BOLA||e===n.ABR_STRATEGY_THROUGHPUT?k.setABRStrategy(e):y("Warning: Ignoring setABRStrategy("+e+") - unknown value.")},getABRStrategy:function(){return k.getABRStrategy()},useDefaultABRRules:function(e){k.setUseDefaultABRRules(e)},addABRCustomRule:function(e,t,r){k.addABRCustomRule(e,t,r)},removeABRCustomRule:function(e){k.removeABRCustomRule(e)},removeAllABRCustomRule:function(){k.removeAllABRCustomRule()},setBandwidthSafetyFactor:function(e){k.setBandwidthSafetyFactor(e)},getBandwidthSafetyFactor:function(){return k.getBandwidthSafetyFactor()},getAverageThroughput:function(e){var t=A.getThroughputHistory();return t?t.getAverageThroughput(e):0},setAbandonLoadTimeout:function(e){k.setAbandonLoadTimeout(e)},retrieveManifest:function(e,t){var r=Re(),n=this;f.on(p.INTERNAL_MANIFEST_LOADED,(function e(i){i.error?t(null,i.error):t(i.manifest),f.off(p.INTERNAL_MANIFEST_LOADED,e,n),r.reset()}),n),Fe(l).getInstance().initialize(e),r.load(e,q)},addUTCTimingSource:ye,removeUTCTimingSource:me,clearDefaultUTCTimingSources:function(){k.setUTCTimingSources([])},restoreDefaultUTCTimingSources:ge,setBufferToKeep:function(e){k.setBufferToKeep(e)},setBufferAheadToKeep:function(e){k.setBufferAheadToKeep(e)},setBufferPruningInterval:function(e){k.setBufferPruningInterval(e)},setStableBufferTime:function(e){k.setStableBufferTime(e)},getStableBufferTime:function(){return k.getStableBufferTime()},setBufferTimeAtTopQuality:function(e){k.setBufferTimeAtTopQuality(e)},getBufferTimeAtTopQuality:function(){return k.getBufferTimeAtTopQuality()},setBufferTimeAtTopQualityLongForm:function(e){k.setBufferTimeAtTopQualityLongForm(e)},getBufferTimeAtTopQualityLongForm:function(){return k.getBufferTimeAtTopQualityLongForm()},setFragmentLoaderRetryAttempts:function(e){k.setFragmentRetryAttempts(e)},setFragmentLoaderRetryInterval:function(e){k.setFragmentRetryInterval(e)},setManifestLoaderRetryAttempts:function(e){k.setManifestRetryAttempts(e)},setManifestLoaderRetryInterval:function(e){k.setManifestRetryInterval(e)},setXHRWithCredentialsForType:function(e,t){k.setXHRWithCredentialsForType(e,t)},getXHRWithCredentialsForType:function(e){return k.getXHRWithCredentialsForType(e)},setJumpGaps:function(e){k.setJumpGaps(e)},getJumpGaps:function(){return k.getJumpGaps()},setSmallGapLimit:function(e){k.setSmallGapLimit(e)},getSmallGapLimit:function(){return k.getSmallGapLimit()},getLowLatencyEnabled:function(){return k.getLowLatencyEnabled()},setLowLatencyEnabled:function(e){return k.setLowLatencyEnabled(e)},setPreloadData:function(e){return k.setPreloadData(e)},setManifestUpdateRetryInterval:function(e){k.setManifestUpdateRetryInterval(e)},getManifestUpdateRetryInterval:function(){return k.getManifestUpdateRetryInterval()},setLongFormContentDurationThreshold:function(e){k.setLongFormContentDurationThreshold(e)},setSegmentOverlapToleranceTime:function(e){k.setSegmentOverlapToleranceTime(e)},setCacheLoadThresholdForType:function(e,t){k.setCacheLoadThresholdForType(e,t)},getProtectionController:function(){return Pe()},attachProtectionController:function(e){D=e},setProtectionData:function(e){E=e,M&&M.setProtectionData(E)},enableManifestDateHeaderTimeSource:function(e){k.setUseManifestDateHeaderTimeSource(e)},attachVideoContainer:function(e){if(!G.getElement())throw r;G.setVideoContainer(e)},attachTTMLRenderingDiv:function(e){if(!G.getElement())throw r;G.setTTMLRenderingDiv(e)},getUseDeadTimeLatencyForAbr:function(){return A.getUseDeadTimeLatency()},setUseDeadTimeLatencyForAbr:function(e){A.setUseDeadTimeLatency(e)},getThumbnail:function(e){if(e<0)return null;var t=U.getIsDynamic()?le(e):e,r=M.getStreamForTime(t);if(null===r)return null;var n=r.getThumbnailController(),i=r.getStreamInfo();if(!n||!i)return null;var o=M.getTimeRelativeToStreamId(t,r.getId());return n.get(o)},setDefaultQualityFor:function(e,t){A||(A=oe(l).getInstance()),A.setDefaultQualityFor(e,t)},getDefaultQualityFor:function(e){return A.getDefaultQualityFor(e)},getDroppedFramesInfo:function(){return A.getDroppedFramesInfo()},getCurrentSegmentInfoFor:function(e){return A.getCurrentSegmentInfoFor(e)},onInitSegmentsLoaded:function(e){re=e},getThroughputDict:function(e){var t=A.getThroughputHistory();return t?t.getDict(e):{}},getInitializeDate:Me,updateSource:function(e){if(!b)throw c;"string"==typeof e&&Fe(l).getInstance().initialize(e),ee.video={},ee.audio={},_=e,M.load(_,q)},switchSource:function(e){if(!b)throw c;"string"==typeof e&&Fe(l).getInstance().initialize(e),ee.video={},ee.audio={},te.min=0,te.video=0,te.audio=0,_=e,Y=0,G.setDataOffsetAttr(0),k.setCachedDurationOffset("offset",0),k.setCachedDurationOffset("time",0),k.setCachedDurationOffset("duration",0),k.setAppendingSourceState(!1),k.resetStartAndSeekTime(),Z=!1,Q=[],(S||T)&&Ae(),ae()&&Ce()},appendSource:Ue,setEndOfStreamState:function(e){k&&k.setEndOfStreamState(e)},setP2pPermission:function(e){e||k.addBufferingCount()},setP2pType:function(e,t){var r,n=!1;switch(e){case"yf-eg":case"yf-cg2":window.YFDashIO&&(n=!0);break;case"xl-eg":case"xl-cg2":window.xyvp&&(n=!0);break;case"ks-eg":case"ks-cg2":window.KSLoader&&(n=!0);break;case"bili-eg":case"bili-cg2":window.DIYSdk&&(n=!0);break;case"pear-eg":case"pear-cg2":window.PearDownloader&&(n=!0)}n?window.__DASH_P2P_TYPE__=e:t?(r=t,new Promise((function(e,t){var n=document.createElement("script");n.src=r,n.onload=function(){window.clearTimeout(W),e()},n.onerror=function(){window.clearTimeout(W),t(),f.trigger(p.PCDN_LOADED_ERROR,{code:o.DOWNLOAD_PCDN_SCRIPT_ERROR,url:r})},document.body.appendChild(n),W=window.setTimeout((function(){t(),f.trigger(p.PCDN_LOADED_ERROR,{code:o.DOWNLOAD_PCDN_SCRIPT_TIMEOUT,url:r})}),2e3)}))).then((function(){window.__DASH_P2P_TYPE__=e,y("[MediaPlayer] p2p Sdk Scripts Loaded")})).catch((function(){console.warn("load p2p sdk scripts failed")})):console.warn("lack p2p sdk scripts")},setUseNC:function(e){k&&k.setUseNC(e)},setUseP2P:function(e){k&&k.setUseP2P(e)},switchAudioTrack:function(e){return k.getAudioTrackIds().find((function(t){return t.id===e}))?(k.setAudioTrackId(e),f.trigger(p.SWITCH_AUDIO_TRACK_REQUEST,{id:e}),0):-1},getCurrentAudioTrackId:function(){return k.getAudioTrackId()},
getAudioTrackList:function(){return k.getAudioTrackIds()},getRetryTimes:function(){return k.getRetryTimes()},getSpaceUtilLastSeekInSec:function(){return((new Date).getTime()-k.getLastStartSeekTime())/1e3},setPlayAt:function(e){return k.setPlayAt(e)},reset:function(){we(null),Se(null),E=null,z=!1,Z=!1,Y=0,Q=[],D&&(D.reset(),D=null),I&&(I.reset(),I=null),U&&(U.reset(),U=null),f.off(p.SEGMENTS_LOADED,ke,v),f.off(p.BUFFER_LEVEL_UPDATED,xe,v),f.off(p.PLAYBACK_ENDED,Le,this),f.off(p.STREAM_BUFFERING_COMPLETED,Le,this),f.off(p.PLAYBACK_TIME_UPDATED,Ne,this),f.off(p.PLAYBACK_METADATA_LOADED,ie,this)},setQualityMap:function(e){},setPlayerId:function(e){k.setPlayerId(e)}},function(){b=!1,T=!1,S=!1,w=!0,D=null,E=null,C=null,p.extend(hr),k=pr(l).getInstance(),G=Yn(l).getInstance(),Y=0,K=!1,Q=[],ne={video:0,audio:0},J=0,f.on(p.SEGMENTS_LOADED,ke,v),f.on(p.BUFFER_LEVEL_UPDATED,xe,v),f.on(p.PLAYBACK_ENDED,Le,this),f.on(p.STREAM_BUFFERING_COMPLETED,Le,this),f.on(p.PLAYBACK_TIME_UPDATED,Ne,this),f.on(p.PLAYBACK_METADATA_LOADED,ie,this)}(),v}Ai.__dashjs_factory_name="MediaPlayer";var Ri=s.a.getClassFactory(Ai);Ri.events=hr,s.a.updateClassFactory(Ai.__dashjs_factory_name,Ri),t.a=Ri},function(e,t,r){var n,i,o,u,c,l=function(e){for(var t=[],r=0;r<e.length;++r){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?(t.push(192|n>>6),t.push(128|63&n)):n<65536?(t.push(224|n>>12),t.push(128|63&n>>6),t.push(128|63&n)):(t.push(240|n>>18),t.push(128|63&n>>12),t.push(128|63&n>>6),t.push(128|63&n))}return t},d=function(e){for(var t=[],r=0;r<e.length;){var n=e[r++];n<128||(n<224?(n=(31&n)<<6,n|=63&e[r++]):n<240?(n=(15&n)<<12,n|=(63&e[r++])<<6,n|=63&e[r++]):(n=(7&n)<<18,n|=(63&e[r++])<<12,n|=(63&e[r++])<<6,n|=63&e[r++])),t.push(String.fromCharCode(n))}return t.join("")},f={};n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(e){for(var t=0,r=[],i=0|e.length/3;0<i--;){var o=(e[t]<<16)+(e[t+1]<<8)+e[t+2];t+=3,r.push(n.charAt(63&o>>18)),r.push(n.charAt(63&o>>12)),r.push(n.charAt(63&o>>6)),r.push(n.charAt(63&o))}return 2==e.length-t?(o=(e[t]<<16)+(e[t+1]<<8),r.push(n.charAt(63&o>>18)),r.push(n.charAt(63&o>>12)),r.push(n.charAt(63&o>>6)),r.push("=")):1==e.length-t&&(o=e[t]<<16,r.push(n.charAt(63&o>>18)),r.push(n.charAt(63&o>>12)),r.push("==")),r.join("")},o=function(){for(var e=[],t=0;t<64;++t)e[n.charCodeAt(t)]=t;return e["=".charCodeAt(0)]=0,e}(),u=function(e){for(var t=0,r=[],n=0|e.length/4;0<n--;){var i=(o[e.charCodeAt(t)]<<18)+(o[e.charCodeAt(t+1)]<<12)+(o[e.charCodeAt(t+2)]<<6)+o[e.charCodeAt(t+3)];r.push(255&i>>16),r.push(255&i>>8),r.push(255&i),t+=4}return r&&("="==e.charAt(t-2)?(r.pop(),r.pop()):"="==e.charAt(t-1)&&r.pop()),r},c={encode:function(e){for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t},decode:function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")}},f.decodeArray=function(e){var t=u(e);return new Uint8Array(t)},f.encodeASCII=function(e){var t=c.encode(e);return i(t)},f.decodeASCII=function(e){var t=u(e);return c.decode(t)},f.encode=function(e){var t=l(e);return i(t)},f.decode=function(e){var t=u(e);return d(t)},t.decode=f.decode,t.decodeArray=f.decodeArray,t.encode=f.encode,t.encodeASCII=f.encodeASCII},function(e,t,r){"use strict";(function(e){var n=r(7);r.d(t,"a",(function(){return n.a}));var i=r(0),o=r(5),a="undefined"!=typeof window&&window||e,s=a.dashjs;s||(s=a.dashjs={}),Object.defineProperties(s,{MediaPlayer:{value:n.a},FactoryMaker:{value:i.a},Version:{value:Object(o.a)()}})}).call(this,r(17))},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return o(t,e),t},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=r(18),d=r(11),f=u(r(4)),p=r(2),h=u(r(19)),y=a(r(13)),m=u(r(20)),g=r(12),v=r(6),_=u(r(21)),E=u(r(22)),b=function(){function e(t,r){if(this.switchSourcePromise={},this.id=++e.id,this.qnSwitchingInfo={video:{switching:!1,qn:NaN,resolve:null,reject:null,listener:null,oQn:NaN},audio:{switching:!1,qn:NaN,resolve:null,reject:null,listener:null,oQn:NaN}},this.config={scriptSrc:"https://static.hdslb.com/player/js/dash.mediaplayer.min.js",scriptMaxLoadTime:1e4,minQualityNumberMappingNumber:6,videoInfoScheduleTime:1e3},(null==r?void 0:r.hid)&&"string"==typeof r.hid&&(this.config.hid=r.hid),(null==r?void 0:r.mediaSourceLoader)&&"function"==typeof r.mediaSourceLoader&&(this.externalMediaLoader=r.mediaSourceLoader),this.state={defaultVideoQuality:0,defaultAudioQuality:0,setTheDefaultVideoQualityState:!1,stableBufferTime:60,isAutoPlay:!1,abrStrategy:p.STRING.ABR_THROUGHPUT,isAutoSwitch:{video:!1,audio:!1},autoSwitchTopQualityMap:{video:-1,audio:-1},onScriptLoading:!1,initialized:!1,mpd:null,manifest:null,manifestInfo:{},currentQualityIndex:{video:0,audio:0},maxQualityIndex:{video:-1,audio:-1},qualityNumberMap:{video:{},audio:{}},segmentsInfoMap:{video:{},audio:{}},mediaInfo:{},statisticsInfo:{},autoSwitchStartTime:0,preloadData:null,startOffsetTime:0,enforceSSLStream:!1,latestPlayurlExpireTimeStamp:0,latestPlayurlErrorHTTPCode:0,fragmentLoadingInfo:{},appendingSourceState:!1,logHistory:[],networkWarningHistory:[],playbackState:y.BUFFERING.PLAYBACK.PLAYING,enableHEVC:!1,enableAV1:!1,cdnInfo:{cdn:0,p2p:0,nc:0,pdn:0,ncBr:0,business:0,mcdn:0,bcache:0,vcache:0,ncFail:0,ncGotFail:0},cdnInfoDetail:{},requestedInfoRecordIndex:0,requestedInfoDetail:{},NCInfo:{},filterVideoInfo:{},protectionDataSet:null,ignoreEmeEncryptedEvent:r.ignoreEmeEncryptedEvent,enableMultiAudioTracks:!!r.enableMultiAudioTracks,playAt:r.playAt,decodeErrorLocalConfig:r.decodeErrorLocalConfig||{}},this.timer={loadScript:0,videoInfoSchedule:0,removeSwitchSourceTransition:0,qnChangeTimeOutFlag:{video:-1,audio:-1},switchSourceTimer:-1,updateSourceTimer:-1,appendSourceTimer:-1,delayStartOffsetHackTimer:-1},this.events={},this.components={networkActivity:new h.default,bufferingInfo:new y.default(t),bufferingStrategy:new m.default,performanceInfo:new _.default(t),ncDisableStrategy:new E.default(this)},this.video=t,this.mixin(r),this.onVideoSwitchSourceEnded=this.onVideoSwitchSourceEnded.bind(this),!t||!(t instanceof HTMLVideoElement||window.__ENABLE_WASM_PLAYER__&&t instanceof window.BwpElement))throw new Error("Video parameter is not a HTMLVideoElement")}return e.clearAll=function(){window.dashjs&&window.dashjs.FactoryMaker&&"function"==typeof window.dashjs.FactoryMaker.reset&&window.dashjs.FactoryMaker.reset()},e.getFawkesConfigValue=function(t,r){if(!e.fawkesConfig){var i=JSON.parse(JSON.stringify(p.DEFAULT_FAWKES_CONFIG));e.fawkesConfig=i;try{var o=f.default.getLocalStorage("bilibili_player_dash_fawkes_config");if(o){var a=f.default.switchFawkesConfig(JSON.parse(o));Object.keys(a).forEach((function(t){e.fawkesConfig[t]=n(n({},e.fawkesConfig[t]),a[t])}))}}catch(e){}}return e.fawkesConfig[t]?r&&"string"==typeof r?e.fawkesConfig[t][r]||"":e.fawkesConfig[t]||"":""},e.prototype.processManifest=function(e,t,r){return"string"!=typeof e&&this.processSpecialAudioItem(e,this.state.defaultAudioQuality),this.filterManifest({enableHEVC:t,enableAV1:r,manifest:e,state:this.state})},e.prototype.preload=function(){var e=this;this.detectDashJSExists()||this.loadDashPlayerScript().then((function(){e.fire(p.EVENTS.SCRIPT_LOADED)})).catch((function(t){e.error({
msg:"Load dash player script error",detail:t})}))},e.prototype.initialize=function(e,t){var r=this;this.mixin(t);var n=this.processManifest(e,this.state.enableHEVC,this.state.enableAV1),i=n.codecId,o=n.manifest;return this.state.mpd=o,this.state.enableHEVC=i===p.VIDEO_CODEC_ID.HEVC,this.state.enableAV1=i===p.VIDEO_CODEC_ID.AV1,this.checkShouldResetLocalDecodeErr(),this.components.bufferingStrategy.setHEVCEnableFlag(this.state.enableHEVC).setOnOptimizingCallback(this.fire.bind(this)),new Promise((function(t,n){e||n({msg:"Manifest parameter error, manifest: "+JSON.stringify(e)}),r.detectDashJSExists()?r.createPlayer(t,n):r.state.onScriptLoading?r.on(p.EVENTS.SCRIPT_LOADED,(function(){r.off(p.EVENTS.SCRIPT_LOADED),r.createPlayer(t,n)})):r.loadDashPlayerScript().then((function(){r.createPlayer(t,n)})).catch((function(e){r.error(e)}))}))},e.prototype.on=function(e,t){e&&"function"==typeof t&&(this.events[e]||(this.events[e]=[]),this.events[e].push(t))},e.prototype.once=function(e,t){var r=this;this.on(e,(function(n){t(n),r.off(e,t)}))},e.prototype.off=function(e,t){if(e)if("function"==typeof t){if(this.events[e]&&this.events[e].length){var r=this.events[e].indexOf(t);r>=0&&this.events[e].splice(r,1)}}else this.events[e]=[]},e.prototype.fire=function(e,t){if(e){var r=this.events[e];r&&r.length&&r.forEach((function(e){"function"==typeof e&&e.call(null,t)}))}},e.prototype.play=function(){try{return this.player.play()}catch(e){this.error({msg:"Call play function error",detail:e})}},e.prototype.pause=function(){try{this.player.pause()}catch(e){this.error({msg:"Call pause function error",detail:e})}},e.prototype.getCurrentTime=function(e){void 0===e&&(e=!0);try{return this.player.time(void 0,e)}catch(e){this.error({type:p.STRING.WARNING,msg:"Call getCurrentTime function error",detail:e})}return 0},e.prototype.getBufferedTime=function(){this.getCurrentTime();var e=this.video;try{e.buffered}catch(e){this.error({msg:"Call getBufferedTime function error",detail:e})}return 0},e.prototype.getDuration=function(e){void 0===e&&(e=!0);try{return this.player.duration(e)}catch(e){this.error({msg:"Call getDuration function error",detail:e})}},e.prototype.seek=function(e,t){var r=this;return void 0===t&&(t=!1),new Promise((function(n,i){if(isNaN(parseInt(""+e,10))||e<0)i({msg:"Seek time value error, time: "+e});else if(r.state.appendingSourceState)i({msg:"Call seek function error while appending source, time: "+e});else try{var o=r.getCurrentTime(),a=Date.now();r.changePlaybackState(y.BUFFERING.PLAYBACK.SEEKING);var s=r.getStartOffsetTime();e<s&&(e=s+.3);var u=999999,c=r.state.segmentsInfoMap,l=parseInt(r.video.getAttribute("data-offset"),10)||0;if(c)for(var d in c)u=Math.min(c[d].realDuration+l,u);u=Math.min(r.state.manifest.mediaPresentationDuration,u),e>u-.6&&(e=u-.6),r.player.seek(e,t),r.player.on(p.EVENTS.PLAYBACK_SEEKED,(function i(){r.changePlaybackState(y.BUFFERING.PLAYBACK.PLAYING).player.off(p.EVENTS.PLAYBACK_SEEKED,i),n({cost:Math.floor(Date.now()-a),currentTime:o,seekedTime:e,isRelative:t})}))}catch(e){r.error({msg:"Call seek function error",detail:e})}}))},e.prototype.getCorePlayer=function(){return this.player},e.prototype.setVolume=function(e){if(isNaN(parseInt(""+e,10))||e<0||e>1)this.error({msg:"SetVolume value error, value: "+e});else try{this.player.setVolume(e)}catch(e){this.error({msg:"Call setVolume function error",detail:e})}},e.prototype.getVolume=function(){try{return this.player.getVolume()}catch(e){this.error({msg:"Call getVolume function error",detail:e})}},e.prototype.setPlaybackRate=function(e){try{this.player.setPlaybackRate(e)}catch(e){this.error({msg:"Call setPlaybackRate function error",detail:e})}},e.prototype.getPlaybackRate=function(){try{return this.player.getPlaybackRate()}catch(e){this.error({msg:"Call getPlaybackRate function error",detail:e})}},e.prototype.getAutoSwitchQualityFor=function(e){try{return this.player.getAutoSwitchQualityFor(e)}catch(e){this.error({msg:"Call getAutoSwitchQualityFor function error",detail:e})}},e.prototype.setAutoSwitchQualityFor=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!0);try{this.state.isAutoSwitch&&r&&(this.state.isAutoSwitch[e]=t),t||this.setMaxAllowedBitrateFor(e,0),this.player.setAutoSwitchQualityFor(e,t)}catch(e){this.error({msg:"Call setAutoSwitchQualityFor function error",detail:e})}return this},e.prototype.getAudioQuallityCanBeUsed=function(e){return e===p.DOLBY_AUDIO_QN.AUDIO||e===p.DOLBY_AUDIO_QN.AMTOS?this.checkAudioCodecCanUseByType(p.SPECIAL_AUDIO_TYPE.DOLBY)&&e||30280:e===p.FLAC_QN?this.checkAudioCodecCanUseByType(p.SPECIAL_AUDIO_TYPE.FLAC)&&e||30280:e},e.prototype.getQualityList=function(e){try{return this.player.getBitrateInfoListFor(e)}catch(e){this.error({msg:"Call getQualityList function error",detail:e})}},e.prototype.setDefaultQualityFor=function(e,t){void 0===t&&(t=0);var r=this.getQualityIndexFromQualityNumber(t,e);try{var n=this.state.mpd&&this.state.mpd[e];if(!n)return;var i=n.length;i&&(r=Math.min(r,i-1)),r>=0?(this.state.currentQualityIndex[e]=r,this.player.setDefaultQualityFor(e,r)):this.error({msg:"Call setDefaultQualityFor function error, quality: "+t})}catch(e){this.error({msg:"Call setDefaultQualityFor function error, quality: "+t+", qualityIndex = "+r,detail:e})}},e.prototype.setAutoSwitchTopQualityFor=function(e,t){var r=this;try{if(!this.state.initialized)return void this.on(p.EVENTS.STREAM_INITIALIZED,(function n(){r.off(p.EVENTS.STREAM_INITIALIZED,n),r.setAutoSwitchTopQualityFor(e,t)}));if(!t&&0!==t)return void this.setMaxAllowedBitrateFor(e,0);if(!this.state.isAutoSwitch||!this.state.isAutoSwitch[e])return;var n=this.getQualityIndexFromQualityNumber(t,e),i=this.getQualityList(e),o=i&&i[n],a=Math.floor(o.bitrate/1e3)+1;this.state.autoSwitchTopQualityMap[e]=n,this.setMaxAllowedBitrateFor(e,a)}catch(e){this.error({msg:"Call setAutoSwitchTopQualityFor function error",detail:e})}},e.prototype.setQualityFor=function(e,t,r){var n=this;return void 0===r&&(r=20),new Promise((function(i,o){if(isNaN(parseInt(""+t,10))||t<0)o({msg:"Set quality value error, quality: "+t,code:p.ERROR_CODE.SET_QUALITY_VALUE_ERR});else if(n.detectQualityTypeIsLegal(e))o({msg:"Set quality type error, type: "+e,code:p.ERROR_CODE.SET_QUALITY_TYPE_ERR});else if(n.state.appendingSourceState)o({msg:"Reject setQualityFor by appending next source.",code:p.ERROR_CODE.SET_QUALITY_APENDING_ERR});else if("audio"===e&&n.state.enableMultiAudioTracks)o({msg:"MultiAudioTrack disable change Qn",code:p.ERROR_CODE.SET_QUALITY_MULTI_TRACK});else if("audio"===e&&n.getAutoSwitchQualityFor("video"))o({msg:"abr disable change Qn",code:p.ERROR_CODE.SET_QUALITY_ABR});else try{var a=t;if((t=n.getQualityIndexFromQualityNumber(t,e))===n.state.currentQualityIndex[e])return void o({msg:"Set quality equal current quality, quality: "+t,code:p.ERROR_CODE.SET_QUALITY_SAME_VALUE,isChange:a!==n.getQualityNumberFromQualityIndex(t)&&t!==a});n.player.setQualityFor(e,t);var s=Date.now(),u=function(e){-1!==n.timer.qnChangeTimeOutFlag[e]&&(clearTimeout(n.timer.qnChangeTimeOutFlag[e]),n.timer.qnChangeTimeOutFlag[e]=-1),n.qnSwitchingInfo[e]={}};u(e);var c=1e3*r;n.timer.qnChangeTimeOutFlag[e]=window.setTimeout((function(){n.player.off(p.EVENTS.QUALITY_CHANGE_RENDERED,l),o({msg:"Call setQualityFor timeout",code:p.ERROR_CODE.SET_QUALITY_TIME_OUT}),u(e);var t=n.state.currentQualityIndex[e];n.player.setQualityFor(e,t)}),c);var l=function r(c){if(c.mediaType===e){var l=c.newQuality;if(u(c.mediaType),n.player.off(p.EVENTS.QUALITY_CHANGE_RENDERED,r),l===t){var d=n.getQualityNumberFromQualityIndex(l,e);l!==a&&a!==d?(o({msg:"Quality rendered and quality is not "+a+" but "+d,code:p.ERROR_CODE.SET_QUALITY_RENDER_CHANGED,newQuality:l,newQnNumber:d}),n.fire(p.EVENTS.QUALITY_CHANGE_ABNORMAL,{type:p.EVENTS.QUALITY_CHANGE_ABNORMAL,mediaType:e,defaultQuality:a,currentIndex:l,qualityNumber:d})):i(n.getQualityChangedData(c,s))}}};n.qnSwitchingInfo[e]={switching:!0,oQn:a,qn:t,reject:o,resolve:i,listener:l},n.player.on(p.EVENTS.QUALITY_CHANGE_RENDERED,l)}catch(e){o({msg:"Call setQualityFor function error",code:p.ERROR_CODE.SET_QUALITY_ERR,detail:e})}}))},e.prototype.getQualityFor=function(e){try{return this.player.getQualityFor(e)}catch(e){
this.error({msg:"Call getQualityFor function error",detail:e})}},e.prototype.setStableBufferTime=function(e){void 0===e&&(e=60);try{this.player.setStableBufferTime(e),this.player.setBufferTimeAtTopQuality(e),this.player.setBufferTimeAtTopQualityLongForm(e),this.player.setBufferAheadToKeep(e+10)}catch(e){this.error({msg:"Call setStableBufferTime function error",detail:e})}},e.prototype.getStableBufferTime=function(){try{return this.player.getStableBufferTime()}catch(e){this.error({msg:"Call getStableBufferTime function error",detail:e})}},e.prototype.getBufferLength=function(e){try{return this.player.getBufferLength(e)}catch(e){this.error({msg:"Call getBufferLength function error",detail:e})}},e.prototype.getCurrentPlayURLFor=function(e){try{return this.player.getCurrentSegmentInfoFor(e).url||""}catch(t){this.error({msg:"Call getCurrentPlayURLFor function error, type: "+e+", qualityIndex: "+this.state.currentQualityIndex[e],detail:t})}},e.prototype.getVideoInfo=function(){return{mediaInfo:this.state.mediaInfo,statisticsInfo:this.state.statisticsInfo}},e.prototype.getCurrentCodecID=function(e){void 0===e&&(e=p.STRING.VIDEO);var t=0;return e===p.STRING.VIDEO&&this.state&&(t=p.VIDEO_CODEC_ID.AVC,this.state.enableAV1&&(t=p.VIDEO_CODEC_ID.AV1),this.state.enableHEVC&&(t=p.VIDEO_CODEC_ID.HEVC)),t},e.prototype.getAverageConnectionSpeed=function(e){void 0===e&&(e=p.STRING.VIDEO);try{return Number(this.player.getAverageThroughput(e))||0}catch(e){this.error({msg:"Call getAverageConnectionSpeed function error",detail:e})}},e.prototype.switchSource=function(e,t,r,n){var i=this;this.onDashJSLog({type:"switchsource",message:"start switchsource"+this.id}),"function"==typeof this.switchSourcePromise.reject&&this.switchSourcePromise.reject({code:p.ERROR_CODE.SWITCH_SOURCE_ABORT,msg:"abort switch source"}),this.player.off(p.EVENTS.STREAM_INITIALIZED,this.onSiwtchSourceInitialized,this);var o=n||{},a=o.playAt,s=o.keepTransition,u=o.autoPlay;if(window.clearTimeout(this.timer.removeSwitchSourceTransition),window.clearTimeout(this.timer.switchSourceTimer),s||this.onVideoSwitchSourceEnded(),t&&("string"!=typeof t.videoid||"string"!=typeof t.audioid?this.error({type:p.STRING.WARNING,msg:"Preload data videoid/audioid value must be string type.",detail:t}):this.player&&this.player.setPreloadData(t)),this.player&&this.player.setPlayAt(a||0),this.state&&(this.state.playAt=a),r){if(!this.getTransitionCanvas()||!s){var c=document.createElement("canvas"),l=this.video.offsetWidth,d=this.video.offsetHeight,f=this.video.videoWidth,h=this.video.videoHeight,y=f/h,m=l/d;c.width=f,c.height=h,c.style.zIndex="10",c.style.position="absolute",c.style.top="50%",c.style.left="50%",c.style.transform="translate(-50%, -50%)",c.className=p.STRING.SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME;var g=c.getContext("2d"),v=void 0,_=void 0;m>=y?(_=d,v=d/h*f):(v=l,_=l/f*h),c.style.width=(v/l*100).toFixed(2)+"%",c.style.height=(_/d*100).toFixed(2)+"%",g.fillRect(0,0,c.width,c.height),g.drawImage(this.video,0,0,c.width,c.height),this.video.parentNode.appendChild(c),this.video.style.visibility="hidden",c=null,g=null}this.timer.removeSwitchSourceTransition=window.setTimeout((function(){s||i.onVideoSwitchSourceEnded()}),1e4),this.video.removeEventListener("canplay",this.onVideoSwitchSourceEnded),this.video.addEventListener("canplay",this.onVideoSwitchSourceEnded)}return new Promise((function(t,r){try{e=i.filterManifest({manifest:e,state:i.state}).manifest,i.state.mpd=e,i.player?(["video","audio"].forEach((function(e){var t=i.qnSwitchingInfo[e];t&&t.switching?(clearTimeout(i.timer.qnChangeTimeOutFlag[e]),i.setDefaultQualityFor(e,t.qn),i.player.off(p.EVENTS.QUALITY_CHANGE_RENDERED,t.listener)):i.setDefaultQualityFor(e,i.state.currentQualityIndex[e])})),i.state.defaultVideoQuality=i.state.currentQualityIndex.video,i.state.defaultAudioQuality=i.state.currentQualityIndex.audio,i.bindSwitchSourceEvents(t,r,1e4,u),i.player.switchSource(e)):r({code:p.ERROR_CODE.SWITCH_SOURCE_FAILED,msg:"switch source failed"})}catch(e){r({code:p.ERROR_CODE.SWITCH_SOURCE_ERR,msg:e})}}))},e.prototype.updateSource=function(e){var t=this;return new Promise((function(r,n){try{e=t.filterManifest({manifest:e,state:t.state}).manifest,t.player.updateSource(e),t.timer.updateSourceTimer=window.setTimeout((function(){n({msg:"Update Source Timeout"})}),5e3),t.player.on(p.EVENTS.STREAM_INITIALIZED,(function e(){t.player.off(p.EVENTS.STREAM_INITIALIZED,e),clearTimeout(t.timer.updateSourceTimer),r(null)}))}catch(e){n({msg:"Call updateSource function error, "+JSON.stringify(e),detail:e})}}))},e.prototype.appendSource=function(e,t){var r=this,n=this.state.appendingSourceState,i=this.state;return new Promise((function(o,a){n&&a("Dash Player is Appending Next Source!"),r.setAutoSwitchQualityFor("video",!1,!1),r.setAutoSwitchQualityFor("audio",!1,!1);var s=Date.now();t&&("string"!=typeof t.videoid||"string"!=typeof t.audioid?r.error({type:p.STRING.WARNING,msg:"Preload data videoid/audioid value must be string type.",detail:t}):r.player&&r.player.setPreloadData(t)),r.timer.appendSourceTimer=window.setTimeout((function(){r.state.appendingSourceState=!1,a({msg:"Append source time out."})}),5e3),r.state.appendingSourceState=!0;try{if(r.player){for(var u in r.state.currentQualityIndex)r.state.currentQualityIndex[u]>=0&&r.setDefaultQualityFor(u,r.state.currentQualityIndex[u]);e=r.filterManifest({manifest:e,state:r.state}).manifest,r.player.setEndOfStreamState(!1),r.player.appendSource(e),r.player.on(p.EVENTS.APPENDED_NEXT_SOURCE,(function e(t){clearTimeout(r.timer.appendSourceTimer),r.player.off(p.EVENTS.APPENDED_NEXT_SOURCE,e),o({cost:Date.now()-s})})),r.player.on(p.EVENTS.APPENDED_NEXT_SOURCE_DURATION_CHANGED,(function e(t){r.player.off(p.EVENTS.APPENDED_NEXT_SOURCE_DURATION_CHANGED,e),r.state.appendingSourceState=!1,i.autoSwitchTopQualityMap.video>=0&&r.setAutoSwitchTopQualityFor("video",i.autoSwitchTopQualityMap.video),r.setAutoSwitchQualityFor("video",i.isAutoSwitch[p.STRING.VIDEO],!1),r.setAutoSwitchQualityFor("audio",i.isAutoSwitch[p.STRING.AUDIO],!1)}))}else clearTimeout(r.timer.appendSourceTimer),r.state.appendingSourceState=!1,a({msg:"Missing dash player instance!"})}catch(e){clearTimeout(r.timer.appendSourceTimer),r.state.appendingSourceState=!1,a({msg:"Append Source Error",detail:e})}}))},e.prototype.getNextFragmentHistoryInfo=function(){var e="";try{var t=function(e){return e?1:0};if(this.state.getNextFragmentHistory){var r=function(r){var i=n.state.getNextFragmentHistory[r],o="";i.forEach((function(e){var r,n,i=[t(e.final),e.currentTime,e.bufferLevel.toFixed(3),(r=[e.bufferResetInProgress,e.isReplacement,e.switchTrack,e.hasTopQualityChanged,e.lastInitQuality,e.bufferLevelRule],n="",r.length&&r.forEach((function(e){n+=""+t(e)})),parseInt(n,2))];o+=i.join(",")+";"})),e+=r+":"+o+"!"},n=this;for(var i in this.state.getNextFragmentHistory)r(i)}}catch(e){}return e},e.prototype.isLoadingFragment=function(e){if(e)return!!this.state.fragmentLoadingInfo[e]},e.prototype.getNetworkActivity=function(){return this.components.networkActivity&&this.components.networkActivity.getNetworkActivity()},e.prototype.getNetworkActivityHistory=function(e){return void 0===e&&(e=0),this.components.networkActivity&&this.components.networkActivity.getNetworkActivityHistory(e)},e.prototype.setEndOfStreamState=function(e){void 0===e&&(e=!1);try{return this.player.setEndOfStreamState(e)}catch(e){this.error({msg:"Call setEndOfStreamState function error",detail:e})}},e.prototype.getLogHistory=function(){var e=this.state&&this.state.logHistory||[],t=e.join("\n");return{length:e.length,log:t,size:function(e){for(var t=[],r=[e],n=0;r.length;){var i=r.pop();if("boolean"==typeof i)n+=4;else if("string"==typeof i)n+=2*i.length;else if("number"==typeof i)n+=8;else if("object"==c(i)&&-1===t.indexOf(i))for(var o in t.push(i),i)r.push(i[o])}return n}(t)}},e.prototype.getPerformanceInfo=function(e){void 0===e&&(e=!1);var t=this.getDroppedFramesInfo();return this.components.performanceInfo.getInfo(t,e)},e.prototype.getDisableLoaderType=function(){
return this.components.ncDisableStrategy.isUseNC?this.components.ncDisableStrategy.isUseP2P?p.DISABLE_LOADER_TYPE.NONE:p.DISABLE_LOADER_TYPE.DISABLE_RP:p.DISABLE_LOADER_TYPE.DISABLE_NC},e.prototype.getBufferingInfo=function(e){var t;void 0===e&&(e=!0);var r={type:-1};try{var i=this.state.currentQualityIndex.video,o=this.state.currentQualityIndex.audio;r=this.components.bufferingInfo&&this.components.bufferingInfo.getInfo({videoBufferLength:this.getBufferLength("video"),audioBufferLength:this.getBufferLength("audio"),videoCurrentIndex:i,audioCurrentIndex:o,videoCurrentQn:this.getQualityNumberFromQualityIndex(i,p.STRING.VIDEO),audioCurrentQn:this.getQualityNumberFromQualityIndex(o,p.STRING.AUDIO),videoSpeed:this.getAverageConnectionSpeed(p.STRING.VIDEO),audioSpeed:this.getAverageConnectionSpeed(p.STRING.AUDIO),networkActivity:this.getNetworkActivityHistory(5),playbackState:this.state.playbackState,latestPlayurlErrorHTTPCode:this.state.latestPlayurlErrorHTTPCode,fragmentLoadingInfo:this.state.fragmentLoadingInfo,networkWarningHistory:this.state.networkWarningHistory,startOffsetTime:this.state.startOffsetTime,retryTimes:this.player.getRetryTimes(),seekSpace:this.player.getSpaceUtilLastSeekInSec()}),r=n(n({},r),this.getPerformanceInfo(!0)),null===(t=this.components)||void 0===t||t.bufferingStrategy.push(r)}catch(e){throw new Error(e.message)}return e&&this.onDashJSLog({type:"videoBuffering",message:"[videoBuffering]:"+JSON.stringify(r)}),r},e.prototype.getCDNInfo=function(e){if(void 0===e&&(e=!1),this.state){var t=n({},this.state.cdnInfo);return e&&(this.state.cdnInfo={cdn:0,p2p:0,nc:0,pdn:0,ncBr:0,business:0,mcdn:0,bcache:0,vcache:0,ncFail:0,ncGotFail:0}),t}return{}},e.prototype.getCDNInfoDetail=function(e){if(void 0===e&&(e=!1),this.state){var t=n({},this.state.cdnInfoDetail);return e&&(this.state.cdnInfoDetail={}),t}return{}},e.prototype.getRequestedInfoDetail=function(e){if(void 0===e&&(e=!1),this.state){var t=n({},this.state.requestedInfoDetail);return e&&(this.state.requestedInfoDetail={}),t}return{}},e.prototype.getNCInfo=function(e){if(void 0===e&&(e=!1),this.state){var t={};for(var r in this.state.NCInfo)t[r]=n({},this.state.NCInfo[r]);return e&&(this.state.NCInfo={}),t}return{}},e.prototype.switchAudioTrack=function(e){var t=this;return new Promise((function(r,n){try{var i=-1,o="";if(t.state.enableMultiAudioTracks?e===t.getCurrentAudioTrackId()&&(i=p.ERROR_CODE.SWITCH_AUDIO_TRACK_ID_NOT_CHANGED,o="the id which is going to be switched is equal to current"):(i=p.ERROR_CODE.SWITCH_AUDIO_TRACK_NOT_SUPPORT,o="not support multiple audio tracks"),-1!==i)return void n({code:i,msg:o});0!==t.player.switchAudioTrack(e)?n({code:i=p.ERROR_CODE.SWITCH_AUDIO_TRACK_ID_NOT_EXIST,msg:o="the id which is going to be switched is not exist"}):t.once(p.EVENTS.SWITCH_AUDIO_TRACK_RENDERED,(function(e){r(e)}))}catch(e){n({code:p.ERROR_CODE.SWITCH_AUDIO_TRACK_ERR,msg:"switch aduio track failed, "+(e&&e.message)})}}))},e.prototype.getCurrentAudioTrackId=function(){return this.player.getCurrentAudioTrackId()},e.prototype.getAudioTrackList=function(){try{return this.player.getAudioTrackList()}catch(e){return[]}},e.prototype.destroy=function(){try{this.player.off(p.EVENTS.FRAGMENT_LOADING_STARTED,this.onFragmentLoading,this),this.player.off(p.EVENTS.FRAGMENT_LOADING_PROGRESS,this.onFragmentLoading,this),this.player.off(p.EVENTS.FRAGMENT_LOADING_COMPLETED,this.onFragmentLoading,this),this.player.off(p.EVENTS.SWITCH_AUDIO_TRACK_REQUEST,this.onAudioTrackSwitchRequest,this),this.player.off(p.EVENTS.SWITCH_AUDIO_TRACK_RENDERED,this.onAudioTrackSwitchRendered,this),this.player.off(p.EVENTS.LOG,this.onDashJSLog,this),this.player.off(p.EVENTS.PREDICT_SEEK,this.onPredictSeek,this),this.player.off(p.EVENTS.JUMP_MEDIA_GAP,this.onJumpMediaGap,this),this.player.off(p.EVENTS.STREAM_INITIALIZED,this.onSiwtchSourceInitialized,this),this.player&&this.player.reset(),this.onVideoSwitchSourceEnded(),this.switchSourcePromise=null,this.clearAllTimer(),this.events={},this.config=null,this.state=null,this.video=null,this.player=null,this.switchStartTime=null,this.destroyAllComponents(),this.externalMediaLoader=null,this.qnSwitchingInfo=null}catch(e){this.error({msg:"Call destroy function error, "+(e&&e.message),detail:e})}},e.prototype.destroyAllComponents=function(){this.components.networkActivity.destroy(),this.components.networkActivity=null,this.components.bufferingInfo.destroy(),this.components.bufferingInfo=null,this.components.bufferingStrategy.destroy(),this.components.bufferingStrategy=null,this.components.performanceInfo.destroy(),this.components.performanceInfo=null,this.components.ncDisableStrategy.destroy(),this.components.ncDisableStrategy=null,this.components=null},e.prototype.clearAllTimer=function(){var e=this;this.timer&&(Object.keys(this.timer).forEach((function(t){"qnChangeTimeOutFlag"===t?(clearTimeout(e.timer.qnChangeTimeOutFlag.video),clearTimeout(e.timer.qnChangeTimeOutFlag.audio)):clearTimeout(e.timer[t])})),this.timer=null)},e.prototype.mixin=function(e){if(e&&e instanceof Object)for(var t in e)e.hasOwnProperty(t)&&this.state.hasOwnProperty(t)&&(this.state[t]=e[t]);this.state&&this.state.isAutoSwitch||(this.state.isAutoSwitch={video:!1,audio:!1})},e.prototype.loadDashPlayerScript=function(){var e=this,t=this.config.scriptSrc;return new Promise((function(r,n){try{var i=document.createElement("script");i.src=t,i.onload=function(){e.state.onScriptLoading=!1,clearTimeout(e.timer.loadScript),r()},i.onerror=function(r){e.state.onScriptLoading=!1,clearTimeout(e.timer.loadScript),n({msg:"Load dash player script error, src: "+t,detail:r})},document.body.appendChild(i),e.state.onScriptLoading=!0,e.timer.loadScript=window.setTimeout((function(){n({msg:"Call loadDashPlayerScript function timeout"})}),e.config.scriptMaxLoadTime)}catch(e){n({msg:"Call loadDashPlayerScript function error",detail:e})}}))},e.prototype.createPlayer=function(t,r){var n,i=window.dashjs,o=this.state;this.state.defaultVideoQuality=this.getQualityIndexFromQualityNumber(o.defaultVideoQuality,p.STRING.VIDEO),this.state.defaultAudioQuality=this.getQualityIndexFromQualityNumber(o.defaultAudioQuality,p.STRING.AUDIO);try{var a=i.MediaPlayer().create();a.setPlayerId(this.id),o&&o.protectionDataSet&&"function"==typeof a.setProtectionData&&a.setProtectionData(o.protectionDataSet),this.player=a,this.setDebugLog(),this.bindEvents(t),this.state.logHistory.push("Dash player log history, "+JSON.stringify(e.CONFIG)),o.preloadData&&a.setPreloadData(o.preloadData),o.playAt&&a.setPlayAt(o.playAt),a.initialize(this.video,o.mpd,o.isAutoPlay,o.enforceSSLStream,null===(n=this.config)||void 0===n?void 0:n.hid,this.externalMediaLoader,o.ignoreEmeEncryptedEvent,o.enableMultiAudioTracks),a.setABRStrategy(o.abrStrategy||p.STRING.ABR_THROUGHPUT),a.setAutoSwitchQualityFor(p.STRING.VIDEO,o.isAutoSwitch[p.STRING.VIDEO]),a.setAutoSwitchQualityFor(p.STRING.AUDIO,o.isAutoSwitch[p.STRING.AUDIO]),a.setFastSwitchEnabled(!0),a.enableLastBitrateCaching(!1),a.setBufferPruningInterval(20),a.setUseNC(this.components.ncDisableStrategy.isUseNC),a.setUseP2P(this.components.ncDisableStrategy.isUseP2P),o.mpd&&o.mpd.interactive&&a.setEndOfStreamState(!1),a.setJumpGaps(!0),this.setStableBufferTime(this.state.stableBufferTime)}catch(e){r({msg:"Call createPlayer function error",detail:e})}},e.prototype.bindEvents=function(e){var t=this,r=this.player;r.on(p.EVENTS.STREAM_INITIALIZED,(function n(){r.off(p.EVENTS.STREAM_INITIALIZED,n,t),t.state.initialized=!0;var i=t.player.getBitrateInfoListFor("video");e&&e(i),t.fire(p.EVENTS.STREAM_INITIALIZED),t.videoInfoSchedule(),t.detectDefaultQualityChangeAbnormal()}),this),r.on(p.EVENTS.MANIFEST_LOADED,this.parseManifestInfo,this),r.on(p.EVENTS.GET_NEXT_FRAGMENT,this.getNextFragmentInfo,this),r.on(p.EVENTS.FRAGMENT_LOADING_STARTED,this.onFragmentLoading,this),r.on(p.EVENTS.FRAGMENT_LOADING_PROGRESS,this.onFragmentLoading,this),r.on(p.EVENTS.FRAGMENT_LOADING_COMPLETED,this.onFragmentLoading,this),r.on(p.EVENTS.SWITCH_AUDIO_TRACK_REQUEST,this.onAudioTrackSwitchRequest,this),r.on(p.EVENTS.SWITCH_AUDIO_TRACK_RENDERED,this.onAudioTrackSwitchRendered,this),
r.on(p.EVENTS.FRAGMENT_LOADED_ERROR,this.onFragmentLoadingError,this),r.on(p.EVENTS.REQUEST_RETRYED,this.onFragmentLoadingError,this),r.on(p.EVENTS.LOG,this.onDashJSLog,this),r.on(p.EVENTS.PREDICT_SEEK,this.onPredictSeek,this),r.on(p.EVENTS.JUMP_MEDIA_GAP,this.onJumpMediaGap,this),r.onInitSegmentsLoaded(this.onInitSegmentsLoaded.bind(this)),r.on(p.EVENTS.DELAY_TO_APPEND_TO_BUFFER,(function(e){})),r.on(p.EVENTS.START_OFFSET_TIME_WARNING,(function(e){var r=e&&e.time;r&&r>t.state.startOffsetTime&&(t.error({type:p.STRING.WARNING,code:p.ERROR.START_OFFSET_TIME_WARNING,msg:"Start offset time is less than buffer.start(0), "+t.state.startOffsetTime+" < "+r}),t.state.startOffsetTime=r+.2)})),r.on(p.EVENTS.PLAYBACK_METADATA_LOADED,(function e(){r.off(p.EVENTS.PLAYBACK_METADATA_LOADED,e),t.timer.delayStartOffsetHackTimer=window.setTimeout((function(){if(t.video){var e=t.video.buffered,n=e.length&&e.start(0),i=t.video.currentTime;i<n&&(t.error({type:p.STRING.WARNING,code:p.ERROR.START_OFFSET_TIME_WARNING,msg:"Current offset time is less than buffer.start(0), "+i+" < "+n}),t.state.startOffsetTime=n+.2,r.seek(n+.2))}}),3e3)})),this.bindDashCorePlayerEvents()},e.prototype.onAudioTrackSwitchRequest=function(e){this.fire(p.EVENTS.SWITCH_AUDIO_TRACK_REQUEST,e)},e.prototype.onAudioTrackSwitchRendered=function(e){this.fire(p.EVENTS.SWITCH_AUDIO_TRACK_RENDERED,e)},e.prototype.bindSwitchSourceEvents=function(e,t,r,n){var i=this;this.switchStartTime=Date.now(),this.switchSourcePromise={resolve:e,reject:t},this.timer.switchSourceTimer=window.setTimeout((function(){i.onVideoSwitchSourceEnded(),t({code:p.ERROR_CODE.SWITCH_SOURCE_TIMEOUT,msg:"Dash Player Switch Source timeout",cost:Date.now()-i.switchStartTime})}),r),this.player.on(p.EVENTS.STREAM_INITIALIZED,this.onSiwtchSourceInitialized,this),n&&this.player.once(p.EVENTS.CAN_PLAY,(function(){i.player.play()}))},e.prototype.onSiwtchSourceInitialized=function(){var e=this;window.clearTimeout(this.timer.switchSourceTimer),this.player.off(p.EVENTS.STREAM_INITIALIZED,this.onSiwtchSourceInitialized,this),"function"==typeof this.switchSourcePromise.resolve&&(this.switchSourcePromise.resolve({cost:Date.now()-this.switchStartTime}),this.switchStartTime=1/0,["video","audio"].forEach((function(t){var r=e.qnSwitchingInfo[t];r&&r.switching&&(r.resolve(e.getQualityChangedData({mediaType:t,newQuality:r.qn,oldQuality:r.oQn})),e.qnSwitchingInfo[t]={})})))},e.prototype.error=function(e){e.code=e.code||p.ERROR.INTERNAL_ERROR,e.msg="[Dash] "+e.msg,e.type=e.type||p.STRING.ERROR,this.state&&this.state.logHistory.push("Dash player "+e.type+" - "+e.code+": "+e.msg),p.STRING.ERROR===e.type?this.fire(p.EVENTS.ERROR,e):this.fire(p.EVENTS.WARNING,e)},e.prototype.bindDashCorePlayerEvents=function(){var e=this,t=this.events;this.player.on(p.EVENTS.ERROR,(function(t){var r,n=null===(r=null==t?void 0:t.event)||void 0===r?void 0:r.request;n&&(n.code=t.httpCode||t.code),e.recordRequestedInfoDetail(null==n?void 0:n.mediaType,n),e.errorHandler(t)})),this.on(p.EVENTS.QUALITY_CHANGE_REQUESTED,(function(t){e.changePlaybackState(y.BUFFERING.PLAYBACK.SWITCHING_QUALITY),e.components.bufferingInfo&&e.components.bufferingInfo.setSwitchingInfo({mediaType:t.mediaType,newQuality:t.newQuality,oldQuality:t.oldQuality})})),this.on(p.EVENTS.QUALITY_CHANGE_RENDERED,(function(t){e.changePlaybackState(y.BUFFERING.PLAYBACK.PLAYING),e.components.bufferingInfo&&e.components.bufferingInfo.setSwitchingInfo(null),e.state.currentQualityIndex[t.mediaType]=t.newQuality})),[{key:p.EVENTS.QUALITY_CHANGE_REQUESTED,callbackQueue:function(){return t[p.EVENTS.QUALITY_CHANGE_REQUESTED]}},{key:p.EVENTS.QUALITY_CHANGE_RENDERED,callbackQueue:function(){return t[p.EVENTS.QUALITY_CHANGE_RENDERED]}},{key:p.EVENTS.QUALITY_CHANGE_DOWNLOADED,callbackQueue:function(){return t[p.EVENTS.QUALITY_CHANGE_DOWNLOADED]}}].forEach((function(t){e.player.on(t.key,(function(r){try{var n=t.callbackQueue();n&&n.forEach((function(t){"function"==typeof t&&t(e.getQualityChangedData(r))}))}catch(r){e.error({msg:"Call "+t.key+" callback queue error",detail:r,type:p.STRING.WARNING})}}))})),this.player.on(p.EVENTS.FRAGMENT_LOADED_ERROR,(function(t){if(t){if(!t.code)return;var r=p.STRING.WARNING;t.code===p.ERROR.DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE&&(r=p.STRING.ERROR),e.saveNetworkWarningInfo(t),e.error({code:t.code,detail:t,msg:"Fragment Loaded Error, "+JSON.stringify(t),type:r})}})),this.player.on(p.EVENTS.PCDN_LOADED_ERROR,(function(t){if(t){if(!t.code)return;e.error({code:t.code,detail:t,msg:"Pcdn Loaded Error, "+JSON.stringify(t),type:p.STRING.WARNING})}})),this.player.on(p.EVENTS.CDN_LOAD_INFO,this.onDashCDNLoadInfo,this),this.player.on(p.EVENTS.QUOTA_EXCEEDED,(function(e){}))},e.prototype.checkShouldResetLocalDecodeErr=function(){if(this.state){var e=this.state,t=e.enableAV1,r=e.enableHEVC,n=t?"AV1":r?"HEVC":"AVC";if("AVC"!==n){var i=d.getLocalDecodeErrorInfo(n);if(i&&"number"==typeof i.reactivateTime){var o=(new Date).getTime();i.reactivateTime<=o&&d.rmLocalDecodeErrorInfo(n)}}}},e.prototype.errorHandler=function(e){var t=this;if(e)try{var r=e.code,n=e.error,i=e.event.message,o=e.decodeErrorType||null;switch(r){case p.ERROR.DOWNLOAD_ERROR:case p.ERROR.DOWNLOAD_MPD_ERROR:case p.ERROR.DOWNLOAD_XINK_ERROR:case p.ERROR.DOWNLOAD_INIT_SEGMENT_ERROR:case p.ERROR.DOWNLOAD_MEDIA_SEGMENT_ERROR:case p.ERROR.DOWNLOAD_INDEX_SEGMENT_ERROR:case p.ERROR.DOWNLOAD_SWITCHING_SEGMENT_ERROR:case p.ERROR.DOWNLOAD_OTHER_ERROR:var a=e.event.url,s=e.httpCode,u=!0;if(s&&s>=400){var c=0;if(a){var l=a.match(/expires=\d+/g),h=a.match(/deadline=\d+/g);c=l&&parseInt(l[0].substr(8),10)||h&&parseInt(h[0].substr(9),10)}c&&this.state.latestPlayurlExpireTimeStamp===c&&this.state.latestPlayurlErrorHTTPCode===s&&(u=!1),this.state.latestPlayurlExpireTimeStamp=c,this.state.latestPlayurlErrorHTTPCode=s}u&&this.error({code:r,msg:s+" downloadError - "+a,detail:e});break;case p.ERROR.MANIFEST_ERROR:case p.ERROR.MANIFEST_TYPE_ERROR:case p.ERROR.MANIFEST_RESOLVE_ERROR:this.error({code:r,msg:n+" - "+i,detail:e});break;case p.ERROR.MEDIA_ERROR:case p.ERROR.MEDIA_ABORTED_ERROR:case p.ERROR.MEDIA_NETWORK_ERROR:case p.ERROR.MEDIA_SUPPORTED_ERROR:case p.ERROR.MEDIA_ENCRYPTED_ERROR:case p.ERROR.MEDIA_UNKNOWN_ERROR:case p.ERROR.MEDIA_DECODE_ERROR:!function(){try{if(r===p.ERROR.MEDIA_DECODE_ERROR&&"audio"===o){var e=t.getQualityNumberFromQualityIndex(t.getQualityFor("audio"),"audio");f.default.saveDecodeErrorMediaQualityNumber("audio",e,p.STRING.BILIBILI_DECODE_ERROR_OBJ)}var n=t.state,i=n.enableAV1,a=n.enableHEVC,s=n.decodeErrorLocalConfig,u=i?"AV1":a?"HEVC":"AVC";if("AVC"===u)return;if(!o||"audio"!==o){var c="enable"+u+"Error";f.default.setSessionStorage(c,"1")}if(s&&s[u]){var l=s[u],h=l.occurTimes,y=l.disableDuration,m=d.getLocalDecodeErrorInfo(u)||{occurTimes:0},g=m.occurTimes,v=m.reactivateTime;if(++g>=h&&!v){var _=y||6048e5;v=(new Date).getTime()+_}d.setLocalDecodeErrorInfo(u,{occurTimes:g,reactivateTime:v})}}catch(e){}}();var y=e.event,m=o?"[DecodeErrorType]"+o+";":n+" - "+y;this.error({code:r,msg:m,detail:e});break;default:this.error({msg:"Unknown error.",detail:e}),console.error(e)}}catch(e){this.error({msg:"Unknown error.",detail:e})}},e.prototype.detectDashJSExists=function(){return!(!window.dashjs||!window.dashjs.MediaPlayer)},e.prototype.detectQualityTypeIsLegal=function(e){return!(e===p.STRING.VIDEO||e===p.STRING.AUDIO)},e.prototype.parseManifestInfo=function(e){var t=this;try{var r=e.data;if(this.state.manifest=r,r&&r.Period){var n={baseUri:r.baseUri,representation:{video:[],audio:[]}},i={video:{},audio:{}},o=r.Period.AdaptationSet_asArray;o.length&&o.forEach((function(e){var r=e.Representation_asArray;if(r){var o="";r instanceof Array||(r=[r]),r.length&&(r.sort((function(e,t){return e.bandwidth-t.bandwidth})),r.forEach((function(r,a){var s=r.frameRate,u=r.mimeType||e.mimeType;try{if(s&&(""+s).indexOf("/")>-1){var c=s.split("/");s=(s=parseInt(c[0],10)/parseInt(c[1],10)).toFixed(3)}}catch(e){t.error({msg:"Parse fps error, fps: "+s,detail:e})}var l={id:r.id,baseURL:r.BaseURL,width:r.width,height:r.height,bandwidth:r.bandwidth,codecs:r.codecs,fps:s,mimeType:u,sar:r.sar,startWithSAP:r.startWithSAP,audioSamplingRate:r.audioSamplingRate}
;u.indexOf(p.STRING.VIDEO)>-1?o=p.STRING.VIDEO:u.indexOf(p.STRING.AUDIO)>-1?o=p.STRING.AUDIO:t.error({msg:"Manifest missing mimeType",detail:r}),o&&(function(e){var t,r,n,i=e.width,o=e.height,a=e.id;return t=function(e,t,r,n){return e+';codecs="'+t+'"'+(r&&n?';width="'+r+'";height="'+n+'"':";")}(e.mimeType,e.codecs,i,o),(null===(n=(r=window.MediaSource).isTypeSupported)||void 0===n?void 0:n.call(r,t))&&function(e,t,r){return v.getCurrentBrowserInfo().type!==v.BROWSER_TYPE.Firefox||e!==p.VIDEO_QN.QN_4K||!(!t||!r)&&t<=4096&&r<=2160}(+a,i,o)}(l)||t.isUsingWasmPlayer())?(n.representation[o].push(l),i[o][l.id]=a):t.onDashJSLog({type:"FilterCodecNotSupportedQn",message:"abandon qn: "+l.id})}))),t.state.maxQualityIndex[o]=r.length-1}})),this.state.manifestInfo=n,this.state.qualityNumberMap=i,this.state.setTheDefaultVideoQualityState||(this.state.setTheDefaultVideoQualityState=!0,this.setDefaultQualityFor("video",this.state.defaultVideoQuality),this.setDefaultQualityFor("audio",this.state.defaultAudioQuality))}}catch(t){this.error({msg:"Parse dash player manifest error",detail:e})}},e.prototype.getQualityIndexFromQualityNumber=function(e,t){void 0===t&&(t=p.STRING.VIDEO);var r=0;"audio"===t&&(e=this.qualityNumberDowngrading("audio",e)),t===p.STRING.AUDIO&&[p.DOLBY_AUDIO_QN.AMTOS,p.DOLBY_AUDIO_QN.AUDIO,p.FLAC_QN].includes(e)&&(e=this.getAudioQuallityCanBeUsed(e));try{var n=this.state.qualityNumberMap[t];e=parseInt(""+e,10);var i=this.state.maxQualityIndex[t];if(n&&n[e]>=0&&e>=this.config.minQualityNumberMappingNumber){var o=n[e];o>=0&&(r=o)}else if(-1===i||e>=0&&e<=i)r=e;else if(n){for(var a in n)if(n.hasOwnProperty(a)){var s=parseInt(a,10);s<e&&(r=n[""+Math.max(r,s)])}this.error({msg:"Quality number or index is error, qn or index: "+e+",using lower quality number: "+this.getQualityNumberFromQualityIndex(r)+" with quality index: "+r,type:p.STRING.WARNING})}else this.error({msg:"Quality number or index is error, qn or index: "+e+", qn map: "+JSON.stringify(n)+", max quality index: "+i,type:p.STRING.WARNING})}catch(t){this.error({msg:"Call getQualityIndexFromQualityNumber error, qn: "+e,detail:t})}return r},e.prototype.getQualityNumberFromQualityIndex=function(e,t){void 0===t&&(t=p.STRING.VIDEO);try{var r=this.state.qualityNumberMap[t];if(e=parseInt(""+e,10),r)for(var n in r)if(r.hasOwnProperty(n)&&r[n]===e)return parseInt(n,10)}catch(t){this.error({msg:"Call getQualityNumberFromQualityIndex error, qn: "+e,detail:t})}return 32},e.prototype.getDroppedFramesInfo=function(){try{return this.player.getDroppedFramesInfo()||{}}catch(e){this.error({msg:"Call getDroppedFramesInfo function error",detail:e,type:p.STRING.WARNING})}},e.prototype.getCurrentTrackFor=function(e){try{return this.player.getCurrentTrackFor(e)||{}}catch(e){this.error({msg:"Call getCurrentTrackFor function error, "+(e&&e.message),detail:e,type:p.STRING.WARNING})}},e.prototype.getCurrentSegmentInfoFor=function(e){void 0===e&&(e=p.STRING.VIDEO);try{return this.player.getCurrentSegmentInfoFor(e)||{}}catch(e){this.error({msg:"Call getCurrentSegmentInfoFor function error",detail:e,type:p.STRING.WARNING})}},e.prototype.onInitSegmentsLoaded=function(e,t){try{if(this.state.segmentsInfoMap[e]=t,!t.isDurationAllEqual){var r=t.notEqualQualityIndex;this.error({code:p.ERROR.DURATION_IS_NOT_ALL_EQUAL,msg:"Segments duration is not all equal, type: "+e+", quality index switch: "+r.old+" => "+r.new+", segment index list: "+t.notEqualIndexList+" } "})}var n=this.state.segmentsInfoMap,i=this.state.appendingSourceState;if(n&&n.video&&n.audio&&!i){var o=n.video.realDuration,a=n.audio.realDuration,s=Math.abs(o-a);if(s>3){var u=this.getQualityNumberFromQualityIndex(n.video.qualityIndex,p.STRING.VIDEO),c=this.getQualityNumberFromQualityIndex(n.audio.qualityIndex,p.STRING.AUDIO),l=n.video.segments.length,d=n.audio.segments.length;this.error({type:p.STRING.WARNING,code:p.ERROR.DURATION_DEVIATION_IS_TOO_LARGE,msg:"Video / audio duration deviation is too large, deviation: "+s+"s. Video qn:"+u+", segments:"+l+", duration:"+o+". Audio qn:"+c+", segments:"+d+", duration:"+a})}}if(this.state.startOffsetTime<t.startOffsetTime&&(this.state.startOffsetTime=t.startOffsetTime,t.segments&&t.segments.length)){var f=t.segments[0],h=(f.duration,f.timescale,this.state.playAt||.1);this.state.startOffsetTime>h&&(this.player.seek(this.state.startOffsetTime+.2),this.error({type:p.STRING.WARNING,code:p.ERROR.START_OFFSET_TIME_WARNING,msg:e+" start offset time is greater than 0, "+this.state.startOffsetTime}))}}catch(e){this.error({msg:"Call onInitSegmentsLoaded function error",detail:e})}},e.prototype.setMaxAllowedBitrateFor=function(e,t){try{this.player.setMaxAllowedBitrateFor(e,t)}catch(e){this.error({msg:"Call setMaxAllowedBitrateFor function error",detail:e})}},e.prototype.videoInfoSchedule=function(){var e=this,t={},r={};try{var n=this.state,i=n.manifestInfo,o=n.currentQualityIndex,a=i.representation[p.STRING.VIDEO][o[p.STRING.VIDEO]]||{},s=i.representation[p.STRING.AUDIO][o[p.STRING.AUDIO]]||{},u=a.mimeType+';codecs="'+a.codecs+'"',c=this.getCurrentSegmentInfoFor(p.STRING.VIDEO),l=s.mimeType+';codecs="'+s.codecs+'"',d=this.getCurrentSegmentInfoFor(p.STRING.AUDIO),f=this.getDroppedFramesInfo(),h=this.getCurrentCodecID(p.STRING.VIDEO);t={width:a.width,height:a.height,sar:a.sar,mimeType:u+", "+l,fps:a.fps,videoDataRate:a.bandwidth,videoCodec:a.codecs,videoCodecID:h,audioDataRate:s.bandwidth,audioCodec:s.codecs,audioCodecID:0,audioSampleRate:s.audioSamplingRate||0,audioChannelCount:0},r={playerType:"DashPlayer",speed:Math.round(this.getAverageConnectionSpeed(p.STRING.VIDEO)),videoConnectionSpeed:Math.round(this.getAverageConnectionSpeed(p.STRING.VIDEO)),audioConnectionSpeed:Math.round(this.getAverageConnectionSpeed(p.STRING.AUDIO)),networkActivity:this.components.networkActivity&&this.components.networkActivity.getNetworkActivity(),videoBufferHealth:this.getBufferLength("video")||0,audioBufferHealth:this.getBufferLength("audio")||0,droppedFrames:f.droppedFrames||0,decodedFrames:f.totalFrames||0,audioURL:d.url||"",audioCurrentSegmentIndex:d.index||0,audioCurrentSegmentStartTime:d.startTime||0,audioCurrentSegmentDuration:d.duration||0,audioTotalSegmentCount:n.segmentsInfoMap[p.STRING.AUDIO].total||0,videoURL:c.url||"",videoCurrentSegmentIndex:c.index||0,videoCurrentSegmentStartTime:c.startTime||0,videoCurrentSegmentDuration:c.duration||0,videoTotalSegmentCount:n.segmentsInfoMap[p.STRING.VIDEO].total||0},this.state.mediaInfo=t,this.state.statisticsInfo=r,this.fire(p.EVENTS.VIDEO_INFO,{mediaInfo:t,statisticsInfo:r})}catch(e){}clearTimeout(this.timer&&this.timer.videoInfoSchedule),this.config&&this.config.videoInfoScheduleTime&&this.timer&&(this.timer.videoInfoSchedule=window.setTimeout((function(){e.videoInfoSchedule()}),this.config.videoInfoScheduleTime))},e.prototype.getQualityChangedData=function(e,t){var r={};try{var n=e.mediaType,i=e.type,o=e.newQuality,a=e.oldQuality,s=this.state.isAutoSwitch[n];r={mediaType:n,type:i,newQuality:o,newQualityNumber:this.getQualityNumberFromQualityIndex(o,n),oldQuality:a,oldQualityNumber:this.getQualityNumberFromQualityIndex(a,n),currentTime:this.getCurrentTime(),isAutoSwitch:s,dict:this.player.getThroughputDict("video")},p.EVENTS.QUALITY_CHANGE_RENDERED===i?((t=t||this.state.autoSwitchStartTime||0)&&(r.cost=Math.floor(Date.now()-t)),this.state.autoSwitchStartTime=0):p.EVENTS.QUALITY_CHANGE_REQUESTED===i&&(this.state.autoSwitchStartTime=Date.now())}catch(e){this.error({msg:"Call getQualityChangedData error",detail:e,type:p.STRING.WARNING})}return r},e.prototype.getTransitionCanvas=function(){try{if(this.video&&this.video.parentNode)return this.video.parentNode.querySelector("."+p.STRING.SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME)}catch(e){return null}},e.prototype.onVideoSwitchSourceEnded=function(e){try{this.switchSourcePromise={},window.clearTimeout(this.timer.removeSwitchSourceTransition),window.clearTimeout(this.timer.switchSourceTimer),this.video&&(this.video.style.visibility="",this.video.removeEventListener("canplay",this.onVideoSwitchSourceEnded));var t=void 0;if(e&&e.target){var r=e.target.parentElement;t=r&&r.querySelectorAll("."+p.STRING.SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME)
}else t=document.querySelectorAll("."+p.STRING.SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME);t&&t.length&&t.forEach((function(e){e&&e.parentElement.removeChild(e)}))}catch(e){console.error("Remove transition canvas error.",e)}},e.prototype.getStartOffsetTime=function(){var e=0;try{var t=this.state.segmentsInfoMap;t&&(e=Math.max(t.video.startOffsetTime||0,t.audio.startOffsetTime||0))}catch(e){}return e},e.prototype.setDebugLog=function(){try{var e=location.href;e&&e.indexOf("debug=1")>0&&this.player.getDebug().setLogToBrowserConsole(!0)}catch(e){}},e.prototype.getNextFragmentInfo=function(e){if(e&&e.mediaType){var t=e.mediaType;this.state.getNextFragmentHistory||(this.state.getNextFragmentHistory={video:[],audio:[]});var r=!1,n=this.state.getNextFragmentHistory[t].length;if(n){var i=this.state.getNextFragmentHistory[t][this.state.getNextFragmentHistory[t].length-1];for(var o in i)if(i[o]!==e[o]){r=!0;break}}!r&&n||(n>=30&&this.state.getNextFragmentHistory[e.mediaType].splice(0,1),this.state.getNextFragmentHistory[e.mediaType].push(e))}},e.prototype.onFragmentLoading=function(e){var t,r;if(e&&e.type){var n=e.type,i=e.request,o=this.covertFragmentInfoObject(i);if(o.loadingType=n,n===p.EVENTS.FRAGMENT_LOADING_STARTED)this.state.fragmentLoadingInfo[o.mediaType]=o;else if(n===p.EVENTS.FRAGMENT_LOADING_COMPLETED){var a=this.state.fragmentLoadingInfo[o.mediaType];o.isError=!!e.error;var s=e.response&&e.response.byteLength||0,u=Number(i.firstByteDate)-Number(i.requestStartDate);u=u?Math.max(u,1):1;var c=Number(i.requestEndDate)-Number(i.firstByteDate);c=c?Math.max(c,1):1;var l=Number(i.requestEndDate)-Number(i.requestStartDate);l=l?Math.max(l,1):1;var d=Math.round(8*s/l);o.latencyTime=u,o.downloadTime=c,o.totalTime=l,o.downloadBytes=s,o.connectionSpeed=d,o.data=e.response,o.totalSize=this.state.segmentsInfoMap[o.mediaType].rangeEnd+1;var f=!0;for(var h in a)if(a[h]!==o[h]&&"loadingType"!==h&&!isNaN(a[h])){f=!1;break}f&&(this.state.fragmentLoadingInfo[o.mediaType]=null,this.fire(p.EVENTS.FRAGMENT_LOADING_COMPLETED,o)),this.bpNCSaveData(o);var y=i.mediaType;"video"!==y&&"audio"!==y||this.recordRequestedInfoDetail(y,{code:200,qn:null==o?void 0:o.qn,index:null==o?void 0:o.index,rType:null===(t=null==i?void 0:i.loadInfo)||void 0===t?void 0:t.rType,protocol:null===(r=null==i?void 0:i.loadInfo)||void 0===r?void 0:r.protocol,currentTime:this.getCurrentTime(),buffered:this.getBufferLength(y),now:Math.round(null===performance||void 0===performance?void 0:performance.now()),latencyTime:u,downloadTime:c,totalTime:l,connectionSpeed:d,totalSize:s,retryTimes:null==i?void 0:i.retry,url:null==i?void 0:i.url})}else this.state.fragmentLoadingInfo&&this.state.fragmentLoadingInfo[o.mediaType]&&!this.state.fragmentLoadingInfo[o.mediaType].loaderType&&(this.state.fragmentLoadingInfo[o.mediaType].loaderType=o.loaderType),this.components.networkActivity&&this.components.networkActivity.onFragmentLoadingProgess(e)}},e.prototype.onFragmentLoadingError=function(e){if(e){if(e.type===p.EVENTS.REQUEST_RETRYED&&(null==e?void 0:e.code)<4e3)return;var t=null==e?void 0:e.mediaType;"video"!==t&&"audio"!==t||this.recordRequestedInfoDetail(t,{code:null==e?void 0:e.code,qn:(null==e?void 0:e.id)||(null==e?void 0:e.qn),index:null==e?void 0:e.index,rType:e.rType,retryTimes:e.retryTimes,currentTime:this.getCurrentTime(),buffered:this.getBufferLength(t),now:Math.round(null===performance||void 0===performance?void 0:performance.now()),latencyTime:null==e?void 0:e.timeout,downloadTime:(null==e?void 0:e.downloadTime)||(null==e?void 0:e.timeout),totalTime:(null==e?void 0:e.totalTime)||(null==e?void 0:e.timeout),totalSize:null==e?void 0:e.received,url:null==e?void 0:e.url})}},e.prototype.recordRequestedInfoDetail=function(e,t){var r,n,i,o;if(t&&this.state){(null===(r=this.state)||void 0===r?void 0:r.requestedInfoDetail[e])||(this.state.requestedInfoDetail[e]={latestHost:"",list:[]}),this.state.requestedInfoDetail[e].list.length>1e3&&this.state.requestedInfoDetail[e].list.shift();var a="-",s="443";try{var u=((null==t?void 0:t.url)||"").match(/^(?:https?:\/\/)?([^\/\n:]+)(?::(\d+))?/);u[2]&&(s=u[2]);var c=null===(n=u[1])||void 0===n?void 0:n.split(".");a=c.splice(0,c.length-2).join("."),"443"!==s&&(a+=":"+s);var l=this.state.requestedInfoDetail[e].latestHost;l&&l===a||(this.state.requestedInfoDetail[e].latestHost=a)}catch(e){}var d=t.qn||t.representationId;if(d){var p={id:this.state.requestedInfoRecordIndex++,co:t.code,qn:parseInt(d.toString().substr(-3),10),in:t.index,rt:(t.rType||"-").substr(0,1),qr:(t.protocol||"-").substr(0,1),ct:f.default.toFixed(t.currentTime||0,2),bf:f.default.toFixed(t.buffered||0,2),lt:t.latencyTime||0,dt:t.downloadTime||0,cs:t.connectionSpeed||0,ts:t.totalSize||0,ry:t.retryTimes||0,ht:a};null===(o=null===(i=this.state)||void 0===i?void 0:i.requestedInfoDetail[e])||void 0===o||o.list.push([p.id,p.co,p.qn,p.in,{"-":0,X:1,N:2,P:3}[p.rt]||0,{"-":0,T:1,Q:2}[p.qr]||0,p.ct,p.bf,p.lt,p.dt,p.cs,p.ts,p.ry,p.ht])}}},e.prototype.bpNCSaveData=function(e){if(e&&e.url&&e.range&&e.data){var t=this.getBPNC();if(t&&"function"==typeof t.allowDPSaveDataByNC){var r=(""+e.url).split("?")[0].split("/"),n=r[r.length-1].split(".")[0].split("-").pop();if(n){var i=parseInt(n,10);if(!isNaN(i)&&t.allowDPSaveDataByNC({qn:i})){var o={url:e.url,range:e.range,data:e.data,totalSize:e.totalSize,token:t.getToken()};t.saveData(o)}}}}},e.prototype.getBPNC=function(){var e,t="bpNC";return(null===(e=this.config)||void 0===e?void 0:e.hid)&&(t+="_"+this.config.hid),window[t]},e.prototype.covertFragmentInfoObject=function(e){var t={};try{t={type:e.type,mediaType:e.mediaType,startTime:e.startTime,url:e.url,index:e.index,id:e.representationId,qn:this.getQualityNumberFromQualityIndex(e.quality,e.mediaType),range:e.range,duration:e.duration,isError:!1},e.startLoadFragmentTime?t.startDownloadTime=new Date(e.startLoadFragmentTime).getTime():t.startDownloadTime=(new Date).getTime(),e.loadInfo&&(t.loaderType=e.loadInfo.rType)}catch(e){}return t},e.prototype.onDashJSLog=function(e){this.state.logHistory||(this.state.logHistory=[]),this.state.logHistory.length>=2e4&&this.state.logHistory.shift(),e&&this.state.logHistory.push(e.message)},e.prototype.onPredictSeek=function(e){this.fire(p.EVENTS.PREDICT_SEEK,e)},e.prototype.onJumpMediaGap=function(e){this.fire(p.EVENTS.JUMP_MEDIA_GAP,e)},e.prototype.onDashCDNLoadInfo=function(e){var t,r,n,i,o,a,s,u,c;if(null==e?void 0:e.loadInfo){var l=e.loadInfo,d=null==e?void 0:e.mediaInfo.id;for(var f in d&&!this.state.cdnInfoDetail[d]&&(this.state.cdnInfoDetail[d]={cdn:0,p2p:0,nc:0,ncBr:0,pdn:0,business:0,mcdn:0,bcache:0,vcache:0,ncFail:0,ncGotFail:0}),this.state.cdnInfo)l[f]&&(this.state.cdnInfo[f]+=l[f],d&&(this.state.cdnInfoDetail[d][f]+=l[f]));if("XHR"===l.rType&&l.url&&l.cdn){var h=l.url;h.indexOf("upos-")>-1?(this.state.cdnInfo.business+=l.cdn,d&&(this.state.cdnInfoDetail[d].business+=l.cdn)):h.indexOf("os=mcdn")>-1?(this.state.cdnInfo.mcdn+=l.cdn,d&&(this.state.cdnInfoDetail[d].mcdn+=l.cdn)):h.indexOf("os=bcache")>-1?(this.state.cdnInfo.bcache+=l.cdn,d&&(this.state.cdnInfoDetail[d].bcache+=l.cdn)):h.indexOf("os=vcache")>-1&&(this.state.cdnInfo.vcache+=l.cdn,d&&(this.state.cdnInfoDetail[d].vcache+=l.cdn))}this.fire(p.EVENTS.CDN_LOAD_INFO,l)}if((null===(t=null==e?void 0:e.NCInfo)||void 0===t?void 0:t.responseData)&&this.state.NCInfo){var y=null==e?void 0:e.NCInfo,m=(d=y.qn,this.state.NCInfo[d]||{total:0,response:0,expect:0});if(9999===y.code){if(m.total++,y.range){var g=y.range.split("-"),v=parseInt(g[0],10),_=parseInt(g[1],10);_&&(m.expect+=_-v+1||0)}return void(this.state.NCInfo[d]=m)}if(m[y.code]||(m[y.code]={}),4999===y.code)return m[y.code].count=(null===(r=m[y.code])||void 0===r?void 0:r.count)+1||1,(null===(n=this.video)||void 0===n?void 0:n.seeking)&&(m[y.code].seeking=m[y.code].seeking+1||1),void(this.state.NCInfo[d]=m);var E=y.responseData,b=E.gotDataByte,S=E.getDataTime,T=E.usePeerSids,w=E.retryCount,A=E.originRange,R=E.gotDataByteFromBr;T=T||[],b=b||0,S=S||0,R=R||0,w=w||0,A&&A.hasOwnProperty("start")&&A.hasOwnProperty("end")||(A={start:0,end:0});var P=Math.abs(A.end-A.start)+1,D=(null==T?void 0:T.length)||0;if(m.response++,
m[y.code].count=(null===(i=m[y.code])||void 0===i?void 0:i.count)+1||1,m[y.code].bytes=(null===(o=m[y.code])||void 0===o?void 0:o.bytes)+b||b,m[y.code].time=(null===(a=m[y.code])||void 0===a?void 0:a.time)+S||S,m[y.code].peers=(null===(s=m[y.code])||void 0===s?void 0:s.peers)+D||D,m[y.code].retry=(null===(u=m[y.code])||void 0===u?void 0:u.retry)+w||w,m[y.code].expect=(null===(c=m[y.code])||void 0===c?void 0:c.expect)+P||P,4003!==y.code&&40003!==y.code||0!==b||(m[y.code].abnormal=m[y.code].abnormal+1||1),2e3===y.code||24e3===y.code){var I="peers_"+D;m[y.code][I]=m[y.code][I]+1||1}this.state.NCInfo[d]=m}},e.prototype.changePlaybackState=function(e){return this.state.playbackState=e,this},e.prototype.saveNetworkWarningInfo=function(e){this.state.networkWarningHistory&&(this.state.networkWarningHistory||(this.state.networkWarningHistory=[]),this.state.networkWarningHistory.length>=100&&this.state.networkWarningHistory.shift(),this.state.networkWarningHistory.push(e))},e.prototype.detectDefaultQualityChangeAbnormal=function(){var e=this,t=this.state,r=t.defaultVideoQuality,n=t.defaultAudioQuality,i=t.currentQualityIndex,o=i.video,a=i.audio;return[{type:p.STRING.VIDEO,defaultQuality:r,currentIndex:o},{type:p.STRING.AUDIO,defaultQuality:n,currentIndex:a}].forEach((function(t){var r=e.getQualityNumberFromQualityIndex(t.currentIndex,t.type),n=t.defaultQuality,i=t.currentIndex;n>=0&&i>=0&&-1===[i,r].indexOf(n)&&e.fire(p.EVENTS.QUALITY_CHANGE_ABNORMAL,{type:p.EVENTS.QUALITY_CHANGE_ABNORMAL,mediaType:t.type,defaultQuality:n,currentIndex:i,qualityNumber:r})})),this},e.prototype.isUsingWasmPlayer=function(){return window.__ENABLE_WASM_PLAYER__&&this.video instanceof window.BwpElement},e.prototype.filterHEVCSpecialVideoUrl=function(e){var t=this;if("string"!=typeof e&&(null==e?void 0:e.video)){var r=this.state.defaultVideoQuality,n=[p.VIDEO_QN.QN_8K,p.VIDEO_QN.QN_DOLBY_VISION,p.VIDEO_QN.QN_HDR10],i=p.VIDEO_CODEC_ID.HEVC;((null==e?void 0:e.video)||[]).filter((function(e){return e.codecid===i})).length<=0||n.includes(r)||(e.video=e.video.filter((function(e){if(!n.includes(e.id))return!0;var r=t.state.filterVideoInfo,i=p.FILTER_VIDEO_URL_REASON.FILTER_SPECIAL_VIDEO;return void 0===r[i]&&(r[i]=[]),r[i].push(JSON.parse(JSON.stringify(e))),t.onDashJSLog({type:"filterSpecialVideo",message:"filter hevc special video urls"}),!1})))}},e.prototype.filterPdnUrl=function(t){if("string"!=typeof t&&t){var r=t.video,n=t.audio,i=function(e){return"string"==typeof e&&(e.includes("traceid")||e.includes(":8082"))},o=this.shouldFilterPdnUrl(),a=JSON.parse(e.getFawkesConfigValue(p.STRING.DASH_CONFIG,"pdn_disable_qn_list")),s=JSON.parse(e.getFawkesConfigValue(p.STRING.DASH_CONFIG,"pdn_disable_codecid_list")),u=!1,c=function(e){e&&e.length&&e.forEach((function(e){(i(e.baseUrl)||i(e.base_url))&&(o||a.includes(e.id)&&f.default.isInSpareTime()||s.includes(e.codecid)&&f.default.isInSpareTime())&&(u=!0,e.baseUrl&&e.backupUrl&&e.backupUrl.length&&(e.baseUrl=e.backupUrl.shift()),e.base_url&&e.backup_url&&e.backup_url.length&&(e.base_url=e.backup_url.shift()))}))};c(r),c(n),u&&this.onDashJSLog({type:"filterPdn",message:"["+Math.round(performance.now())+"] filter pdn, "+o+", qn list: "+a+", codec list: "+s})}},e.prototype.filterManifest=function(e){var t=e.manifest;e.log=this.onDashJSLog.bind(this),void 0===e.enableAV1&&(e.enableAV1=this.state.enableAV1),void 0===e.enableHEVC&&(e.enableHEVC=this.state.enableHEVC),t&&!t.video&&(this.onDashJSLog({type:"audio-only",message:"playing in audio-only"}),"string"!=typeof t&&(t.video=[]));var r=p.VIDEO_CODEC_ID.AVC;t&&t.video&&t.video instanceof Array&&(this.externalMediaLoader||(this.filterHEVCSpecialVideoUrl(e.manifest),r=g.applyCodecStrategy(e),t.video=t.video.filter((function(e){return e.codecid===r}))),t=this.adjustManifestHack(t));try{this.filterPdnUrl(t)}catch(e){}return{codecId:r,manifest:t}},e.prototype.shouldFilterPdnUrl=function(){try{var t=e.getFawkesConfigValue(p.STRING.DASH_CONFIG,"pdn_mid_black_list"),r=t&&JSON.parse(t)||[],n=f.default.getCookie("DedeUserID"),i=""===n?0:Number(n);if(Math.random()>Number(e.getFawkesConfigValue(p.STRING.DASH_CONFIG,p.STRING.PDN_ENABLE)))return!0;if(r.includes(i))return!0}catch(e){return!1}return!1},e.prototype.adjustManifestHack=function(e){var t;if((null===(t=null==e?void 0:e.video)||void 0===t?void 0:t.length)>1){var r=e.video,n=Math.max.apply(Math,r.map((function(e){return e.bandwidth}))),i=Math.min.apply(Math,r.map((function(e){return e.bandwidth})));if(Math.abs(n-i)<1e4){this.state&&this.state.logHistory.push("Adjust manifest hack, max: "+n+", min: "+i+", delta: "+Math.abs(n-i));for(var o=r.length-1;o>0;o--)r[o-1].bandwidth=Math.max(r[o-1].bandwidth,r[o].bandwidth+1e4)}}return e},e.prototype.processSpecialAudioItem=function(e,t){var r;void 0===t&&(t=30280),e.audio;var n=e.flac,i=e.dolby;if(n&&n.audio&&d.isFLACTypeSupported()&&t===p.FLAC_QN)return n.audio.codecs=n.audio.codecs.toLocaleLowerCase(),void(e.audio=[n.audio]);i&&(null===(r=null==i?void 0:i.audio)||void 0===r?void 0:r.length)&&d.isEC3DolbyATMOSTypeSupported()&&[p.DOLBY_AUDIO_QN.AMTOS,p.DOLBY_AUDIO_QN.AUDIO].includes(t)&&(e.audio=s(i.audio))},e.prototype.checkAudioCodecCanUseByType=function(e){var t=this.state.mpd&&this.state.mpd[p.STRING.AUDIO]?this.state.mpd[p.STRING.AUDIO]:this.state.manifest&&this.state.manifest.audio?this.state.manifest.audio:void 0;if(!t||!t.length)return!1;switch(e){case p.SPECIAL_AUDIO_TYPE.DOLBY:if(d.isEC3DolbyATMOSTypeSupported())return-1!==t.findIndex((function(e){return e.id===p.DOLBY_AUDIO_QN.AUDIO||e.id===p.DOLBY_AUDIO_QN.AMTOS}));break;case p.SPECIAL_AUDIO_TYPE.FLAC:if(d.isFLACTypeSupported())return-1!==t.findIndex((function(e){return e.id===p.FLAC_QN}))}return!1},e.prototype.qualityNumberDowngrading=function(e,t){var r=f.default.getDecodeErrorMediaQualityNumberListForType(e,p.STRING.BILIBILI_DECODE_ERROR_OBJ),n=Object.keys(this.state.qualityNumberMap[e]).map(Number).reverse(),i=0;if(r.length>0){for(;r.includes(t)&&i<n.length;)t=n[i++];if(r.includes(t))return-1}return t},e.EVENTS=p.EVENTS,e.ERROR=p.ERROR,e.STRING=p.STRING,e.BUFFERING=y.BUFFERING,e.CONFIG=l.CONFIG,e.ERROR_CODE=p.ERROR_CODE,e.id=0,e.isHEVCTypeSupported=d.isHEVCTypeSupported,e.isBwpHEVCPrefSupported=d.isBwpHEVCPrefSupported,e.isHEVCHDR10TypeSupported=d.isHEVCHDR10TypeSupported,e.isEC3DolbyATMOSTypeSupported=d.isEC3DolbyATMOSTypeSupported,e.isHEVCDolbyVisionTypeSupported=d.isHEVCDolbyVisionTypeSupported,e.isHEVC8kTypeSupported=d.isHEVC8kTypeSupported,e.isAV1TypeSupported=d.isAV1TypeSupported,e.isAV18KTypeSupported=d.isAV18KTypeSupported,e.is8KTypeSupported=d.is8KTypeSupported,e.getSupportedVideoIdList=d.getSupportedVideoIdList,e.shouldUseHardwareDecodingAV1=d.shouldUseHardwareDecodingAV1,e.isFLACTypeSupported=d.isFLACTypeSupported,e.getVideoCodecStrategy=d.getVideoCodecStrategy,e.isMultiAudioTracksSupported=d.isMultiAudioTracksSupported,e.shouldUseNativeHEVCDecode=d.shouldUseNativeHEVCDecode,e.fawkesConfig=null,e}();t.default=b},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.rmLocalDecodeErrorInfo=t.setLocalDecodeErrorInfo=t.getLocalDecodeErrorInfo=t.getCPULogicCount=t.getOS=t.shouldUseNativeHEVCDecode=t.isMultiAudioTracksSupported=t.getVideoCodecStrategy=t.isFLACTypeSupported=t.shouldUseHardwareDecodingAV1=t.isBrowserSupportHardwareDecodeAV1=t.getSupportedVideoIdList=t.is8KTypeSupported=t.isAV18KTypeSupported=t.isBrowserSupportAV1=t.isMIMETypeSupported=t.isAV1TypeSupported=t.isHEVC8kTypeSupported=t.isHEVCDolbyVisionTypeSupported=t.isEC3DolbyATMOSTypeSupported=t.isHEVCHDR10TypeSupported=t.isBwpHEVCPrefSupported=t.isHEVCTypeSupported=void 0;var i=r(2),o=r(6),a=n(r(4)),s=r(12);t.isHEVCTypeSupported=function(){return"1"!==a.default.getSessionStorage("enableHEVCError")&&(!!window.__ENABLE_WASM_PLAYER__||window.MediaSource&&window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="hev1.1.6.L120.90"'))},t.isBwpHEVCPrefSupported=function(){if("1"===a.default.getSessionStorage("enableHEVCError"))return!1;switch(s.getUserCodecPreferType()){case i.USER_CODEC_PREFER_TYPE.HEVC:return!0
;case i.USER_CODEC_PREFER_TYPE.AV1:case i.USER_CODEC_PREFER_TYPE.DISABLE:return!1;default:var e=parseInt(a.default.getLocalStorage("bilibili_player_codec_prefer_strategy"),10);return i.USER_CODEC_PREFER_TYPE.DISABLE!==e}};var u=function(e){var t,r,n,i;if("1"===a.default.getSessionStorage("enableHEVCError"))return!1;var s=!1,u=null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase(),c=u.indexOf("safari")>-1&&u.indexOf("chrom")<0,l=0,d=u.match(/version\/\d+/);c&&d&&d.length&&(l=Number(d[0].substr(8)));var f=u.indexOf("edge/")>-1,p=0,h=u.match(/edge\/\d+/);f&&h&&h.length&&(p=Number(h[0].substr(5)));var y=(null==e?void 0:e.codec)||"hev1.2.4.H150.90",m=window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="'+y+'"'),g=null===(n=window.matchMedia("(color-gamut:p3)"))||void 0===n?void 0:n.matches,v=(null===(i=window.screen)||void 0===i||i.colorDepth,parseInt(a.default.getLocalStorage("bilibili_player_force_hdr"),10)),_=o.getCurrentBrowserInfo(),E=_.type,b=_.version;return m&&(c&&g&&l>=13||f&&p>=18||g&&"Chrome"===E&&b>=104||v)&&(s=!0),s};t.isHEVCHDR10TypeSupported=u;var c=function(e){var t=window.MediaSource;return t&&!!t.isTypeSupported(e)};t.isMIMETypeSupported=c;var l=function(e){var t,r,n,i;if("1"===a.default.getSessionStorage("enableHEVCError"))return!1;var s=null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase(),u=o.getSafariInfo(s),l=o.getEdgeInfo(s),d=!1;if(e&&e.codec)d=c('video/mp4; codecs="'+e.codec+'"');else{var f=c('video/mp4; codecs="hev1.1.6.L153.90"'),p=c('video/mp4; codecs="dvh1.05.06"');d=f&&p}var h=parseInt(a.default.getLocalStorage("bilibili_player_force_hdr"),10);if(!d)return!1;var y=!1;u.isSafari&&(y=(null===(n=window.matchMedia("(color-gamut:p3)"))||void 0===n?void 0:n.matches)&&u.version>=13||!1),l.isEdge&&(y=l.version>=18);var m=o.getCurrentBrowserInfo(),g=m.type,v=m.version;return"Chrome"===g&&(y=(null===(i=window.matchMedia("(color-gamut:p3)"))||void 0===i?void 0:i.matches)&&v>=104||!1),!!h||y};t.isHEVCDolbyVisionTypeSupported=l,t.isEC3DolbyATMOSTypeSupported=function(){var e,t,r=c('audio/mp4; codecs="ec-3"'),n=null===(t=null===(e=window.navigator)||void 0===e?void 0:e.userAgent)||void 0===t?void 0:t.toLowerCase(),i=o.getSafariInfo(n),a=o.getEdgeInfo(n);return!!r&&(i.isSafari&&i.version>=13||a.isEdge)};var d=function(e){var t=(null==e?void 0:e.width)||7680,r=(null==e?void 0:e.height)||4320,n=(null==e?void 0:e.codec)||"hev1.1.6.L180.90";if(!c('video/mp4;codecs="'+n+'";width='+t+";height="+r))return!1;var i=o.getSafariInfo();return!!parseInt(a.default.getLocalStorage("bilibili_player_force_8k"),10)||i.isSafari&&i.version>=13};t.isHEVC8kTypeSupported=d;var f=function(e){var t=o.getCurrentBrowserInfo(),r=t.type,n=t.version;return e="number"==typeof e?e:4e3,r===o.BROWSER_TYPE.ChromiumEdge&&n>=79||r===o.BROWSER_TYPE.Chrome&&n>=70||r===o.BROWSER_TYPE.Firefox&&n>=67||r===o.BROWSER_TYPE.QQ&&n>=70&&e<=4e3};t.isBrowserSupportAV1=f,t.isAV1TypeSupported=function(e){if(!window||!window.MediaSource||!window.MediaSource.isTypeSupported)return!1;if(!f())return!1;var t="av01.0.08M.08.0.110.01.01.01.0";if(!e)return c('video/mp4;codecs="'+t+'";');var r=e.width,n=e.height;return c('video/mp4;codecs="'+t+'";width='+r+";height="+n)};var p=function(e){var t=(null==e?void 0:e.width)||7680,r=(null==e?void 0:e.height)||4320,n=(null==e?void 0:e.codec)||"av01.0.16M.08.0.110.01.01.01.0";return!!c('video/mp4;codecs="'+n+'";width='+t+";height="+r)&&(!!parseInt(a.default.getLocalStorage("bilibili_player_force_8k"),10)||f())};t.isAV18KTypeSupported=p,t.is8KTypeSupported=function(){return p()||d()},t.getSupportedVideoIdList=function(e,t,r){try{var n=[],o="boolean"!=typeof(null==t?void 0:t.enableHEVC)||t.enableHEVC,a="boolean"!=typeof(null==t?void 0:t.enableAV1)||t.enableAV1,s=function(e){return-1!==e.indexOf("av01")?i.VIDEO_CODEC_ID.AV1:-1!==e.indexOf("hev")||-1!==e.indexOf("dvh")?i.VIDEO_CODEC_ID.HEVC:i.VIDEO_CODEC_ID.AVC},f=function(e){return e&&e instanceof Array&&e.length>0},h=function(e,t,r,n){for(var o=n[0],a=n[1],u=0,c=e;u<c.length;u++){var l=c[u],f=s(l);if(f===i.VIDEO_CODEC_ID.AV1&&a&&p({codec:l})){t.push(r);break}if(f===i.VIDEO_CODEC_ID.HEVC&&o&&d({codec:l})){t.push(r);break}}},y=function(e,t,r,n){for(var i=0,o=e;i<o.length;i++)if(n({codec:o[i]})){t.push(r);break}};if(!f(e))return n;var m="number"==typeof r?r:0,g=e.filter((function(e){return e.quality>m}));if(g.length<=0)return n;for(var v=0,_=g;v<_.length;v++){var E=_[v],b=E.quality,S=E.codecs;if(f(S))if([i.VIDEO_QN.QN_DOLBY_VISION,i.VIDEO_QN.QN_HDR10,i.VIDEO_QN.QN_8K].includes(b))if(i.VIDEO_QN.QN_8K===b)(o||a)&&h(S,n,b,[o,a]);else{if(!o)continue;y(S,n,b,i.VIDEO_QN.QN_DOLBY_VISION===b?l:u)}else for(var T=0,w=S;T<w.length;T++){var A=w[T];if(c('video/mp4;codecs="'+A+'";')){n.push(b);break}}else n.push(b)}return n}catch(e){return[]}};var h=function(){var e=o.getCurrentBrowserInfo(),t=e.type,r=e.version;return t===o.BROWSER_TYPE.ChromiumEdge&&r>=79||t===o.BROWSER_TYPE.Chrome&&r>=70};t.isBrowserSupportHardwareDecodeAV1=h,t.shouldUseHardwareDecodingAV1=function(){if(!h())return!1;var e=o.getGPUInfo().toLowerCase();return!!Object.values({rtx3xx:/rtx 3[0-9]{3}/,m1max:/m1 max/}).some((function(t){return t.test(e)}))},t.isFLACTypeSupported=function(){var e,t,r=c('audio/mp4; codecs="flac"'),n=null===(t=null===(e=window.navigator)||void 0===e?void 0:e.userAgent)||void 0===t?void 0:t.toLowerCase(),i=o.getSafariInfo(n);return!!r&&(i.isSafari&&i.version>=13||r)},t.getVideoCodecStrategy=function(e){return s.applyCodecStrategy(e)},t.isMultiAudioTracksSupported=function(){var e=o.getCurrentBrowserInfo(),t=e.type,r=e.version;return t===o.BROWSER_TYPE.ChromiumEdge&&r>=79||t===o.BROWSER_TYPE.Chrome&&r>=69||t===o.BROWSER_TYPE.Firefox&&r>=67||t===o.BROWSER_TYPE.QQ&&r>=69||t===o.BROWSER_TYPE.Safari&&r>=13||t===o.BROWSER_TYPE.Sogou};var y=function(){var e=window.navigator.userAgent,t=window.navigator.platform,r=null;return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?r="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(t)?r="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(t)?r="Windows":/Android/.test(e)?r="Android":!r&&/Linux/.test(t)&&(r="Linux"),r};t.getOS=y,t.getCPULogicCount=function(){return navigator.hardwareConcurrency||0},t.shouldUseNativeHEVCDecode=function(){var e=o.getCurrentBrowserInfo().type,t="Mac OS"===y(),r=c('video/mp4; codecs="hev1.1.6.L120.90"');return e===o.BROWSER_TYPE.ChromiumEdge?t&&r:r},t.getLocalDecodeErrorInfo=function(e){var t="decode"+e+"Error",r=a.default.getLocalStorage(t);return r?JSON.parse(r):null},t.setLocalDecodeErrorInfo=function(e,t){var r="decode"+e+"Error";a.default.setLocalStorage(r,JSON.stringify(t))},t.rmLocalDecodeErrorInfo=function(e){var t="decode"+e+"Error";a.default.removeStorage(t)}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getUserCodecPreferType=t.applyCodecStrategy=void 0;var i=r(2),o=r(6),a=n(r(4)),s=r(11),u="bilibili_player_codec_prefer_type",c={HARDWARE:i.VIDEO_QN.QN_4K,SOFTWARE:i.VIDEO_QN.QN_1080P_60},l=[i.VIDEO_QN.QN_8K],d={HARDWARE:i.VIDEO_QN.QN_4K,SOFTWARE:i.VIDEO_QN.QN_1080P_PLUS,WASM:i.VIDEO_QN.QN_1080P_60},f=[i.VIDEO_QN.QN_HDR10,i.VIDEO_QN.QN_DOLBY_VISION,i.VIDEO_QN.QN_8K];function p(){return parseInt(a.default.getLocalStorage(u),10)||i.USER_CODEC_PREFER_TYPE.RECOMMEND}function h(){return new Promise((function(e,t){var r="bilibili_player_codec_prefer_reset",n="1.5.2";a.default.getLocalStorage(r)!==n?(a.default.setLocalStorage(r,n),e()):t()}))}t.applyCodecStrategy=function(e){var t,r,n=e.state,y=e.manifest,m=e.enableAV1,g=e.enableHEVC,v=e.log,_=e.defaultVideoQn,E=i.VIDEO_CODEC_ID.HEVC,b=i.VIDEO_CODEC_ID.AV1,S=i.VIDEO_CODEC_ID.AVC,T=n?n.defaultVideoQuality:_;T=T||0;var w=-1,A=-1,R=!1,P=!1,D=y.video,I=y.duration;if(D&&D.forEach((function(e){e.codecid===b&&(w=s.isMIMETypeSupported('video/mp4;codecs="'+e.codecs+'";')?1:0,e.id!==T&&0!==T||(R=!0)),e.codecid===E&&(A=s.isMIMETypeSupported('video/mp4;codecs="'+e.codecs+'";')?1:0,e.id!==T&&0!==T||(P=!0))})),v&&v({type:"UA",
message:""+(null===(r=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===r?void 0:r.toLowerCase())}),v&&v({type:"abilityDetect",message:"[0]Ability: isAV1CodecSupported: "+w+", isAV1HasCurrentQn: "+R+"        isHEVCCodecSupported: "+A+", isHEVCHasCurrentQn: "+P}),1===w&&R&&function(e,t,r,n,o){var u=e;if(u){var d=0;t&&t.defaultVideoQuality?d=t.defaultVideoQuality:"number"==typeof o&&(d=o);var f=c.HARDWARE,h=c.SOFTWARE;d>(s.shouldUseHardwareDecodingAV1()?f:h)&&(u=!1);var y=p();switch(y){case i.USER_CODEC_PREFER_TYPE.AV1:u=!0;break;case i.USER_CODEC_PREFER_TYPE.DISABLE:case i.USER_CODEC_PREFER_TYPE.HEVC:u=!1}var m=s.getLocalDecodeErrorInfo("AV1"),g=(new Date).getTime();m&&(m.reactivateTime||0)>g&&(u=!1),l.includes(d)&&(u=!0),s.isBrowserSupportAV1(r)||(u=!1);var v=!!+a.default.getSessionStorage("enableAV1Error");v&&(u=!1),n&&n({type:"applyAV1Strategy",message:"[1] Apply AV1 strategy, enable: "+u+", preferType: "+y+", hardwareLimit: "+f+", softwareLimit: "+h+", prevEnableAV1Error: "+v})}return u}(m,n,I,v,_))return b;var O=!!window.__ENABLE_WASM_PLAYER__;return(1===A||O)&&P&&function(e,t,r,n){var c=e;if(c){var l=navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase(),y=l.indexOf("edge/")>-1,m=t&&t.defaultVideoQuality||n,g=d.SOFTWARE,v=d.HARDWARE,_=d.WASM,E=o.getCurrentBrowserInfo(),b=E.type,S=E.version,T=b===o.BROWSER_TYPE.Chrome&&S>108&&s.getCPULogicCount()>=8?v:g,w=m>T&&!y&&l.indexOf("chrome/")>0,A=m>v,R=b===o.BROWSER_TYPE.ChromiumEdge,P=!!+a.default.getSessionStorage("enableHEVCError"),D=parseInt(a.default.getLocalStorage("bilibili_player_codec_prefer_strategy"),10);window.__ENABLE_WASM_PLAYER__?m>_&&(c=!1):(w||A)&&(c=!1);var I=p();i.USER_CODEC_PREFER_TYPE.HEVC===I?c=!0:i.USER_CODEC_PREFER_TYPE.DISABLE===I||i.USER_CODEC_PREFER_TYPE.AV1===I?(c=!1,h().then((function(){a.default.setLocalStorage(u,""+i.USER_CODEC_PREFER_TYPE.RECOMMEND)})).catch((function(){}))):(h().catch((function(){})),i.USER_CODEC_PREFER_TYPE.DISABLE===D&&(c=!1));var O=s.getLocalDecodeErrorInfo("HEVC"),C=(new Date).getTime();O&&(O.reactivateTime||0)>C&&(c=!1),f.includes(m)&&(c=!0),(!window.__ENABLE_WASM_PLAYER__&&R&&"Mac OS"!==s.getOS()||P)&&(c=!1),r&&r({type:"applyHEVCStrategy",message:"[1] Apply HEVC strategy, enable: "+c+", preferType: "+I+", hardwareLimit: "+v+", softwareLimit: "+T+", wasm: "+_+", prevEnableHEVCError: "+P+", strategyType: "+D})}return c}(g,n,v,_)?E:S},t.getUserCodecPreferType=p},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.BUFFERING=void 0;var i=r(2);t.BUFFERING={PLAYBACK:{PLAYING:1,SEEKING:2,SWITCHING_QUALITY:3,SWITCHING_SOURCE:4,UPDATING_SOURCE:5,APPENDING_SOURCE:6},TYPE:{UNKNOWN:0,SEEKING:10,SEEKING_INSIDE_BUFFERED:11,SEEKING_OUTSIDE_BUFFERED:12,NETWORK:20,NETWORK_CONNECT_TIMEOUT:21,NETWORK_READING_TIMEOUT:22,NETWORK_DOWNLOAD_TIMEOUT:23,NETWORK_DOWNLOAD_ERROR:24,NETWORK_POOR:25,NETWORK_POOR_UNDER_PLAYBACKRATE:26,NETWORK_DOWNLOAD_TOO_LONG:27,MEDIA:30,MEDIA_ERR_ABORTED:31,MEDIA_ERR_NETWORK:32,MEDIA_ERR_DECODE:33,MEDIA_ERR_SRC_NOT_SUPPORTED:34,MEDIA_DECODING_PERFORMANCE:35,GAP:40,GAP_BEFORE_CURRENT:41,GAP_AFTER_CURRENT:42,PERFORMANCE:50,PERFORMANCE_UNKNOWN:51,INTERNAL:60,INTERNAL_STARTING:61,INTERNAL_ENDING:62,INTERNAL_UNNORMAL_RANGES:63,INTERNAL_VIDEO_RANGES:64,INTERNAL_AUDIO_RANGES:65}};var o=function(){function e(e){this.video=e,this.swichingInfo=null,this.downloadInfo=null}return e.prototype.destroy=function(){this.swichingInfo=null,this.downloadInfo=null,this.video=null},e.prototype.setSwitchingInfo=function(e){if(this.swichingInfo=e,e&&this.video&&this.video.buffered&&this.video.buffered.length>0){var t=this.video.buffered.end(this.video.buffered.length-1),r=this.video.currentTime,n=Math.floor(1e3*(t-r))/1e3;this.swichingInfo.bufferLen=n}},e.prototype.getInfo=function(e){var r={type:-1};if(!e)return r;try{var i=this.video,o=i.currentTime,a=i.duration,s=i.readyState,u=i.buffered,c=u&&u.length,l=i.seeking,d=i.playbackRate,f=t.BUFFERING.TYPE.UNKNOWN,p=e.playbackState||t.BUFFERING.PLAYBACK.PLAYING;if(!l||p!==t.BUFFERING.PLAYBACK.PLAYING&&p!==t.BUFFERING.PLAYBACK.SWITCHING_QUALITY||(p=t.BUFFERING.PLAYBACK.SEEKING),r={type:f,isSeeking:l,cTime:o,duration:a,rState:s,nRanges:c,vLength:e.videoBufferLength,aLength:e.audioBufferLength,activity:e.networkActivity,vSpeed:Math.round(e.videoSpeed),aSpeed:Math.round(e.audioSpeed),playbackRate:d,vQn:e.videoCurrentQn,aQn:e.audioCurrentQn,retryTimes:e.retryTimes,seekSpace:e.seekSpace},p===t.BUFFERING.PLAYBACK.SEEKING)f=0===c?t.BUFFERING.TYPE.SEEKING_OUTSIDE_BUFFERED:t.BUFFERING.TYPE.SEEKING_INSIDE_BUFFERED;else{var h=this.checkGapInfo(),y=h.nativeBufferLength;if(r.nLength=y,r.cRange=h.start+"-"+h.end,h.hasGap)f=h.type,r.gap=h.gapStart+"-"+h.gapEnd,r.gapLength=h.gapLength;else if(y<1){var m=this.checkLackOfBufferInfo(e);f=m.type,r.vCode=m.videoErrorCode,r.aCode=m.audioErrorCode}else f=s>=3?t.BUFFERING.TYPE.PERFORMANCE:t.BUFFERING.TYPE.PERFORMANCE_UNKNOWN}var g=this.checkNativeErrorInfo();g.type&&(f=g.type,r.nCode=g.code);var v=e.fragmentLoadingInfo;if(v&&v.video){var _=v.video;r.vFragment=_.id+"-"+_.index,e.latestPlayurlErrorHTTPCode&&(r.hCode=e.latestPlayurlErrorHTTPCode)}v&&v.audio&&(_=v.audio,r.aFragment=_.id+"-"+_.index,e.latestPlayurlErrorHTTPCode&&(r.hCode=e.latestPlayurlErrorHTTPCode)),r.type=""+p+(f||"00")}catch(e){throw new Error(e.message)}return this.swichingInfo&&(r=n(n({},r),this.swichingInfo)),this.downloadInfo&&(r=n(n({},r),this.downloadInfo)),r},e.prototype.checkGapInfo=function(){var e=this.video,r=e.currentTime,n=e.buffered,i=n&&n.length,o=0,a=!1,s=0,u=0,c={start:0,end:0},l=0,d=t.BUFFERING.TYPE.UNKNOWN;if(i&&i>1)for(var f=0;f<i;f++){var p=n.start(f),h=n.end(f);p<=r&&h>=r&&(o=Math.floor(1e3*(h-r))/1e3,c={start:p,end:h},d===t.BUFFERING.TYPE.GAP_BEFORE_CURRENT?u=p:s=h),p>r&&p-r<=1&&d!==t.BUFFERING.TYPE.GAP_BEFORE_CURRENT&&(a=!0,d=t.BUFFERING.TYPE.GAP_AFTER_CURRENT,u=u?Math.min(u,p):p,s=c.end),r-h<3&&r-h>=0&&(a=!0,d=t.BUFFERING.TYPE.GAP_BEFORE_CURRENT,s=h,u=c.start)}else 1===i&&(h=n.end(0),c={start:n.start(0),end:h},o=Math.floor(1e3*(h-r))/1e3);return a&&(l=Math.round(1e3*(u-s))/1e3),{type:d,start:c.start,end:c.end,nativeBufferLength:o,hasGap:a,gapStart:s,gapEnd:u,gapLength:l}},e.prototype.checkLackOfBufferInfo=function(e){var r=t.BUFFERING.TYPE.UNKNOWN,n=this.video,i=n.currentTime,o=n.buffered,a=n.duration,s=n.readyState,u=0,c=0;if(o&&o.length)if(a&&a-i<1)r=t.BUFFERING.TYPE.INTERNAL_ENDING;else{var l=this.checkNetworkInfo(e);r=l.type,u=l.videoErrorCode,c=l.audioErrorCode}else r=i<=e.startOffsetTime&&s<=1?t.BUFFERING.TYPE.INTERNAL_STARTING:(e.networkActivity.length&&e.networkActivity.reduce((function(e,t){return e+t})))<100?t.BUFFERING.TYPE.NETWORK_POOR:e.videoBufferLength?e.audioBufferLength?t.BUFFERING.TYPE.INTERNAL_UNNORMAL_RANGES:t.BUFFERING.TYPE.INTERNAL_AUDIO_RANGES:t.BUFFERING.TYPE.INTERNAL_VIDEO_RANGES;return{type:r,videoErrorCode:u,audioErrorCode:c}},e.prototype.checkNetworkInfo=function(e){var r=this,n=t.BUFFERING.TYPE.UNKNOWN,o=this.video.currentTime,a=e.videoBufferLength||0,s=e.audioBufferLength||0,u=e.networkWarningHistory,c=this.getCurrentNetworkWarningInfo({mediaType:i.STRING.VIDEO,currentQn:e.videoCurrentQn,networkWarningHistory:u,warningTime:o+a,bufferLength:a},1),l=this.getCurrentNetworkWarningInfo({mediaType:i.STRING.AUDIO,currentQn:e.audioCurrentQn,networkWarningHistory:u,warningTime:o+s,bufferLength:s},1),d=c.code,f=l.code,p=this.getBufferingTypeByPoorNetwork(d),h=this.getBufferingTypeByPoorNetwork(f);if(p||h)n=p||"00",h&&(n=""+n+h);else if(this.video.playbackRate>1)n=t.BUFFERING.TYPE.NETWORK_POOR_UNDER_PLAYBACKRATE;else{var y=e.fragmentLoadingInfo,m=function(e){if(!e)return!1;var t=e.startDownloadTime,n=e.loaderType,i=e.qn,o=e.index,a=((new Date).getTime()-t)/1e3;return r.downloadInfo||(r.downloadInfo={}),r.downloadInfo[e.mediaType]={downloadTime:a,loaderType:n,qn:i,index:o},a>5};if(y){var g=y.video,v=y.audio,_=m(g),E=m(v)
;n=_||E?t.BUFFERING.TYPE.NETWORK_DOWNLOAD_TOO_LONG:t.BUFFERING.TYPE.NETWORK}else n=t.BUFFERING.TYPE.NETWORK}return{type:n,videoErrorCode:d,audioErrorCode:f,videoBufferLength:a,audioBufferLength:s}},e.prototype.checkNativeErrorInfo=function(){var e=this.video.error,r=e&&e.code||0,n=t.BUFFERING.TYPE.UNKNOWN;if(e&&r)switch(r){case 1:n=t.BUFFERING.TYPE.MEDIA_ERR_ABORTED;break;case 2:n=t.BUFFERING.TYPE.MEDIA_ERR_NETWORK;break;case 3:n=t.BUFFERING.TYPE.MEDIA_ERR_DECODE;break;case 4:n=t.BUFFERING.TYPE.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:n=t.BUFFERING.TYPE.MEDIA}return{type:n,code:r}},e.prototype.getCurrentNetworkWarningInfo=function(e,t){if(void 0===t&&(t=1),!e)return{code:0};var r=e.mediaType,n={code:0,type:"",mediaType:e.mediaType},i=e.networkWarningHistory,o=e.warningTime,a=e.bufferLength,s=e.currentQn;if(i.length&&a<t){o+=t;try{var u=i.filter((function(e){return e.mediaType===r&&e.startTime<=o+t&&e.startTime+e.duration>=o&&e.id===s.toString()}));u.length&&(n=u[u.length-1])}catch(e){throw new Error("getCurrentNetworkWarningInfo error, "+JSON.stringify(e))}}return n},e.prototype.getBufferingTypeByPoorNetwork=function(e){var r=t.BUFFERING.TYPE.UNKNOWN;if(e)switch(e){case i.ERROR.CONNECT_FRAGMENT_ERROR_TIMEOUT:r=t.BUFFERING.TYPE.NETWORK_CONNECT_TIMEOUT;break;case i.ERROR.DOWNLOAD_FRAGMENT_ERROR_TIMEOUT:r=t.BUFFERING.TYPE.NETWORK_DOWNLOAD_TIMEOUT;break;case i.ERROR.DOWNLOAD_FRAGMENT_ERROR:r=t.BUFFERING.TYPE.NETWORK_DOWNLOAD_ERROR}return r},e}();t.default=o},function(e,t,r){"use strict";var n=Array.isArray,i=Object.keys,o=Object.prototype.hasOwnProperty;e.exports=function e(t,r){if(t===r)return!0;var a,s,u,c=n(t),l=n(r);if(c&&l){if((s=t.length)!=r.length)return!1;for(a=0;a<s;a++)if(!e(t[a],r[a]))return!1;return!0}if(c!=l)return!1;var d=t instanceof Date,f=r instanceof Date;if(d!=f)return!1;if(d&&f)return t.getTime()==r.getTime();var p=t instanceof RegExp,h=r instanceof RegExp;if(p!=h)return!1;if(p&&h)return t.toString()==r.toString();if(t instanceof Object&&r instanceof Object){var y=i(t);if((s=y.length)!==i(r).length)return!1;for(a=0;a<s;a++)if(!o.call(r,y[a]))return!1;for(a=0;a<s;a++)if(!e(t[u=y[a]],r[u]))return!1;return!0}return!1}},function(e,t,r){!function(e){"use strict";var t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},r=function(e){var r=e;return t.hasOwnProperty(e)&&(r=t[e]),String.fromCharCode(r)},n=15,i=32,o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},a={17:2,18:4,21:6,22:8,23:10,19:13,20:15},s={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},u={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],l={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var r=this.verboseFilter[e];this.verboseLevel>=r&&console.log(this.time+" ["+e+"] "+t)}},d=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},f=function(e,t,r,n,i){this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=n||"black",this.flash=i||!1};f.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},copy:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var p=function(e,t,r,n,i,o){this.uchar=e||" ",this.penState=new f(t,r,n,i,o)};p.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(e,t){this.uchar=e,this.penState.copy(t)},setPenState:function(e){this.penState.copy(e)},equals:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},copy:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var h=function(){this.chars=[];for(var e=0;e<i;e++)this.chars.push(new p);this.pos=0,this.currPenState=new f};h.prototype={equals:function(e){for(var t=!0,r=0;r<i;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},copy:function(e){for(var t=0;t<i;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<i;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},setCursor:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(l.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(l.log("ERROR","Too large cursor position "+this.pos),this.pos=i)},moveCursor:function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(e){e>=144&&this.backSpace();var t=r(e);this.pos>=i?l.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},clearFromPos:function(e){var t;for(t=e;t<i;t++)this.chars[t].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var e=[],t=!0,r=0;r<i;r++){var n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")},setPenStyles:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}};var y=function(){this.rows=[];for(var e=0;e<n;e++)this.rows.push(new h);this.currRow=14,this.nrRollUpRows=null,this.reset()};y.prototype={reset:function(){for(var e=0;e<n;e++)this.rows[e].clear();this.currRow=14},equals:function(e){for(var t=!0,r=0;r<n;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},copy:function(e){for(var t=0;t<n;t++)this.rows[t].copy(e.rows[t])},isEmpty:function(){for(var e=!0,t=0;t<n;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(e){this.rows[this.currRow].insertChar(e)},setPen:function(e){this.rows[this.currRow].setPenStyles(e)},moveCursor:function(e){this.rows[this.currRow].moveCursor(e)},setCursor:function(e){l.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},setPAC:function(e){l.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.currRow=t;var r=this.rows[this.currRow];if(null!==e.indent){var n=e.indent,i=Math.max(n-1,0);r.setCursor(e.indent),e.color=r.chars[i].penState.foreground}var o={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(o)},setBkgData:function(e){l.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},setRollUpRows:function(e){this.nrRollUpRows=e},rollUp:function(){if(null!==this.nrRollUpRows){l.log("TEXT",this.getDisplayText())
;var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),l.log("INFO","Rolling up")}else l.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(e){e=e||!1;for(var t=[],r="",i=-1,o=0;o<n;o++){var a=this.rows[o].getTextString();a&&(i=o+1,e?t.push("Row "+i+': "'+a+'"'):t.push(a.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},getTextAndFormat:function(){return this.rows}};var m=function(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new y,this.nonDisplayedMemory=new y,this.lastOutputScreen=new y,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};m.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(e){this.outputFilter=e},setPAC:function(e){this.writeScreen.setPAC(e)},setBkgData:function(e){this.writeScreen.setBkgData(e)},setMode:function(e){e!==this.mode&&(this.mode=e,l.log("INFO","MODE="+e),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},insertChars:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";l.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(l.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){l.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){l.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){l.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(e){l.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},cc_FON:function(){l.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){l.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){l.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){l.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){l.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){l.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){l.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(l.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,l.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(e){l.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},cc_MIDROW:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}l.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},outputDataUpdate:function(){var e=l.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}};var g=function(e,t,r){this.field=e||1,this.outputs=[t,r],this.channels=[new m(1,t),new m(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};g.prototype={getHandler:function(e){return this.channels[e].getHandler()},setHandler:function(e,t){this.channels[e].setHandler(t)},addData:function(e,t){var r,n,i,o=!1;this.lastTime=e,l.setTime(e);for(var a=0;a<t.length;a+=2)n=127&t[a],i=127&t[a+1],n>=16&&n<=31&&n===this.lastCmdA&&i===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,l.log("DEBUG","Repeated command ("+d([n,i])+") is dropped")):0!==n||0!==i?(l.log("DATA","["+d([t[a],t[a+1]])+"] -> ("+d([n,i])+")"),(r=this.parseCmd(n,i))||(r=this.parseMidrow(n,i)),r||(r=this.parsePAC(n,i)),r||(r=this.parseBackgroundAttributes(n,i)),r||(o=this.parseChars(n,i))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(o):l.log("WARNING","No channel found yet. TEXT-MODE?")),r?this.dataCounters.cmd+=2:o?this.dataCounters.char+=2:(this.dataCounters.other+=2,l.log("WARNING","Couldn't parse cleaned data "+d([n,i])+" orig: "+d([t[a],t[a+1]])))):this.dataCounters.padding+=2},parseCmd:function(e,t){var r;if(!((20===e||21===e||28===e||29===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;r=20===e||21===e||23===e?1:2;var n=this.channels[r-1];return 20===e||21===e||28===e||29===e?32===t?n.cc_RCL():33===t?n.cc_BS():34===t?n.cc_AOF():35===t?n.cc_AON():36===t?n.cc_DER():37===t?n.cc_RU(2):38===t?n.cc_RU(3):39===t?n.cc_RU(4):40===t?n.cc_FON():41===t?n.cc_RDC():42===t?n.cc_TR():43===t?n.cc_RTD():44===t?n.cc_EDM():45===t?n.cc_CR():46===t?n.cc_ENM():47===t&&n.cc_EOC():n.cc_TO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},parseMidrow:function(e,t){var r=null;if((17===e||25===e)&&32<=t&&t<=47){if((r=17===e?1:2)!==this.currChNr)return l.log("ERROR","Mismatch channel in midrow parsing"),!1;var n=this.channels[r-1];return n.insertChars([32]),n.cc_MIDROW(t),l.log("DEBUG","MIDROW ("+d([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1},parsePAC:function(e,t){var r,n;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;r=e<=23?1:2,n=64<=t&&t<=95?1===r?o[e]:s[e]:1===r?a[e]:u[e];var i=this.interpretPAC(n,t);return this.channels[r-1].setPAC(i),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},interpretPAC:function(e,t){var r,n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,n.underline=1==(1&r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n},parseChars:function(e,t){var n,i=null,o=null,a=null;(e>=25?(i=2,a=e-8):(i=1,a=e),17<=a&&a<=19)?(n=17===a?t+80:18===a?t+112:t+144,l.log("INFO","Special char '"+r(n)+"' in channel "+i),o=[n],this.lastCmdA=e,this.lastCmdB=t):32<=e&&e<=127&&(o=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null);if(o){var s=d(o);l.log("DEBUG","Char codes =  "+s.join(","))}return o},parseBackgroundAttributes:function(e,t){var r,n,i;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(r={},16===e||24===e?(n=Math.floor((t-32)/2),r.background=c[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),i=e<24?1:2,this.channels[i-1].setBkgData(r),this.lastCmdA=e,this.lastCmdB=t,!0)},reset:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(e){
for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}},e.logger=l,e.PenState=f,e.CaptionScreen=y,e.Cea608Parser=g,e.findCea608Nalus=function(e,t,r){for(var n=0,i=t,o=[],a=function(e,t,r,n){if(4!==e||t<8)return null;var i=r.getUint8(n),o=r.getUint16(n+1),a=r.getUint32(n+3),s=r.getUint8(n+7);return 181==i&&49==o&&1195456820==a&&3==s};i<t+r;){if(n=e.getUint32(i),6==(31&e.getUint8(i+4)))for(var s=i+5,u=-1;s<i+4+n-1;){u=0;for(var c=255;255===c;)u+=c=e.getUint8(s),s++;var l=0;for(c=255;255===c;)l+=c=e.getUint8(s),s++;a(u,l,e,s)&&o.push([s,l]),s+=l}i+=n+4}return o},e.extractCea608DataFromRange=function(e,t){var r=t[0],n=[[],[]];r+=8;var i=31&e.getUint8(r);r+=2;for(var o=0;o<i;o++){var a=e.getUint8(r),s=4&a,u=3&a;r++;var c=e.getUint8(r);r++;var l=e.getUint8(r);r++,s&&(127&c)+(127&l)!=0&&(0===u?(n[0].push(c),n[0].push(l)):1===u&&(n[1].push(c),n[1].push(l)))}return n}}(t)},function(e,t,r){var n=r(23).default,i=r(10).default;window.dashjs=n,e.exports=i},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==("undefined"==typeof window?"undefined":c(window))&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONFIG=void 0,t.CONFIG={version:"1.15.28",gitHash:"6a8c2376",build:355,release:"2024-02-29T07:18:24.725Z",mode:"production"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.state={runningInterval:1e3,maxCacheLength:200,fragmentLoadingProgressInfo:{},networkActivityLoadedList:[],networkActivityHistory:[],networkActivityLatestTraceTime:0},this.initalize()}return e.prototype.onFragmentLoadingProgess=function(e){var t=e.request,r=0,n=Math.floor(performance.now()),i=t.quality+"-"+t.index+"-"+t.ts,o=!1;if(this.state.fragmentLoadingProgressInfo[t.mediaType]&&this.state.fragmentLoadingProgressInfo[t.mediaType][i]){var a=this.state.fragmentLoadingProgressInfo[t.mediaType][i],s=!1;for(var u in a)if("bytesLoaded"!==u&&a[u]!==t[u])s=!0;else if(a.bytesLoaded===t.bytesLoaded)return;r=s?t.bytesLoaded:t.bytesLoaded-a.bytesLoaded}else this.state.fragmentLoadingProgressInfo[t.mediaType]||(this.state.fragmentLoadingProgressInfo[t.mediaType]={}),r=t.bytesLoaded;t.bytesLoaded===t.bytesTotal&&(o=!0),o?delete this.state.fragmentLoadingProgressInfo[t.mediaType][i]:this.state.fragmentLoadingProgressInfo[t.mediaType][i]={bytesLoaded:t.bytesLoaded,bytesTotal:t.bytesTotal,quality:t.quality,index:t.index,mediaType:t.mediaType,range:t.range},this.state.networkActivityLoadedList.length>=this.state.maxCacheLength&&this.state.networkActivityLoadedList.splice(0,1),r&&this.state.networkActivityLoadedList.push({time:n,loaded:Math.max(r,0)})},e.prototype.getNetworkActivity=function(){return this.state.networkActivityHistory.length?this.state.networkActivityHistory[this.state.networkActivityHistory.length-1]:0},e.prototype.getNetworkActivityHistory=function(e){return void 0===e&&(e=0),e?this.state.networkActivityHistory.slice(this.state.networkActivityHistory.length-e):this.state.networkActivityHistory},e.prototype.destroy=function(){clearTimeout(this.state&&this.state.networkActivityTimer),this.state.networkActivityLoadedList.length=0,this.state.networkActivityHistory.length=0,this.state=null},e.prototype.initalize=function(){this.runNewWorkActivityTimer()},e.prototype.runNewWorkActivityTimer=function(){var e=this;this.runNetworkActivity(),clearTimeout(this.state.networkActivityTimer),this.state.networkActivityTimer=window.setTimeout((function(){e.runNewWorkActivityTimer()}),this.state.runningInterval)},e.prototype.runNetworkActivity=function(){var e=this.state.runningInterval,t=Math.floor(performance.now()),r=this.state.networkActivityLatestTraceTime,n=this.state.networkActivityLoadedList.filter((function(n){return t-n.time<e&&t>r}));this.state.networkActivityLatestTraceTime=t;var i=0;n&&n.length&&n.forEach((function(e){return i+=e.loaded})),this.state.networkActivityHistory.length>=this.state.maxCacheLength&&this.state.networkActivityHistory.splice(0,1),this.state.networkActivityHistory.push(Math.max(i,0))},e}();t.default=n},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),o=r(13),a=n(r(4)),s=function(){function e(){this.bufferingHistory=[],this.state={enableHEVC:!1}}return e.prototype.destroy=function(){this.state=null,this.bufferingHistory.length=0},e.prototype.setHEVCEnableFlag=function(e){return void 0===e&&(e=!1),this.state.enableHEVC=e,this},e.prototype.push=function(e){this.bufferingHistory.length>=this.MAX_HISTORY_LENGTH&&this.bufferingHistory.shift(),e.timestamp=this.getNow(),this.bufferingHistory.push(e),this.optimize()},e.prototype.setOnOptimizingCallback=function(e){this.state.onOptimizingCallback=e},e.prototype.onOptimzing=function(e,t){"function"==typeof this.state.onOptimizingCallback&&this.state.onOptimizingCallback(e,t)},e.prototype.optimize=function(){var e=this.getNow(),t=this.bufferingHistory.filter((function(t){return e-t.timestamp<=2e4}));if(this.state.enableHEVC){var r=""+o.BUFFERING.PLAYBACK.PLAYING+o.BUFFERING.TYPE.PERFORMANCE,n=t.filter((function(e){return r===e.type}));n&&n.length>=10&&(this.state.enableHEVC=!1,this.disableHEVCFlag())}},e.prototype.disableHEVCFlag=function(){1!==parseInt(a.default.getLocalStorage("bilibili_player_codec_prefer_type"),10)&&(a.default.setLocalStorage("bilibili_player_codec_prefer_strategy","2"),this.onOptimzing(i.EVENTS.BUFFERING_OPTIMIZATION,{type:"hevcPerf"}))},e.prototype.getNow=function(){var e;return(null===(e=window.performance)||void 0===e?void 0:e.now())||Date.now()},e}();t.default=s},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.video=e,this.frameCount=0,this.totalFrameCnt=0,this.fpsArr=[],this.lows=[],this.lastFPSTime=0,this.battery=null,this.chargingState=1,this.rafId=-1,this.hiddenCnt=0,this.start=this.start.bind(this),e.addEventListener("canplay",this.start)}return e.prototype.getInfo=function(e,t){void 0===t&&(t=!1);var r=+("visible"===document.visibilityState),i=this.chargingState,o=navigator.hardwareConcurrency||0,a=t?1:5,s=this.getLastXMinutesFPS(a);return n({viState:r,fps:this.getFPS(),oneLowFps:this.get1PercentLowFPS(),stdDev:this.getStandardDeviation(),charging:i,coreNum:o,totalRFrames:this.totalFrameCnt,fpsArr:s,hiddenCnt:this.hiddenCnt},e)},e.prototype.destroy=function(){this.fpsArr.length=0,this.lows.length=0,this.removePageEvent(),window.cancelAnimationFrame(this.rafId),this.battery&&(this.battery.removeEventListener("chargingchange",this.onChargingStateChange),this.battery=null),this.video.removeEventListener("canplay",this.start),this.video=null},e.prototype.start=function(){this.pageVisible()&&-1===this.rafId&&(this.video.removeEventListener("canplay",this.start),this.runFPSDetect()),this.addPageEvent(),this.runBatteryStateDetect()},e.prototype.stopFPSDetect=function(){window.cancelAnimationFrame(this.rafId),this.rafId=-1,this.frameCount=1,this.lastFPSTime=0},e.prototype.onVisibilityChange=function(){this.pageVisible()?-1===this.rafId&&this.runFPSDetect():(this.hiddenCnt++,this.stopFPSDetect())},e.prototype.addPageEvent=function(){this.onVisibilityChange=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.onVisibilityChange)},e.prototype.removePageEvent=function(){document.removeEventListener("visibilitychange",this.onVisibilityChange)},e.prototype.pageVisible=function(){return"visible"===document.visibilityState},e.prototype.getFPS=function(){return this.fpsArr.length?Math.floor(this.fpsArr.reduce((function(e,t){return e+t}),0)/this.fpsArr.length):0},e.prototype.get1PercentLowFPS=function(){if(!this.lows.length||this.lows.length<1500)return 0;var e=this.lows.slice().sort((function(e,t){return e-t})),t=Math.ceil(.01*e.length),r=e.slice(1,t)
;return Math.floor(r.reduce((function(e,t){return e+t}),0)/r.length)||1},e.prototype.getLastXMinutesFPS=function(e){if(e<=0)return[];var t=60*e,r=this.fpsArr.length-t,n=Math.max(r,0);return this.fpsArr.slice(n)},e.prototype.getStandardDeviation=function(){var e=this.fpsArr.slice(),t=e.length;if(!t)return 0;var r=e.reduce((function(e,t){return e+t}),0)/t,n=e.reduce((function(e,t){return e+Math.pow(t-r,2)}),0)/t;return+Math.sqrt(n).toFixed(1)},e.prototype.getTime=function(){return performance.now()||(new Date).getTime()},e.prototype.runFPSDetect=function(){var e=this;"function"!=typeof window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(e){clearTimeout(e)});var t=0;this.rafId=requestAnimationFrame((function r(n){e.frameCount++,e.totalFrameCnt++;var i=e.getTime();e.lastFPSTime||(e.lastFPSTime=i);var o=i-e.lastFPSTime,a=n-t;if(a>0){var s=1e3/a;e.lows.length>=43200&&e.lows.shift(),e.lows.push(s)}t=n,o>=1e3&&(s=e.frameCount/o*1e3,e.frameCount=1,e.lastFPSTime=i,e.fpsArr.length>=7200&&e.fpsArr.shift(),e.fpsArr.push(Math.floor(s)||1)),e.rafId=requestAnimationFrame(r)}))},e.prototype.onChargingStateChange=function(){this.chargingState=+this.battery.charging},e.prototype.runBatteryStateDetect=function(){var e=this;"function"==typeof navigator.getBattery&&(this.onChargingStateChange=this.onChargingStateChange.bind(this),navigator.getBattery().then((function(t){e.battery=t,e.chargingState=+t.charging,t.addEventListener("chargingchange",e.onChargingStateChange)})))},e}();t.default=i},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(10)),o=r(2),a=function(){function e(e){this.player=e,this.ncGrayPercentage=Math.random(),this.p2pGrayPercentage=Math.random(),this.ncDisable=this.getDisableValue("nc_disable"),this.p2pDisable=this.getDisableValue("rp_disable")}return Object.defineProperty(e.prototype,"isUseNC",{get:function(){return this.ncGrayPercentage>=this.ncDisable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUseP2P",{get:function(){return this.p2pGrayPercentage>=this.p2pDisable},enumerable:!1,configurable:!0}),e.prototype.getDisableValue=function(e){var t=0,r=i.default.getFawkesConfigValue(o.STRING.DASH_CONFIG,e);return""!==r&&(t=Number(r)),t},e.prototype.destroy=function(){this.player=null},e}();t.default=a},function(e,t,r){"use strict";r.r(t),r.d(t,"MediaPlayer",(function(){return n.a})),r.d(t,"Protection",(function(){return X}));var n=r(9),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.findCencContentProtection=function(e){for(var t=null,r=0;r<e.length;++r){var n=e[r];"urn:mpeg:dash:mp4protection:2011"===n.schemeIdUri.toLowerCase()&&"cenc"===n.value.toLowerCase()&&(t=n)}return t},e.getPSSHData=function(e){var t=8,r=new DataView(e),n=r.getUint8(t);return t+=20,n>0&&(t+=4+16*r.getUint32(t)),t+=4,e.slice(t)},e.getPSSHForKeySystem=function(t,r){var n=e.parsePSSHList(r);return n.hasOwnProperty(t.uuid.toLowerCase())?n[t.uuid.toLowerCase()]:null},e.parseInitDataFromContentProtection=function(e,t){return"pssh"in e?t.decodeArray(e.pssh.__text).buffer:null},e.parsePSSHList=function(e){if(null===e)return[];for(var t=new DataView(e.buffer||e),r={},n=0;;){var i,o,a=void 0,s=n;if(n>=t.buffer.byteLength)break;if(i=n+t.getUint32(n),n+=4,1886614376===t.getUint32(n))if(n+=4,0===(o=t.getUint8(n))||1===o){n++,n+=3,a="";var u=void 0,c=void 0;for(u=0;u<4;u++)a+=1===(c=t.getUint8(n+u).toString(16)).length?"0"+c:c;for(n+=4,a+="-",u=0;u<2;u++)a+=1===(c=t.getUint8(n+u).toString(16)).length?"0"+c:c;for(n+=2,a+="-",u=0;u<2;u++)a+=1===(c=t.getUint8(n+u).toString(16)).length?"0"+c:c;for(n+=2,a+="-",u=0;u<2;u++)a+=1===(c=t.getUint8(n+u).toString(16)).length?"0"+c:c;for(n+=2,a+="-",u=0;u<6;u++)a+=1===(c=t.getUint8(n+u).toString(16)).length?"0"+c:c;n+=6,a=a.toLowerCase(),t.getUint32(n),n+=4,r[a]=t.buffer.slice(s,i),n=i}else n=i;else n=i}return r},e}(),o=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType=t,this.robustness=r},a=function e(t,r,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initDataTypes=["cenc"],t&&t.length&&(this.audioCapabilities=t),r&&r.length&&(this.videoCapabilities=r),this.distinctiveIdentifier=n,this.persistentState=i,this.sessionTypes=o},s="function"==typeof Symbol&&"symbol"==c(Symbol.iterator)?function(e){return c(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":c(e)};function u(e){var t,r=(e=e||{}).protectionKeyController,n=e.protectionModel,u=e.eventBus,c=e.events,l=e.log,d=e.BASE64,f=e.constants,p=e.ignoreEmeEncryptedEvent,h=void 0,y=void 0,m=void 0,g=void 0,v=void 0,_=void 0;function E(e,t){var o=i.getPSSHForKeySystem(_,e),a=T(_);if(o){for(var s=n.getAllInitData(),d=0;d<s.length;d++)if(r.initDataEquals(o,s[d]))return void l("DRM: Ignoring initData because we have already seen it!");try{n.createKeySession(o,a,A(_),t)}catch(e){u.trigger(c.KEY_SESSION_CREATED,{data:null,error:"Error creating key session! "+e.message})}}else e?n.createKeySession(e,a,A(_),t):u.trigger(c.KEY_SESSION_CREATED,{data:null,error:"Selected key system is "+_.systemString+".  needkey/encrypted event contains no initData corresponding to that key system!"})}function b(e,t){n.loadKeySession(e,t,A(_))}function S(e){e?(n.setMediaElement(e),u.on(c.NEED_KEY,O,this)):null===e&&(n.setMediaElement(e),u.off(c.NEED_KEY,O,this))}function T(e){var t=null;if(e){var r=e.systemString;m&&(t=r in m?m[r]:null)}return t}function w(e){var t=T(e),r=[],n=[],i=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:v,s=t&&t.videoRobustness&&t.videoRobustness.length>0?t.videoRobustness:v,u=A(e);return y.forEach((function(e){e.type===f.AUDIO?r.push(new o(e.codec,i)):e.type===f.VIDEO&&n.push(new o(e.codec,s))})),new a(r,n,"optional","temporary"===u?"optional":"required",[u])}function A(e){var t=T(e);return t&&t.sessionType?t.sessionType:g}function R(e,t){var i=this,o=[];e=e.sort((function(t,r){return(m&&m[t.ks.systemString]&&m[t.ks.systemString].priority>=0?m[t.ks.systemString].priority:e.length)-(m&&m[r.ks.systemString]&&m[r.ks.systemString].priority>=0?m[r.ks.systemString].priority:e.length)}));var a=void 0;if(_)for(a=0;a<e.length&&(_!==e[a].ks||"break"!=(o.push({ks:e[a].ks,configs:[w(_)]}),u.on(c.KEY_SYSTEM_ACCESS_COMPLETE,(function r(n){u.off(c.KEY_SYSTEM_ACCESS_COMPLETE,r,i),n.error?t||u.trigger(c.KEY_SYSTEM_SELECTED,{error:"DRM: KeySystem Access Denied! -- "+n.error}):(l("DRM: KeySystem Access Granted"),u.trigger(c.KEY_SYSTEM_SELECTED,{data:n.data}),e[a].sessionId?b(e[a].sessionId,e[a].initData):e[a].initData&&E(e[a].initData,e[a].cdmData))}),i),n.requestKeySystemAccess(o),"break"));a++);else if(void 0===_){_=null,h.push(e);for(var s=0;s<e.length;s++)o.push({ks:e[s].ks,configs:[w(e[s].ks)]});var f=void 0,p=function e(r){u.off(c.KEY_SYSTEM_ACCESS_COMPLETE,e,i),r.error?(_=void 0,u.off(c.INTERNAL_KEY_SYSTEM_SELECTED,y,i),t||u.trigger(c.KEY_SYSTEM_SELECTED,{data:null,error:"DRM: KeySystem Access Denied! -- "+r.error})):(f=r.data,l("DRM: KeySystem Access Granted ("+f.keySystem.systemString+")!  Selecting key system..."),n.selectKeySystem(f))},y=function e(o){if(u.off(c.INTERNAL_KEY_SYSTEM_SELECTED,e,i),u.off(c.KEY_SYSTEM_ACCESS_COMPLETE,p,i),o.error)_=void 0,t||u.trigger(c.KEY_SYSTEM_SELECTED,{data:null,error:"DRM: Error selecting key system! -- "+o.error});else{_=n.getKeySystem(),u.trigger(c.KEY_SYSTEM_SELECTED,{data:f});var s=T(_);s&&s.serverCertificate&&s.serverCertificate.length>0&&n.setServerCertificate(d.decodeArray(s.serverCertificate).buffer)
;for(var l=0;l<h.length;l++)for(a=0;a<h[l].length;a++)if(_===h[l][a].ks){if(r.isClearKey(_)&&s&&s.hasOwnProperty("clearkeys")){var y={kids:Object.keys(s.clearkeys)};h[l][a].initData=(new TextEncoder).encode(JSON.stringify(y))}h[l][a].sessionId?b(h[l][a].sessionId,h[l][a].initData):null!==h[l][a].initData&&E(h[l][a].initData,h[l][a].cdmData);break}}};u.on(c.INTERNAL_KEY_SYSTEM_SELECTED,y,i),u.on(c.KEY_SYSTEM_ACCESS_COMPLETE,p,i),n.requestKeySystemAccess(o)}else h.push(e)}function P(e,t){u.trigger(c.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function D(e){e.error?u.trigger(c.KEY_STATUSES_CHANGED,{data:null,error:"DRM: KeyStatusChange error! -- "+e.error}):l("DRM: key status = "+e.status)}function I(e){if(l("DRM: onKeyMessage"),e.error)l(e.error);else{var t=e.data;u.trigger(c.KEY_MESSAGE,{data:t});var o=t.messageType?t.messageType:"license-request",a=t.message,d=t.sessionToken,f=T(_),p=_?_.systemString:null,h=r.getLicenseServer(_,f,o),y={sessionToken:d,messageType:o};if(a&&0!==a.byteLength){if(!h)return l("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+d.getSessionID()),void P(y);if(r.isClearKey(_)){var m=r.processClearKeyLicenseRequest(_,f,a);if(m)return l("DRM: ClearKey license request handled by application!"),P(y),void n.updateKeySession(d,m)}var g=new XMLHttpRequest,v=null;if(f&&f.serverURL){var E=f.serverURL;"string"==typeof E&&""!==E?v=E:"object"===(void 0===E?"undefined":s(E))&&E.hasOwnProperty(o)&&(v=E[o])}else f&&f.laURL&&""!==f.laURL?v=f.laURL:(v=_.getLicenseServerURLFromInitData(i.getPSSHData(d.initData)))||(v=e.data.laURL);if(v=h.getServerURLFromMessage(v,a,o)){var b=function(e,t,r,n){var i=e.response?h.getErrorResponse(e.response,r,n):"NONE";P(t,"DRM: "+r+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+i)};g.open(h.getHTTPMethod(o),v,!0),g.responseType=h.getResponseType(p,o),g.onload=function(){if(200==this.status){var e=h.getLicenseMessage(this.response,p,o);null!==e?(P(y),n.updateKeySession(d,e)):b(this,y,p,o)}else b(this,y,p,o)},g.onabort=function(){P(y,"DRM: "+p+' update, XHR aborted. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)},g.onerror=function(){P(y,"DRM: "+p+' update, XHR error. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)};var S=function(e){if(e)for(var t in e)"authorization"===t.toLowerCase()&&(g.withCredentials=!0),g.setRequestHeader(t,e[t])};f&&S(f.httpRequestHeaders),S(_.getRequestHeadersFromMessage(a)),f&&"boolean"==typeof f.withCredentials&&(g.withCredentials=f.withCredentials),g.send(_.getLicenseRequestFromMessage(a))}else P(y,"DRM: No license server URL specified!")}else P(y,"DRM: Empty key message from CDM")}}function O(e){if(!p){if(l("DRM: onNeedKey"),"cenc"!==e.key.initDataType)return void l("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType);var t=e.key.initData;if(ArrayBuffer.isView(t)&&(t=t.buffer),_){var o=i.getPSSHForKeySystem(_,t);if(o)for(var a=n.getAllInitData(),s=0;s<a.length;s++)if(r.initDataEquals(o,a[s]))return void l("DRM: Ignoring initData because we have already seen it!")}l("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(t)));var u=r.getSupportedKeySystems(t,m);if(0===u.length)return void l("DRM: Received needkey event with initData, but we don't support any of the key systems!");R(u,!1)}}return t={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");!function(){if(!(u&&u.hasOwnProperty("on")&&r&&r.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}(),u.on(c.INTERNAL_KEY_MESSAGE,I,this),u.on(c.INTERNAL_KEY_STATUS_CHANGED,D,this),y.push(e);var t=r.getSupportedKeySystemsFromContentProtection(e.contentProtection);t&&t.length>0&&R(t,!0)},createKeySession:E,loadKeySession:b,removeKeySession:function(e){n.removeKeySession(e)},closeKeySession:function(e){n.closeKeySession(e)},setServerCertificate:function(e){n.setServerCertificate(e)},setMediaElement:S,setSessionType:function(e){g=e},setRobustnessLevel:function(e){v=e},setProtectionData:function(e){m=e,r.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return r.getSupportedKeySystemsFromContentProtection(e)},getKeySystems:function(){return r?r.getKeySystems():[]},reset:function(){u.off(c.INTERNAL_KEY_MESSAGE,I,this),u.off(c.INTERNAL_KEY_STATUS_CHANGED,D,this),S(null),_=void 0,n&&(n.reset(),n=null),y=[]}},h=[],y=[],g="temporary",v="",t}u.__dashjs_factory_name="ProtectionController";var l=dashjs.FactoryMaker.getClassFactory(u),d=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyID=t,this.key=r},f=function(){function e(t,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r&&"persistent"!==r&&"temporary"!==r)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=t,this.type=r}return e.prototype.toJWK=function(){var e=void 0,t=this.keyPairs.length,r={keys:[]};for(e=0;e<t;e++){var n={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};r.keys.push(n)}this.type&&(r.type=this.type);var i=JSON.stringify(r),o=i.length,a=new ArrayBuffer(o),s=new Uint8Array(a);for(e=0;e<o;e++)s[e]=i.charCodeAt(e);return a},e}(),p=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init=function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready"},e}()),h=p.CLEARKEY_KEYSTEM_STRING;function y(e){var t=(e=e||{}).BASE64;return{uuid:"e2719d58-a985-b3c9-781a-b030af78d30e",schemeIdURI:"urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e",systemString:h,getInitData:function(e){return i.parseInitDataFromContentProtection(e,t)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getClearKeysFromProtectionData:function(e,t){var r=null;if(e){for(var n=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),i=[],o=0;o<n.kids.length;o++){var a=n.kids[o],s=e.clearkeys&&e.clearkeys.hasOwnProperty(a)?e.clearkeys[a]:null;if(!s)throw new Error("DRM: ClearKey keyID ("+a+") is not known!");i.push(new d(a,s))}r=new f(i)}return r}}}y.__dashjs_factory_name="KeySystemClearKey";var m=dashjs.FactoryMaker.getSingletonFactory(y),g=p.CLEARKEY_KEYSTEM_STRING;function v(e){var t=e.BASE64,r=e.log;return{uuid:"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",schemeIdURI:"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString:g,getInitData:function(e){return i.parseInitDataFromContentProtection(e,t)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getClearKeysFromProtectionData:function(e,t){var n=null;if(e){for(var i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),o=[],a=0;a<i.kids.length;a++){var s=i.kids[a],u=e.clearkeys&&e.clearkeys.hasOwnProperty(s)?e.clearkeys[s]:null;if(!u)throw new Error("DRM: ClearKey keyID ("+s+") is not known!");o.push(new d(s,u))}n=new f(o),r("Warning: ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return n}}}v.__dashjs_factory_name="KeySystemW3CClearKey";var _=dashjs.FactoryMaker.getSingletonFactory(v),E=p.WIDEVINE_KEYSTEM_STRING;function b(e){var t=null,r=(e=e||{}).BASE64;return{uuid:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",schemeIdURI:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString:E,init:function(e){e&&(t=e)},getInitData:function(e){
return i.parseInitDataFromContentProtection(e,r)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(e){return t&&t.sessionId?t.sessionId:e&&e.sessionId?e.sessionId:null}}}b.__dashjs_factory_name="KeySystemWidevine";var S=dashjs.FactoryMaker.getSingletonFactory(b),T=p.PLAYREADY_KEYSTEM_STRING,w=void 0;function A(e){var t="utf16",r=(e=e||{}).BASE64;function n(){if(!r||!r.hasOwnProperty("decodeArray")||!r.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return{uuid:"9a04f079-9840-4286-ab92-e65be0885f95",schemeIdURI:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",systemString:T,getInitData:function(e){var t,o,a,s=new Uint8Array([112,115,115,104,0,0,0,0]),u=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),c=0,l=null,d=void 0,f=void 0;if(n(),"pssh"in e)return i.parseInitDataFromContentProtection(e,r);if("pro"in e)l=r.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;l=r.decodeArray(e.prheader.__text)}return t=l.length,o=4+s.length+u.length+4+t,a=new ArrayBuffer(o),d=new Uint8Array(a),(f=new DataView(a)).setUint32(c,o),c+=4,d.set(s,c),c+=s.length,d.set(u,c),c+=u.length,f.setUint32(c,t),c+=4,d.set(l,c),c+=t,d.buffer},getRequestHeadersFromMessage:function(e){var r,n=void 0,i={},o=new DOMParser,a="utf16"===t?new Uint16Array(e):new Uint8Array(e);r=String.fromCharCode.apply(null,a);for(var s=(n=o.parseFromString(r,"application/xml")).getElementsByTagName("name"),u=n.getElementsByTagName("value"),c=0;c<s.length;c++)i[s[c].childNodes[0].nodeValue]=u[c].childNodes[0].nodeValue;return i.hasOwnProperty("Content")&&(i["Content-Type"]=i.Content,delete i.Content),i.hasOwnProperty("Content-Type")||(i["Content-Type"]="text/xml; charset="+t),i},getLicenseRequestFromMessage:function(e){var i=null,o=new DOMParser,a="utf16"===t?new Uint16Array(e):new Uint8Array(e);n();var s=String.fromCharCode.apply(null,a),u=o.parseFromString(s,"application/xml");if(u.getElementsByTagName("Challenge")[0]){var c=u.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;c&&(i=r.decode(c))}else if(u.getElementsByTagName("parsererror").length)return e;return i},getLicenseServerURLFromInitData:function(e){if(e)for(var t=new DataView(e),r=t.getUint16(4,!0),n=6,i=new DOMParser,o=0;o<r;o++){var a=t.getUint16(n,!0);n+=2;var s=t.getUint16(n,!0);if(n+=2,1===a){var u=e.slice(n,n+s),c=String.fromCharCode.apply(null,new Uint16Array(u)),l=i.parseFromString(c,"application/xml");if(l.getElementsByTagName("LA_URL")[0]){var d=l.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(d)return d}if(l.getElementsByTagName("LUI_URL")[0]){var f=l.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(f)return f}}else n+=s}return null},getCDMData:function(){var e=void 0,t=void 0,i=void 0,o=void 0;if(n(),w&&w.cdmData){for(e=[],o=0;o<w.cdmData.length;++o)e.push(w.cdmData.charCodeAt(o)),e.push(0);for(e=String.fromCharCode.apply(null,e),e=r.encode(e),t='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",e),i=[],o=0;o<t.length;++o)i.push(t.charCodeAt(o)),i.push(0);return new Uint8Array(i).buffer}return null},getSessionId:function(){return null},setPlayReadyMessageFormat:function(e){if("utf8"!==e&&"utf16"!==e)throw new Error("Illegal PlayReady message format! -- "+e);t=e},init:function(e){e&&(w=e)}}}A.__dashjs_factory_name="KeySystemPlayReady";var R=dashjs.FactoryMaker.getSingletonFactory(A);function P(e){var t=(e=e||{}).BASE64,r={};return r[p.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return t.decodeArray(e.license)},getErrorResponse:function(e){return e}},r[p.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return r[e].responseType},getLicenseMessage:function(e,n){return function(){if(!t||!t.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),r[n].getLicenseMessage(e)},getErrorResponse:function(e,t){return r[t].getErrorResponse(e)}}}P.__dashjs_factory_name="DRMToday";var D=dashjs.FactoryMaker.getSingletonFactory(P);function I(){var e="http://schemas.xmlsoap.org/soap/envelope/";function t(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}function r(r){if(window.DOMParser){var n=t(r),i=(new window.DOMParser).parseFromString(n,"text/xml"),o=i?i.getElementsByTagNameNS(e,"Envelope")[0]:null,a=o?o.getElementsByTagNameNS(e,"Body")[0]:null;if(a&&a.getElementsByTagNameNS(e,"Fault")[0])return null}return r}function n(r){var n="",i="",o="",a=-1,s=-1;if(window.DOMParser){var u=t(r),c=(new window.DOMParser).parseFromString(u,"text/xml"),l=c?c.getElementsByTagNameNS(e,"Envelope")[0]:null,d=l?l.getElementsByTagNameNS(e,"Body")[0]:null,f=d?d.getElementsByTagNameNS(e,"Fault")[0]:null,p=f?f.getElementsByTagName("detail")[0]:null,h=p?p.getElementsByTagName("Exception")[0]:null,y=null;if(null===f)return u;n=(y=f.getElementsByTagName("faultstring")[0].firstChild)?y.nodeValue:null,null!==h&&(i=(y=h.getElementsByTagName("StatusCode")[0])?y.firstChild.nodeValue:null,a=(o=(y=h.getElementsByTagName("Message")[0])?y.firstChild.nodeValue:null)?o.lastIndexOf("[")+1:-1,s=o?o.indexOf("]"):-1,o=o?o.substring(a,s):"")}var m="code: "+i+", name: "+n;return o&&(m+=", message: "+o),m}return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return r.call(this,e)},getErrorResponse:function(e){return n.call(this,e)}}}I.__dashjs_factory_name="PlayReady";var O=dashjs.FactoryMaker.getSingletonFactory(I);function C(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}C.__dashjs_factory_name="Widevine";var N=dashjs.FactoryMaker.getSingletonFactory(C);function k(){return{getServerURLFromMessage:function(e,t){var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t)));e+="/?";for(var n=0;n<r.kids.length;n++)e+=r.kids[n]+"&";return e.substring(0,e.length-1)},getHTTPMethod:function(){return"GET"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],r=0;r<e.keys.length;r++){var n=e.keys[r],i=n.kid.replace(/=/g,""),o=n.k.replace(/=/g,"");t.push(new d(i,o))}return new f(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}k.__dashjs_factory_name="ClearKey";var L=dashjs.FactoryMaker.getSingletonFactory(k);function x(){var e=this.context,t=void 0,r=void 0,n=void 0,o=void 0,a=void 0;return{initialize:function(){r=[];var i=void 0;i=R(e).getInstance({BASE64:n}),r.push(i),i=S(e).getInstance({BASE64:n}),r.push(i),i=m(e).getInstance({BASE64:n}),r.push(i),o=i,i=_(e).getInstance({BASE64:n,log:t}),r.push(i),a=i},setProtectionData:function(e){for(var t,n,i=0;i<r.length;i++){var o=r[i];o.hasOwnProperty("init")&&o.init((t=o.systemString,n=void 0,n=null,e&&(n=t in e?e[t]:null),n))}},isClearKey:function(e){return e===o||e===a},initDataEquals:function(e,t){if(e.byteLength===t.byteLength){for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<r.length;i++)if(r[i]!==n[i])return!1;return!0}return!1},getKeySystems:function(){return r},getKeySystemBySystemString:function(e){for(var t=0;t<r.length;t++)if(r[t].systemString===e)return r[t];return null},getSupportedKeySystemsFromContentProtection:function(e){var t=void 0,n=void 0,i=void 0,o=void 0,a=[];if(e)for(i=0;i<r.length;++i)for(n=r[i],
o=0;o<e.length;++o)(t=e[o]).schemeIdUri.toLowerCase()===n.schemeIdURI&&a.push({ks:n,initData:n.getInitData(t),cdmData:n.getCDMData(),sessionId:n.getSessionId(t)});return a},getSupportedKeySystems:function(e,t){for(var n=[],o=i.parsePSSHList(e),a=void 0,s=void 0,u=void 0,c=0;c<r.length;++c)s=(a=r[c]).systemString,u=!t||s in t,a.uuid in o&&u&&n.push({ks:a,initData:o[a.uuid],cdmData:a.getCDMData(),sessionId:a.getSessionId()});return n},getLicenseServer:function(t,r,i){if("license-release"===i||"individualization-request"===i)return null;var o=null;return r&&r.hasOwnProperty("drmtoday")?o=D(e).getInstance({BASE64:n}):t.systemString===p.WIDEVINE_KEYSTEM_STRING?o=N(e).getInstance():t.systemString===p.PLAYREADY_KEYSTEM_STRING?o=O(e).getInstance():t.systemString===p.CLEARKEY_KEYSTEM_STRING&&(o=L(e).getInstance()),o},processClearKeyLicenseRequest:function(e,r,n){try{return e.getClearKeysFromProtectionData(r,n)}catch(e){return t("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(e){e&&(e.log&&(t=e.log),e.BASE64&&(n=e.BASE64))}}}x.__dashjs_factory_name="ProtectionKeyController";var M=dashjs.FactoryMaker.getSingletonFactory(x),F=new(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=c(t)&&"function"!=typeof t?e:t}(this,e.call(this));return r.INTERNAL_KEY_MESSAGE="internalKeyMessage",r.INTERNAL_KEY_SYSTEM_SELECTED="internalKeySystemSelected",r.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",r.KEY_ADDED="public_keyAdded",r.KEY_ERROR="public_keyError",r.KEY_MESSAGE="public_keyMessage",r.KEY_SESSION_CLOSED="public_keySessionClosed",r.KEY_SESSION_CREATED="public_keySessionCreated",r.KEY_SESSION_REMOVED="public_keySessionRemoved",r.KEY_STATUSES_CHANGED="public_keyStatusesChanged",r.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",r.KEY_SYSTEM_SELECTED="public_keySystemSelected",r.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",r.NEED_KEY="needkey",r.PROTECTION_CREATED="public_protectioncreated",r.PROTECTION_DESTROYED="public_protectiondestroyed",r.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",r.TEARDOWN_COMPLETE="protectionTeardownComplete",r.VIDEO_ELEMENT_SELECTED="videoElementSelected",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+c(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(r(3).a)),U=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initData=t,this.initDataType=r},B=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessionToken=t,this.error=r},j=function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessionToken=t,this.message=r,this.defaultURL=n,this.messageType=i||"license-request"},V=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keySystem=t,this.ksConfiguration=r};function G(e){e=e||{};var t,r=this.context,n=e.eventBus,i=e.events,o=e.log,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,d=void 0;function f(e,t){void 0!==navigator.requestMediaKeySystemAccess&&"function"==typeof navigator.requestMediaKeySystemAccess?function(t){var r=e[t].ks,o=e[t].configs;navigator.requestMediaKeySystemAccess(r.systemString,o).then((function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,o=new V(r,t);o.mksa=e,n.trigger(i.KEY_SYSTEM_ACCESS_COMPLETE,{data:o})})).catch((function(r){++t<e.length?f(e,t):n.trigger(i.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! "+r.message})}))}(t):n.trigger(i.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Insecure origins are not allowed"})}function h(e){var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function y(e){for(var t=0;t<c.length;t++)if(c[t]===e){c.splice(t,1);break}}function m(e,t,r,a){var s={session:e,initData:t,sessionId:a,handleEvent:function(e){switch(e.type){case"keystatuseschange":n.trigger(i.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach((function(){var e=void 0,t=void 0;"expired"===(arguments&&arguments.length>0&&(arguments[0]&&("string"==typeof arguments[0]?e=arguments[0]:t=arguments[0]),arguments[1]&&("string"==typeof arguments[1]?e=arguments[1]:t=arguments[1])),e)?n.trigger(i.INTERNAL_KEY_STATUS_CHANGED,{error:"License has expired"}):n.trigger(i.INTERNAL_KEY_STATUS_CHANGED,{status:e,keyId:t})}));break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;n.trigger(i.INTERNAL_KEY_MESSAGE,{data:new j(this,t,void 0,e.messageType)})}},getSessionID:function(){return e.sessionId},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getSessionType:function(){return r}};return e.addEventListener("keystatuseschange",s),e.addEventListener("message",s),e.closed.then((function(){y(s),o("DRM: Session closed.  SessionID = "+s.getSessionID()),n.trigger(i.KEY_SESSION_CLOSED,{data:s.getSessionID()})})),c.push(s),s}return t={getAllInitData:function(){for(var e=[],t=0;t<c.length;t++)c[t].initData&&e.push(c[t].initData);return e},requestKeySystemAccess:function(e){f(e,0)},getKeySystem:function(){return a},selectKeySystem:function(e){e.mksa.createMediaKeys().then((function(t){a=e.keySystem,u=t,s?s.setMediaKeys(u).then((function(){n.trigger(i.INTERNAL_KEY_SYSTEM_SELECTED)})):n.trigger(i.INTERNAL_KEY_SYSTEM_SELECTED)})).catch((function(){n.trigger(i.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+e.keySystem.systemString+")! Could not create MediaKeys -- TODO"})}))},setMediaElement:function(e){s!==e&&(s&&(s.removeEventListener("encrypted",l),s.setMediaKeys&&s.setMediaKeys(null)),(s=e)&&(s.addEventListener("encrypted",l),s.setMediaKeys&&u&&s.setMediaKeys(u)))},setServerCertificate:function(e){if(!a||!u)throw new Error("Can not set server certificate until you have selected a key system");u.setServerCertificate(e).then((function(){o("DRM: License server certificate successfully updated."),n.trigger(i.SERVER_CERTIFICATE_UPDATED)})).catch((function(e){n.trigger(i.SERVER_CERTIFICATE_UPDATED,{error:"Error updating server certificate -- "+e.name})}))},createKeySession:function(e,t,r){if(!a||!u)throw new Error("Can not create sessions until you have selected a key system");var s=u.createSession(r),c=m(s,e,r),l=this.getKeySystem().systemString===p.CLEARKEY_KEYSTEM_STRING&&t&&t.clearkeys?"keyids":"cenc";s.generateRequest(l,e).then((function(){o("DRM: Session created.  SessionID = "+c.getSessionID()),n.trigger(i.KEY_SESSION_CREATED,{data:c})})).catch((function(e){y(c),n.trigger(i.KEY_SESSION_CREATED,{data:null,error:"Error generating key request -- "+e.name})}))},updateKeySession:function(e,t){var r=e.session;d.isClearKey(a)&&(t=t.toJWK()),r.update(t).catch((function(t){n.trigger(i.KEY_ERROR,{data:new B(e,"Error sending update() message! "+t.name)})}))},loadKeySession:function(e,t,r){if(!a||!u)throw new Error("Can not load sessions until you have selected a key system");for(var s=0;s<c.length;s++)if(e===c[s].sessionId)return void o("DRM: Ignoring session ID because we have already seen it!");var l=u.createSession(r),d=m(l,t,r,e);l.load(e).then((function(t){t?(o("DRM: Session loaded.  SessionID = "+d.getSessionID()),n.trigger(i.KEY_SESSION_CREATED,{data:d})):(y(d),n.trigger(i.KEY_SESSION_CREATED,{data:null,error:"Could not load session! Invalid Session ID ("+e+")"}))})).catch((function(t){y(d),n.trigger(i.KEY_SESSION_CREATED,{data:null,error:"Could not load session ("+e+")! "+t.name})}))},removeKeySession:function(e){e.session.remove().then((function(){o("DRM: Session removed.  SessionID = "+e.getSessionID()),n.trigger(i.KEY_SESSION_REMOVED,{data:e.getSessionID()})
}),(function(t){n.trigger(i.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+e.getSessionID()+"). "+t.name})}))},closeKeySession:function(e){h(e).catch((function(t){y(e),n.trigger(i.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.getSessionID()+") "+t.name})}))},reset:function(){var e=c.length,t=void 0;0!==e?function(){for(var r=function(e){y(e),0===c.length&&(s?(s.removeEventListener("encrypted",l),s.setMediaKeys(null).then((function(){n.trigger(i.TEARDOWN_COMPLETE)}))):n.trigger(i.TEARDOWN_COMPLETE))},o=0;o<e;o++)!function(e){t.session.closed.then((function(){r(e)})),h(t).catch((function(){r(e)}))}(t=c[o])}():n.trigger(i.TEARDOWN_COMPLETE)}},a=null,s=null,u=null,c=[],d=M(r).getInstance(),l={handleEvent:function(e){if("encrypted"===e.type&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;n.trigger(i.NEED_KEY,{key:new U(t,e.initDataType)})}}},t}G.__dashjs_factory_name="ProtectionModel_21Jan2015";var H=dashjs.FactoryMaker.getClassFactory(G);function q(e){e=e||{};var t,r=this.context,n=e.eventBus,i=e.events,o=e.log,s=e.api,u=void 0,c=void 0,l=void 0,d=void 0,f=void 0,p=void 0,h=void 0;function y(e){var t=e.session;t.removeEventListener(s.error,e),t.removeEventListener(s.message,e),t.removeEventListener(s.ready,e),t.removeEventListener(s.close,e);for(var r=0;r<f.length;r++)if(f[r]===e){f.splice(r,1);break}t[s.release]()}function m(){var e=null,t=function(){u.removeEventListener("loadedmetadata",e),u[s.setMediaKeys](l),n.trigger(i.VIDEO_ELEMENT_SELECTED)};u.readyState>=1?t():(e=t.bind(this),u.addEventListener("loadedmetadata",e))}return t={getAllInitData:function(){for(var e=[],t=0;t<f.length;t++)e.push(f[t].initData);return e},requestKeySystemAccess:function(e){for(var t=!1,r=0;r<e.length;r++)for(var o=e[r].ks.systemString,u=e[r].configs,c=null,l=null,d=0;d<u.length;d++){var f=u[d].audioCapabilities,p=u[d].videoCapabilities;if(f&&0!==f.length){c=[];for(var y=0;y<f.length;y++)window[s.MediaKeys].isTypeSupported(o,f[y].contentType)&&c.push(f[y])}if(p&&0!==p.length){l=[];for(var m=0;m<p.length;m++)window[s.MediaKeys].isTypeSupported(o,p[m].contentType)&&l.push(p[m])}if(!(!c&&!l||c&&0===c.length||l&&0===l.length)){t=!0;var g=new a(c,l),v=h.getKeySystemBySystemString(o);n.trigger(i.KEY_SYSTEM_ACCESS_COMPLETE,{data:new V(v,g)});break}}t||n.trigger(i.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return c},selectKeySystem:function(e){try{l=e.mediaKeys=new window[s.MediaKeys](e.keySystem.systemString),c=e.keySystem,d=e,u&&m(),n.trigger(i.INTERNAL_KEY_SYSTEM_SELECTED)}catch(e){n.trigger(i.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+c.systemString+")! Could not create MediaKeys -- TODO"})}},setMediaElement:function(e){u!==e&&(u&&u.removeEventListener(s.needkey,p),(u=e)&&(u.addEventListener(s.needkey,p),l&&m()))},createKeySession:function(e,t,r,a){if(!c||!l||!d)throw new Error("Can not create sessions until you have selected a key system");var u=null;if(null!==d.ksConfiguration.videoCapabilities&&d.ksConfiguration.videoCapabilities.length>0&&(u=d.ksConfiguration.videoCapabilities[0]),null===u&&null!==d.ksConfiguration.audioCapabilities&&d.ksConfiguration.audioCapabilities.length>0&&(u=d.ksConfiguration.audioCapabilities[0]),null===u)throw new Error("Can not create sessions for unknown content types.");var p=u.contentType,h=l.createSession(p,new Uint8Array(e),a?new Uint8Array(a):null),y=function(e,t){return{session:e,initData:t,getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case s.error:n.trigger(i.KEY_ERROR,{data:new B(this,"KeyError")});break;case s.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;n.trigger(i.INTERNAL_KEY_MESSAGE,{data:new j(this,t,e.destinationURL)});break;case s.ready:o("DRM: Key added."),n.trigger(i.KEY_ADDED);break;case s.close:o("DRM: Session closed.  SessionID = "+this.getSessionID()),n.trigger(i.KEY_SESSION_CLOSED,{data:this.getSessionID()})}}}}(h,e);h.addEventListener(s.error,y),h.addEventListener(s.message,y),h.addEventListener(s.ready,y),h.addEventListener(s.close,y),f.push(y),o("DRM: Session created.  SessionID = "+y.getSessionID()),n.trigger(i.KEY_SESSION_CREATED,{data:y})},updateKeySession:function(e,t){var r=e.session;h.isClearKey(c)?r.update(new Uint8Array(t.toJWK())):r.update(new Uint8Array(t))},closeKeySession:y,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},reset:function(){try{for(var e=0;e<f.length;e++)y(f[e]);u&&u.removeEventListener(s.needkey,p),n.trigger(i.TEARDOWN_COMPLETE)}catch(e){n.trigger(i.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}},u=null,c=null,l=null,d=null,f=[],h=M(r).getInstance(),p={handleEvent:function(e){if(e.type===s.needkey&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;n.trigger(i.NEED_KEY,{key:new U(t,"cenc")})}}},t}q.__dashjs_factory_name="ProtectionModel_3Feb2014";var W=dashjs.FactoryMaker.getClassFactory(q);function Y(e){e=e||{};var t,r=this.context,n=e.eventBus,i=e.events,o=e.log,s=e.api,u=e.errHandler,c=void 0,l=void 0,d=void 0,f=void 0,p=void 0,h=void 0,y=void 0;function m(e){try{c[s.cancelKeyRequest](l.systemString,e.sessionID)}catch(t){n.trigger(i.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.sessionID+") "+t.message})}}function g(e,t){if(t&&e){for(var r=e.length,n=0;n<r;n++)if(e[n].sessionID==t)return e[n];return null}return null}function v(){c.removeEventListener(s.keyerror,y),c.removeEventListener(s.needkey,y),c.removeEventListener(s.keymessage,y),c.removeEventListener(s.keyadded,y)}return t={getAllInitData:function(){for(var e=[],t=0;t<f.length;t++)e.push(f[t].initData);for(var r=0;r<p.length;r++)e.push(p[r].initData);return e},requestKeySystemAccess:function(e){var t=c;t||(t=document.createElement("video"));for(var r=!1,o=0;o<e.length;o++)for(var s=e[o].ks.systemString,u=e[o].configs,l=null,f=0;f<u.length;f++){var p=u[f].videoCapabilities;if(p&&0!==p.length){l=[];for(var h=0;h<p.length;h++)""!==t.canPlayType(p[h].contentType,s)&&l.push(p[h])}if(l&&(!l||0!==l.length)){r=!0;var y=new a(null,l),m=d.getKeySystemBySystemString(s);n.trigger(i.KEY_SYSTEM_ACCESS_COMPLETE,{data:new V(m,y)});break}}r||n.trigger(i.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return l},selectKeySystem:function(e){l=e.keySystem,n.trigger(i.INTERNAL_KEY_SYSTEM_SELECTED)},setMediaElement:function(e){c!==e&&(c&&v(),(c=e)&&(c.addEventListener(s.keyerror,y),c.addEventListener(s.needkey,y),c.addEventListener(s.keymessage,y),c.addEventListener(s.keyadded,y),n.trigger(i.VIDEO_ELEMENT_SELECTED)))},createKeySession:function(e){if(!l)throw new Error("Can not create sessions until you have selected a key system");if(h||0===p.length){var t={sessionID:null,initData:e,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return f.push(t),c[s.generateKeyRequest](l.systemString,new Uint8Array(e)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){var r=e.sessionID;if(d.isClearKey(l))for(var n=0;n<t.keyPairs.length;n++)c[s.addKey](l.systemString,t.keyPairs[n].key,t.keyPairs[n].keyID,r);else c[s.addKey](l.systemString,new Uint8Array(t),new Uint8Array(e.initData),r)},closeKeySession:m,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},reset:function(){c&&v();for(var e=0;e<p.length;e++)m(p[e]);n.trigger(i.TEARDOWN_COMPLETE)}},c=null,l=null,f=[],p=[],d=M(r).getInstance(),y={handleEvent:function(e){var t=null;switch(e.type){case s.needkey:var r=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;n.trigger(i.NEED_KEY,{key:new U(r,"cenc")});break;case s.keyerror:if((t=g(p,e.sessionId))||(t=g(f,e.sessionId)),t){var a="";switch(e.errorCode.code){case 1:
a+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:a+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:a+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:a+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:a+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:a+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}a+="  System Code = "+e.systemCode,n.trigger(i.KEY_ERROR,{data:new B(t,a)})}else o("No session token found for key error");break;case s.keyadded:(t=g(p,e.sessionId))||(t=g(f,e.sessionId)),t?(o("DRM: Key added."),n.trigger(i.KEY_ADDED,{data:t})):o("No session token found for key added");break;case s.keymessage:if((h=null!==e.sessionId&&void 0!==e.sessionId)?!(t=g(p,e.sessionId))&&f.length>0&&(t=f.shift(),p.push(t),t.sessionID=e.sessionId,n.trigger(i.KEY_SESSION_CREATED,{data:t})):f.length>0&&(t=f.shift(),p.push(t),0!==f.length&&u.mediaKeyMessageError("Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!")),t){var c=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=c,n.trigger(i.INTERNAL_KEY_MESSAGE,{data:new j(t,c,e.defaultURL)})}else o("No session token found for key message")}}},t}Y.__dashjs_factory_name="ProtectionModel_01b";var K=dashjs.FactoryMaker.getClassFactory(Y),Q=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],z=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function Z(){var e=this.context;function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];if("function"==typeof e[n[Object.keys(n)[0]]])return n}return null}return{createProtectionSystem:function(r){var n=null,i=M(e).getInstance();i.setConfig({log:r.log,BASE64:r.BASE64}),i.initialize();var o=function(r){var n=r.log,i=r.eventBus,o=r.errHandler,a=r.videoModel?r.videoModel.getElement():null;return a&&void 0===a.onencrypted||a&&void 0===a.mediaKeys?t(a,z)?(n("EME detected on this user agent! (ProtectionModel_3Feb2014)"),W(e).create({log:n,eventBus:i,events:r.events,api:t(a,z)})):t(a,Q)?(n("EME detected on this user agent! (ProtectionModel_01b)"),K(e).create({log:n,eventBus:i,errHandler:o,events:r.events,api:t(a,Q)})):(n("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(n("EME detected on this user agent! (ProtectionModel_21Jan2015)"),H(e).create({log:n,eventBus:i,events:r.events}))}(r);return!n&&o&&(n=l(e).create({protectionModel:o,protectionKeyController:i,eventBus:r.eventBus,log:r.log,events:r.events,BASE64:r.BASE64,constants:r.constants,ignoreEmeEncryptedEvent:r.ignoreEmeEncryptedEvent}),r.capabilities.setEncryptedMediaSupported(!0)),n}}}Z.__dashjs_factory_name="Protection";var J=dashjs.FactoryMaker.getClassFactory(Z);J.events=F,dashjs.FactoryMaker.updateClassFactory(Z.__dashjs_factory_name,J);var X=J;dashjs.Protection=X,t.default=dashjs}])})();